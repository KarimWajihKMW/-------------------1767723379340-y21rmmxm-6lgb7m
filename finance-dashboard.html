<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ© - Ù†Ø§ÙŠÙˆØ´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .stat-card.green {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
        }
        .stat-card.red {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        .stat-card.blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 1rem;
            transition: border 0.3s;
        }
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 700;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideDown 0.3s ease-out;
        }
        .toast.success { background: #56ab2f; }
        .toast.error { background: #eb3349; }
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 shadow-lg">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold mb-2">ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
            <p class="text-purple-100">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© â€¢ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© â€¢ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
        </div>
    </div>

    <!-- Tabs -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto flex">
            <div class="tab active" onclick="switchTab('overview')">
                <i class="fas fa-chart-line ml-2"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
            </div>
            <div class="tab" onclick="switchTab('operating')">
                <i class="fas fa-shopping-cart ml-2"></i> Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©
            </div>
            <div class="tab" onclick="switchTab('investing')">
                <i class="fas fa-building ml-2"></i> Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©
            </div>
            <div class="tab" onclick="switchTab('financing')">
                <i class="fas fa-hand-holding-usd ml-2"></i> Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©
            </div>
            <div class="tab" onclick="switchTab('forecast')">
                <i class="fas fa-brain ml-2"></i> Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto p-6">

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content">
            <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="stat-card green">
                    <div class="text-sm opacity-90">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ</div>
                    <div class="text-3xl font-bold mt-2" id="operating-net">0 Ø±ÙŠØ§Ù„</div>
                    <div class="text-sm mt-2 opacity-75">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-card red">
                    <div class="text-sm opacity-90">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ</div>
                    <div class="text-3xl font-bold mt-2" id="investing-net">0 Ø±ÙŠØ§Ù„</div>
                    <div class="text-sm mt-2 opacity-75">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-card blue">
                    <div class="text-sm opacity-90">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠ</div>
                    <div class="text-3xl font-bold mt-2" id="financing-net">0 Ø±ÙŠØ§Ù„</div>
                    <div class="text-sm mt-2 opacity-75">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
            </div>

            <!-- Total Net Flow -->
            <div class="card">
                <h3 class="text-xl font-bold mb-4">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ</h3>
                <div class="text-4xl font-bold text-purple-600" id="total-net">0 Ø±ÙŠØ§Ù„</div>
                <div class="mt-4">
                    <canvas id="cashflow-chart"></canvas>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="card">
                <h3 class="text-xl font-bold mb-4">ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                <div id="recent-transactions" class="space-y-2">
                    <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </div>
            </div>
        </div>

        <!-- Operating Cashflow Tab -->
        <div id="operating-tab" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-4">ğŸ”„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Add Operating Flow -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">â• Ø¥Ø¶Ø§ÙØ© ØªØ¯ÙÙ‚ ØªØ´ØºÙŠÙ„ÙŠ</h3>
                    <form id="operating-form" onsubmit="addOperatingFlow(event)">
                        <select class="input-field" id="op-type" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ¯ÙÙ‚</option>
                            <option value="customer_collection">ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„</option>
                            <option value="vendor_payment">Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯</option>
                            <option value="salary_payment">Ø±ÙˆØ§ØªØ¨ Ù…ÙˆØ¸ÙÙŠÙ†</option>
                            <option value="rent_payment">Ø¥ÙŠØ¬Ø§Ø±Ø§Øª</option>
                            <option value="utilities_payment">Ù…Ø±Ø§ÙÙ‚</option>
                        </select>
                        <input type="number" class="input-field" id="op-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <input type="text" class="input-field" id="op-description" placeholder="Ø§Ù„ÙˆØµÙ" required>
                        <input type="date" class="input-field" id="op-date" required>
                        <button type="submit" class="btn btn-success w-full">
                            <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </form>
                </div>

                <!-- Operating Summary -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h3>
                    <div id="operating-summary" class="space-y-3">
                        <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>

            <!-- Operating List -->
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h3>
                <div id="operating-list" class="overflow-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th class="p-3 text-right">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th class="p-3 text-right">Ø§Ù„ÙˆØµÙ</th>
                                <th class="p-3 text-right">Ø¯Ø§Ø®Ù„</th>
                                <th class="p-3 text-right">Ø®Ø§Ø±Ø¬</th>
                            </tr>
                        </thead>
                        <tbody id="operating-tbody">
                            <tr><td colspan="5" class="text-center p-4 text-gray-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Investing Cashflow Tab -->
        <div id="investing-tab" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-4">ğŸ¢ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Add Investing Flow -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">â• Ø¥Ø¶Ø§ÙØ© ØªØ¯ÙÙ‚ Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ</h3>
                    <form id="investing-form" onsubmit="addInvestingFlow(event)">
                        <select class="input-field" id="inv-type" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ¯ÙÙ‚</option>
                            <option value="asset_purchase">Ø´Ø±Ø§Ø¡ Ø£ØµÙ„</option>
                            <option value="asset_sale">Ø¨ÙŠØ¹ Ø£ØµÙ„</option>
                            <option value="platform_investment">Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ù…Ù†ØµØ©</option>
                            <option value="equipment_purchase">Ø´Ø±Ø§Ø¡ Ù…Ø¹Ø¯Ø§Øª</option>
                        </select>
                        <input type="number" class="input-field" id="inv-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <input type="text" class="input-field" id="inv-description" placeholder="Ø§Ù„ÙˆØµÙ" required>
                        <input type="date" class="input-field" id="inv-date" required>
                        <button type="submit" class="btn btn-success w-full">
                            <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </form>
                </div>

                <!-- Investing Summary -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©</h3>
                    <div id="investing-summary" class="space-y-3">
                        <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>

            <!-- Investing List -->
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©</h3>
                <div id="investing-list" class="overflow-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th class="p-3 text-right">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th class="p-3 text-right">Ø§Ù„ÙˆØµÙ</th>
                                <th class="p-3 text-right">Ø¯Ø§Ø®Ù„</th>
                                <th class="p-3 text-right">Ø®Ø§Ø±Ø¬</th>
                            </tr>
                        </thead>
                        <tbody id="investing-tbody">
                            <tr><td colspan="5" class="text-center p-4 text-gray-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Financing Cashflow Tab -->
        <div id="financing-tab" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-4">ğŸ’µ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Add Financing Flow -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">â• Ø¥Ø¶Ø§ÙØ© ØªØ¯ÙÙ‚ ØªÙ…ÙˆÙŠÙ„ÙŠ</h3>
                    <form id="financing-form" onsubmit="addFinancingFlow(event)">
                        <select class="input-field" id="fin-type" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ¯ÙÙ‚</option>
                            <option value="bank_loan">Ù‚Ø±Ø¶ Ù…Ù† Ø¨Ù†Ùƒ</option>
                            <option value="loan_repayment">Ø³Ø¯Ø§Ø¯ Ù‚Ø±Ø¶</option>
                            <option value="capital_increase">Ø²ÙŠØ§Ø¯Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„</option>
                            <option value="dividend_payment">ØªÙˆØ²ÙŠØ¹ Ø£Ø±Ø¨Ø§Ø­</option>
                        </select>
                        <input type="number" class="input-field" id="fin-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <input type="text" class="input-field" id="fin-description" placeholder="Ø§Ù„ÙˆØµÙ" required>
                        <input type="date" class="input-field" id="fin-date" required>
                        <button type="submit" class="btn btn-success w-full">
                            <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </form>
                </div>

                <!-- Financing Summary -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h3>
                    <div id="financing-summary" class="space-y-3">
                        <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>

            <!-- Financing List -->
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h3>
                <div id="financing-list" class="overflow-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th class="p-3 text-right">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th class="p-3 text-right">Ø§Ù„ÙˆØµÙ</th>
                                <th class="p-3 text-right">Ø¯Ø§Ø®Ù„</th>
                                <th class="p-3 text-right">Ø®Ø§Ø±Ø¬</th>
                            </tr>
                        </thead>
                        <tbody id="financing-tbody">
                            <tr><td colspan="5" class="text-center p-4 text-gray-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- AI Forecast Tab -->
        <div id="forecast-tab" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-4">ğŸ¤– Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Create Forecast -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">â• Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</h3>
                    <form id="forecast-form" onsubmit="addForecast(event)">
                        <select class="input-field" id="fc-type" required>
                            <option value="">Ù†ÙˆØ¹ Ø§Ù„ØªÙˆÙ‚Ø¹</option>
                            <option value="surplus">ÙØ§Ø¦Ø¶ Ù†Ù‚Ø¯ÙŠ</option>
                            <option value="deficit">Ø¹Ø¬Ø² Ù†Ù‚Ø¯ÙŠ</option>
                        </select>
                        <input type="date" class="input-field" id="fc-date" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙ‚Ø¹" required>
                        <input type="number" class="input-field" id="fc-amount" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <input type="number" class="input-field" id="fc-confidence" placeholder="Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø© %" required min="0" max="100" step="0.1">
                        <input type="number" class="input-field" id="fc-lower" placeholder="Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <input type="number" class="input-field" id="fc-upper" placeholder="Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø±ÙŠØ§Ù„)" required step="0.01">
                        <textarea class="input-field" id="fc-factors" placeholder="Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© (JSON)" rows="3">[]</textarea>
                        <button type="submit" class="btn btn-primary w-full">
                            <i class="fas fa-brain ml-2"></i> Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆÙ‚Ø¹
                        </button>
                    </form>
                </div>

                <!-- Forecast Stats -->
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h3>
                    <div id="forecast-stats" class="space-y-3">
                        <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>

            <!-- Forecasts List -->
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">ğŸ”® Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h3>
                <div id="forecast-list" class="space-y-3">
                    <div class="text-gray-500 text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        const ENTITY_ID = 1; // Default entity
        let cashflowChart = null;

        // Switch Tabs
        function switchTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

            // Show selected tab
            document.getElementById(`${tab}-tab`).classList.remove('hidden');
            event.target.closest('.tab').classList.add('active');

            // Load data for the tab
            if (tab === 'overview') loadOverview();
            else if (tab === 'operating') loadOperating();
            else if (tab === 'investing') loadInvesting();
            else if (tab === 'financing') loadFinancing();
            else if (tab === 'forecast') loadForecasts();
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} ml-2"></i> ${message}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Format Number
        function formatMoney(amount) {
            return new Intl.NumberFormat('ar-SA', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount) + ' Ø±ÙŠØ§Ù„';
        }

        // Load Overview
        async function loadOverview() {
            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/comprehensive?entity_id=${ENTITY_ID}`);
                const data = await res.json();

                document.getElementById('operating-net').textContent = formatMoney(data.operating.net_flow);
                document.getElementById('investing-net').textContent = formatMoney(data.investing.net_flow);
                document.getElementById('financing-net').textContent = formatMoney(data.financing.net_flow);
                document.getElementById('total-net').textContent = formatMoney(data.total_net_cashflow);

                // Update Chart
                updateChart([
                    data.operating.net_flow,
                    data.investing.net_flow,
                    data.financing.net_flow
                ]);
            } catch (error) {
                console.error('Error loading overview:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }

        // Update Chart
        function updateChart(data) {
            const ctx = document.getElementById('cashflow-chart');
            if (cashflowChart) cashflowChart.destroy();

            cashflowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ', 'Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ', 'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠ'],
                    datasets: [{
                        label: 'ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ (Ø±ÙŠØ§Ù„)',
                        data: data,
                        backgroundColor: [
                            'rgba(86, 171, 47, 0.7)',
                            'rgba(235, 51, 73, 0.7)',
                            'rgba(79, 172, 254, 0.7)'
                        ],
                        borderColor: [
                            'rgb(86, 171, 47)',
                            'rgb(235, 51, 73)',
                            'rgb(79, 172, 254)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Add Operating Flow
        async function addOperatingFlow(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/operating`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        entity_id: ENTITY_ID,
                        flow_type: document.getElementById('op-type').value,
                        amount: parseFloat(document.getElementById('op-amount').value),
                        description: document.getElementById('op-description').value,
                        flow_date: document.getElementById('op-date').value
                    })
                });

                if (res.ok) {
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¯ÙÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
                    e.target.reset();
                    loadOperating();
                } else {
                    throw new Error('Failed to add');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©';
            }
        }

        // Load Operating
        async function loadOperating() {
            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/operating?entity_id=${ENTITY_ID}`);
                const data = await res.json();

                // Summary
                document.getElementById('operating-summary').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„</div>
                        <div class="text-2xl font-bold text-green-600">${formatMoney(data.summary.inflow)}</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø®Ø§Ø±Ø¬</div>
                        <div class="text-2xl font-bold text-red-600">${formatMoney(data.summary.outflow)}</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚</div>
                        <div class="text-2xl font-bold text-blue-600">${formatMoney(data.summary.net_flow)}</div>
                    </div>
                `;

                // List
                const tbody = document.getElementById('operating-tbody');
                if (data.flows.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</td></tr>';
                } else {
                    tbody.innerHTML = data.flows.map(f => `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-3">${new Date(f.flow_date).toLocaleDateString('ar-SA')}</td>
                            <td class="p-3">${getFlowTypeLabel(f.flow_type)}</td>
                            <td class="p-3">${f.description}</td>
                            <td class="p-3 text-green-600">${f.inflow_amount > 0 ? formatMoney(f.inflow_amount) : '-'}</td>
                            <td class="p-3 text-red-600">${f.outflow_amount > 0 ? formatMoney(f.outflow_amount) : '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading operating:', error);
            }
        }

        // Add Investing Flow
        async function addInvestingFlow(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/investing`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        entity_id: ENTITY_ID,
                        flow_type: document.getElementById('inv-type').value,
                        amount: parseFloat(document.getElementById('inv-amount').value),
                        description: document.getElementById('inv-description').value,
                        flow_date: document.getElementById('inv-date').value
                    })
                });

                if (res.ok) {
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¯ÙÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
                    e.target.reset();
                    loadInvesting();
                } else {
                    throw new Error('Failed');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©';
            }
        }

        // Load Investing
        async function loadInvesting() {
            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/investing?entity_id=${ENTITY_ID}`);
                const data = await res.json();

                document.getElementById('investing-summary').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„</div>
                        <div class="text-2xl font-bold text-green-600">${formatMoney(data.summary.inflow)}</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø®Ø§Ø±Ø¬</div>
                        <div class="text-2xl font-bold text-red-600">${formatMoney(data.summary.outflow)}</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚</div>
                        <div class="text-2xl font-bold text-blue-600">${formatMoney(data.summary.net_flow)}</div>
                    </div>
                `;

                const tbody = document.getElementById('investing-tbody');
                if (data.flows.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</td></tr>';
                } else {
                    tbody.innerHTML = data.flows.map(f => `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-3">${new Date(f.flow_date).toLocaleDateString('ar-SA')}</td>
                            <td class="p-3">${getFlowTypeLabel(f.flow_type)}</td>
                            <td class="p-3">${f.description}</td>
                            <td class="p-3 text-green-600">${f.inflow_amount > 0 ? formatMoney(f.inflow_amount) : '-'}</td>
                            <td class="p-3 text-red-600">${f.outflow_amount > 0 ? formatMoney(f.outflow_amount) : '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Add Financing Flow
        async function addFinancingFlow(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/financing`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        entity_id: ENTITY_ID,
                        flow_type: document.getElementById('fin-type').value,
                        amount: parseFloat(document.getElementById('fin-amount').value),
                        description: document.getElementById('fin-description').value,
                        flow_date: document.getElementById('fin-date').value
                    })
                });

                if (res.ok) {
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¯ÙÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
                    e.target.reset();
                    loadFinancing();
                } else {
                    throw new Error('Failed');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©';
            }
        }

        // Load Financing
        async function loadFinancing() {
            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/financing?entity_id=${ENTITY_ID}`);
                const data = await res.json();

                document.getElementById('financing-summary').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„</div>
                        <div class="text-2xl font-bold text-green-600">${formatMoney(data.summary.inflow)}</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø®Ø§Ø±Ø¬</div>
                        <div class="text-2xl font-bold text-red-600">${formatMoney(data.summary.outflow)}</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚</div>
                        <div class="text-2xl font-bold text-blue-600">${formatMoney(data.summary.net_flow)}</div>
                    </div>
                `;

                const tbody = document.getElementById('financing-tbody');
                if (data.flows.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</td></tr>';
                } else {
                    tbody.innerHTML = data.flows.map(f => `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-3">${new Date(f.flow_date).toLocaleDateString('ar-SA')}</td>
                            <td class="p-3">${getFlowTypeLabel(f.flow_type)}</td>
                            <td class="p-3">${f.description}</td>
                            <td class="p-3 text-green-600">${f.inflow_amount > 0 ? formatMoney(f.inflow_amount) : '-'}</td>
                            <td class="p-3 text-red-600">${f.outflow_amount > 0 ? formatMoney(f.outflow_amount) : '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Add Forecast
        async function addForecast(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/forecast`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        entity_id: ENTITY_ID,
                        forecast_type: document.getElementById('fc-type').value,
                        forecast_date: document.getElementById('fc-date').value,
                        predicted_amount: parseFloat(document.getElementById('fc-amount').value),
                        confidence_level: parseFloat(document.getElementById('fc-confidence').value),
                        lower_bound: parseFloat(document.getElementById('fc-lower').value),
                        upper_bound: parseFloat(document.getElementById('fc-upper').value),
                        influencing_factors: JSON.parse(document.getElementById('fc-factors').value)
                    })
                });

                if (res.ok) {
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
                    e.target.reset();
                    loadForecasts();
                } else {
                    throw new Error('Failed');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-brain ml-2"></i> Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆÙ‚Ø¹';
            }
        }

        // Load Forecasts
        async function loadForecasts() {
            try {
                const res = await fetch(`${API_BASE}/finance/cashflow/forecast?entity_id=${ENTITY_ID}`);
                const data = await res.json();

                document.getElementById('forecast-stats').innerHTML = `
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</div>
                        <div class="text-2xl font-bold text-purple-600">${data.forecasts.length}</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„ÙØ§Ø¦Ø¶</div>
                        <div class="text-2xl font-bold text-green-600">${data.forecasts.filter(f => f.forecast_type === 'surplus').length}</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø¹Ø¬Ø²</div>
                        <div class="text-2xl font-bold text-red-600">${data.forecasts.filter(f => f.forecast_type === 'deficit').length}</div>
                    </div>
                `;

                const list = document.getElementById('forecast-list');
                if (data.forecasts.length === 0) {
                    list.innerHTML = '<div class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙ‚Ø¹Ø§Øª</div>';
                } else {
                    list.innerHTML = data.forecasts.map(f => `
                        <div class="bg-${f.forecast_type === 'surplus' ? 'green' : 'red'}-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-bold text-lg">${f.forecast_type === 'surplus' ? 'ğŸ“ˆ ÙØ§Ø¦Ø¶' : 'ğŸ“‰ Ø¹Ø¬Ø²'} Ù…ØªÙˆÙ‚Ø¹</div>
                                    <div class="text-sm text-gray-600">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(f.forecast_date).toLocaleDateString('ar-SA')}</div>
                                </div>
                                <div class="text-left">
                                    <div class="text-2xl font-bold">${formatMoney(f.predicted_amount)}</div>
                                    <div class="text-sm">Ø«Ù‚Ø©: ${f.confidence_level}%</div>
                                </div>
                            </div>
                            <div class="mt-2 text-sm text-gray-600">
                                Ø§Ù„Ù†Ø·Ø§Ù‚: ${formatMoney(f.lower_bound)} - ${formatMoney(f.upper_bound)}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Get Flow Type Label
        function getFlowTypeLabel(type) {
            const labels = {
                customer_collection: 'ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„',
                vendor_payment: 'Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯',
                salary_payment: 'Ø±ÙˆØ§ØªØ¨',
                rent_payment: 'Ø¥ÙŠØ¬Ø§Ø±',
                utilities_payment: 'Ù…Ø±Ø§ÙÙ‚',
                asset_purchase: 'Ø´Ø±Ø§Ø¡ Ø£ØµÙ„',
                asset_sale: 'Ø¨ÙŠØ¹ Ø£ØµÙ„',
                platform_investment: 'Ø§Ø³ØªØ«Ù…Ø§Ø± Ù…Ù†ØµØ©',
                equipment_purchase: 'Ø´Ø±Ø§Ø¡ Ù…Ø¹Ø¯Ø§Øª',
                bank_loan: 'Ù‚Ø±Ø¶ Ø¨Ù†ÙƒÙŠ',
                loan_repayment: 'Ø³Ø¯Ø§Ø¯ Ù‚Ø±Ø¶',
                capital_increase: 'Ø²ÙŠØ§Ø¯Ø© Ø±Ø£Ø³ Ù…Ø§Ù„',
                dividend_payment: 'ØªÙˆØ²ÙŠØ¹ Ø£Ø±Ø¨Ø§Ø­'
            };
            return labels[type] || type;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('op-date').value = today;
            document.getElementById('inv-date').value = today;
            document.getElementById('fin-date').value = today;
            document.getElementById('fc-date').value = today;

            // Load overview
            loadOverview();
        });
    </script>

</body>
</html>
