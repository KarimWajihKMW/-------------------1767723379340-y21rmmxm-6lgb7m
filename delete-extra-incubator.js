const { Pool } = require('pg');

const pool = new Pool({
  connectionString: 'postgresql://postgres:PddzJpAQYezqknsntSzmCUlQYuYJldcT@crossover.proxy.rlwy.net:44255/railway',
  ssl: { rejectUnauthorized: false }
});

const req = ['التعليم والتعلم','التدريب والشهادات الإحترافية','التسويق الرقمي','نادي بيتا الرقمي','الإعتمادات الدولية','الإعتمادات المحلية','الحياة الرقمية','المنضمات والجمعيات المحلية','المنضمات والجمعيات الدولية','المدن الصناعية','الشعر والأدب','الغرف الصناعية','العرف التجارية','النقابات','الإيتيكيت','عالم الأعمال','الرياضة واللياقة','الطعام والشراب','المطابخ السحابية','المطابخ والولائم','مطاعم متنقلة','شقق مفروشة','الفنادق','المجمعات السنكية','شليهات','نوادي رياضية','نوادي ليلية','السياحة والترفيه','المرافق','المولات ومجمعات التسوق','الكافيهات','الترفيه','التصميم الداخلي','تصميم جرافيك','الإنشاءات','الديكورات','مواد البناء','مواد الديكو','مقاولات عامة','طاقة','الصحة والجمال','فريلانسر استشارات زتدريب','المبادرات','رعاية الحيوانات وتربيتها','خدمة العملاء','الموارد البشرية','المالية والمحاسبة والضريبة','التحصيل','الرعاية الصحية','صيدليات','التغذية والجيم','القانونية والإستشارات','الإستشارات والبحوث','الإستشارات النفسية','الإستشارات الطبية والعيادات','الصناعات والمدن الصناعية','الجودة الشاملة والأيزو','السلامة والصحة المهنية','الأمن الصناعي والغذائي','الحراسات الأمنية','معارض السيارات','معارض المعدات','معارض الأدوات','مستلزمات المنزل','النقل','التوصيل','الخدمات اللوجستية','الخضروات والفاكهة','العطارة','أثاث وأجهزة منزلية ومكتبية','الحلويات والعصائر','محامص ومكسرات','الورد والزينة','الملابس والأحذية','الأعراس والحفلات','مغاسل السيارات','مكتانيكا وكهرباء سيارات','كمبيوترات وصيانة','تحف و إكسسوارات','مجوهرات','تصفيات','كل شي مستعمل','عيادات ومراكز طبية','عيادات بيطرية','اعلاف واغذية للحيوانات','سجاد وموكيت','سلاسل الإمداد','محطات وقود وغسيل سيارات','جامعات ومعاهد ومراكز','تجهيزات كطابخ صناعية','أجهزة وملابس رياضية','معاصر زيتون','موزعي مواد غذائية','مطابع ومستلزماتها','إكسسوارات ةزينة سيارات','قرطاسية واوازم مدرسية','مدارس خاصة','جوالات وإكسسواراتها','اتصالات','خردوات وكل شي مستعمل'];

pool.query('SELECT id, name FROM entities WHERE type = \'INCUBATOR\' ORDER BY name').then(async r => {
  const cur = r.rows;
  const extras = cur.filter(c => !req.includes(c.name));
  
  console.log('الحاضنات الزائدة:', extras.length);
  for (const e of extras) {
    console.log('  - ' + e.name + ' (ID: ' + e.id + ')');
    await pool.query('DELETE FROM entities WHERE id = $1', [e.id]);
    console.log('    ✓ تم الحذف');
  }
  
  await pool.end();
});
