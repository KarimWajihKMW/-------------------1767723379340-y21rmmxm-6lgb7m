#!/bin/bash

# ุฃููุงู ููุทุจุงุนุฉ
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "================================================"
echo "๐งช ุงุฎุชุจุงุฑ ููุงุฆู ุดุงูู ูุจู ุงููุดุฑ"
echo "================================================"
echo ""

# 1. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "1๏ธโฃ  ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช..."
node test-super-admin-connection.js > /tmp/db-test.log 2>&1
if [ $? -eq 0 ]; then
    echo -e "${GREEN}โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฌุญ${NC}"
else
    echo -e "${RED}โ ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช${NC}"
    cat /tmp/db-test.log
    exit 1
fi
echo ""

# 2. ุงูุชุญูู ูู ูููุงุช ุงูุณูุฑูุฑ
echo "2๏ธโฃ  ุงูุชุญูู ูู ูููุงุช ุงูุณูุฑูุฑ..."
if [ -f "server.js" ] && [ -f "super-admin-api.js" ]; then
    echo -e "${GREEN}โ ุฌููุน ุงููููุงุช ุงููุทููุจุฉ ููุฌูุฏุฉ${NC}"
else
    echo -e "${RED}โ ูููุงุช ููููุฏุฉ${NC}"
    exit 1
fi
echo ""

# 3. ุงูุชุญูู ูู ุฑุจุท API
echo "3๏ธโฃ  ุงูุชุญูู ูู ุฑุจุท Super Admin API..."
if grep -q "super-admin-api" server.js; then
    echo -e "${GREEN}โ Super Admin API ููุตูู ุจู server.js${NC}"
else
    echo -e "${RED}โ Super Admin API ุบูุฑ ููุตูู${NC}"
    exit 1
fi
echo ""

# 4. ุงุฎุชุจุงุฑ ุงูุจูุงุก
echo "4๏ธโฃ  ุงุฎุชุจุงุฑ ุงูุจูุงุก (npm test)..."
npm test > /tmp/npm-test.log 2>&1
if [ $? -eq 0 ]; then
    echo -e "${GREEN}โ ุงุฎุชุจุงุฑ ุงูุจูุงุก ูุงุฌุญ${NC}"
else
    echo -e "${YELLOW}โ๏ธ  ุชุญุฐูุฑ ูู ุงุฎุชุจุงุฑ ุงูุจูุงุก (ูุฏ ูููู ุทุจูุนูุงู)${NC}"
fi
echo ""

# 5. ุงูุชุญูู ูู Git
echo "5๏ธโฃ  ุงูุชุญูู ูู ุญุงูุฉ Git..."
git status --short > /tmp/git-status.log
if [ -s /tmp/git-status.log ]; then
    echo -e "${YELLOW}โ๏ธ  ููุฌุฏ ุชุบููุฑุงุช ุบูุฑ ูุญููุธุฉ:${NC}"
    cat /tmp/git-status.log
else
    echo -e "${GREEN}โ ุฌููุน ุงูุชุบููุฑุงุช ูุญููุธุฉ ูู Git${NC}"
fi
echo ""

# 6. ุนุฑุถ ููุฎุต
echo "================================================"
echo "๐ ููุฎุต ุงูุงุฎุชุจุงุฑุงุช"
echo "================================================"
echo ""
echo "โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช: ูุงุฌุญ"
echo "โ ูููุงุช ุงูุณูุฑูุฑ: ููุฌูุฏุฉ"
echo "โ Super Admin API: ููุตูู"
echo "โ ุงุฎุชุจุงุฑ ุงูุจูุงุก: ููุชูู"
echo "โ Git: ุฌุงูุฒ"
echo ""
echo -e "${GREEN}๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุงูุชููุช ุจูุฌุงุญ!${NC}"
echo ""
echo "================================================"
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ูููุดุฑ ุนูู Railway:"
echo "================================================"
echo ""
echo "1. ุชุฃูุฏ ูู ุฃู ุงูุชุบููุฑุงุช ูุฏููุนุฉ ุฅูู main branch:"
echo "   git push origin main"
echo ""
echo "2. ุจุนุฏ ุงููุดุฑ ุนูู Railwayุ ูู ุจุชุดุบูู:"
echo "   node assign-super-admin-role.js"
echo ""
echo "3. ุงุฎุชุจุฑ ุงูุตูุญุฉ:"
echo "   https://super-cmk2wuy9-production.up.railway.app/super-admin-page.html"
echo ""
echo "================================================"
