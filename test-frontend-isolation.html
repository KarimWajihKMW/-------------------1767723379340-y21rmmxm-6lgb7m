<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Frontend</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Frontend</h1>
    
    <div class="test-section">
        <h2>1ï¸âƒ£ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙŠØ§Ù†</h2>
        <button class="btn btn-primary" onclick="selectEntity('HQ001', 'HQ')">ğŸ›ï¸ HQ001 (Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)</button>
        <button class="btn btn-success" onclick="selectEntity('BR015', 'BRANCH')">ğŸª BR015 (ÙØ±Ø¹ Ø§Ù„Ø¹Ù„ÙŠØ§ Ù…ÙˆÙ„)</button>
        <button class="btn btn-danger" onclick="clearEntity()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="currentEntity" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± API Endpoints</h2>
        <button class="btn btn-primary" onclick="testEmployees()">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
        <button class="btn btn-primary" onclick="testInvoices()">ğŸ’° Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
        <button class="btn btn-primary" onclick="testAds()">ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>
        <button class="btn btn-success" onclick="testAll()">âœ¨ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„</button>
        <div id="apiResults" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>3ï¸âƒ£ ÙØ­Øµ window.currentUserData</h2>
        <button class="btn btn-primary" onclick="checkWindowData()">ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="windowData" class="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        function log(msg, type = 'info') {
            const colors = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            console.log(`${colors[type]} ${msg}`);
        }
        
        function selectEntity(entityId, entityType) {
            window.currentUserData = {
                id: 1,
                name: entityId === 'HQ001' ? 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ù…Ø³Ø¤ÙˆÙ„' : 'ÙØ±Ø¹ Ø§Ù„Ø¹Ù„ÙŠØ§ Ù…ÙˆÙ„ - Ù…Ø³Ø¤ÙˆÙ„',
                role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',
                tenantType: entityType,
                entityId: entityId,
                entityName: entityId === 'HQ001' ? 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' : 'ÙØ±Ø¹ Ø§Ù„Ø¹Ù„ÙŠØ§ Ù…ÙˆÙ„'
            };
            
            const display = document.getElementById('currentEntity');
            display.innerHTML = `<span class="success">âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙŠØ§Ù†:</span>\n${JSON.stringify(window.currentUserData, null, 2)}`;
            log(`Selected entity: ${entityId}`, 'success');
        }
        
        function clearEntity() {
            window.currentUserData = null;
            document.getElementById('currentEntity').innerHTML = '<span class="warning">âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙŠØ§Ù† Ù…Ø­Ø¯Ø¯</span>';
            log('Entity cleared', 'warning');
        }
        
        async function fetchWithHeaders(endpoint) {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (window.currentUserData) {
                headers['x-entity-type'] = window.currentUserData.tenantType;
                headers['x-entity-id'] = window.currentUserData.entityId;
            }
            
            log(`Fetching ${endpoint} with headers: ${JSON.stringify(headers)}`, 'info');
            
            const response = await fetch(`${API_BASE}${endpoint}`, { headers });
            const data = await response.json();
            return data;
        }
        
        async function testEmployees() {
            try {
                const data = await fetchWithHeaders('/employees');
                const result = document.getElementById('apiResults');
                result.innerHTML = `<span class="success">âœ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (${data.length}):</span>\n${JSON.stringify(data.map(e => ({id: e.id, name: e.full_name, entity: e.entity_id})), null, 2)}`;
                log(`Employees: ${data.length}`, 'success');
            } catch (error) {
                document.getElementById('apiResults').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                log(`Error: ${error.message}`, 'error');
            }
        }
        
        async function testInvoices() {
            try {
                const data = await fetchWithHeaders('/invoices');
                const result = document.getElementById('apiResults');
                result.innerHTML = `<span class="success">âœ… Ø§Ù„ÙÙˆØ§ØªÙŠØ± (${data.length}):</span>\n${JSON.stringify(data.map(i => ({id: i.id, title: i.title, entity: i.entity_id})), null, 2)}`;
                log(`Invoices: ${data.length}`, 'success');
            } catch (error) {
                document.getElementById('apiResults').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                log(`Error: ${error.message}`, 'error');
            }
        }
        
        async function testAds() {
            try {
                const data = await fetchWithHeaders('/ads');
                const result = document.getElementById('apiResults');
                result.innerHTML = `<span class="success">âœ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${data.length}):</span>\n${JSON.stringify(data.map(a => ({id: a.id, title: a.title, entity: a.entity_id})), null, 2)}`;
                log(`Ads: ${data.length}`, 'success');
            } catch (error) {
                document.getElementById('apiResults').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                log(`Error: ${error.message}`, 'error');
            }
        }
        
        async function testAll() {
            const results = {};
            try {
                results.employees = await fetchWithHeaders('/employees');
                results.invoices = await fetchWithHeaders('/invoices');
                results.ads = await fetchWithHeaders('/ads');
                
                const summary = `
<span class="success">âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„:</span>
ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†: ${results.employees.length}
ğŸ’° Ø§Ù„ÙÙˆØ§ØªÙŠØ±: ${results.invoices.length}
ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª: ${results.ads.length}

Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${window.currentUserData ? window.currentUserData.entityId : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                `;
                
                document.getElementById('apiResults').innerHTML = summary;
                log(`Test complete - Employees: ${results.employees.length}, Invoices: ${results.invoices.length}, Ads: ${results.ads.length}`, 'success');
            } catch (error) {
                document.getElementById('apiResults').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                log(`Error: ${error.message}`, 'error');
            }
        }
        
        function checkWindowData() {
            const display = document.getElementById('windowData');
            if (window.currentUserData) {
                display.innerHTML = `<span class="success">âœ… window.currentUserData Ù…ÙˆØ¬ÙˆØ¯Ø©:</span>\n${JSON.stringify(window.currentUserData, null, 2)}`;
            } else {
                display.innerHTML = '<span class="error">âŒ window.currentUserData ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!</span>';
            }
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            checkWindowData();
            log('Test page loaded', 'info');
        });
    </script>
</body>
</html>
