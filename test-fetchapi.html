<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>اختبار إدارة الموظفين</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto bg-white rounded-lg p-6">
        <h1 class="text-2xl font-bold mb-4">اختبار fetchAPI</h1>
        <button onclick="testFetchAPI()" class="bg-blue-500 text-white px-4 py-2 rounded">
            اختبار تحميل الموظفين
        </button>
        <div id="result" class="mt-4 p-3 bg-gray-50 rounded"></div>
    </div>

    <script>
        // تعريف API_BASE_URL
        const API_BASE_URL = 'http://localhost:3000/api';
        
        // تعريف fetchAPI العام
        window.fetchAPI = async function(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        };

        async function testFetchAPI() {
            const resultDiv = document.getElementById('result');
            try {
                resultDiv.innerHTML = '<div class="text-blue-600">جاري التحميل...</div>';
                
                const employees = await window.fetchAPI('/employees');
                
                resultDiv.innerHTML = `
                    <div class="text-green-600 font-bold">✅ نجح!</div>
                    <div class="mt-2">تم تحميل ${employees.length} موظف</div>
                    <div class="mt-2 text-sm">
                        أول موظف: ${employees[0]?.full_name || 'غير متاح'}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="text-red-600 font-bold">❌ خطأ!</div>
                    <div class="mt-2 text-sm">${error.message}</div>
                `;
            }
        }
    </script>
</body>
</html>