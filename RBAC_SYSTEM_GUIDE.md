# ูุธุงู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช ูุงูุญูููุฉ ูุณุฌู ุงููุฑุงุฌุนุงุช
## RBAC System + Governance + Audit Log

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ููุชุญูู ูู ุงูุตูุงุญูุงุช ูุงูุญูููุฉ ูุชุณุฌูู ุงูุนูููุงุช

---

## ๐ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1๏ธโฃ **ุงูุฃุฏูุงุฑ (Roles)**
ูุธุงู ุงูุฃุฏูุงุฑ ุงููุธูููุฉ ูู ุงููุดุฑูุน:

| ุงูุฏูุฑ | ุงูุงุณู ุจุงูุนุฑุจูุฉ | ุงููุณุชูู | ุงููุตู |
|------|----------------|---------|-------|
| `SUPER_ADMIN` | ูุฏูุฑ ุงููุธุงู ุงูุฑุฆูุณู | HQ | ุตูุงุญูุงุช ูุงููุฉ ุนูู ุงููุธุงู ุจุงููุงูู |
| `HQ_ADMIN` | ูุฏูุฑ ุงูููุชุจ ุงูุฑุฆูุณู | HQ | ุฅุฏุงุฑุฉ ุงูููุชุจ ุงูุฑุฆูุณู |
| `BRANCH_ADMIN` | ูุฏูุฑ ุงููุฑุน | BRANCH | ุฅุฏุงุฑุฉ ูุฑุน ูุนูู |
| `INCUBATOR_ADMIN` | ูุฏูุฑ ุงูุญุงุถูุฉ | INCUBATOR | ุฅุฏุงุฑุฉ ุญุงุถูุฉ ูุนููุฉ |
| `PLATFORM_ADMIN` | ูุฏูุฑ ุงูููุตุฉ | PLATFORM | ุฅุฏุงุฑุฉ ููุตุฉ ูุนููุฉ |
| `OFFICE_ADMIN` | ูุฏูุฑ ุงูููุชุจ | OFFICE | ุฅุฏุงุฑุฉ ููุชุจ ูุนูู |
| `MANAGER` | ูุฏูุฑ | ALL | ูุฏูุฑ ุนุงู |
| `ACCOUNTANT` | ูุญุงุณุจ | ALL | ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช ูุงูููุงุชูุฑ |
| `HR_MANAGER` | ูุฏูุฑ ููุงุฑุฏ ุจุดุฑูุฉ | ALL | ุฅุฏุงุฑุฉ ุงูููุธููู ูุงูุทูุจุงุช |
| `EMPLOYEE` | ููุธู | ALL | ููุธู ุนุงุฏู |
| `AUDITOR` | ูุฏูู | ALL | ูุฑุงุฌุนุฉ ุงูุนูููุงุช ููุท |
| `VIEWER` | ูุดุงูุฏ | ALL | ุนุฑุถ ุงูุจูุงูุงุช ููุท |

**ุฅุฌูุงูู:** 12 ุฏูุฑ

---

### 2๏ธโฃ **ุงูุตูุงุญูุงุช (Permissions)**
ุงูุตูุงุญูุงุช ููุฒุนุฉ ุญุณุจ ุงูููุงุฑุฏ:

#### Users (ุงููุณุชุฎุฏููู)
- `users.create` - ุฅูุดุงุก ูุณุชุฎุฏู
- `users.read` - ุนุฑุถ ุงููุณุชุฎุฏููู
- `users.update` - ุชุนุฏูู ูุณุชุฎุฏู
- `users.delete` - ุญุฐู ูุณุชุฎุฏู

#### Entities (ุงูููุงูุงุช)
- `entities.create` - ุฅูุดุงุก ููุงู
- `entities.read` - ุนุฑุถ ุงูููุงูุงุช
- `entities.update` - ุชุนุฏูู ููุงู
- `entities.delete` - ุญุฐู ููุงู

#### Invoices (ุงูููุงุชูุฑ)
- `invoices.create` - ุฅูุดุงุก ูุงุชูุฑุฉ
- `invoices.read` - ุนุฑุถ ุงูููุงุชูุฑ
- `invoices.update` - ุชุนุฏูู ูุงุชูุฑุฉ
- `invoices.delete` - ุญุฐู ูุงุชูุฑุฉ
- `invoices.approve` - ุงูููุงููุฉ ุนูู ูุงุชูุฑุฉ

#### Transactions (ุงููุนุงููุงุช ุงููุงููุฉ)
- `transactions.create` - ุฅูุดุงุก ูุนุงููุฉ
- `transactions.read` - ุนุฑุถ ุงููุนุงููุงุช
- `transactions.approve` - ุงูููุงููุฉ ุนูู ูุนุงููุฉ

#### Employees (ุงูููุธููู)
- `employees.create` - ุฅูุดุงุก ููุธู
- `employees.read` - ุนุฑุถ ุงูููุธููู
- `employees.update` - ุชุนุฏูู ููุธู
- `employees.delete` - ุญุฐู ููุธู

#### Reports (ุงูุชูุงุฑูุฑ)
- `reports.read` - ุนุฑุถ ุงูุชูุงุฑูุฑ
- `reports.export` - ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ

#### System (ุงููุธุงู)
- `audit.read` - ุนุฑุถ ุณุฌู ุงููุฑุงุฌุนุงุช
- `settings.read` - ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช
- `settings.update` - ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช
- `roles.manage` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
- `permissions.manage` - ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช

**ุฅุฌูุงูู:** 27 ุตูุงุญูุฉ

---

### 3๏ธโฃ **ููุงุนุฏ ุงูุญูููุฉ (Governance Rules)**

#### ุงููุงุนุฏุฉ 1: ุงูููุงููุฉ ุนูู ุงูููุงุชูุฑ ุฃูุจุฑ ูู 10,000 ุฑูุงู
- **ุงูุงุณู:** `INVOICE_APPROVAL_10K`
- **ุงูููุฑุฏ:** Invoices
- **ุงูุญุฏ:** 10,000 ุฑูุงู
- **ุงูููุงูููู ุงููุทููุจูู:** 1
- **ุงูุฅุฌุฑุงุก:** APPROVE

#### ุงููุงุนุฏุฉ 2: ุงูููุงููุฉ ุนูู ุงูููุงุชูุฑ ุฃูุจุฑ ูู 50,000 ุฑูุงู
- **ุงูุงุณู:** `INVOICE_APPROVAL_50K`
- **ุงูููุฑุฏ:** Invoices
- **ุงูุญุฏ:** 50,000 ุฑูุงู
- **ุงูููุงูููู ุงููุทููุจูู:** 2
- **ุงูุฅุฌุฑุงุก:** APPROVE

#### ุงููุงุนุฏุฉ 3: ุฑูุงุจุฉ ุซูุงุฆูุฉ ุนูู ุงููุนุงููุงุช ุงููุงููุฉ
- **ุงูุงุณู:** `TRANSACTION_DUAL_CONTROL`
- **ุงูููุฑุฏ:** Transactions
- **ุงูุญุฏ:** 5,000 ุฑูุงู
- **ุงูููุงูููู ุงููุทููุจูู:** 2
- **ุงูุฅุฌุฑุงุก:** APPROVE

**ุฅุฌูุงูู:** 3 ููุงุนุฏ ุญูููุฉ ูุดุทุฉ

---

### 4๏ธโฃ **ุณุฌู ุงููุฑุงุฌุนุงุช (Audit Log)**

ูุณุฌู ุงููุธุงู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ:

#### ุงููุนูููุงุช ุงููุณุฌูุฉ:
- ูุนุฑู ุงููุณุชุฎุฏู ูุงุณูู
- ูุนุฑู ุงูููุงู
- ููุน ุงูุนูููุฉ (LOGIN, CREATE, UPDATE, DELETE, APPROVE, etc.)
- ููุน ุงูููุฑุฏ ุงููุชุฃุซุฑ
- ูุนุฑู ุงูุณุฌู ุงููุชุฃุซุฑ
- ุงููููุฉ ุงููุฏููุฉ (ูุจู ุงูุชุนุฏูู)
- ุงููููุฉ ุงูุฌุฏูุฏุฉ (ุจุนุฏ ุงูุชุนุฏูู)
- ุนููุงู IP
- User Agent
- ุณุจุจ ุงูุฅุฌุฑุงุก
- ุญุงูุฉ ุงูุนูููุฉ (SUCCESS, FAILED, BLOCKED)
- ุงูุชุงุฑูุฎ ูุงูููุช

---

### 5๏ธโฃ **ุณุฌู ุงูููุงููุงุช (Approval Log)**

ูุชุชุจุน ุทูุจุงุช ุงูููุงููุฉ:

- ููุน ุงูููุฑุฏ
- ูุนุฑู ุงูุณุฌู
- ุงูุนูููุฉ ุงููุทููุจุฉ
- ุงููุณุชุฎุฏู ุงูุทุงูุจ
- ุงููุณุชุฎุฏู ุงูููุงูู
- ุงูุญุงูุฉ (PENDING, APPROVED, REJECTED)
- ุงูุชุนูููุงุช
- ุชุงุฑูุฎ ุงูููุงููุฉ

---

## ๐ง ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููููุดุฃุฉ:

1. **`roles`** - ุฌุฏูู ุงูุฃุฏูุงุฑ
2. **`permissions`** - ุฌุฏูู ุงูุตูุงุญูุงุช
3. **`role_permissions`** - ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช
4. **`user_roles`** - ุฑุจุท ุงููุณุชุฎุฏููู ุจุงูุฃุฏูุงุฑ (ูุน ุงููุทุงู)
5. **`audit_logs`** - ุณุฌู ุงููุฑุงุฌุนุงุช ุงูุดุงูู
6. **`governance_rules`** - ููุงุนุฏ ุงูุญูููุฉ
7. **`approval_log`** - ุณุฌู ุทูุจุงุช ุงูููุงููุฉ

### ุงูููุงุฑุณ ุงููููุดุฃุฉ:
- `idx_audit_logs_user` - ุนูู ุนููุฏ user_id
- `idx_audit_logs_entity` - ุนูู ุนููุฏ entity_id
- `idx_audit_logs_action` - ุนูู ุนููุฏ action
- `idx_audit_logs_created` - ุนูู ุนููุฏ created_at (DESC)
- `idx_user_roles_user` - ุนูู ุนููุฏ user_id
- `idx_user_roles_entity` - ุนูู ุนููุฏ entity_id
- `idx_approval_log_status` - ุนูู ุนููุฏ status

---

## ๐ป ุงุณุชุฎุฏุงู ุงููุธุงู ูู ุงูููุฏ

### ุชููุฆุฉ ุงููุธุงู:
```javascript
// ูุชู ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
await window.initializeRBAC();
```

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
```javascript
// ุงูุชุญูู ูู ุตูุงุญูุฉ ูุนููุฉ
if (rbac.hasPermission('invoices.create')) {
    // ูููู ุฅูุดุงุก ูุงุชูุฑุฉ
}

// ุงูุชุญูู ูู ุฏูุฑ
if (rbac.hasRole('SUPER_ADMIN')) {
    // ูู Super Admin
}

// ุงูุชุญูู ูู ุตูุงุญูุฉ ุนูู ุนูููุฉ ูููุฑุฏ
if (rbac.can('create', 'invoices')) {
    // ูููู ุฅูุดุงุก ูุงุชูุฑุฉ
}

// ุฏูุงู ูุฎุชุตุฑุฉ
rbac.canCreate('invoices')
rbac.canRead('users')
rbac.canUpdate('entities')
rbac.canDelete('employees')
rbac.canApprove('transactions')
```

### ุงูุชุญูู ูู ููุงุนุฏ ุงูุญูููุฉ:
```javascript
const result = await rbac.checkGovernance('create', 'invoices', {
    amount: 15000
});

if (result.requiresApproval) {
    console.log(`ูุชุทูุจ ${result.approversRequired} ููุงูู`);
    // ุทูุจ ููุงููุฉ
    await rbac.requestApproval('invoices', invoiceId, 'CREATE', 'ูุงุชูุฑุฉ ุจูุจูุบ ูุจูุฑ');
}

if (result.blocked) {
    console.log(`ุนูููุฉ ูุญุธูุฑุฉ: ${result.reason}`);
}
```

### ุชุณุฌูู ุงูุนูููุงุช:
```javascript
await rbac.logAction('CREATE_INVOICE', 'invoices', invoiceId, {
    newValue: invoiceData,
    reason: 'ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ',
    status: 'SUCCESS'
});

await rbac.logAction('UPDATE_USER', 'users', userId, {
    oldValue: oldUserData,
    newValue: newUserData,
    reason: 'ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู'
});
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ุงูุฃุฏูุงุฑ:** 12
- **ุงูุตูุงุญูุงุช:** 27
- **ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช:** 27 (SUPER_ADMIN ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช)
- **ููุงุนุฏ ุงูุญูููุฉ ุงููุดุทุฉ:** 3
- **ุงูุฌุฏุงูู ุงููููุดุฃุฉ:** 7
- **ุงูููุงุฑุณ ุงููููุดุฃุฉ:** 7

---

## โ ุงูุงุฎุชุจุงุฑุงุช

ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช:

### ุงุฎุชุจุงุฑุงุช ุงูุฎูููุฉ:
- โ 8/8 ุงุฎุชุจุงุฑุงุช ูุฌุญุช (100%)

### ุงุฎุชุจุงุฑ ุงูุจูุงุก:
- โ ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
- โ ุฌููุน ุงูุฌุฏุงูู ููุฌูุฏุฉ (39 ุฌุฏูู)
- โ 5,294 ููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงุฎุชุจุงุฑ ูุธุงู RBAC:
- โ ุฌููุน ุงูุฃุฏูุงุฑ ูุญุฏุฏุฉ ุจุดูู ุตุญูุญ
- โ ุฌููุน ุงูุตูุงุญูุงุช ูููุดุฃุฉ
- โ ุงูุฑุจุท ุจูู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช ูุนูู
- โ ููุงุนุฏ ุงูุญูููุฉ ูุดุทุฉ
- โ ุงูุจููุฉ ุงููุงููุฉ ุตุญูุญุฉ

---

## ๐ ุงูุฃูุงู ูุงูุญูุงูุฉ

1. **ุนุฒู ุงูุจูุงูุงุช:** ูู ูุณุชุฎุฏู ูุฑู ููุท ุงูุจูุงูุงุช ุถูู ูุทุงูู
2. **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:** ูุจู ูู ุนูููุฉ ุญุณุงุณุฉ
3. **ููุงุนุฏ ุงูุญูููุฉ:** ุชููุน ุงูุนูููุงุช ุงูุฎุทุฑุฉ ุชููุงุฆูุงู
4. **ุณุฌู ุงููุฑุงุฌุนุงุช:** ูุณุฌู ูู ุงูุนูููุงุช ูููุณุงุกูุฉ
5. **ูุธุงู ุงูููุงููุงุช:** ููุนูููุงุช ุงูุญุณุงุณุฉ

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ

1. `create-rbac-system.sql` - ุณูุฑูุจุช SQL ูุฅูุดุงุก ุงูุฌุฏุงูู
2. `init-rbac-system.js` - ุณูุฑูุจุช ุชููุฆุฉ ุงูุฌุฏุงูู
3. `seed-rbac-data.js` - ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุฃูููุฉ
4. `rbac-system.js` - ูุธุงู RBAC ุงููุงูู (Frontend)
5. `test-rbac-system.js` - ุณูุฑูุจุช ุงูุงุฎุชุจุงุฑ ุงูุดุงูู
6. `RBAC_SYSTEM_GUIDE.md` - ูุฐุง ุงูููู (ุงูุชูุซูู)

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ููุชูุงูู ููุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช ูุงูุญูููุฉ ูุณุฌู ุงููุฑุงุฌุนุงุช ูููุฑ:

โ **ุงูุชุญูู ุงูุฏููู ูู ุงูุตูุงุญูุงุช** - ูู ุฎูุงู ูุธุงู RBAC
โ **ุงูุญูููุฉ ุงูุชููุงุฆูุฉ** - ููุงุนุฏ ุชููุน ุงูุฃุฎุทุงุก ุงููุงููุฉ
โ **ุงููุณุงุกูุฉ ุงููุงููุฉ** - ุณุฌู ุดุงูู ููู ุงูุนูููุงุช
โ **ูุธุงู ููุงููุงุช** - ููุนูููุงุช ุงูุญุณุงุณุฉ
โ **ูุงุจููุฉ ุงูุชูุณุน** - ุณูู ุฅุถุงูุฉ ุฃุฏูุงุฑ ูุตูุงุญูุงุช ุฌุฏูุฏุฉ
โ **ุงูุฃูุงู ูุงูุญูุงูุฉ** - ุญูุงูุฉ ูุงููุฉ ููุจูุงูุงุช ูุงูุนูููุงุช

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐
