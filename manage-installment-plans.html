<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ø· - Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .plan-card {
            transition: all 0.3s ease;
        }
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="/" class="text-gray-600 hover:text-blue-600 transition">
                        <i class="fas fa-arrow-right text-2xl"></i>
                    </a>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <i class="fas fa-calendar-alt text-blue-600"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                    </h1>
                </div>
                <button onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold shadow-lg transition transform hover:scale-105">
                    <i class="fas fa-plus ml-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-r-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·Ø·</p>
                        <p class="text-3xl font-bold text-gray-800" id="total-plans">0</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-full">
                        <i class="fas fa-calendar-alt text-blue-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-r-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù†Ø´Ø·Ø©</p>
                        <p class="text-3xl font-bold text-gray-800" id="active-plans">0</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-full">
                        <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-r-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Ø¨Ø¯ÙˆÙ† ÙÙˆØ§Ø¦Ø¯</p>
                        <p class="text-3xl font-bold text-gray-800" id="zero-interest">0</p>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-full">
                        <i class="fas fa-percent text-yellow-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-r-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯Ø©</p>
                        <p class="text-3xl font-bold text-gray-800" id="avg-duration">0</p>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-full">
                        <i class="fas fa-clock text-purple-600 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter & Search -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø¨Ø­Ø«</label>
                    <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®Ø·Ø©..." 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="status-filter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="true">Ù†Ø´Ø·</option>
                        <option value="false">ØºÙŠØ± Ù†Ø´Ø·</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button onclick="applyFilters()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold transition">
                        <i class="fas fa-filter ml-2"></i>
                        ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
                    </button>
                </div>
            </div>
        </div>

        <!-- Plans Grid -->
        <div id="plans-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Plans will be loaded here -->
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden flex items-center justify-center py-20">
            <div class="text-center">
                <i class="fas fa-spinner fa-spin text-6xl text-blue-600 mb-4"></i>
                <p class="text-gray-600 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20">
            <i class="fas fa-calendar-alt text-8xl text-gray-300 mb-4"></i>
            <h3 class="text-2xl font-bold text-gray-600 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ø£Ù‚Ø³Ø§Ø·</h3>
            <p class="text-gray-500 mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
            <button onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-bold shadow-lg transition">
                <i class="fas fa-plus ml-2"></i>
                Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø©
            </button>
        </div>
    </main>

    <!-- Add/Edit Modal -->
    <div id="planModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-2xl flex justify-between items-center z-10">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="modal-title">Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø£Ù‚Ø³Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø©</span>
                </h2>
                <button onclick="closeModal()" class="text-white/80 hover:text-white hover:rotate-90 transition-all duration-300">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <form id="planForm" class="p-6 space-y-6">
                <input type="hidden" id="plan-id">

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-blue-600"></i>
                        Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø© *</label>
                            <input type="text" id="plan-code" required 
                                   placeholder="Ù…Ø«Ø§Ù„: PLAN_6M"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª)</p>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *</label>
                            <input type="text" id="plan-name-ar" required 
                                   placeholder="Ù…Ø«Ø§Ù„: 6 Ø£Ø´Ù‡Ø±"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                            <input type="text" id="plan-name-en" 
                                   placeholder="Example: 6 Months"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                            <input type="text" id="icon" 
                                   placeholder="Ù…Ø«Ø§Ù„: ğŸ“…"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ù„ÙˆÙ†</label>
                            <input type="color" id="color" value="#3b82f6"
                                   class="w-full h-12 border border-gray-300 rounded-lg cursor-pointer">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ù†Øµ Ø§Ù„Ø´Ø§Ø±Ø©</label>
                            <input type="text" id="badge-text" 
                                   placeholder="Ù…Ø«Ø§Ù„: âœ“ Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø¯Ø©"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-gray-700 font-bold mb-2">Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                        <textarea id="description-ar" rows="2" 
                                  placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø®Ø·Ø©..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø© -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-calendar text-green-600"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø©
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ù…Ø¯Ø© Ø§Ù„Ø®Ø·Ø© (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±) *</label>
                            <input type="number" id="duration-months" required min="1" 
                                   placeholder="Ù…Ø«Ø§Ù„: 6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª *</label>
                            <input type="number" id="number-of-payments" required min="1" 
                                   placeholder="Ù…Ø«Ø§Ù„: 6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¯ÙØ¹</label>
                            <select id="payment-frequency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="MONTHLY">Ø´Ù‡Ø±ÙŠ</option>
                                <option value="QUARTERLY">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                                <option value="SEMI_ANNUAL">Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option>
                                <option value="ANNUAL">Ø³Ù†ÙˆÙŠ</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶</label>
                            <input type="number" id="display-order" min="0" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ§Ù„ÙÙˆØ§Ø¦Ø¯ -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-percent text-yellow-600"></i>
                        Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ§Ù„ÙÙˆØ§Ø¦Ø¯
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø© %</label>
                            <input type="number" id="interest-rate" min="0" max="100" step="0.01" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ© (Ø«Ø§Ø¨ØªØ©)</label>
                            <input type="number" id="admin-fee" min="0" step="0.01" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ£Ø®ÙŠØ±</label>
                            <input type="number" id="late-payment-fee" min="0" step="0.01" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ± %</label>
                            <input type="number" id="early-payment-discount" min="0" max="100" step="0.01" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø¯ÙˆØ¯ -->
                <div class="border-b pb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-chart-line text-purple-600"></i>
                        Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="min-amount" min="0" step="0.01"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="max-amount" min="0" step="0.01"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-cog text-red-600"></i>
                        Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="is-active" checked 
                                   class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="font-bold text-gray-700">Ù†Ø´Ø·</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="is-featured" 
                                   class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="font-bold text-gray-700">Ù…Ù…ÙŠØ²</span>
                        </label>

                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="has-grace-period" 
                                   class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="font-bold text-gray-700">ÙŠÙˆØ¬Ø¯ ÙØªØ±Ø© Ø³Ù…Ø§Ø­</span>
                        </label>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ù…Ø§Ø­</label>
                            <input type="number" id="grace-period-days" min="0" value="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex gap-4 pt-4 border-t">
                    <button type="button" onclick="closeModal()" 
                            class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition">
                        <i class="fas fa-times ml-2"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" 
                            class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold shadow-lg transition transform hover:scale-105">
                        <i class="fas fa-save ml-2"></i>
                        Ø­ÙØ¸
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        let currentEditId = null;
        let allPlans = [];

        // Load plans
        async function loadPlans() {
            const loadingEl = document.getElementById('loading');
            const containerEl = document.getElementById('plans-container');
            const emptyStateEl = document.getElementById('empty-state');

            try {
                loadingEl.classList.remove('hidden');
                containerEl.innerHTML = '';
                emptyStateEl.classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/installment-plan-types`);
                allPlans = await response.json();

                if (allPlans.length === 0) {
                    emptyStateEl.classList.remove('hidden');
                } else {
                    displayPlans(allPlans);
                    updateStats(allPlans);
                }
            } catch (error) {
                console.error('Error loading plans:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Display plans
        function displayPlans(plans) {
            const container = document.getElementById('plans-container');
            container.innerHTML = '';

            plans.forEach(plan => {
                const card = document.createElement('div');
                card.className = 'plan-card bg-white rounded-xl shadow-lg overflow-hidden border-r-4';
                card.style.borderColor = plan.color || '#3b82f6';

                const statusBadge = plan.is_active 
                    ? '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold">Ù†Ø´Ø·</span>'
                    : '<span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs font-bold">ØºÙŠØ± Ù†Ø´Ø·</span>';

                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <span class="text-4xl">${plan.icon || 'ğŸ“…'}</span>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">${plan.plan_name_ar}</h3>
                                    <p class="text-xs text-gray-500">${plan.plan_code}</p>
                                </div>
                            </div>
                            ${statusBadge}
                        </div>
                        
                        ${plan.badge_text ? `<p class="text-sm text-gray-600 mb-3">${plan.badge_text}</p>` : ''}
                        ${plan.description_ar ? `<p class="text-sm text-gray-600 mb-4">${plan.description_ar}</p>` : ''}
                        
                        <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p class="text-xs text-blue-600 font-bold">Ø§Ù„Ù…Ø¯Ø©</p>
                                <p class="text-lg font-bold text-blue-800">${plan.duration_months} Ø´Ù‡Ø±</p>
                            </div>
                            <div class="bg-green-50 p-3 rounded-lg">
                                <p class="text-xs text-green-600 font-bold">Ø§Ù„Ø¯ÙØ¹Ø§Øª</p>
                                <p class="text-lg font-bold text-green-800">${plan.number_of_payments} Ø¯ÙØ¹Ø©</p>
                            </div>
                        </div>

                        <div class="space-y-2 mb-4 text-xs text-gray-600">
                            ${plan.interest_rate > 0 ? `<div>ğŸ“Š ÙØ§Ø¦Ø¯Ø©: ${plan.interest_rate}%</div>` : '<div>âœ“ Ø¨Ø¯ÙˆÙ† ÙÙˆØ§Ø¦Ø¯</div>'}
                            ${plan.admin_fee > 0 ? `<div>ğŸ’µ Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ©: ${plan.admin_fee} Ø±.Ø³</div>` : ''}
                            ${plan.early_payment_discount > 0 ? `<div>ğŸ Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ±: ${plan.early_payment_discount}%</div>` : ''}
                        </div>

                        <div class="flex gap-2">
                            <button onclick="editPlan(${plan.id})" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">
                                <i class="fas fa-edit ml-1"></i>
                                ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button onclick="toggleActive(${plan.id})" 
                                    class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">
                                <i class="fas fa-power-off ml-1"></i>
                                ØªØ¨Ø¯ÙŠÙ„
                            </button>
                            <button onclick="deletePlan(${plan.id})" 
                                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Update stats
        function updateStats(plans) {
            document.getElementById('total-plans').textContent = plans.length;
            document.getElementById('active-plans').textContent = plans.filter(p => p.is_active).length;
            document.getElementById('zero-interest').textContent = plans.filter(p => p.interest_rate == 0).length;
            
            const avgDuration = plans.length > 0 
                ? Math.round(plans.reduce((sum, p) => sum + p.duration_months, 0) / plans.length)
                : 0;
            document.getElementById('avg-duration').textContent = `${avgDuration} Ø´Ù‡Ø±`;
        }

        // Apply filters
        function applyFilters() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const status = document.getElementById('status-filter').value;

            let filtered = allPlans;

            if (search) {
                filtered = filtered.filter(p => 
                    p.plan_name_ar.toLowerCase().includes(search) ||
                    p.plan_code.toLowerCase().includes(search)
                );
            }

            if (status !== '') {
                const isActive = status === 'true';
                filtered = filtered.filter(p => p.is_active === isActive);
            }

            displayPlans(filtered);
        }

        // Open add modal
        function openAddModal() {
            currentEditId = null;
            document.getElementById('modal-title').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø£Ù‚Ø³Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('planForm').reset();
            document.getElementById('plan-id').value = '';
            document.getElementById('planModal').classList.remove('hidden');
        }

        // Edit plan
        async function editPlan(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/installment-plan-types/${id}`);
                const plan = await response.json();

                currentEditId = id;
                document.getElementById('modal-title').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø®Ø·Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·';
                document.getElementById('plan-id').value = id;
                document.getElementById('plan-code').value = plan.plan_code;
                document.getElementById('plan-name-ar').value = plan.plan_name_ar;
                document.getElementById('plan-name-en').value = plan.plan_name_en || '';
                document.getElementById('description-ar').value = plan.description_ar || '';
                document.getElementById('icon').value = plan.icon || '';
                document.getElementById('color').value = plan.color || '#3b82f6';
                document.getElementById('badge-text').value = plan.badge_text || '';
                document.getElementById('duration-months').value = plan.duration_months;
                document.getElementById('number-of-payments').value = plan.number_of_payments;
                document.getElementById('payment-frequency').value = plan.payment_frequency || 'MONTHLY';
                document.getElementById('interest-rate').value = plan.interest_rate || 0;
                document.getElementById('admin-fee').value = plan.admin_fee || 0;
                document.getElementById('late-payment-fee').value = plan.late_payment_fee || 0;
                document.getElementById('early-payment-discount').value = plan.early_payment_discount || 0;
                document.getElementById('min-amount').value = plan.min_amount || '';
                document.getElementById('max-amount').value = plan.max_amount || '';
                document.getElementById('is-active').checked = plan.is_active;
                document.getElementById('is-featured').checked = plan.is_featured || false;
                document.getElementById('has-grace-period').checked = plan.has_grace_period || false;
                document.getElementById('grace-period-days').value = plan.grace_period_days || 0;
                document.getElementById('display-order').value = plan.display_order || 0;

                document.getElementById('planModal').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading plan:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('planModal').classList.add('hidden');
            currentEditId = null;
        }

        // Toggle active status
        async function toggleActive(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©ØŸ')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/installment-plan-types/${id}/toggle-active`, {
                    method: 'PATCH'
                });

                if (response.ok) {
                    loadPlans();
                } else {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©');
                }
            } catch (error) {
                console.error('Error toggling status:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©');
            }
        }

        // Delete plan
        async function deletePlan(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/installment-plan-types/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadPlans();
                } else {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
                }
            } catch (error) {
                console.error('Error deleting plan:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
            }
        }

        // Form submit
        document.getElementById('planForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                plan_code: document.getElementById('plan-code').value,
                plan_name_ar: document.getElementById('plan-name-ar').value,
                plan_name_en: document.getElementById('plan-name-en').value,
                description_ar: document.getElementById('description-ar').value,
                icon: document.getElementById('icon').value,
                color: document.getElementById('color').value,
                badge_text: document.getElementById('badge-text').value,
                duration_months: parseInt(document.getElementById('duration-months').value),
                number_of_payments: parseInt(document.getElementById('number-of-payments').value),
                payment_frequency: document.getElementById('payment-frequency').value,
                interest_rate: parseFloat(document.getElementById('interest-rate').value),
                admin_fee: parseFloat(document.getElementById('admin-fee').value),
                late_payment_fee: parseFloat(document.getElementById('late-payment-fee').value),
                early_payment_discount: parseFloat(document.getElementById('early-payment-discount').value),
                min_amount: document.getElementById('min-amount').value ? parseFloat(document.getElementById('min-amount').value) : null,
                max_amount: document.getElementById('max-amount').value ? parseFloat(document.getElementById('max-amount').value) : null,
                is_active: document.getElementById('is-active').checked,
                is_featured: document.getElementById('is-featured').checked,
                has_grace_period: document.getElementById('has-grace-period').checked,
                grace_period_days: parseInt(document.getElementById('grace-period-days').value),
                display_order: parseInt(document.getElementById('display-order').value)
            };

            try {
                const url = currentEditId 
                    ? `${API_BASE_URL}/installment-plan-types/${currentEditId}`
                    : `${API_BASE_URL}/installment-plan-types`;
                
                const method = currentEditId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeModal();
                    loadPlans();
                    alert(currentEditId ? 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    const error = await response.json();
                    alert(error.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
                }
            } catch (error) {
                console.error('Error saving:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸');
            }
        });

        // Search on input
        document.getElementById('search-input').addEventListener('input', applyFilters);

        // Load on page load
        document.addEventListener('DOMContentLoaded', loadPlans);
    </script>
</body>
</html>
