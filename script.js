/**
 * NAYOSH ERP - SaaS Multi-Tenant Architecture
 * Features: Strict Isolation, Tenant Scopes, Subscription Mgmt, Advertiser Panel, Financial System
 */

// Global Loading Indicator Functions
function showGlobalLoading() {
    const loader = document.getElementById('global-loading');
    if (loader) loader.style.display = 'flex';
}

function hideGlobalLoading() {
    const loader = document.getElementById('global-loading');
    if (loader) loader.style.display = 'none';
}

// Global API Configuration (accessible from all functions)
const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:3000/api'
    : '/api';

const app = (() => {
    // --- API CONFIGURATION (using global) ---
    
    // Helper function to fetch data from API with data isolation headers
    async function fetchAPI(endpoint, options = {}) {
        // Use cached fetch if available and not a POST/PUT/DELETE request
        const method = options.method || 'GET';
        const useCache = method === 'GET' && typeof cachedFetchAPI !== 'undefined';
        
        if (useCache) {
            console.log(`ğŸ”„ [fetchAPI] Using cached fetch for: ${endpoint}`);
            return cachedFetchAPI(endpoint, options);
        }
        
        try {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            // Ø¥Ø¶Ø§ÙØ© headers Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
            // Ø§Ø³ØªØ®Ø¯Ù… currentUser Ø£Ùˆ fallback Ø¹Ù„Ù‰ window.currentUserData
            const user = currentUser || window.currentUserData;
            if (user) {
                const tenantType = user.tenantType || user.tenant_type || 'HQ';
                const entityId = user.entityId || user.entity_id || 'HQ001';
                headers['x-entity-type'] = tenantType;
                headers['x-entity-id'] = entityId;
                console.log('ğŸ“¤ [fetchAPI] Sending headers:', { endpoint, entityType: tenantType, entityId: entityId });
            } else {
                console.warn('âš ï¸ [fetchAPI] No user data available for:', endpoint);
            }
            
            const url = `${API_BASE_URL}${endpoint}`;
            console.log(`ğŸŒ [fetchAPI] Requesting: ${url}`);
            
            // Show global loading indicator for write operations
            if (method !== 'GET') showGlobalLoading();
            
            const response = await fetch(url, {
                ...options,
                headers,
                timeout: 30000 // 30 second timeout
            });
            
            console.log(`ğŸ“¥ [fetchAPI] Response status for ${endpoint}: ${response.status}`);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error(`âŒ [fetchAPI] HTTP Error ${response.status} for ${endpoint}:`, errorText);
                throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
            }
            
            // Check if response is actually JSON
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                const responseText = await response.text();
                console.error(`âŒ [fetchAPI] Expected JSON but got ${contentType} for ${endpoint}:`, responseText.substring(0, 200));
                throw new Error(`Expected JSON response but got ${contentType}. Response starts with: ${responseText.substring(0, 100)}`);
            }
            
            const data = await response.json();
            console.log(`âœ… [fetchAPI] Success for ${endpoint}:`, Array.isArray(data) ? `${data.length} items` : 'object');
            
            // Hide loading indicator
            if (method !== 'GET') hideGlobalLoading();
            
            return data;
        } catch (error) {
            console.error(`âŒ [fetchAPI] Error for ${endpoint}:`, error);
            console.error('Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name
            });
            
            // Hide loading indicator on error
            if (method !== 'GET') hideGlobalLoading();
            
            throw error;
        }
    }
    
    // --- CONFIGURATION ---
    const TENANT_TYPES = {
        HQ: { id: 'HQ', label: 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Provider)', icon: 'fa-building', color: 'text-purple-600', bg: 'bg-purple-50', theme: 'purple' },
        BRANCH: { id: 'BRANCH', label: 'ÙØ±Ø¹ ØªØ¬Ø²Ø¦Ø© (Tenant)', icon: 'fa-store', color: 'text-red-600', bg: 'bg-red-50', theme: 'blue' },
        INCUBATOR: { id: 'INCUBATOR', label: 'Ø­Ø§Ø¶Ù†Ø© Ø£Ø¹Ù…Ø§Ù„ (Tenant)', icon: 'fa-seedling', color: 'text-orange-600', bg: 'bg-orange-50', theme: 'orange' },
        PLATFORM: { id: 'PLATFORM', label: 'Ù…Ù†ØµØ© Ø±Ù‚Ù…ÙŠØ© (Tenant)', icon: 'fa-server', color: 'text-green-600', bg: 'bg-green-50', theme: 'green' },
        OFFICE: { id: 'OFFICE', label: 'Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±ÙŠ (Tenant)', icon: 'fa-briefcase', color: 'text-gray-600', bg: 'bg-gray-50', theme: 'gray' }
    };

    const ROLES = {
        ADMIN: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',       // Tenant Admin
        FINANCE: 'Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø§Ù„ÙŠ',      // Finance Access
        SUPPORT: 'Ø¯Ø¹Ù… ÙÙ†ÙŠ',         // Support Tickets
        HR: 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©',          // Human Resources
        ADVERTISER: 'Ù…Ø¹Ù„Ù†',         // Ad Publisher
        USER: 'Ù…Ø³ØªØ®Ø¯Ù…'             // Standard User
    };

    const THEMES = {
        BLUE: { name: 'Ø³Ù…Ø§Ø¡ Ø²Ø±Ù‚Ø§Ø¡ (Default)', colors: { 50: '240 249 255', 100: '224 242 254', 400: '56 189 248', 500: '14 165 233', 600: '2 132 199', 800: '7 89 133', 900: '12 74 110' }, preview: 'bg-sky-500' },
        PURPLE: { name: 'Ø¨Ù†ÙØ³Ø¬ÙŠ Ù…Ù„ÙƒÙŠ', colors: { 50: '250 245 255', 100: '243 232 255', 400: '192 132 252', 500: '168 85 247', 600: '147 51 234', 800: '107 33 168', 900: '88 28 135' }, preview: 'bg-purple-500' },
        EMERALD: { name: 'Ø£Ø®Ø¶Ø± Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©', colors: { 50: '236 253 245', 100: '209 250 229', 400: '52 211 153', 500: '16 185 129', 600: '5 150 105', 800: '6 95 70', 900: '6 78 59' }, preview: 'bg-emerald-500' },
        ROSE: { name: 'ÙˆØ±Ø¯ÙŠ Ø£Ù†ÙŠÙ‚', colors: { 50: '255 241 242', 100: '255 228 230', 400: '251 113 133', 500: '244 63 94', 600: '225 29 72', 800: '159 18 57', 900: '136 19 55' }, preview: 'bg-rose-500' },
        AMBER: { name: 'Ø°Ù‡Ø¨ÙŠ ÙØ§Ø®Ø±', colors: { 50: '255 251 235', 100: '254 243 199', 400: '251 191 36', 500: '245 158 11', 600: '217 119 6', 800: '146 64 14', 900: '120 53 15' }, preview: 'bg-amber-500' }
    };

    const SUBSCRIPTION_PLANS = {
        BASIC: { name: 'Ø£Ø³Ø§Ø³ÙŠ', price: 999, limit: 10, features: ['Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ©'] },
        PRO: { name: 'Ø§Ø­ØªØ±Ø§ÙÙŠ', price: 2499, limit: 50, features: ['ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©', 'API Access'] },
        ENTERPRISE: { name: 'Ù…Ø¤Ø³Ø³Ø§Øª', price: 4999, limit: 999, features: ['Ø¯Ø¹Ù… 24/7', 'Ù†Ø·Ø§Ù‚ Ø®Ø§Øµ', 'Ø¹Ø²Ù„ ÙƒØ§Ù…Ù„'] }
    };

    const AD_LEVELS = {
        L1_LOCAL: { id: 1, key: 'L1_LOCAL', label: 'Ù…Ø­Ù„ÙŠ (Tenant Only)', desc: 'Ø¯Ø§Ø®Ù„ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙÙ‚Ø·', cost: 0, approval: false, badgeClass: 'bg-gray-100 text-gray-600 border-gray-200', gradient: 'from-gray-50 to-gray-100', chartColor: '#94a3b8' },
        L2_MULTI: { id: 2, key: 'L2_MULTI', label: 'Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ÙØ±ÙˆØ¹ (Paid)', desc: 'Ù†Ø´Ø± Ù„Ø¹Ø¯Ø© ÙØ±ÙˆØ¹ Ù…Ø®ØªØ§Ø±Ø©', cost: 500, approval: true, badgeClass: 'bg-red-100 text-red-600 border-red-200', gradient: 'from-red-50 to-cyan-50', chartColor: '#ef4444' },
        L3_INC_INT: { id: 3, key: 'L3_INC_INT', label: 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§Ø¶Ù†Ø©', desc: 'Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù†Ø³ÙˆØ¨ÙŠ Ø§Ù„Ø­Ø§Ø¶Ù†Ø©', cost: 100, approval: false, badgeClass: 'bg-orange-100 text-orange-600 border-orange-200', gradient: 'from-orange-50 to-amber-50', chartColor: '#f97316' },
        L4_PLT_INT: { id: 4, key: 'L4_PLT_INT', label: 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†ØµØ©', desc: 'Ù„Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ù‚Ù…ÙŠ', cost: 1000, approval: true, badgeClass: 'bg-green-100 text-green-600 border-green-200', gradient: 'from-emerald-50 to-teal-50', chartColor: '#10b981' },
        L5_CROSS_INC: { id: 5, key: 'L5_CROSS_INC', label: 'Ø´Ø¨ÙƒØ© SaaS Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©', desc: 'Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ø¨Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†', cost: 1500, approval: true, badgeClass: 'bg-purple-100 text-purple-600 border-purple-200', gradient: 'from-violet-50 to-fuchsia-50', chartColor: '#8b5cf6' }
    };

    const getAdLevelsMeta = (ad) => {
      const levelKeys = Array.isArray(ad?.levels) ? ad.levels : (ad?.level ? [ad.level] : []);
      const normalized = levelKeys.length ? levelKeys : ['L1_LOCAL'];
      return normalized.map(k => AD_LEVELS[k] || { key: k, label: k, badgeClass: 'bg-gray-100 text-gray-600 border-gray-200', gradient: 'from-gray-50 to-gray-100' });
    };

    const INVOICE_STATUS = {
        PAID: { label: 'Ù…Ø¯ÙÙˆØ¹Ø©', color: 'text-green-600', bg: 'bg-green-100' },
        PARTIAL: { label: 'Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ', color: 'text-orange-600', bg: 'bg-orange-100' },
        UNPAID: { label: 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©', color: 'text-red-600', bg: 'bg-red-100' },
        OVERDUE: { label: 'Ù…ØªØ£Ø®Ø±Ø©', color: 'text-red-800', bg: 'bg-red-200' }
    };

    // --- DATA LAYER (Multi-Tenant) ---
    const db = {
        users: [],
        entities: [],
        invoices: [],
        transactions: [],
        ledger: [],
        ads: [],
        approvals: [],
        notifications: [],

        tasks: [
            { id: 101, title: 'ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ SaaS', dueDate: '2023-11-30', status: 'Pending', priority: 'High', type: 'Billing', entityId: 'BR015' },
            { id: 102, title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©', dueDate: '2023-11-21', status: 'In Progress', priority: 'Medium', type: 'Ops', entityId: 'HQ001' },
            { id: 103, title: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¶Ù†Ø©', dueDate: '2023-11-22', status: 'Done', priority: 'Low', type: 'Ops', entityId: 'INC03' }
        ],

        tickets: [
            { id: 'T-201', subject: 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', status: 'Open', priority: 'High', type: 'System', entityId: 'BR015', date: '2023-11-20' },
            { id: 'T-202', subject: 'Ø·Ù„Ø¨ Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', status: 'Pending', priority: 'Medium', type: 'Billing', entityId: 'INC03', date: '2023-11-21' }
        ],

        auditLogs: [
            { id: 1, user: 'Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', role: 'HQ Admin', action: 'LOGIN', details: 'System Login', timestamp: '2023-11-20 08:00', entityId: 'HQ001' },
            { id: 2, user: 'Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯', role: 'Branch Admin', action: 'UPDATE_PLAN', details: 'Plan upgrade requested', timestamp: '2023-11-20 09:15', entityId: 'BR015' }
        ]
    };

    let currentUser = null;
    let activeChart = null;
    let analyticsChart = null;
    let adWizardData = {}; 

    // --- ISOLATION & PERMISSIONS LAYER ---
    const perms = {
        isHQ: () => {
            const tenantType = currentUser?.tenantType || currentUser?.tenant_type;
            return tenantType === 'HQ';
        },
        isAdmin: () => currentUser?.role === ROLES.ADMIN,
        isFinance: () => currentUser?.role === ROLES.FINANCE || currentUser?.role === ROLES.ADMIN,
        isSupport: () => currentUser?.role === ROLES.SUPPORT,
        isHR: () => currentUser?.role === ROLES.HR || currentUser?.role === ROLES.ADMIN,
        canManageAds: () => perms.isAdmin() || currentUser?.role === ROLES.ADVERTISER,
        canViewAuditLogs: () => perms.isAdmin(),

        getVisibleEntities: () => {
            if (perms.isHQ()) return db.entities;
            const entityId = currentUser?.entityId || currentUser?.entity_id;
            return db.entities.filter(e => e.id === entityId);
        },

        getVisibleTasks: () => {
            const entityId = currentUser?.entityId || currentUser?.entity_id;
            return db.tasks.filter(t => t.entityId === entityId);
        },
        getVisibleTickets: () => {
            const entityId = currentUser?.entityId || currentUser?.entity_id;
            return (perms.isHQ() && perms.isSupport()) ? db.tickets : db.tickets.filter(t => t.entityId === entityId);
        },
        
        getVisibleAds: () => {
          const entityId = currentUser?.entityId || currentUser?.entity_id;
          const tenantType = currentUser?.tenantType || currentUser?.tenant_type;
          console.log(`ğŸ” [getVisibleAds] Called for user: ${entityId} (${tenantType})`);
          console.log(`ğŸ“Š [getVisibleAds] Total ads in db.ads: ${db.ads.length}`);
          console.log(`ğŸ“‹ [getVisibleAds] Ads:`, db.ads.map(a => `${a.title} (${a.sourceType})`));
          const filtered = db.ads.filter(ad => {
                const sourceId = ad.sourceEntityId || ad.entityId;
            const adLevels = Array.isArray(ad.levels) ? ad.levels : (ad.level ? [ad.level] : []);
                
                // Check 0: HQ sees everything!
                if (currentUser.tenantType === 'HQ') {
                    console.log(`âœ… Ad "${ad.title}" visible: HQ sees all`);
                    return true;
                }
                
                // Check 1: Own ads
                if (sourceId === currentUser.entityId) {
                    console.log(`âœ… Ad "${ad.title}" visible: Own ad`);
                    return true;
                }
                // Check 2: HQ ads (visible to all)
                if (ad.sourceType === 'HQ') {
                    console.log(`âœ… Ad "${ad.title}" visible: HQ source`);
                    return true;
                }
                // Check 3: Targeted ads
                if (Array.isArray(ad.targetIds) && ad.targetIds.includes(currentUser.entityId) && ad.status === 'ACTIVE') {
                    console.log(`âœ… Ad "${ad.title}" visible: Targeted`);
                    return true;
                }
                // Check 4: Platform internal ads
                if (adLevels.includes('L4_PLT_INT')) {
                    console.log(`âœ… Ad "${ad.title}" visible: Platform internal`);
                    return true;
                }
                console.log(`âŒ Ad "${ad.title}" NOT visible (sourceType: ${ad.sourceType}, targetIds: ${JSON.stringify(ad.targetIds)})`);
                return false;
            });
            console.log(`ğŸ“Š Total visible ads for ${currentUser.entityId}: ${filtered.length} out of ${db.ads.length}`);
            return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
        },

        getManagedAds: () => db.ads.filter(ad => ad.sourceEntityId === currentUser.entityId),
        getVisibleAuditLogs: () => (perms.isHQ() && perms.isAdmin()) ? db.auditLogs : db.auditLogs.filter(l => l.entityId === currentUser.entityId),

        // Financial Permissions
        getVisibleInvoices: () => {
            if (perms.isHQ()) return db.invoices;
            return db.invoices.filter(i => i.entityId === currentUser.entityId);
        },
        getVisibleLedger: () => db.ledger.filter(l => l.entityId === currentUser.entityId)
    };

    // --- UTILS ---
    const showToast = (msg, type = 'info') => {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        const styles = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-slate-800';
        toast.className = `${styles} text-white px-6 py-4 rounded-xl shadow-2xl text-sm flex items-center gap-4 animate-slide-in backdrop-blur-sm bg-opacity-95`;
        toast.innerHTML = `<i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} text-lg"></i> <span class="font-semibold">${msg}</span>`;
        container.appendChild(toast);
        setTimeout(() => { 
            toast.style.opacity = '0'; 
            toast.style.transform = 'translateY(-20px)';
            setTimeout(() => toast.remove(), 300); 
        }, 3000);
    };

    const logAction = (action, details) => {
        db.auditLogs.unshift({ 
            id: db.auditLogs.length + 1,
            user: currentUser.name,
            role: `${currentUser.tenantType} ${currentUser.role}`,
            action: action,
            details: details,
            timestamp: new Date().toISOString().slice(0, 16).replace('T', ' '),
            entityId: currentUser.entityId
        });
    };

    const updateThemeVariables = (themeKey) => {
        const theme = THEMES[themeKey] || THEMES.BLUE;
        const root = document.documentElement;
        Object.entries(theme.colors).forEach(([key, value]) => {
            root.style.setProperty(`--brand-${key}`, value);
        });
    };

    // --- FALLBACK DATA (in case API fails) ---
    const fallbackData = {
        entities: [
            { id: 'HQ001', name: 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', type: 'HQ', status: 'Active', balance: 2500000, location: 'Ø§Ù„Ø±ÙŠØ§Ø¶', users: 15, plan: 'ENTERPRISE', expiry: '2030-12-31', theme: 'BLUE' }
        ],
        users: [
            { id: 1, name: 'Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…', tenantType: 'HQ', entityId: 'HQ001', entityName: 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' }
        ]
    };

    // --- SELECT TENANT MODAL (for proper data isolation) ---
    async function showTenantSelector() {
        console.log('ğŸ” Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙŠØ§Ù†...');
        return new Promise((resolve) => {
            // First load all entities to show available tenants
            const showSelector = async () => {
                try {
                    console.log('ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª...');
                    // Get all entities first WITHOUT headers (for selection screen)
                    const response = await fetch(`${API_BASE_URL}/entities`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const entities = await response.json();
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${entities.length} ÙƒÙŠØ§Ù†`);
                    
                    if (!entities || entities.length === 0) {
                        throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©');
                    }
                    
                    const modal = document.createElement('div');
                    modal.id = 'tenant-selector';
                    modal.className = 'fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm';
                    modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 overflow-hidden max-h-[90vh] flex flex-col">
                      <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-8 py-8 text-white">
                        <h1 class="text-3xl font-bold mb-2">ğŸ¢ Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´ ERP</h1>
                        <p class="text-purple-100">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù†Ù‡</p>
                      </div>
                      <div class="p-8 overflow-y-auto flex-1 custom-scrollbar space-y-4">
                        <div class="sticky top-0 z-10 bg-white/95 backdrop-blur border border-gray-200 rounded-xl px-4 py-3 shadow-sm">
                          <label class="block text-sm font-semibold text-gray-700 mb-2">Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙŠØ§Ù†</label>
                          <div class="relative">
                            <input id="tenant-search" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙƒÙŠØ§Ù† Ø£Ùˆ Ø§Ù„Ù†ÙˆØ¹ Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯" class="w-full border border-gray-300 rounded-lg px-4 py-3 pr-10 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition" />
                            <i class="fas fa-search text-gray-400 absolute right-3 top-3.5"></i>
                          </div>
                          <div id="tenant-results-count" class="text-xs text-gray-500 mt-2">${entities.length} ÙƒÙŠØ§Ù† Ù…ØªØ§Ø­</div>
                        </div>

                        <div id="tenant-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-2"></div>
                        
                        <div id="load-more-container" class="flex justify-center pt-4">
                          <button id="load-more-btn" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition shadow-lg hidden">
                            <i class="fas fa-chevron-down ml-2"></i>
                            Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯
                          </button>
                        </div>
                        
                        <p class="text-center text-sm text-gray-500 mt-4 pt-4 border-t">
                          ğŸ’¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙŠØ§Ù† Ø³ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªØ±Ø§Ù‡Ø§ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                        </p>
                      </div>
                    </div>
                  `;
                
                  document.body.appendChild(modal);

                  const searchInput = modal.querySelector('#tenant-search');
                  const grid = modal.querySelector('#tenant-grid');
                  const resultCount = modal.querySelector('#tenant-results-count');
                  const loadMoreBtn = modal.querySelector('#load-more-btn');
                  
                  let currentPage = 1;
                  const itemsPerPage = 20; // Ø¹Ø±Ø¶ 20 ÙƒÙŠØ§Ù† ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
                  let filteredEntities = [...entities];

                  const renderCards = (list) => {
                    if (!list || list.length === 0) {
                      return `<div class="col-span-1 md:col-span-2 text-center border border-dashed border-gray-300 rounded-xl py-10 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ</div>`;
                    }
                    return list.map(e => `
                      <div class="tenant-card cursor-pointer p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all transform hover:scale-105"
                         onclick="selectTenant('${e.id}', '${e.type}')">
                        <div class="flex items-start justify-between gap-3">
                          <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg mb-2 text-gray-900 truncate" title="${e.name}">${e.name}</h3>
                            <p class="text-sm text-gray-600 mb-3">Ø§Ù„Ù†ÙˆØ¹: <span class="font-semibold">${e.type === 'HQ' ? 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' : e.type === 'BRANCH' ? 'ÙØ±Ø¹' : e.type === 'INCUBATOR' ? 'Ø­Ø§Ø¶Ù†Ø©' : e.type === 'PLATFORM' ? 'Ù…Ù†ØµØ©' : e.type === 'OFFICE' ? 'Ù…ÙƒØªØ¨' : 'ÙƒÙŠØ§Ù†'}</span></p>
                            <div class="flex flex-wrap gap-2 text-xs">
                              <span class="bg-gray-100 px-3 py-1 rounded-full">Ø§Ù„Ø­Ø§Ù„Ø©: ${e.status === 'active' || e.status === 'Active' ? 'âœ… Ù†Ø´Ø·' : 'â¸ï¸ Ù…Ø¹Ø·Ù„'}</span>
                              ${e.id ? `<span class="bg-red-50 text-red-700 px-3 py-1 rounded-full">Ø§Ù„ÙƒÙˆØ¯: ${e.id}</span>` : ''}
                              ${e.location ? `<span class="bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full">Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${e.location}</span>` : ''}
                            </div>
                          </div>
                          <div class="text-3xl shrink-0">
                            ${e.type === 'HQ' ? 'ğŸ›ï¸' : e.type === 'BRANCH' ? 'ğŸª' : e.type === 'INCUBATOR' ? 'ğŸŒ±' : e.type === 'PLATFORM' ? 'ğŸ’»' : e.type === 'OFFICE' ? 'ğŸ¢' : 'ğŸ“‹'}
                          </div>
                        </div>
                      </div>
                    `).join('');
                  };

                  const renderPage = (append = false) => {
                    const startIdx = 0;
                    const endIdx = currentPage * itemsPerPage;
                    const pageItems = filteredEntities.slice(startIdx, endIdx);
                    
                    if (append) {
                      grid.innerHTML += renderCards(pageItems.slice((currentPage - 1) * itemsPerPage));
                    } else {
                      grid.innerHTML = renderCards(pageItems);
                    }
                    
                    // Show/hide load more button
                    if (endIdx < filteredEntities.length) {
                      loadMoreBtn.classList.remove('hidden');
                      loadMoreBtn.textContent = `Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ (${filteredEntities.length - endIdx} Ù…ØªØ¨Ù‚ÙŠ)`;
                    } else {
                      loadMoreBtn.classList.add('hidden');
                    }
                  };

                  const applyFilter = () => {
                    const term = (searchInput.value || '').trim().toLowerCase();
                    filteredEntities = term
                      ? entities.filter(e => [e.name, e.type, e.id, e.location, e.status]
                        .filter(Boolean)
                        .some(v => v.toString().toLowerCase().includes(term)))
                      : entities;
                    
                    currentPage = 1; // Reset to first page
                    renderPage(false);
                    
                    resultCount.textContent = term
                      ? `${filteredEntities.length} ÙƒÙŠØ§Ù† Ù…Ø·Ø§Ø¨Ù‚ Ù…Ù† ${entities.length}`
                      : `${entities.length} ÙƒÙŠØ§Ù† Ù…ØªØ§Ø­`;
                  };

                  loadMoreBtn.addEventListener('click', () => {
                    currentPage++;
                    renderPage(true);
                  });

                  searchInput.addEventListener('input', applyFilter);
                  applyFilter();
                
                window.selectTenant = (tenantId, tenantType) => {
                    const selectedEntity = entities.find(e => e.id === tenantId);
                    currentUser = {
                        id: 1,
                        name: selectedEntity.name + ' - Ù…Ø³Ø¤ÙˆÙ„',
                        role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',
                        tenantType: tenantType,
                        entityId: tenantId,
                        entityName: selectedEntity.name
                    };
                    
                    // ğŸ”‘ Ø­ÙØ¸ currentUser ÙÙŠ window ÙˆlocalStorage
                    window.currentUserData = currentUser;
                    localStorage.setItem('nayosh_selected_entity', JSON.stringify(currentUser));
                    console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:', window.currentUserData);
                    
                    modal.remove();
                    resolve(currentUser);
                };
                
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙŠØ§Ù†:', error);
                    // Show error message to user
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50';
                    errorDiv.innerHTML = `
                        <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
                            <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</h2>
                            <p class="text-gray-600 mb-4">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª</p>
                            <p class="text-sm text-gray-500 mb-4">${error.message}</p>
                            <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    `;
                    document.body.appendChild(errorDiv);
                }
            };
            
            showSelector();
        });
    }

    // --- DATA LOADING FROM API ---
    async function loadDataFromAPI(routeName = null) {
        console.log('ğŸ”„ Starting loadDataFromAPI for route:', routeName || 'ALL');
        console.log('ğŸ‘¤ Current user:', currentUser);
        
        // Verify that currentUser is set
        if (!currentUser || !currentUser.entityId) {
            console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯! Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            throw new Error('User not selected. Cannot load data.');
        }
        
        const loadedData = {
            entities: 0,
            users: 0,
            invoices: 0,
            transactions: 0,
            ledger: 0,
            ads: 0
        };
        
        try {
            // OPTIMIZATION: Load only data needed for current route
            const loadAll = !routeName; // Load all only on initial login
            const needsEntities = loadAll || ['dashboard', 'hierarchy', 'entities'].includes(routeName);
            const needsUsers = loadAll || ['users'].includes(routeName);
            const needsInvoices = loadAll || ['invoices'].includes(routeName);
            const needsTransactions = loadAll || ['invoices', 'ledger'].includes(routeName);
            const needsLedger = loadAll || ['ledger'].includes(routeName);
            const needsAds = loadAll || ['ads'].includes(routeName);
            
            // Load entities (needed for most routes)
            // OPTIMIZATION: Load only essential entities (HQ, BRANCH, and limited others)
            if (needsEntities && (!db.entities || db.entities.length === 0)) {
                console.log('ğŸ“¥ Loading essential entities only...');
                // Only load HQ, BRANCH, and limited INCUBATOR/PLATFORM/OFFICE
                const entities = await fetchAPI('/entities?types=HQ,BRANCH&limit=50');
                db.entities = entities.map(e => ({
                    id: e.id,
                    name: e.name,
                    type: e.type,
                    status: e.status,
                    balance: parseFloat(e.balance) || 0,
                    location: e.location,
                    users: e.users_count || 0,
                    plan: e.plan,
                    expiry: e.expiry_date,
                    theme: e.theme
                }));
                loadedData.entities = db.entities.length;
                console.log(`âœ… Loaded ${loadedData.entities} essential entities (optimized)`);
            } else if (db.entities) {
                loadedData.entities = db.entities.length;
                console.log(`âœ… Using cached ${loadedData.entities} entities`);
            }

            // Load users (only when needed)
            if (needsUsers && (!db.users || db.users.length === 0)) {
                console.log('ğŸ“¥ Loading users...');
                const users = await fetchAPI('/users');
                db.users = users.map(u => ({
                    id: u.id,
                    name: u.name,
                    role: u.role,
                    tenantType: u.tenant_type,
                    entityId: u.entity_id,
                    entityName: u.entity_name
                }));
                loadedData.users = db.users.length;
                console.log(`âœ… Loaded ${loadedData.users} users`);
            } else if (db.users) {
                loadedData.users = db.users.length;
                console.log(`âœ… Using cached ${loadedData.users} users`);
            }

            // Load invoices (only when needed)
            if (needsInvoices && (!db.invoices || db.invoices.length === 0)) {
                console.log('ğŸ“¥ Loading invoices...');
                const invoices = await fetchAPI('/invoices');
                db.invoices = invoices.map(inv => ({
                    id: inv.id,
                    entityId: inv.entity_id,
                    type: inv.type,
                    title: inv.title,
                    amount: parseFloat(inv.amount),
                    paidAmount: parseFloat(inv.paid_amount),
                    status: inv.status,
                    date: inv.issue_date,
                    dueDate: inv.due_date,
                    customerName: inv.customer_name || '',
                    customerNumber: inv.customer_number || '',
                    customerPhone: inv.customer_phone || '',
                    customerEmail: inv.customer_email || '',
                    paymentMethod: inv.payment_method || ''
                }));
                loadedData.invoices = db.invoices.length;
                console.log(`âœ… Loaded ${loadedData.invoices} invoices`);
            } else if (db.invoices) {
                loadedData.invoices = db.invoices.length;
                console.log(`âœ… Using cached ${loadedData.invoices} invoices`);
            }

            // Load transactions (only when needed)
            if (needsTransactions && (!db.transactions || db.transactions.length === 0)) {
                console.log('ğŸ“¥ Loading transactions...');
                const transactions = await fetchAPI('/transactions');
                db.transactions = transactions.map(t => ({
                    id: t.id,
                    invoiceId: t.invoice_id,
                    entityId: t.entity_id,
                    type: t.type,
                    amount: parseFloat(t.amount),
                    method: t.payment_method,
                    date: t.transaction_date,
                    ref: t.reference_code,
                    user: t.user_name
                }));
                loadedData.transactions = db.transactions.length;
                console.log(`âœ… Loaded ${loadedData.transactions} transactions`);
            } else if (db.transactions) {
                loadedData.transactions = db.transactions.length;
                console.log(`âœ… Using cached ${loadedData.transactions} transactions`);
            }

            // Load ledger (only when needed)
            if (needsLedger && (!db.ledger || db.ledger.length === 0)) {
                console.log('ğŸ“¥ Loading ledger...');
                const ledger = await fetchAPI('/ledger');
                db.ledger = ledger.map(l => ({
                    id: l.id,
                    entityId: l.entity_id,
                    trxId: l.transaction_id,
                    date: l.transaction_date,
                    desc: l.description,
                    debit: parseFloat(l.debit),
                    credit: parseFloat(l.credit),
                    balance: parseFloat(l.balance),
                    type: l.type
                }));
                loadedData.ledger = db.ledger.length;
                console.log(`âœ… Loaded ${loadedData.ledger} ledger entries`);
            } else if (db.ledger) {
                loadedData.ledger = db.ledger.length;
                console.log(`âœ… Using cached ${loadedData.ledger} ledger entries`);
            }

            // Load ads (only when needed)
            if (needsAds && (!db.ads || db.ads.length === 0)) {
                console.log('ğŸ“¥ Loading ads...');
                const ads = await fetchAPI('/ads');
                db.ads = ads.map(ad => {
                    const sourceId = ad.source_entity_id || ad.entity_id;
                    const levelKeys = Array.isArray(ad.levels)
                        ? ad.levels
                        : ad.level && typeof ad.level === 'string' && ad.level.includes(',')
                        ? ad.level.split(',').map(x => x.trim()).filter(Boolean)
                        : ad.level
                            ? [ad.level]
                            : [];
                    // Convert target_ids from string to array
                    let targetIds = [];
                    if (ad.target_ids) {
                        targetIds = typeof ad.target_ids === 'string' 
                            ? ad.target_ids.split(',').filter(id => id.trim()) 
                            : ad.target_ids;
                    }
                    return {
                        id: ad.id,
                        title: ad.title,
                        content: ad.content,
                        level: levelKeys[0] || ad.level,
                        levels: levelKeys,
                        scope: ad.scope,
                        status: ad.status,
                        sourceEntityId: sourceId,
                        entityId: ad.entity_id,
                        targetIds: targetIds,
                        date: ad.created_at,
                        cost: parseFloat(ad.cost) || 0,
                        sourceType: ad.source_type,
                        budget: parseFloat(ad.budget) || 0,
                        spent: parseFloat(ad.spent) || 0,
                        impressions: ad.impressions || 0,
                        clicks: ad.clicks || 0,
                        startDate: ad.start_date,
                        endDate: ad.end_date
                    };
                });
                loadedData.ads = db.ads.length;
                console.log(`âœ… Loaded ${loadedData.ads} ads`);
            } else if (db.ads) {
                loadedData.ads = db.ads.length;
                console.log(`âœ… Using cached ${loadedData.ads} ads`);
            }

            // Load approvals
            console.log('ğŸ“¥ Loading approvals...');
            const approvals = await fetchAPI('/approvals');
            db.approvals = approvals.map(a => ({
                id: a.id,
                entityId: a.entity_id,
                itemType: a.item_type,
                itemId: a.item_id,
                itemTitle: a.item_title,
                amount: parseFloat(a.amount),
                currentLevel: a.current_level,
                status: a.status,
                createdBy: a.created_by,
                createdByName: a.created_by_name,
                createdAt: a.created_at,
                steps: a.steps || []
            }));
            console.log(`âœ… Loaded ${db.approvals.length} approvals`);

            // Load employee requests
            console.log('ğŸ“¥ Loading employee requests...');
            const employeeRequests = await fetchAPI('/employee-requests');
            db.employeeRequests = employeeRequests.map(req => ({
                id: req.id,
                entityId: req.entity_id,
                employeeId: req.employee_id,
                employeeName: req.employee_name,
                requestType: req.request_type,
                requestTitle: req.request_title,
                description: req.description,
                status: req.status,
                priority: req.priority,
                requestData: req.request_data,
                requiresApproval: req.requires_approval,
                approverId: req.approver_id,
                approverName: req.approver_name,
                approvalDate: req.approval_date,
                approvalNotes: req.approval_notes,
                requestedDate: req.requested_date,
                startDate: req.start_date,
                endDate: req.end_date,
                completionDate: req.completion_date,
                attachments: req.attachments,
                notes: req.notes,
                createdBy: req.created_by,
                createdAt: req.created_at,
                updatedAt: req.updated_at
            }));
            console.log(`âœ… Loaded ${db.employeeRequests.length} employee requests`);

            // Load payment methods
            console.log('ğŸ“¥ Loading payment methods...');
            const paymentMethods = await fetchAPI('/api/payment-methods?is_active=true');
            db.paymentMethods = paymentMethods.map(pm => ({
                id: pm.id,
                methodCode: pm.method_code,
                methodNameAr: pm.method_name_ar,
                methodNameEn: pm.method_name_en,
                descriptionAr: pm.description_ar,
                descriptionEn: pm.description_en,
                icon: pm.icon,
                color: pm.color,
                isActive: pm.is_active,
                requiresBankDetails: pm.requires_bank_details,
                requiresCardDetails: pm.requires_card_details,
                processingFeePercentage: pm.processing_fee_percentage,
                processingFeeFixed: pm.processing_fee_fixed,
                minAmount: pm.min_amount,
                maxAmount: pm.max_amount,
                displayOrder: pm.display_order
            }));
            console.log(`âœ… Loaded ${db.paymentMethods.length} payment methods`);

            // Load installment plan types
            console.log('ğŸ“¥ Loading installment plan types...');
            const installmentPlanTypes = await fetchAPI('/api/installment-plan-types?is_active=true');
            db.installmentPlanTypes = installmentPlanTypes.map(ipt => ({
                id: ipt.id,
                planCode: ipt.plan_code,
                planNameAr: ipt.plan_name_ar,
                planNameEn: ipt.plan_name_en,
                descriptionAr: ipt.description_ar,
                descriptionEn: ipt.description_en,
                durationMonths: ipt.duration_months,
                numberOfPayments: ipt.number_of_payments,
                paymentFrequency: ipt.payment_frequency,
                interestRate: ipt.interest_rate,
                adminFee: ipt.admin_fee,
                latePaymentFee: ipt.late_payment_fee,
                minAmount: ipt.min_amount,
                maxAmount: ipt.max_amount,
                hasGracePeriod: ipt.has_grace_period,
                gracePeriodDays: ipt.grace_period_days,
                earlyPaymentDiscount: ipt.early_payment_discount,
                icon: ipt.icon,
                color: ipt.color,
                badgeText: ipt.badge_text,
                isActive: ipt.is_active,
                isFeatured: ipt.is_featured,
                displayOrder: ipt.display_order
            }));
            console.log(`âœ… Loaded ${db.installmentPlanTypes.length} installment plan types`);

            // Load tax settings
            console.log('ğŸ“¥ Loading tax settings...');
            const taxSettings = await fetchAPI('/api/tax-settings?is_active=true');
            db.taxSettings = taxSettings.map(ts => ({
                id: ts.id,
                taxCode: ts.tax_code,
                taxNameAr: ts.tax_name_ar,
                taxNameEn: ts.tax_name_en,
                descriptionAr: ts.description_ar,
                descriptionEn: ts.description_en,
                taxType: ts.tax_type,
                defaultRate: ts.default_rate,
                branchId: ts.branch_id,
                branchNameAr: ts.branch_name_ar,
                branchSpecificRate: ts.branch_specific_rate,
                isActive: ts.is_active,
                applicableOn: ts.applicable_on,
                calculationMethod: ts.calculation_method,
                includeInTotal: ts.include_in_total,
                isDefault: ts.is_default,
                priority: ts.priority,
                minAmount: ts.min_amount,
                maxAmount: ts.max_amount
            }));
            console.log(`âœ… Loaded ${db.taxSettings.length} tax settings`);

            // Load notifications for current user
            if (currentUser?.id) {
                console.log('ğŸ“¥ Loading notifications...');
                const notifications = await fetchAPI(`/notifications?user_id=${currentUser.id}`);
                db.notifications = notifications.map(n => ({
                    id: n.id,
                    userId: n.user_id,
                    entityId: n.entity_id,
                    type: n.type,
                    title: n.title,
                    message: n.message,
                    linkType: n.link_type,
                    linkId: n.link_id,
                    isRead: n.is_read,
                    priority: n.priority,
                    createdAt: n.created_at
                }));
                console.log(`âœ… Loaded ${db.notifications.length} notifications`);
            }

            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', loadedData);
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            console.error('âŒ Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name
            });
            
            // Log which endpoint failed
            console.warn('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
            
            // Use fallback data
            if (!db.entities || db.entities.length === 0) {
                db.entities = fallbackData.entities;
                console.log('ğŸ“¦ Using fallback entities');
            }
            if (!db.users || db.users.length === 0) {
                db.users = fallbackData.users;
                console.log('ğŸ“¦ Using fallback users');
            }
            
            // Throw error to be caught by init()
            throw new Error(`Failed to load data: ${error.message}`);
        }
    }

    // --- INIT & NAV ---
    const init = async () => {
        console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...');
        
        try {
            // ========================================
            // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
            // ========================================
            const authToken = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
            const savedUser = localStorage.getItem('user') || sessionStorage.getItem('user');
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªÙˆÙƒÙ†ØŒ Ø£Ø¹Ø¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (!authToken || !savedUser) {
                console.log('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† Ù…ØµØ§Ø¯Ù‚Ø© - Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                window.location.href = '/login-page.html';
                return;
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            try {
                const userData = JSON.parse(savedUser);
                // ØªØ­ÙˆÙŠÙ„ Ù…Ù† snake_case Ø¥Ù„Ù‰ camelCase Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…
                currentUser = {
                    ...userData,
                    tenantType: userData.tenant_type || userData.tenantType || 'HQ',
                    entityId: userData.entity_id || userData.entityId,
                    entityName: userData.entity_name || userData.entityName
                };
                window.currentUserData = currentUser;
                console.log('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', currentUser);
            } catch (e) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', e);
                // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§Ø³Ø¯Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = '/login-page.html';
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            try {
                const verifyResponse = await fetch('/api/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (!verifyResponse.ok) {
                    console.log('âŒ Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­ - Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = '/login-page.html';
                    return;
                }
            } catch (verifyError) {
                console.warn('âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†:', verifyError);
                // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø­Ø°Ø± - Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³ÙŠØ±ÙØ± ØºÙŠØ± Ù…ØªØ§Ø­
            }
            
            const view = document.getElementById('main-view');
            
            // Show loading
            view.innerHTML = `
                <div class="flex h-full items-center justify-center flex-col gap-6">
                    <div class="relative">
                        <div class="w-24 h-24 rounded-full border-4 border-brand-200 border-t-brand-600 animate-spin"></div>
                        <i class="fas fa-database absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl text-brand-600"></i>
                    </div>
                    <p class="text-slate-600 font-bold text-lg animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: <strong>${currentUser.name}</strong></p>
                </div>`;
            
            // Load data from API (now with proper entity headers)
            try {
                await loadAllData();
                console.log('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', { entities: db.entities.length, users: db.users.length, invoices: db.invoices.length });
            } catch (apiError) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API:', apiError);
                // Continue with empty data - app will still work
                console.log('âš ï¸ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©...');
            }
            
            // User is already selected from tenant selector
            console.log('ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:', currentUser);
            
            renderSidebar();
            updateHeader();
            const tenant = db.entities.find(e => e.id === currentUser?.entity_id);
            if(tenant && tenant.theme) updateThemeVariables(tenant.theme);
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', (event) => {
                const path = window.location.pathname;
                const route = pathToRoute[path] || 'dashboard';
                loadRoute(route, true); // skipHistory = true to avoid pushing same state again
            });
            
            // Load route based on current URL path
            const currentPath = window.location.pathname;
            const initialRoute = pathToRoute[currentPath] || 'dashboard';
            loadRoute(initialRoute, true);
            
            showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser?.name || 'Ø¨Ùƒ'}`, 'success');
            console.log('âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„ØªÙ‡ÙŠØ¦Ø©');
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙØ§Ø¯Ø­ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
            const view = document.getElementById('main-view');
            view.innerHTML = `
                <div class="flex h-full items-center justify-center flex-col gap-6 p-8">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                        <p class="text-slate-600 mb-4">ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p>
                        <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition">
                            <i class="fas fa-sync-alt mr-2"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                        </button>
                    </div>
                    <div class="text-sm text-slate-400 bg-slate-100 p-4 rounded-lg max-w-2xl">
                        <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}
                    </div>
                </div>
            `;
        }
    };

    const init_old = () => {
        renderSidebar();
        updateHeader();
        const tenant = db.entities.find(e => e.id === currentUser.entityId);
        if(tenant && tenant.theme) updateThemeVariables(tenant.theme);
        
        loadRoute('dashboard');
        showToast(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${currentUser.entityName}`, 'success');
    };

    const toggleMobileMenu = () => {
        const sidebar = document.getElementById('sidebar');
        const backdrop = document.getElementById('mobile-backdrop');
        const isClosed = sidebar.classList.contains('translate-x-full');

        if (isClosed) {
            sidebar.classList.remove('translate-x-full');
            sidebar.classList.add('translate-x-0');
            backdrop.classList.remove('hidden');
            requestAnimationFrame(() => backdrop.classList.remove('opacity-0'));
        } else {
            sidebar.classList.remove('translate-x-0');
            sidebar.classList.add('translate-x-full');
            backdrop.classList.add('opacity-0');
            setTimeout(() => backdrop.classList.add('hidden'), 300);
        }
    };

    const switchUser = (id) => {
        const u = db.users.find(x => x.id === id);
        if (u) {
            toggleRoleMenu();
            const sidebar = document.getElementById('sidebar');
            if (sidebar.classList.contains('translate-x-0') && window.innerWidth < 768) {
                toggleMobileMenu();
            }
            currentUser = u;
            const tenant = db.entities.find(e => e.id === currentUser.entityId);
            if(tenant && tenant.theme) updateThemeVariables(tenant.theme);
            const view = document.getElementById('main-view');
            view.innerHTML = `
                <div class="flex h-full items-center justify-center flex-col gap-6">
                    <div class="relative">
                        <div class="w-24 h-24 rounded-full border-4 border-brand-200 border-t-brand-600 animate-spin"></div>
                        <i class="fas fa-sync absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl text-brand-600"></i>
                    </div>
                    <p class="text-slate-600 font-bold text-lg animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ¨Ø¯ÙŠÙ„ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± (Tenant Context)...</p>
                </div>`;
            setTimeout(() => { 
                renderSidebar(); updateHeader(); loadRoute('dashboard');
                showToast(`Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ Ù†Ø·Ø§Ù‚: ${currentUser.entityName}`, 'success');
            }, 800);
        }
    };

    const toggleRoleMenu = (event) => {
        if (event) event.stopPropagation();
        const menu = document.getElementById('role-menu');
        const chevron = document.getElementById('role-chevron');
        
        // Populate menu with users when opening
        if (menu.classList.contains('hidden')) {
            // Group users by tenant type
            const grouped = {};
            db.users.forEach(u => {
                if (!grouped[u.tenantType]) grouped[u.tenantType] = [];
                grouped[u.tenantType].push(u);
            });
            
            let menuHTML = '<div class="p-4">';
            menuHTML += '<h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªØ¨Ø¯ÙŠÙ„</h3>';
            
            // Add "Change Entity" button
            menuHTML += `
                <button onclick="app.changeTenant()" 
                        class="w-full mb-4 p-3 rounded-lg bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-red-700 transition flex items-center gap-3 group shadow-lg">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-exchange-alt text-lg"></i>
                    </div>
                    <div class="flex-1 text-right">
                        <div class="font-bold text-sm">ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙŠØ§Ù†</div>
                        <div class="text-xs opacity-90">Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ÙƒÙŠØ§Ù† Ø¢Ø®Ø±</div>
                    </div>
                </button>
                <div class="border-t border-gray-200 my-3"></div>
            `;
            
            Object.entries(grouped).forEach(([type, users]) => {
                const typeInfo = TENANT_TYPES[type] || TENANT_TYPES.BRANCH;
                menuHTML += `<div class="mb-4">`;
                menuHTML += `<div class="text-xs font-bold text-slate-400 mb-2 flex items-center gap-2">
                    <i class="fas ${typeInfo.icon}"></i>
                    <span>${typeInfo.label}</span>
                </div>`;
                
                users.forEach(u => {
                    const isActive = currentUser && u.id === currentUser.id;
                    menuHTML += `
                        <button onclick="app.switchUser(${u.id})" 
                                class="w-full text-right p-3 rounded-lg hover:bg-slate-50 transition flex items-center gap-3 group ${isActive ? 'bg-brand-50 border border-brand-200' : ''}">
                            <div class="w-10 h-10 rounded-full ${typeInfo.bg} ${typeInfo.color} flex items-center justify-center font-bold text-sm flex-shrink-0">
                                ${u.name.charAt(0)}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-sm text-slate-800 truncate">${u.name}</div>
                                <div class="text-xs text-slate-500 truncate">${u.role} - ${u.entityName}</div>
                            </div>
                            ${isActive ? '<i class="fas fa-check text-brand-600"></i>' : ''}
                        </button>
                    `;
                });
                menuHTML += '</div>';
            });
            
            menuHTML += '</div>';
            menu.innerHTML = menuHTML;
            
            menu.classList.remove('hidden');
            setTimeout(() => { menu.classList.remove('opacity-0', 'scale-95'); menu.classList.add('opacity-100', 'scale-100'); }, 10);
            chevron.classList.add('rotate-180');
        } else {
            menu.classList.remove('opacity-100', 'scale-100');
            menu.classList.add('opacity-0', 'scale-95');
            chevron.classList.remove('rotate-180');
            setTimeout(() => menu.classList.add('hidden'), 200);
        }
    };

    window.addEventListener('click', (e) => {
        const menu = document.getElementById('role-menu');
        const btn = document.querySelector('button[onclick*="toggleRoleMenu"]');
        if (menu && !menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) toggleRoleMenu();
    });

    const changeTenant = () => {
        // Clear saved entity
        localStorage.removeItem('nayosh_selected_entity');
        currentUser = null;
        window.currentUserData = null;
        
        // Reload page to show tenant selector
        showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙŠØ§Ù†...', 'info');
        setTimeout(() => {
            location.reload();
        }, 500);
    };

    const updateHeader = () => {
        if (!currentUser) return;
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† snake_case Ø¥Ù„Ù‰ camelCase Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        const tenantType = currentUser.tenantType || currentUser.tenant_type || 'HQ';
        const entityId = currentUser.entityId || currentUser.entity_id || 'Unknown';
        
        document.getElementById('user-name').innerText = currentUser.name;
        const tenantInfo = TENANT_TYPES[tenantType] || TENANT_TYPES.HQ;
        document.getElementById('user-role').innerText = tenantInfo.label;
        document.getElementById('user-initials').innerText = currentUser.name.charAt(0);
        document.getElementById('tenant-id-display').innerText = entityId;
        document.getElementById('tenant-badge').className = `hidden md:flex items-center gap-2 border px-3 py-1 rounded-full animate-fade-in ${tenantInfo.bg} ${tenantInfo.color} border-current border-opacity-20`;
        
        // Update notification bell
        const unreadCount = db.notifications.filter(n => !n.isRead).length;
        const notificationBell = document.getElementById('notification-bell');
        if (notificationBell) {
            notificationBell.innerHTML = `
                <i class="fas fa-bell text-lg"></i>
                ${unreadCount > 0 ? `<span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold animate-pulse">${unreadCount > 9 ? '9+' : unreadCount}</span>` : ''}
            `;
        }
    };

    const loadRoute = async (route, skipHistory = false) => {
        const sidebar = document.getElementById('sidebar');
        if (sidebar && sidebar.classList.contains('translate-x-0') && window.innerWidth < 768) toggleMobileMenu();

        // Update browser URL
        if (!skipHistory) {
            const path = routeToPath[route] || '/';
            window.history.pushState({ route }, '', path);
        }

        const view = document.getElementById('main-view');
        document.getElementById('page-title').innerText = getTitle(route);
        if (activeChart) { activeChart.destroy(); activeChart = null; }
        if (analyticsChart) { analyticsChart.destroy(); analyticsChart = null; }
        
        let content = '';
        if (route === 'dashboard') {
            view.innerHTML = '<div class="flex items-center justify-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div></div>';
            content = await renderDashboard();
        }
        else if (route === 'super-admin') {
            // ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Super Admin
            window.location.href = '/super-admin-page.html';
            return;
        }
        else if (route === 'hierarchy') {
            content = await renderHierarchy();
            // Load branch relationships after rendering
            setTimeout(() => {
                if (typeof app !== 'undefined' && app.loadBranchRelationships) {
                    app.loadBranchRelationships();
                }
            }, 500);
        }
        else if (route === 'employees') content = await renderEmployees();
        else if (route === 'saas') content = renderSaaSManager();
        else if (route === 'ads') content = renderAdsManager();
        else if (route === 'finance') content = renderFinance();
        else if (route === 'collections') content = renderCollections();
        else if (route === 'approvals') content = renderApprovals();
        else if (route === 'requests') content = renderRequests();
        // Employee HR Routes
        else if (route === 'attendance-departure') content = renderAttendanceDeparture();
        else if (route === 'emp-requests') content = renderEmpRequests();
        else if (route === 'emp-leaves') content = renderEmpLeaves();
        else if (route === 'leave-balance') content = renderLeaveBalance();
        else if (route === 'notifications-warnings') content = renderNotificationsWarnings();
        else if (route === 'emp-decisions') content = renderEmpDecisions();
        else if (route === 'company-violations') content = renderCompanyViolations();
        else if (route === 'evaluation-forms') content = renderEvaluationForms();
        else if (route === 'circulars') content = renderCirculars();
        else if (route === 'advances-receivables') content = renderAdvancesReceivables();
        else if (route === 'surveys') content = renderSurveys();
        else if (route === 'business-activities') content = renderBusinessActivities();
        else if (route === 'emp-letters') content = renderEmpLetters();
        else if (route === 'custodies') content = renderCustodies();
        else if (route === 'salary-slips') content = renderSalarySlips();
        else if (route === 'attendance-register') content = renderAttendanceRegister();
        else if (route === 'attendance-table') content = renderAttendanceTable();
        else if (route === 'incubator') {
            view.innerHTML = '<div class="flex items-center justify-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div></div>';
            await renderIncubator();
        }
        else if (route === 'entities') content = renderEntitiesManager();
        else if (route === 'register-tenant') content = renderTenantRegistration();
        else if (route === 'tasks') content = renderTasksManager();
        else if (route === 'facilities') content = renderFacilities();
        else if (route === 'audit-logs') content = renderAuditLogs();
        else if (route === 'settings') content = renderSettings();
        // Strategic Management Routes
        else if (route === 'executive-management') {
            console.log('ğŸ”„ Routing to: executive-management');
            content = await renderExecutiveManagement();
        }
        else if (route === 'employee-management') {
            console.log('ğŸ”„ Routing to: employee-management');
            content = renderEmployeeManagement();
        }
        else if (route === 'smart-systems') {
            console.log('ğŸ”„ Routing to: smart-systems');
            content = await renderSmartSystems();
        }
        else if (route === 'subscription-management') {
            console.log('ğŸ”„ Routing to: subscription-management');
            content = await renderSubscriptionManagement();
        }
        else if (route === 'operations-management') {
            console.log('ğŸ”„ Routing to: operations-management');
            content = renderOperationsManagement();
        }
        else if (route === 'financial-approvals') {
            console.log('ğŸ”„ Routing to: financial-approvals');
            content = await renderFinancialApprovals();
        }
        else if (route === 'tenants') content = renderTenants();
        else if (route === 'collections-strategic') content = renderCollectionsStrategic();
        else if (route === 'marketing') content = renderMarketing();
        else if (route === 'advertisers-center') content = renderAdvertisersCenter();
        else if (route === 'training-development') {
            console.log('ğŸ”„ Routing to: training-development');
            content = await renderTrainingDevelopment();
        }
        else if (route === 'quality-audit') {
            console.log('ğŸ”„ Routing to: quality-audit');
            content = await renderQualityAudit();
        }
        else if (route === 'evaluation') {
            console.log('ğŸ”„ Routing to: evaluation');
            content = await renderEvaluation();
        }
        else if (route === 'tasks-strategic') content = renderTasksStrategic();
        else if (route === 'information-center') {
            console.log('ğŸ”„ Routing to: information-center');
            content = await renderInformationCenter();
        }
        else if (route === 'identity-settings') content = renderIdentitySettings();
        else if (route === 'system-log') content = renderSystemLog();
        else if (route === 'reports') content = renderReports();
        // Payment System Routes
        else if (route === 'invoices-enhanced') content = renderInvoicesEnhanced();
        else if (route === 'payment-methods') content = renderPaymentMethods();
        else if (route === 'installment-plans') content = renderInstallmentPlans();
        else if (route === 'payment-tracking') content = renderPaymentTracking();
        else if (route === 'tax-settings') content = renderTaxSettings();
        else if (route === 'collection-rules') content = renderCollectionRules();
        else if (route === 'payment-reminders') content = renderPaymentReminders();
        else if (route === 'overdue-management') content = renderOverdueManagement();
        else if (route === 'payment-analytics') content = renderPaymentAnalytics();
        // Supply Chain Routes
        else if (route === 'purchases') content = renderPurchases();
        else if (route === 'logistics') content = renderLogistics();
        else if (route === 'inventory') content = renderInventory();
        else if (route === 'suppliers') content = renderSuppliers();
        else if (route === 'orders-delivery') content = renderOrdersDelivery();
        else if (route === 'smart-procurement') content = renderSmartProcurement();
        else if (route === 'manufacturing') content = renderManufacturing();
        else if (route === 'product-lifecycle') content = renderProductLifecycle();
        else if (route === 'maintenance') content = renderMaintenance();
        else if (route === 'quality-control') content = renderQualityControl();
        else if (route === 'safety') content = renderSafety();
        // Sales Routes
        else if (route === 'crm') content = renderCRM();
        else if (route === 'sales-operations') content = renderSalesOperations();
        else if (route === 'pos') content = renderPOS();
        else if (route === 'quotes-contracts') content = renderQuotesContracts();
        else if (route === 'commissions') content = renderCommissions();
        else if (route === 'order-tracking') content = renderOrderTracking();
        // Internet & Automation Routes
        else if (route === 'ai-integration') content = renderAIIntegration();
        else if (route === 'governance') content = renderGovernance();
        else if (route === 'compliance') content = renderCompliance();
        else if (route === 'iot') content = renderIOT();
        else if (route === 'elearning') content = renderELearning();
        else if (route === 'forum') content = renderForum();
        else if (route === 'etiquette') content = renderEtiquette();
        else if (route === 'knowledge') content = renderKnowledge();
        else if (route === 'intellectual-property') content = renderIntellectualProperty();
        else if (route === 'visitor-chat') content = renderVisitorChat();
        // Occupational Health & Safety Routes
        else if (route === 'occupational-safety') content = renderOccupationalSafety();
        else if (route === 'international-standards') content = renderInternationalStandards();
        else if (route === 'iso-standards') content = renderISOStandards();
        else if (route === 'risk-management') content = renderRiskManagement();
        else if (route === 'consulting') content = renderConsulting();
        else if (route === 'specialized-courses') content = renderSpecializedCourses();
        else if (route === 'ohs-evaluation') content = renderOHSEvaluation();
        else if (route === 'data-analysis') content = renderDataAnalysis();
        // Services Routes
        else if (route === 'project-management-office') content = renderProjectManagementOffice();
        else if (route === 'institutional-performance') content = renderInstitutionalPerformance();
        else if (route === 'operations-monitoring') content = renderOperationsMonitoring();
        else if (route === 'ai-market-research') content = renderAIMarketResearch();
        else if (route === 'customer-service') content = renderCustomerService();
        else if (route === 'client-admin-services') content = renderClientAdminServices();
        else if (route === 'virtual-halls') content = renderVirtualHalls();
        else if (route === 'feasibility-studies') content = renderFeasibilityStudies();
        else if (route === 'research') content = renderResearch();
        else if (route === 'consulting-training') content = renderConsultingTraining();
        else content = renderPlaceholder();

        if (route !== 'incubator') {
            view.innerHTML = `<div class="fade-in">${content}</div>`;
        }
        updateActiveLink(route);

        if (route === 'dashboard') requestAnimationFrame(initDashboardChart);
        if (route === 'ads' && perms.canManageAds()) requestAnimationFrame(initAnalyticsChart);
    };

    const updateActiveLink = (route) => {
        document.querySelectorAll('#nav-menu a').forEach(l => {
            l.classList.remove('bg-gradient-to-r', 'from-red-600/20', 'to-red-600/5', 'text-white', 'border-r-4', 'border-red-500');
            l.classList.add('text-red-200');
        });
        const active = document.getElementById(`link-${route}`);
        if(active) {
            active.classList.remove('text-red-200');
            active.classList.add('bg-gradient-to-r', 'from-red-600/20', 'to-red-600/5', 'text-white', 'border-r-4', 'border-red-500');
        }
    };

    const getTitle = (r) => {
        const map = { 
            'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© (Tenant Dashboard)',
            'hierarchy': 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ - Multi-Tenant',
            'saas': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª (SaaS)',
            'finance': 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
            'collections': 'Ø§Ù„ØªØ­ØµÙŠÙ„',
            'approvals': 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ©',
            'incubator': 'Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© - Ù…Ù†ØµØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¨',
            'entities': perms.isHQ() ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†' : 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙŠØ§Ù†',
            'register-tenant': 'ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ£Ø¬Ø± Ø¬Ø¯ÙŠØ¯',
            'ads': perms.canManageAds() ? 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©' : 'Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª',
            'tasks': 'Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©',
            'facilities': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚',
            'audit-logs': 'Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Audit Logs)',
            'settings': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©',
            // Strategic Management subitems
            'executive-management': 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©',
            'employee-management': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
            'smart-systems': 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©',
            'subscription-management': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª',
            'operations-management': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',
            'financial-approvals': 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
            'tenants': 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†',
            'collections-strategic': 'Ø§Ù„ØªØ­ØµÙŠÙ„',
            'marketing': 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚',
            'advertisers-center': 'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†',
            'training-development': 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±',
            'quality-audit': 'Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚',
            'evaluation': 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…',
            'tasks-strategic': 'Ø§Ù„Ù…Ù‡Ø§Ù…',
            'information-center': 'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
            'identity-settings': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©',
            'system-log': 'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…',
            'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
            // Supply Chain subitems
            'purchases': 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª',
            'logistics': 'Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ÙˆØ§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„',
            'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
            'suppliers': 'Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†',
            'orders-delivery': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ…',
            'smart-procurement': 'Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ø³Ù„ Ø§Ù„ØªÙˆØ±ÙŠØ¯ ÙˆØ§Ù„Ø¥Ù…Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ',
            'manufacturing': 'Ø§Ù„ØªØµÙ†ÙŠØ¹',
            'product-lifecycle': 'Ø­ÙŠØ§Ø© Ø§Ù„Ù…Ù†ØªØ¬',
            'maintenance': 'Ø§Ù„ØµÙŠØ§Ù†Ø©',
            'quality-control': 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©',
            'safety': 'Ø§Ù„Ø³Ù„Ø§Ù…Ø©',
            // Sales subitems
            'crm': 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ CRM',
            'sales-operations': 'Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹',
            'pos': 'Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„ØªØ´Ø§Ø¨ÙƒÙŠ',
            'quotes-contracts': 'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯',
            'commissions': 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª',
            'order-tracking': 'ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø´Ø­Ù†Ø§Øª',
            // Internet & Automation subitems
            'ai-integration': 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ',
            'governance': 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©',
            'compliance': 'Ø§Ù„Ù…ÙˆØ§Ø¦Ù…Ø©',
            'iot': 'Ø§Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡',
            'elearning': 'Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
            'forum': 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰',
            'etiquette': 'Ø§Ù„Ø¥ØªÙŠÙƒÙŠØª ÙˆØ¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„',
            'knowledge': 'Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„',
            'intellectual-property': 'Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©',
            'visitor-chat': 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ø²ÙˆØ§Ø±',
            // Occupational Health & Safety subitems
            'occupational-safety': 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©',
            'international-standards': 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©',
            'iso-standards': 'Ø§Ù„Ø§ÙŠØ²Ùˆ',
            'risk-management': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
            'consulting': 'Ø§Ù„Ø¥Ø³ØªØ´Ø§Ø±Ø§Øª',
            'specialized-courses': 'Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©',
            'evaluation': 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ… - Ø´Ø±ÙƒØ§ØªØŒ Ù…ØµØ§Ù†Ø¹ØŒ Ù…Ø´Ø§Ø±ÙŠØ¹',
            'data-analysis': 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
            // Services subitems
            'project-management-office': 'Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',
            'institutional-performance': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ',
            'operations-monitoring': 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',
            'ai-market-research': 'Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
            'customer-service': 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
            'client-admin-services': 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„',
            'virtual-halls': 'Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©',
            'feasibility-studies': 'Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰',
            'research': 'Ø§Ù„Ø¨Ø­ÙˆØ«',
            'consulting-training': 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨'
        };
        return map[r] || 'Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´';
    };

    // Route to Path mapping
    const routeToPath = {
        'dashboard': '/home',
        'hierarchy': '/hierarchy',
        'saas': '/saas',
        'billing': '/billing',
        'finance': '/finance',
        'collections': '/collections',
        'approvals': '/approvals',
        'requests': '/requests',
        'incubator': '/incubator',
        'entities': '/tenants',
        'register-tenant': '/register-tenant',
        'ads': '/ads',
        'tasks': '/tasks',
        'facilities': '/facilities',
        'audit-logs': '/audit-logs',
        'settings': '/settings',
        'employees': '/hr',
        // Strategic Management Routes
        'executive-management': '/strategic/executive',
        'employee-management': '/strategic/employees',
        'smart-systems': '/strategic/smart-systems',
        'subscription-management': '/strategic/subscriptions',
        'operations-management': '/strategic/operations',
        'financial-approvals': '/strategic/financial-approvals',
        'tenants': '/strategic/tenants',
        'collections-strategic': '/strategic/collections',
        'marketing': '/strategic/marketing',
        'advertisers-center': '/strategic/advertisers',
        'training-development': '/strategic/training',
        'quality-audit': '/strategic/quality',
        'evaluation': '/strategic/evaluation',
        'tasks-strategic': '/strategic/tasks',
        'information-center': '/strategic/information',
        'identity-settings': '/strategic/identity',
        'system-log': '/strategic/log',
        'reports': '/strategic/reports'
    };

    // Path to Route mapping (reverse)
    const pathToRoute = {
        '/home': 'dashboard',
        '/': 'dashboard',
        '/hierarchy': 'hierarchy',
        '/saas': 'saas',
        '/billing': 'billing',
        '/finance': 'finance',
        '/collections': 'collections',
        '/approvals': 'approvals',
        '/requests': 'requests',
        '/incubator': 'incubator',
        '/tenants': 'entities',
        '/register-tenant': 'register-tenant',
        '/ads': 'ads',
        '/tasks': 'tasks',
        '/facilities': 'facilities',
        '/audit-logs': 'audit-logs',
        '/settings': 'settings',
        '/hr': 'employees',
        // Strategic Management Routes
        '/strategic/executive': 'executive-management',
        '/strategic/employees': 'employee-management',
        '/strategic/smart-systems': 'smart-systems',
        '/strategic/subscriptions': 'subscription-management',
        '/strategic/operations': 'operations-management',
        '/strategic/financial-approvals': 'financial-approvals',
        '/strategic/tenants': 'tenants',
        '/strategic/collections': 'collections-strategic',
        '/strategic/marketing': 'marketing',
        '/strategic/advertisers': 'advertisers-center',
        '/strategic/training': 'training-development',
        '/strategic/quality': 'quality-audit',
        '/strategic/evaluation': 'evaluation',
        '/strategic/tasks': 'tasks-strategic',
        '/strategic/information': 'information-center',
        '/strategic/identity': 'identity-settings',
        '/strategic/log': 'system-log',
        '/strategic/reports': 'reports'
    };

    const renderSidebar = () => {
        console.log('ğŸ”„ Ø±Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©...', { currentUser });
        const menu = document.getElementById('nav-menu');
        if (!currentUser) {
            menu.innerHTML = '<li class="px-4 py-2 text-slate-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>';
            console.warn('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠ!');
            return;
        }
        
        const unreadCount = db.notifications.filter(n => !n.isRead).length;
        const pendingApprovals = db.approvals.filter(a => 
            a.status === 'PENDING' && 
            a.steps.some(s => s.approver_id === currentUser.id && s.status === 'PENDING')
        ).length;
        
        const currentEntity = db.entities.find(e => e.id === currentUser.entityId);
        const isIncubator = currentEntity?.type === 'INCUBATOR';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Super Admin (HQ001 ÙÙ‚Ø·)
        const isSuperAdmin = currentUser.entityId === 'HQ001' || currentUser.entityId === 1;
        
        const items = [
            { id: 'dashboard', icon: 'fa-chart-pie', label: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', show: true },
            { id: 'super-admin', icon: 'fa-shield-alt', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', show: isSuperAdmin },
            {
                id: 'strategic-management',
                icon: 'fa-chess',
                label: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©',
                show: true,
subItems: [
                    { id: 'executive-management', icon: 'fa-user-tie', label: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©' },
                    { id: 'employee-management', icon: 'fa-users-cog', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†' },
                    { id: 'smart-systems', icon: 'fa-microchip', label: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©' },
                    { id: 'subscription-management', icon: 'fa-tags', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª' },
                    { id: 'operations-management', icon: 'fa-cogs', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' },
                    { id: 'financial-approvals', icon: 'fa-file-signature', label: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
                    { id: 'tenants', icon: 'fa-building', label: 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†' },
                    { id: 'collections-strategic', icon: 'fa-coins', label: 'Ø§Ù„ØªØ­ØµÙŠÙ„' },
                    { id: 'marketing', icon: 'fa-bullhorn', label: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚' },
                    { id: 'advertisers-center', icon: 'fa-ad', label: 'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†' },
                    { id: 'training-development', icon: 'fa-chalkboard-teacher', label: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±' },
                    { id: 'quality-audit', icon: 'fa-clipboard-check', label: 'Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚' },
                    { id: 'evaluation', icon: 'fa-star', label: 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' },
                    { id: 'tasks-strategic', icon: 'fa-tasks', label: 'Ø§Ù„Ù…Ù‡Ø§Ù…' },
                    { id: 'information-center', icon: 'fa-info-circle', label: 'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
                    { id: 'identity-settings', icon: 'fa-palette', label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©' },
                    { id: 'system-log', icon: 'fa-file-alt', label: 'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…' },
                    { id: 'reports', icon: 'fa-chart-line', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±' }
                ]
            },
            { id: 'hierarchy', icon: 'fa-sitemap', label: 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ', show: true },
            { id: 'saas', icon: 'fa-cubes', label: perms.isHQ() ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª' : 'Ø§Ø´ØªØ±Ø§ÙƒÙŠ (SaaS)', show: true },
            { id: 'incubator', icon: 'fa-graduation-cap', label: 'Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', show: isIncubator || perms.isHQ() },
            { id: 'finance', icon: 'fa-dollar-sign', label: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', show: true },
            { id: 'collections', icon: 'fa-money-bill-wave', label: 'Ø§Ù„ØªØ­ØµÙŠÙ„', show: true },
            { id: 'approvals', icon: 'fa-check-circle', label: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©', show: perms.isFinance(), badge: pendingApprovals },
            { id: 'requests', icon: 'fa-clipboard-list', label: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª', show: true },
            {
                id: 'payment-menu',
                icon: 'fa-credit-card',
                label: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹',
                show: true,
                subItems: [
                    { id: 'invoices-enhanced', icon: 'fa-file-invoice-dollar', label: 'Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø°ÙƒÙŠØ©' },
                    { id: 'payment-methods', icon: 'fa-wallet', label: 'Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹' },
                    { id: 'installment-plans', icon: 'fa-calendar-days', label: 'Ø®Ø·Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ø·' },
                    { id: 'payment-tracking', icon: 'fa-chart-line', label: 'ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙØ¹Ø§Øª' },
                    { id: 'tax-settings', icon: 'fa-percent', label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨' },
                    { id: 'collection-rules', icon: 'fa-cog', label: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­ØµÙŠÙ„' },
                    { id: 'payment-reminders', icon: 'fa-bell', label: 'Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ø¢Ù„ÙŠØ©' },
                    { id: 'overdue-management', icon: 'fa-exclamation-circle', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª' },
                    { id: 'payment-analytics', icon: 'fa-chart-bar', label: 'ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¯ÙØ¹' }
                ]
            },
            { 
                id: 'employee-menu', 
                icon: 'fa-user-tie', 
                label: 'Ø§Ù„Ù…ÙˆØ¸Ù', 
                show: true,
                subItems: [
                    { id: 'attendance-departure', icon: 'fa-clock', label: 'Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù' },
                    { id: 'emp-requests', icon: 'fa-clipboard-list', label: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª' },
                    { id: 'emp-leaves', icon: 'fa-umbrella-beach', label: 'Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª' },
                    { id: 'leave-balance', icon: 'fa-calendar-check', label: 'Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª' },
                    { id: 'notifications-warnings', icon: 'fa-bell', label: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª/Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª' },
                    { id: 'emp-decisions', icon: 'fa-gavel', label: 'Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª' },
                    { id: 'company-violations', icon: 'fa-exclamation-triangle', label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ©' },
                    { id: 'evaluation-forms', icon: 'fa-clipboard-check', label: 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' },
                    { id: 'circulars', icon: 'fa-file-alt', label: 'Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…' },
                    { id: 'advances-receivables', icon: 'fa-hand-holding-usd', label: 'Ø§Ù„Ø³Ù„Ù/Ø§Ù„Ø°Ù…Ù…' },
                    { id: 'surveys', icon: 'fa-poll', label: 'Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª' },
                    { id: 'business-activities', icon: 'fa-briefcase', label: 'Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„' },
                    { id: 'emp-letters', icon: 'fa-envelope', label: 'Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª' },
                    { id: 'custodies', icon: 'fa-box', label: 'Ø§Ù„Ø¹Ù‡Ø¯' },
                    { id: 'salary-slips', icon: 'fa-receipt', label: 'Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ø±Ø§ØªØ¨' },
                    { id: 'attendance-register', icon: 'fa-fingerprint', label: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±' },
                    { id: 'attendance-table', icon: 'fa-table', label: 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±' }
                ]
            },
            {
                id: 'supply-chain',
                icon: 'fa-truck-loading',
                label: 'Ø³Ù„Ø§Ø³Ù„ Ø§Ù„ØªÙˆØ±ÙŠØ¯',
                show: true,
                subItems: [
                    { id: 'purchases', icon: 'fa-shopping-cart', label: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª' },
                    { id: 'logistics', icon: 'fa-truck', label: 'Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ÙˆØ§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„' },
                    { id: 'inventory', icon: 'fa-boxes', label: 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†' },
                    { id: 'suppliers', icon: 'fa-handshake', label: 'Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†' },
                    { id: 'orders-delivery', icon: 'fa-clipboard-list', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ…' },
                    { id: 'smart-procurement', icon: 'fa-brain', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ø³Ù„ Ø§Ù„ØªÙˆØ±ÙŠØ¯ ÙˆØ§Ù„Ø¥Ù…Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ' },
                    { id: 'manufacturing', icon: 'fa-industry', label: 'Ø§Ù„ØªØµÙ†ÙŠØ¹' },
                    { id: 'product-lifecycle', icon: 'fa-recycle', label: 'Ø­ÙŠØ§Ø© Ø§Ù„Ù…Ù†ØªØ¬' },
                    { id: 'maintenance', icon: 'fa-wrench', label: 'Ø§Ù„ØµÙŠØ§Ù†Ø©' },
                    { id: 'quality-control', icon: 'fa-check-double', label: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©' },
                    { id: 'safety', icon: 'fa-hard-hat', label: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø©' }
                ]
            },
            {
                id: 'sales',
                icon: 'fa-chart-line',
                label: 'Ø§Ù„Ø¨ÙŠØ¹',
                show: true,
                subItems: [
                    { id: 'crm', icon: 'fa-users-cog', label: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ CRM' },
                    { id: 'sales-operations', icon: 'fa-handshake', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹' },
                    { id: 'pos', icon: 'fa-cash-register', label: 'Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„ØªØ´Ø§Ø¨ÙƒÙŠ' },
                    { id: 'quotes-contracts', icon: 'fa-file-contract', label: 'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯' },
                    { id: 'commissions', icon: 'fa-percentage', label: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª' },
                    { id: 'order-tracking', icon: 'fa-shipping-fast', label: 'ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø´Ø­Ù†Ø§Øª' }
                ]
            },
            {
                id: 'internet-automation',
                icon: 'fa-robot',
                label: 'Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ø£ØªÙ…ØªØ©',
                show: true,
                subItems: [
                    { id: 'ai-integration', icon: 'fa-brain', label: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ' },
                    { id: 'governance', icon: 'fa-gavel', label: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©' },
                    { id: 'compliance', icon: 'fa-balance-scale', label: 'Ø§Ù„Ù…ÙˆØ§Ø¦Ù…Ø©' },
                    { id: 'iot', icon: 'fa-network-wired', label: 'Ø§Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡' },
                    { id: 'elearning', icon: 'fa-graduation-cap', label: 'Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' },
                    { id: 'forum', icon: 'fa-comments', label: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰' },
                    { id: 'etiquette', icon: 'fa-user-tie', label: 'Ø§Ù„Ø¥ØªÙŠÙƒÙŠØª ÙˆØ¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„' },
                    { id: 'knowledge', icon: 'fa-lightbulb', label: 'Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„' },
                    { id: 'intellectual-property', icon: 'fa-copyright', label: 'Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©' },
                    { id: 'visitor-chat', icon: 'fa-comment-dots', label: 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ø²ÙˆØ§Ø±' }
                ]
            },
            {
                id: 'occupational-health',
                icon: 'fa-hard-hat',
                label: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©',
                show: true,
                subItems: [
                    { id: 'occupational-safety', icon: 'fa-shield-alt', label: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©' },
                    { id: 'international-standards', icon: 'fa-globe', label: 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©' },
                    { id: 'iso-standards', icon: 'fa-certificate', label: 'Ø§Ù„Ø§ÙŠØ²Ùˆ' },
                    { id: 'risk-management', icon: 'fa-exclamation-triangle', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±' },
                    { id: 'consulting', icon: 'fa-user-tie', label: 'Ø§Ù„Ø¥Ø³ØªØ´Ø§Ø±Ø§Øª' },
                    { id: 'specialized-courses', icon: 'fa-graduation-cap', label: 'Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©' },
                    { id: 'evaluation', icon: 'fa-clipboard-check', label: 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ… - Ø´Ø±ÙƒØ§ØªØŒ Ù…ØµØ§Ù†Ø¹ØŒ Ù…Ø´Ø§Ø±ÙŠØ¹' },
                    { id: 'data-analysis', icon: 'fa-chart-bar', label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' }
                ]
            },
            {
                id: 'services',
                icon: 'fa-concierge-bell',
                label: 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª',
                show: true,
                subItems: [
                    { id: 'project-management-office', icon: 'fa-project-diagram', label: 'Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹' },
                    { id: 'institutional-performance', icon: 'fa-chart-line', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ' },
                    { id: 'operations-monitoring', icon: 'fa-eye', label: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' },
                    { id: 'ai-market-research', icon: 'fa-brain', label: 'Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' },
                    { id: 'customer-service', icon: 'fa-headset', label: 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡' },
                    { id: 'client-admin-services', icon: 'fa-user-cog', label: 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„' },
                    { id: 'virtual-halls', icon: 'fa-video', label: 'Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©' },
                    { id: 'feasibility-studies', icon: 'fa-calculator', label: 'Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰' },
                    { id: 'research', icon: 'fa-search', label: 'Ø§Ù„Ø¨Ø­ÙˆØ«' },
                    { id: 'consulting-training', icon: 'fa-chalkboard-teacher', label: 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨' }
                ]
            },
            { id: 'entities', icon: 'fa-sitemap', label: perms.isHQ() ? 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†' : 'ÙØ±Ø¹ÙŠ/ÙƒÙŠØ§Ù†ÙŠ', show: true },
            { id: 'employees', icon: 'fa-users', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', show: perms.isHR() || perms.isAdmin() },
            { id: 'ads', icon: 'fa-bullhorn', label: perms.canManageAds() ? 'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†' : 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', show: true },
            { id: 'tasks', icon: 'fa-tasks', label: 'Ø§Ù„Ù…Ù‡Ø§Ù…', show: true },
            { id: 'facilities', icon: 'fa-building-gear', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚', show: true },
            { id: 'settings', icon: 'fa-paint-brush', label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©', show: perms.isAdmin() },
            { id: 'audit-logs', icon: 'fa-history', label: 'Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…', show: perms.canViewAuditLogs() }
        ];

        menu.innerHTML = items.filter(i => i.show).map(item => {
            const path = routeToPath[item.id] || '/';
            
            // Check if item has submenu
            if (item.subItems) {
                return `
                <li>
                    <div class="submenu-container">
                        <button onclick="app.toggleSubmenu('${item.id}')" 
                           class="flex items-center gap-3 px-4 py-3.5 text-red-200 hover:text-white hover:bg-red-800/50 rounded-lg transition-all group relative overflow-hidden w-full text-right">
                           <i class="fas ${item.icon} w-6 text-center group-hover:text-red-400 transition-colors z-10"></i> 
                           <span class="z-10 relative font-medium flex-1">${item.label}</span>
                           <i class="fas fa-chevron-down z-10 transition-transform duration-200 submenu-arrow-${item.id}"></i>
                        </button>
                        <div id="submenu-${item.id}" class="hidden mt-2 mr-6 space-y-1">
                            ${item.subItems.map(subItem => `
                                <a href="#${subItem.id}" onclick="event.preventDefault(); app.loadRoute('${subItem.id}')" 
                                   class="flex items-center gap-2 px-4 py-2.5 text-red-300 hover:text-white hover:bg-red-800/30 rounded-lg transition-all text-sm">
                                   <i class="fas ${subItem.icon} w-5 text-center"></i>
                                   <span>${subItem.label}</span>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </li>`;
            }
            
            return `<li>
                <a href="${path}" id="link-${item.id}" onclick="event.preventDefault(); app.loadRoute('${item.id}')" 
                   class="flex items-center gap-3 px-4 py-3.5 text-red-200 hover:text-white hover:bg-red-800/50 rounded-lg transition-all group relative overflow-hidden">
                   <i class="fas ${item.icon} w-6 text-center group-hover:text-red-400 transition-colors z-10"></i> 
                   <span class="z-10 relative font-medium">${item.label}</span>
                   ${item.badge ? `<span class="mr-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold animate-pulse">${item.badge}</span>` : ''}
                </a>
            </li>`;
        }).join('');
    };

    // --- FINANCIAL MODULE ---
    
    const switchTab = (tab) => {
        // Hide all tabs
        ['invoices', 'ledger', 'transactions'].forEach(t => {
            const content = document.getElementById('tab-content-' + t);
            const btn = document.getElementById('tab-btn-' + t);
            if (content) content.classList.add('hidden');
            if (btn) btn.className = 'flex-1 py-4 text-sm font-bold text-slate-500 hover:bg-slate-50 transition';
        });
        
        // Show selected tab
        const selectedContent = document.getElementById('tab-content-' + tab);
        const selectedBtn = document.getElementById('tab-btn-' + tab);
        if (selectedContent) selectedContent.classList.remove('hidden');
        if (selectedBtn) selectedBtn.className = 'flex-1 py-4 text-sm font-bold text-brand-600 border-b-2 border-brand-600 bg-brand-50 transition';
    };

    // --- MODALS ---
    const openCreateInvoiceModal = () => {
        const modal = document.createElement('div');
        modal.id = 'invoice-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden animate-scale-up max-h-[95vh] overflow-y-auto">
                <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-red-600 to-red-700 flex justify-between items-center sticky top-0 z-10">
                    <h3 class="font-bold text-2xl text-white flex items-center gap-2">
                        <i class="fas fa-file-invoice-dollar"></i>
                        Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø°ÙƒÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                    </h3>
                    <button onclick="document.getElementById('invoice-modal').remove()" class="text-white/80 hover:text-white"><i class="fas fa-times text-2xl"></i></button>
                </div>
                <div class="p-6 space-y-6">
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-user-circle"></i>
                            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <input type="text" id="inv-customer-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <input type="text" id="inv-customer-number" placeholder="Ù…Ø«Ø§Ù„: CUST-001" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="inv-customer-phone" placeholder="05xxxxxxxx" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="inv-customer-email" placeholder="example@email.com" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„ÙƒÙŠØ§Ù†</label>
                                <select id="inv-entity" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                                    ${db.entities.filter(e => e.type !== 'HQ').map(e => `<option value="${e.id}">${e.name} (${e.id})</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <h4 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-file-invoice"></i>
                            ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                                <input type="text" id="inv-title" placeholder="Ù…Ø«Ø§Ù„: Ø±Ø³ÙˆÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                     <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³)</label>
                                     <input type="number" id="inv-amount" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200 font-bold">
                                </div>
                                <div>
                                     <label class="block text-xs font-bold text-slate-600 mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                                     <input type="date" id="inv-due" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                                
                                <!-- Payment Method Cards -->
                                <div class="grid grid-cols-3 gap-3 mb-4">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="payment-type" value="Ù†Ù‚Ø¯ÙŠ" class="peer sr-only" onchange="document.getElementById('bank-options').classList.add('hidden')">
                                        <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center hover:border-blue-300">
                                            <i class="fas fa-money-bill-wave text-3xl text-blue-600 mb-2"></i>
                                            <div class="text-sm font-bold text-slate-700">Ù†Ù‚Ø¯ÙŠ</div>
                                        </div>
                                    </label>
                                    
                                    <label class="cursor-pointer">
                                        <input type="radio" name="payment-type" value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" class="peer sr-only" onchange="document.getElementById('bank-options').classList.remove('hidden')">
                                        <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center hover:border-blue-300">
                                            <i class="fas fa-university text-3xl text-blue-600 mb-2"></i>
                                            <div class="text-sm font-bold text-slate-700">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</div>
                                        </div>
                                    </label>
                                    
                                    <label class="cursor-pointer">
                                        <input type="radio" name="payment-type" value="Ø´ÙŠÙƒ" class="peer sr-only" onchange="document.getElementById('bank-options').classList.add('hidden')">
                                        <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center hover:border-blue-300">
                                            <i class="fas fa-file-invoice text-3xl text-blue-600 mb-2"></i>
                                            <div class="text-sm font-bold text-slate-700">Ø´ÙŠÙƒ</div>
                                        </div>
                                    </label>
                                </div>
                                
                                <!-- Bank Selection (Shows when "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" is selected) -->
                                <div id="bank-options" class="hidden animate-fade-in">
                                    <select id="inv-bank-name" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-200 mb-3">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ</option>
                                        <optgroup label="Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                                            <option value="Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ">ğŸ¦ Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</option>
                                            <option value="Ø§Ù„Ø£Ù‡Ù„ÙŠ">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
                                            <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">ğŸ¦ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                                            <option value="Ø³Ø§Ù…Ø¨Ø§">ğŸ¦ Ø³Ø§Ù…Ø¨Ø§ (SNB)</option>
                                            <option value="Ø§Ù„ÙØ±Ù†Ø³ÙŠ">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ</option>
                                            <option value="Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡">ğŸ¦ Ø¨Ù†Ùƒ Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡</option>
                                            <option value="Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ</option>
                                            <option value="Ø³Ø§Ø¨">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ (Ø³Ø§Ø¨)</option>
                                            <option value="Ø§Ù„Ø¬Ø²ÙŠØ±Ø©">ğŸ¦ Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©</option>
                                            <option value="Ø§Ù„Ø¨Ù„Ø§Ø¯">ğŸ¦ Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯</option>
                                        </optgroup>
                                        <optgroup label="Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                                            <option value="PayPal">ğŸ’³ PayPal</option>
                                            <option value="Mastercard">ğŸ’³ Mastercard</option>
                                            <option value="Visa">ğŸ’³ Visa</option>
                                            <option value="Square">ğŸ’³ Square</option>
                                            <option value="Stripe">ğŸ’³ Stripe</option>
                                            <option value="STC Pay">ğŸ’³ STC Pay</option>
                                            <option value="Apple Pay">ğŸ’³ Apple Pay</option>
                                        </optgroup>
                                    </select>
                                    
                                    <!-- Payment Gateway Logos -->
                                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex items-center justify-center gap-4 flex-wrap">
                                        <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_37x23.jpg" alt="PayPal" class="h-6 opacity-60 hover:opacity-100 transition" title="PayPal">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" class="h-6 opacity-60 hover:opacity-100 transition" title="Mastercard">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" class="h-6 opacity-60 hover:opacity-100 transition" title="Visa">
                                        <div class="text-xs font-bold text-slate-500">Square</div>
                                    </div>
                                </div>
                                
                                <input type="hidden" id="inv-payment-method">
                            </div>
                        </div>
                    </div>

                    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø°ÙƒÙŠØ© -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200">
                        <h4 class="font-bold text-purple-900 mb-4 flex items-center gap-2 text-lg">
                            <i class="fas fa-credit-card"></i>
                            Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø±Ù†Ø© (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµØ¯Ø§Ø±)
                        </h4>
                        <p class="text-sm text-purple-700 mb-4 bg-white p-3 rounded-lg border border-purple-100">
                            <i class="fas fa-info-circle ml-2"></i>
                            Ø¨Ø¹Ø¯ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©:
                        </p>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Full Payment -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="payment-plan" value="Ø¯ÙØ¹ ÙƒØ§Ù…Ù„" class="peer sr-only" checked>
                                <div class="p-4 rounded-xl border-2 border-green-200 peer-checked:border-green-500 peer-checked:bg-green-50 hover:border-green-400 transition group-hover:shadow-lg">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="fas fa-check-circle text-2xl text-green-600"></i>
                                        <h5 class="font-bold text-green-900">Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</h5>
                                    </div>
                                    <p class="text-xs text-green-700">Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                                    <div class="mt-2 text-xs font-bold text-green-600">âœ“ Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©</div>
                                </div>
                            </label>

                            <!-- Partial Payment -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="payment-plan" value="Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ" class="peer sr-only" onchange="document.getElementById('partial-options').classList.remove('hidden')">
                                <div class="p-4 rounded-xl border-2 border-orange-200 peer-checked:border-orange-500 peer-checked:bg-orange-50 hover:border-orange-400 transition group-hover:shadow-lg">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="fas fa-half-circle text-2xl text-orange-600"></i>
                                        <h5 class="font-bold text-orange-900">Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ</h5>
                                    </div>
                                    <p class="text-xs text-orange-700">Ø§Ø¯ÙØ¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¢Ù†</p>
                                    <div class="mt-2 text-xs font-bold text-orange-600">âœ“ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹</div>
                                </div>
                            </label>

                            <!-- Installment Plan -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="payment-plan" value="Ø£Ù‚Ø³Ø§Ø·" class="peer sr-only" onchange="document.getElementById('installment-options').classList.remove('hidden')">
                                <div class="p-4 rounded-xl border-2 border-blue-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:border-blue-400 transition group-hover:shadow-lg">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="fas fa-calendar-alt text-2xl text-blue-600"></i>
                                        <h5 class="font-bold text-blue-900">Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</h5>
                                    </div>
                                    <p class="text-xs text-blue-700">Ù‚Ø³Ù‘Ø· Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø£Ø´Ù‡Ø±</p>
                                    <div class="mt-2 text-xs font-bold text-blue-600">âœ“ Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ³Ø§ÙˆÙŠØ©</div>
                                </div>
                            </label>
                        </div>

                        <!-- Partial Payment Options -->
                        <div id="partial-options" class="hidden mt-4 p-4 bg-white rounded-lg border border-orange-200 animate-fade-in">
                            <label class="block text-xs font-bold text-slate-600 mb-2">Ø§Ø®ØªØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø£ÙˆÙ„Ù‰:</label>
                            <div class="flex gap-3">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="partial-percent" value="25" class="w-4 h-4">
                                    <span class="text-sm">25% (Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø¨Ù„Øº)</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="partial-percent" value="50" class="w-4 h-4" checked>
                                    <span class="text-sm">50% (Ù†ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº)</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="partial-percent" value="75" class="w-4 h-4">
                                    <span class="text-sm">75% (Ø«Ù„Ø§Ø«Ø© Ø£Ø±Ø¨Ø§Ø¹)</span>
                                </label>
                            </div>
                        </div>

                        <!-- Installment Options -->
                        <div id="installment-options" class="hidden mt-4 p-4 bg-white rounded-lg border border-blue-200 animate-fade-in">
                            <label class="block text-xs font-bold text-slate-600 mb-3">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="installment-count" value="3" class="w-4 h-4" checked>
                                    <span class="text-sm font-bold">3 Ø£Ù‚Ø³Ø§Ø·</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="installment-count" value="6" class="w-4 h-4">
                                    <span class="text-sm font-bold">6 Ø£Ù‚Ø³Ø§Ø·</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="installment-count" value="12" class="w-4 h-4">
                                    <span class="text-sm font-bold">12 Ù‚Ø³Ø·</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="radio" name="installment-count" value="24" class="w-4 h-4">
                                    <span class="text-sm font-bold">24 Ù‚Ø³Ø·</span>
                                </label>
                            </div>
                            
                            <!-- Interest Rate -->
                            <div class="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-100">
                                <p class="text-xs font-bold text-blue-900 mb-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©:</p>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="interest-rate" value="0" class="w-4 h-4" checked>
                                        <span class="text-xs">0% (Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø¯Ø©)</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="interest-rate" value="2" class="w-4 h-4">
                                        <span class="text-xs">2% ÙØ§Ø¦Ø¯Ø©</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="interest-rate" value="3.5" class="w-4 h-4">
                                        <span class="text-xs">3.5% ÙØ§Ø¦Ø¯Ø©</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="interest-rate" value="5" class="w-4 h-4">
                                        <span class="text-xs">5% ÙØ§Ø¦Ø¯Ø©</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div class="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-6 rounded-xl">
                        <h4 class="font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-calculator"></i>
                            Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </h4>
                        <div class="space-y-2 mb-4 pb-4 border-b border-slate-700">
                            <div class="flex justify-between">
                                <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
                                <span id="summary-amount" class="font-bold">0.00 Ø±.Ø³</span>
                            </div>
                            <div class="flex justify-between text-slate-300">
                                <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%):</span>
                                <span id="summary-tax" class="font-bold">0.00 Ø±.Ø³</span>
                            </div>
                            <div class="flex justify-between text-slate-300">
                                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                                <span id="summary-total" class="font-bold text-lg text-yellow-300">0.00 Ø±.Ø³</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 italic">
                            <i class="fas fa-shield-alt ml-1"></i>
                            Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙˆÙÙŠØ±Ù‡Ø§ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </p>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 sticky bottom-0 shadow-lg">
                    <button onclick="document.getElementById('invoice-modal').remove()" class="px-6 py-3 rounded-lg text-slate-700 font-bold hover:bg-slate-200 transition">
                        <i class="fas fa-times ml-2"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button onclick="app.submitInvoice()" class="px-6 py-3 rounded-lg bg-gradient-to-r from-red-600 to-red-700 text-white font-bold hover:from-red-700 hover:to-red-800 shadow-lg transition">
                        <i class="fas fa-file-pdf ml-2"></i>
                        Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    </button>
                </div>
            </div>`;
        document.body.appendChild(modal);

        // Update summary when amount changes
        const amountInput = document.getElementById('inv-amount');
        if (amountInput) {
            amountInput.addEventListener('change', () => {
                const amount = parseFloat(amountInput.value) || 0;
                const tax = amount * 0.15;
                const total = amount + tax;
                document.getElementById('summary-amount').textContent = amount.toFixed(2) + ' Ø±.Ø³';
                document.getElementById('summary-tax').textContent = tax.toFixed(2) + ' Ø±.Ø³';
                document.getElementById('summary-total').textContent = total.toFixed(2) + ' Ø±.Ø³';
            });
        }
    };

    const submitInvoice = async () => {
        const entityId = document.getElementById('inv-entity').value;
        const title = document.getElementById('inv-title').value;
        const amount = parseFloat(document.getElementById('inv-amount').value);
        const due = document.getElementById('inv-due').value;
        const customerName = document.getElementById('inv-customer-name').value;
        const customerNumber = document.getElementById('inv-customer-number').value;
        const customerPhone = document.getElementById('inv-customer-phone').value;
        const customerEmail = document.getElementById('inv-customer-email').value;
        
        // Get payment method
        const paymentType = document.querySelector('input[name="payment-type"]:checked')?.value || '';
        const bankName = document.getElementById('inv-bank-name')?.value || '';
        let paymentMethod = paymentType;
        if (paymentType === 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ' && bankName) {
            paymentMethod = `${paymentType} - ${bankName}`;
        }

        // Get payment plan options
        const paymentPlan = document.querySelector('input[name="payment-plan"]:checked')?.value || 'Ø¯ÙØ¹ ÙƒØ§Ù…Ù„';
        const partialPercent = document.querySelector('input[name="partial-percent"]:checked')?.value || '50';
        const installmentCount = document.querySelector('input[name="installment-count"]:checked')?.value || '3';
        const interestRate = document.querySelector('input[name="interest-rate"]:checked')?.value || '0';

        if(!title || !amount || !due) return showToast('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        if(!paymentType) return showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error');

        const newInv = {
            id: `INV-${Math.floor(1000 + Math.random() * 9000)}`,
            entityId: entityId,
            type: 'SERVICE',
            title: title,
            amount: amount,
            paidAmount: 0,
            tax: amount * 0.15,
            total: amount + (amount * 0.15),
            status: 'ISSUED',
            date: new Date().toISOString().slice(0, 10),
            dueDate: due,
            customerName: customerName || '',
            customerNumber: customerNumber || '',
            customerPhone: customerPhone || '',
            customerEmail: customerEmail || '',
            paymentMethod: paymentMethod || '',
            paymentPlan: paymentPlan,
            partialPercent: paymentPlan === 'Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ' ? partialPercent : null,
            installmentCount: paymentPlan === 'Ø£Ù‚Ø³Ø§Ø·' ? installmentCount : null,
            interestRate: paymentPlan === 'Ø£Ù‚Ø³Ø§Ø·' ? interestRate : null
        };

        try {
            // Save to database
            const response = await fetch('/api/invoices', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newInv)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©');
            }

            const result = await response.json();
            
            // Update local db
            db.invoices.unshift(newInv);
            
            logAction('CREATE_INVOICE', `Generated Invoice ${newInv.id} for ${entityId} - Customer: ${customerName}`);
            document.getElementById('invoice-modal').remove();
            showToast('ØªÙ… Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            loadRoute('collections');
        } catch (error) {
            console.error('Error saving invoice:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ' + error.message, 'error');
        }
    };

    const openPaymentModal = (invId) => {
        const inv = db.invoices.find(i => i.id === invId);
        if(!inv) return;
        const remaining = inv.amount - inv.paidAmount;

        const modal = document.createElement('div');
        modal.id = 'pay-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scale-up max-h-[95vh] overflow-y-auto">
                <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-green-600 to-emerald-600 flex justify-between items-center sticky top-0 z-10">
                    <h3 class="font-bold text-2xl text-white flex items-center gap-2">
                        <i class="fas fa-cash-register"></i>
                        Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø±Ù†Ø©
                    </h3>
                    <button onclick="document.getElementById('pay-modal').remove()" class="text-white/80 hover:text-white"><i class="fas fa-times text-2xl"></i></button>
                </div>
                <div class="p-6 space-y-6">
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div class="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-6 rounded-xl">
                        <h4 class="font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-file-invoice-dollar"></i>
                            ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </h4>
                        <div class="space-y-2 grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-slate-400 text-sm">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</p>
                                <p class="text-lg font-bold">${inv.id}</p>
                            </div>
                            <div>
                                <p class="text-slate-400 text-sm">Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
                                <p class="text-lg font-bold">${inv.customerName}</p>
                            </div>
                            <div>
                                <p class="text-slate-400 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</p>
                                <p class="text-lg font-bold text-blue-400">${(inv.amount).toLocaleString()} Ø±.Ø³</p>
                            </div>
                            <div>
                                <p class="text-slate-400 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</p>
                                <p class="text-lg font-bold text-green-400">${(inv.paidAmount).toLocaleString()} Ø±.Ø³</p>
                            </div>
                            <div class="col-span-2">
                                <p class="text-slate-400 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>
                                <p class="text-2xl font-bold text-red-400">${remaining.toLocaleString()} Ø±.Ø³</p>
                            </div>
                        </div>
                    </div>

                    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ -->
                    <div class="space-y-4">
                        <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-credit-card"></i>
                            Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                        </h4>

                        <!-- Option 1: Full Payment -->
                        <label class="cursor-pointer">
                            <input type="radio" name="payment-option" value="full" class="peer sr-only" onchange="document.getElementById('partial-section').classList.add('hidden'); document.getElementById('installment-section').classList.add('hidden');" checked>
                            <div class="p-4 rounded-xl border-2 border-green-200 peer-checked:border-green-500 peer-checked:bg-green-50 hover:border-green-400 transition">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-check-circle text-2xl text-green-600"></i>
                                        <div>
                                            <h5 class="font-bold text-green-900">Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</h5>
                                            <p class="text-sm text-green-700">Ø§Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>
                                        </div>
                                    </div>
                                    <span class="font-bold text-green-600 text-lg">${remaining.toLocaleString()} Ø±.Ø³</span>
                                </div>
                                <div class="mt-3 pt-3 border-t border-green-200">
                                    <select id="full-payment-method" class="w-full px-3 py-2 rounded-lg border border-green-300 text-sm focus:ring-2 focus:ring-green-500 outline-none">
                                        <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                                        <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ğŸ¦ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                        <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                                        <option value="Ù†Ù‚Ø¯ÙŠ">ğŸ’° Ù†Ù‚Ø¯ÙŠ</option>
                                        <option value="Ø´ÙŠÙƒ">ğŸ“‹ Ø´ÙŠÙƒ</option>
                                    </select>
                                </div>
                            </div>
                        </label>

                        <!-- Option 2: Partial Payment -->
                        <label class="cursor-pointer">
                            <input type="radio" name="payment-option" value="partial" class="peer sr-only" onchange="document.getElementById('partial-section').classList.remove('hidden'); document.getElementById('installment-section').classList.add('hidden');">
                            <div class="p-4 rounded-xl border-2 border-orange-200 peer-checked:border-orange-500 peer-checked:bg-orange-50 hover:border-orange-400 transition">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-half-circle text-2xl text-orange-600"></i>
                                        <div>
                                            <h5 class="font-bold text-orange-900">Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ</h5>
                                            <p class="text-sm text-orange-700">Ø§Ø¯ÙØ¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¢Ù†</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="partial-section" class="hidden mt-3 pt-3 border-t border-orange-200 space-y-3 animate-fade-in">
                                    <div>
                                        <label class="text-xs font-bold text-orange-900 block mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¯ÙØ¹Ù‡:</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center gap-2">
                                                <input type="radio" name="partial-amount" value="${(remaining * 0.25).toFixed(2)}" class="w-4 h-4">
                                                <span class="text-sm">25% (${(remaining * 0.25).toLocaleString('ar-SA')} Ø±.Ø³)</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="radio" name="partial-amount" value="${(remaining * 0.50).toFixed(2)}" class="w-4 h-4" checked>
                                                <span class="text-sm">50% (${(remaining * 0.50).toLocaleString('ar-SA')} Ø±.Ø³)</span>
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <input type="radio" name="partial-amount" value="${(remaining * 0.75).toFixed(2)}" class="w-4 h-4">
                                                <span class="text-sm">75% (${(remaining * 0.75).toLocaleString('ar-SA')} Ø±.Ø³)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-orange-900 block mb-2">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºØ§Ù‹ Ù…Ø®ØµØµØ§Ù‹:</label>
                                        <input type="number" id="custom-partial-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" max="${remaining}" class="w-full px-3 py-2 rounded-lg border border-orange-300 text-sm focus:ring-2 focus:ring-orange-500 outline-none">
                                    </div>
                                    <div>
                                        <select id="partial-payment-method" class="w-full px-3 py-2 rounded-lg border border-orange-300 text-sm focus:ring-2 focus:ring-orange-500 outline-none">
                                            <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                                            <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ğŸ¦ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                            <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                                            <option value="Ù†Ù‚Ø¯ÙŠ">ğŸ’° Ù†Ù‚Ø¯ÙŠ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </label>

                        <!-- Option 3: Installment Plan -->
                        <label class="cursor-pointer">
                            <input type="radio" name="payment-option" value="installment" class="peer sr-only" onchange="document.getElementById('installment-section').classList.remove('hidden'); document.getElementById('partial-section').classList.add('hidden');">
                            <div class="p-4 rounded-xl border-2 border-blue-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:border-blue-400 transition">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-calendar-alt text-2xl text-blue-600"></i>
                                        <div>
                                            <h5 class="font-bold text-blue-900">Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</h5>
                                            <p class="text-sm text-blue-700">Ù‚Ø³Ù‘Ø· Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø£Ø´Ù‡Ø±</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="installment-section" class="hidden mt-3 pt-3 border-t border-blue-200 space-y-3 animate-fade-in">
                                    <div>
                                        <label class="text-xs font-bold text-blue-900 block mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</label>
                                        <div class="grid grid-cols-4 gap-2">
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-months" value="3" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-blue-500 peer-checked:text-white text-center text-sm font-bold cursor-pointer">3 Ø´Ù‡ÙˆØ±</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-months" value="6" class="sr-only peer" checked>
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-blue-500 peer-checked:text-white text-center text-sm font-bold cursor-pointer">6 Ø´Ù‡ÙˆØ±</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-months" value="12" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-blue-500 peer-checked:text-white text-center text-sm font-bold cursor-pointer">12 Ø´Ù‡Ø±</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-months" value="24" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-blue-500 peer-checked:text-white text-center text-sm font-bold cursor-pointer">24 Ø´Ù‡Ø±</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-blue-900 block mb-2">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©:</label>
                                        <div class="grid grid-cols-4 gap-2">
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-interest" value="0" class="sr-only peer" checked>
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-green-500 peer-checked:text-white text-center text-xs font-bold cursor-pointer">0%</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-interest" value="2" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-green-500 peer-checked:text-white text-center text-xs font-bold cursor-pointer">2%</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-interest" value="3.5" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-green-500 peer-checked:text-white text-center text-xs font-bold cursor-pointer">3.5%</span>
                                            </label>
                                            <label class="flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="installment-interest" value="5" class="sr-only peer">
                                                <span class="w-full p-2 rounded-lg border border-blue-300 peer-checked:bg-green-500 peer-checked:text-white text-center text-xs font-bold cursor-pointer">5%</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <select id="installment-payment-method" class="w-full px-3 py-2 rounded-lg border border-blue-300 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                                            <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ğŸ¦ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                            <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                                            <option value="Ù†Ù‚Ø¯ÙŠ">ğŸ’° Ù†Ù‚Ø¯ÙŠ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 sticky bottom-0 shadow-lg">
                    <button onclick="document.getElementById('pay-modal').remove()" class="px-6 py-3 rounded-lg text-slate-700 font-bold hover:bg-slate-200 transition">
                        <i class="fas fa-times ml-2"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button onclick="app.submitPayment('${invId}')" class="px-6 py-3 rounded-lg bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold hover:from-green-700 hover:to-emerald-700 shadow-lg transition">
                        <i class="fas fa-check-circle ml-2"></i>
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
                    </button>
                </div>
            </div>`;
        document.body.appendChild(modal);
    };

    const submitPayment = (invId) => {
        const inv = db.invoices.find(i => i.id === invId);
        if (!inv) return showToast('Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');

        const paymentOption = document.querySelector('input[name="payment-option"]:checked')?.value;
        let amount = 0;
        let method = '';
        let paymentType = '';

        if (paymentOption === 'full') {
            amount = inv.amount - inv.paidAmount;
            method = document.getElementById('full-payment-method')?.value;
            paymentType = 'Ø¯ÙØ¹ ÙƒØ§Ù…Ù„';
            if (!method) return showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error');
        } else if (paymentOption === 'partial') {
            const selectedAmount = document.querySelector('input[name="partial-amount"]:checked')?.value;
            const customAmount = document.getElementById('custom-partial-amount')?.value;
            amount = customAmount ? parseFloat(customAmount) : parseFloat(selectedAmount);
            method = document.getElementById('partial-payment-method')?.value;
            paymentType = 'Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ';
            if (!method) return showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error');
        } else if (paymentOption === 'installment') {
            amount = inv.amount - inv.paidAmount;
            const months = document.querySelector('input[name="installment-months"]:checked')?.value;
            const interest = document.querySelector('input[name="installment-interest"]:checked')?.value;
            method = document.getElementById('installment-payment-method')?.value;
            paymentType = `Ø£Ù‚Ø³Ø§Ø· (${months} Ø´Ù‡Ø± - ÙØ§Ø¦Ø¯Ø© ${interest}%)`;
            if (!method) return showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error');
        }

        if (amount <= 0 || amount > (inv.amount - inv.paidAmount)) {
            return showToast('Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
        }

        // 1. Create Transaction
        const trxId = `TRX-${Math.floor(1000 + Math.random() * 9000)}`;
        const newTrx = {
            id: trxId,
            invoiceId: invId,
            entityId: inv.entityId,
            type: 'PAYMENT',
            amount: amount,
            method: method,
            paymentType: paymentType,
            date: new Date().toISOString().slice(0, 10),
            user: currentUser.name
        };
        db.transactions.push(newTrx);

        // 2. Update Invoice
        inv.paidAmount += amount;
        if (inv.paidAmount >= inv.amount) inv.status = 'PAID';
        else if (inv.paidAmount > 0) inv.status = 'PARTIAL_PAID';

        // 3. Add to Ledger (Immutable)
        db.ledger.unshift({
            id: db.ledger.length + 1,
            entityId: inv.entityId,
            trxId: trxId,
            date: new Date().toISOString().slice(0, 10),
            desc: `Ø³Ø¯Ø§Ø¯ (${paymentType}) Ù„Ù„ÙØ§ØªÙˆØ±Ø© ${invId}`,
            debit: 0,
            credit: amount,
            balance: (db.ledger[0]?.balance || 0) + amount,
            type: 'Credit'
        });

        logAction('PAYMENT', `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹ ${paymentType} Ø¨Ù…Ø¨Ù„Øº ${amount} Ø±.Ø³ Ù„Ù„ÙØ§ØªÙˆØ±Ø© ${invId}`);
        document.getElementById('pay-modal').remove();
        showToast(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${paymentType} Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ù…Ø¨Ù„Øº: ${amount.toLocaleString('ar-SA')} Ø±.Ø³`, 'success');
        loadRoute('invoices-enhanced');
    };

    const reverseTransaction = (trxId) => {
        const originalTrx = db.transactions.find(t => t.id === trxId);
        if (!originalTrx) return;
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¬Ø±Ø§Ø¡ Ù‚ÙŠØ¯ Ø¹ÙƒØ³ÙŠØŸ Ø³ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯.')) {
            // 1. Create Reversal Transaction
            const revId = `REV-${Math.floor(1000 + Math.random() * 9000)}`;
            
            // 2. Update Invoice
            const inv = db.invoices.find(i => i.id === originalTrx.invoiceId);
            if (inv) {
                inv.paidAmount -= originalTrx.amount;
                if (inv.paidAmount <= 0) inv.status = 'UNPAID';
                else if (inv.paidAmount < inv.amount) inv.status = 'PARTIAL';
            }

            // 3. Ledger Entry (Debit to reduce balance)
            db.ledger.unshift({
                id: db.ledger.length + 1,
                entityId: originalTrx.entityId,
                trxId: revId,
                date: new Date().toISOString().slice(0, 10),
                desc: `Ù‚ÙŠØ¯ Ø¹ÙƒØ³ÙŠ (ØªØµØ­ÙŠØ­) Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ${trxId}`,
                debit: originalTrx.amount,
                credit: 0,
                balance: (db.ledger[0]?.balance || 0) - originalTrx.amount,
                type: 'Debit'
            });

            logAction('REVERSAL', `Reversed transaction ${trxId}`);
            showToast('ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø¹ÙƒØ³ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            loadRoute('billing');
        }
    };

    // --- DASHBOARD (Existing) --- 
    const initDashboardChart = () => {
        const ctx = document.getElementById('adsChart');
        if (!ctx) return;
        const visibleAds = perms.getVisibleAds();
        const levels = Object.values(AD_LEVELS);
        const counts = levels.map(l => visibleAds.filter(a => a.level === l.key).length);

        activeChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: levels.map(l => l.label.split(' ')[0]),
                datasets: [{ label: 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', data: counts, backgroundColor: levels.map(l => l.chartColor), borderRadius: 6 }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { beginAtZero: true, grid: { color: '#f1f5f9' }, border: { display: false } }, 
                    x: { grid: { display: false }, border: { display: false } } 
                }
            }
        });
    };

    const renderDashboard = async () => {
        // Verify currentUser exists
        if (!currentUser || !currentUser.entityId) {
            console.error('âŒ No current user or entity ID found');
            return renderPlaceholder('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        }

        console.log('ğŸ” Looking for entity:', currentUser.entityId, 'in', db.entities.length, 'entities');
        
        let entity = db.entities.find(e => e.id === currentUser.entityId);
        
        // If entity not found in db.entities, try to fetch it directly
        if (!entity) {
            console.warn('âš ï¸ Entity not found in db.entities, fetching from API...');
            try {
                const fetchedEntity = await fetchAPI(`/entities/${currentUser.entityId}`);
                if (fetchedEntity) {
                    entity = fetchedEntity;
                    // Add to db.entities for future use
                    db.entities.push(entity);
                    console.log('âœ… Entity fetched and added to cache:', entity);
                }
            } catch (error) {
                console.error('âŒ Failed to fetch entity:', error);
                return renderPlaceholder('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙŠØ§Ù†. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
            }
        }
        
        if (!entity) {
            console.error('âŒ Entity still not found after fetch attempt');
            return renderPlaceholder('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙŠØ§Ù†');
        }

        // Check if entity has specific dashboard type
        try {
            const dashboardType = await fetchAPI(`/dashboard/type?entity_id=${currentUser.entityId}`);
            
            if (dashboardType.dashboard_type === 'incubator') {
                try {
                    return await renderIncubatorDashboard();
                } catch (error) {
                    console.error('Incubator dashboard error:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§Ø¶Ù†Ø©ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'warning');
                }
            } else if (dashboardType.dashboard_type === 'platform') {
                try {
                    return await renderPlatformDashboard();
                } catch (error) {
                    console.error('Platform dashboard error:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØµØ©ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'warning');
                }
            } else if (dashboardType.dashboard_type === 'office') {
                try {
                    return await renderOfficeDashboard();
                } catch (error) {
                    console.error('Office dashboard error:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙƒØªØ¨ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'warning');
                }
            }
        } catch (error) {
            console.log('Using default dashboard:', error.message);
        }

        // Default dashboard
        return `
        <div class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
            <div>
                <span class="px-3 py-1 rounded-lg text-[10px] uppercase tracking-wider font-bold mb-2 inline-block ${TENANT_TYPES[currentUser.tenantType].bg} ${TENANT_TYPES[currentUser.tenantType].color}">
                    ${TENANT_TYPES[currentUser.tenantType].label}
                </span>
                <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800">${entity.name}</h2>
                <p class="text-gray-500 mt-1 flex flex-wrap items-center gap-2">
                    <span class="flex items-center gap-1"><i class="fas fa-map-marker-alt text-brand-500"></i> ${entity.location}</span>
                    <span class="text-slate-300 hidden md:inline">|</span> 
                    <span class="text-slate-400 text-sm">Tenant ID: ${entity.id}</span>
                </p>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-lg border border-slate-100 w-full md:w-auto md:min-w-[200px] text-left">
                 <p class="text-xs text-slate-400 font-bold uppercase mb-1">Ø®Ø·Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (SaaS)</p>
                 <div class="flex items-center justify-end gap-2">
                    <span class="text-xl font-black text-brand-600">${entity.plan}</span>
                    <i class="fas fa-check-circle text-green-500"></i>
                 </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8 mb-8">
            <div class="lg:col-span-2 space-y-6 md:space-y-8">
                 <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                     <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                            <i class="fas fa-chart-bar text-brand-500"></i> Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±
                        </h3>
                     </div>
                     <div class="p-4 md:p-6 h-64 relative">
                        <canvas id="adsChart"></canvas>
                     </div>
                 </div>
                 ${renderAdsFeed()}
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4">
                 ${renderKpiCard('Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©', (perms.isFinance()) ? entity.balance.toLocaleString() : '****', 'fa-wallet', 'text-teal-600', 'bg-teal-50')}
                 ${renderKpiCard('Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©', perms.getVisibleTasks().length, 'fa-tasks', 'text-red-600', 'bg-red-50')}
                 ${renderKpiCard('ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù…', perms.getVisibleTickets().length, 'fa-headset', 'text-red-600', 'bg-red-50')}
                 ${renderKpiCard('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', entity.users, 'fa-users', 'text-purple-600', 'bg-purple-50')}
            </div>
        </div>`;
    };

    // Incubator Dashboard - Customer Journey & Programs
    const renderIncubatorDashboard = async () => {
        const data = await fetchAPI(`/dashboard/incubator?entity_id=${currentUser.entityId}`);
        const stats = data.statistics || {};
        
        return `
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center">
                    <i class="fas fa-seedling text-2xl text-orange-600"></i>
                </div>
                <div>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800">Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</h2>
                    <p class="text-gray-500">Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            ${renderKpiCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†', stats.total_beneficiaries || 0, 'fa-users', 'text-red-600', 'bg-red-50')}
            ${renderKpiCard('Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù†Ø´Ø·Ø©', stats.total_programs || 0, 'fa-graduation-cap', 'text-green-600', 'bg-green-50')}
            ${renderKpiCard('Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†Ø¹Ù‚Ø¯Ø©', stats.total_sessions || 0, 'fa-calendar-check', 'text-purple-600', 'bg-purple-50')}
            ${renderKpiCard('Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', Math.round(stats.overall_completion_rate || 0) + '%', 'fa-chart-line', 'text-orange-600', 'bg-orange-50')}
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-route text-orange-500"></i> Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.beneficiaries && data.beneficiaries.length > 0 ? data.beneficiaries.map(b => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-slate-800">${b.name}</h4>
                                    <p class="text-sm text-slate-500">${b.email}</p>
                                </div>
                                <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full font-bold">
                                    ${Math.round(b.avg_completion || 0)}% Ù…ÙƒØªÙ…Ù„
                                </span>
                            </div>
                            <div class="flex gap-4 text-xs text-slate-600 mt-2">
                                <span><i class="fas fa-book-open text-red-500"></i> ${b.enrollment_count} ØªØ³Ø¬ÙŠÙ„</span>
                                <span><i class="fas fa-calendar text-green-500"></i> ${b.sessions_attended} Ø¬Ù„Ø³Ø©</span>
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</p>'}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-graduation-cap text-green-500"></i> Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.programs && data.programs.length > 0 ? data.programs.map(p => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <h4 class="font-bold text-slate-800 mb-2">${p.name}</h4>
                            <p class="text-sm text-slate-600 mb-3">${p.description || ''}</p>
                            <div class="flex gap-4 text-xs text-slate-600">
                                <span><i class="fas fa-users text-red-500"></i> ${p.total_beneficiaries} Ù…Ø³ØªÙÙŠØ¯</span>
                                <span><i class="fas fa-calendar text-purple-500"></i> ${p.total_sessions} Ø¬Ù„Ø³Ø©</span>
                                <span><i class="fas fa-percent text-green-500"></i> ${Math.round(p.avg_completion_rate || 0)}%</span>
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬</p>'}
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
            <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                    <i class="fas fa-calendar-alt text-purple-500"></i> Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
                </h3>
            </div>
            <div class="p-6">
                ${data.recent_sessions && data.recent_sessions.length > 0 ? `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${data.recent_sessions.map(s => `
                            <div class="p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-800">${s.program_name}</h4>
                                    <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">
                                        ${new Date(s.session_date).toLocaleDateString('ar-SA')}
                                    </span>
                                </div>
                                <p class="text-sm text-slate-600 mb-2">${s.location || 'Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                <div class="flex items-center gap-2 text-xs text-slate-500">
                                    <i class="fas fa-user-friends"></i> ${s.attendees_count} Ø­Ø¶ÙˆØ±
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª</p>'}
            </div>
        </div>`;
    };

    // Platform Dashboard - Services/Content/Subscriptions
    const renderPlatformDashboard = async () => {
        const data = await fetchAPI(`/dashboard/platform?entity_id=${currentUser.entityId}`);
        const stats = data.statistics || {};
        const revenue = data.revenue || {};
        
        return `
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center">
                    <i class="fas fa-server text-2xl text-green-600"></i>
                </div>
                <div>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØµØ©</h2>
                    <p class="text-gray-500">Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            ${renderKpiCard('Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©', stats.total_services || 0, 'fa-box', 'text-green-600', 'bg-green-50')}
            ${renderKpiCard('Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©', stats.active_subscriptions || 0, 'fa-users-cog', 'text-red-600', 'bg-red-50')}
            ${renderKpiCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', stats.total_customers || 0, 'fa-user-tie', 'text-purple-600', 'bg-purple-50')}
            ${renderKpiCard('Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', (revenue.total_revenue || 0).toLocaleString() + ' Ø±.Ø³', 'fa-dollar-sign', 'text-orange-600', 'bg-orange-50')}
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-shopping-bag text-green-500"></i> Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.services && data.services.length > 0 ? data.services.map(s => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-slate-800">${s.title}</h4>
                                <span class="text-xs ${s.status === 'active' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'} px-2 py-1 rounded-full font-bold">
                                    ${s.status}
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 line-clamp-2">${s.content || ''}</p>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª</p>'}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-users-cog text-red-500"></i> Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.subscriptions && data.subscriptions.length > 0 ? data.subscriptions.map(sub => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-slate-800">${sub.customer_name}</h4>
                                    <p class="text-sm text-slate-500">${sub.customer_email}</p>
                                </div>
                                <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-bold">
                                    ${sub.status}
                                </span>
                            </div>
                            <div class="flex gap-4 text-xs text-slate-600 mt-2">
                                <span><i class="fas fa-box text-green-500"></i> ${sub.service_name}</span>
                                <span><i class="fas fa-dollar-sign text-orange-500"></i> ${sub.price} Ø±.Ø³</span>
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p>'}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-chart-pie text-purple-500"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                    </h3>
                </div>
                <div class="p-6">
                    ${data.content_stats && data.content_stats.length > 0 ? `
                        <div class="space-y-3">
                            ${data.content_stats.map(stat => `
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                                    <span class="font-bold text-slate-700">${stat.status}</span>
                                    <div class="flex gap-4 text-sm">
                                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${stat.count}</span>
                                        <span class="text-green-600">Ø¬Ø¯ÙŠØ¯: ${stat.new_this_week || 0}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>'}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-money-bill-wave text-orange-500"></i> Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
                    </h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="text-center p-6 bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl">
                            <p class="text-sm text-slate-600 mb-2">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</p>
                            <p class="text-3xl font-black text-orange-600">${(revenue.total_revenue || 0).toLocaleString()} Ø±.Ø³</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 bg-slate-50 rounded-lg">
                                <p class="text-xs text-slate-500 mb-1">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±</p>
                                <p class="text-lg font-bold text-slate-800">${(revenue.monthly_revenue || 0).toLocaleString()} Ø±.Ø³</p>
                            </div>
                            <div class="text-center p-4 bg-slate-50 rounded-lg">
                                <p class="text-xs text-slate-500 mb-1">Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±</p>
                                <p class="text-lg font-bold text-slate-800">${revenue.monthly_transactions || 0}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
    };

    // Office Dashboard - Service Execution & Customer Appointments
    const renderOfficeDashboard = async () => {
        const data = await fetchAPI(`/dashboard/office?entity_id=${currentUser.entityId}`);
        const stats = data.statistics || {};
        
        return `
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center">
                    <i class="fas fa-briefcase text-2xl text-gray-600"></i>
                </div>
                <div>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙƒØªØ¨</h2>
                    <p class="text-gray-500">ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            ${renderKpiCard('Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©', stats.upcoming_appointments || 0, 'fa-calendar-alt', 'text-red-600', 'bg-red-50')}
            ${renderKpiCard('Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…', stats.today_appointments || 0, 'fa-calendar-day', 'text-green-600', 'bg-green-50')}
            ${renderKpiCard('Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', stats.total_customers || 0, 'fa-users', 'text-purple-600', 'bg-purple-50')}
            ${renderKpiCard('Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©', stats.active_services || 0, 'fa-cogs', 'text-orange-600', 'bg-orange-50')}
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-calendar-check text-red-500"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.today_schedule && data.today_schedule.length > 0 ? data.today_schedule.map(apt => `
                        <div class="mb-4 p-4 border-r-4 border-red-500 bg-red-50/30 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-slate-800">${apt.service_name}</h4>
                                    <p class="text-sm text-slate-500">${new Date(apt.session_date).toLocaleTimeString('ar-SA', {hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                                <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-bold">
                                    ${apt.duration || 60} Ø¯Ù‚ÙŠÙ‚Ø©
                                </span>
                            </div>
                            <div class="flex gap-2 text-xs text-slate-600">
                                <i class="fas fa-users"></i> ${apt.attendees} Ø¹Ù…ÙŠÙ„
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</p>'}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-clock text-green-500"></i> Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.appointments && data.appointments.length > 0 ? data.appointments.map(apt => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-slate-800">${apt.service_name}</h4>
                                <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">
                                    ${new Date(apt.session_date).toLocaleDateString('ar-SA')}
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 mb-2">${apt.location || 'Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            <div class="flex gap-4 text-xs text-slate-600">
                                <span><i class="fas fa-users text-red-500"></i> ${apt.booked_slots}/${apt.total_slots || 'âˆ'}</span>
                                <span class="text-${apt.booked_slots >= (apt.total_slots || 999) ? 'red' : 'green'}-600">
                                    ${apt.booked_slots >= (apt.total_slots || 999) ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…ØªØ§Ø­'}
                                </span>
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</p>'}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-user-friends text-purple-500"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                    </h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    ${data.customers && data.customers.length > 0 ? data.customers.map(c => `
                        <div class="mb-4 p-4 border border-slate-100 rounded-lg hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-slate-800">${c.name}</h4>
                                    <p class="text-sm text-slate-500">${c.email}</p>
                                </div>
                            </div>
                            <div class="flex gap-4 text-xs text-slate-600 mt-2">
                                <span><i class="fas fa-calendar text-red-500"></i> ${c.total_bookings} Ø­Ø¬Ø²</span>
                                <span><i class="fas fa-check-circle text-green-500"></i> ${c.active_bookings} Ù†Ø´Ø·</span>
                                ${c.last_visit ? `<span><i class="fas fa-clock text-orange-500"></i> ${new Date(c.last_visit).toLocaleDateString('ar-SA')}</span>` : ''}
                            </div>
                        </div>
                    `).join('') : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</p>'}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        <i class="fas fa-tasks text-orange-500"></i> Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
                    </h3>
                </div>
                <div class="p-6">
                    ${data.execution_status && data.execution_status.length > 0 ? `
                        <div class="space-y-3">
                            ${data.execution_status.map(stat => `
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                                    <span class="font-bold text-slate-700">${stat.status}</span>
                                    <div class="flex gap-4 text-sm">
                                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${stat.count}</span>
                                        <span class="text-red-600">Ù‚Ø§Ø¯Ù…: ${stat.upcoming || 0}</span>
                                        <span class="text-green-600">Ù…Ù†ØªÙ‡ÙŠ: ${stat.completed || 0}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p class="text-slate-400 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>'}
                </div>
            </div>
        </div>`;
    };

    const renderKpiCard = (title, value, icon, color, bg) => `
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-lg transition-all">
            <div class="relative z-10 flex justify-between items-center">
                <div>
                    <p class="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wide">${title}</p>
                    <h3 class="text-2xl font-extrabold text-slate-800">${value}</h3>
                </div>
                <div class="w-12 h-12 rounded-2xl ${bg} ${color} flex items-center justify-center shadow-inner text-xl transform group-hover:rotate-12 transition-transform">
                    <i class="fas ${icon}"></i>
                </div>
            </div>
        </div>`;

    const renderSaaSManager = () => {
        const entities = perms.getVisibleEntities();
        
        if(perms.isHQ()) {
            return `
            <div class="space-y-6 animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª (SaaS)</h2>
                        <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† ÙˆØ§Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„ÙƒÙŠØ§Ù†Ø§Øª</p>
                    </div>
                    <button onclick="app.loadRoute('register-tenant')" class="w-full md:w-auto bg-brand-600 text-white px-5 py-2.5 rounded-xl font-bold hover:shadow-lg hover:bg-brand-700 transition flex items-center justify-center gap-2"><i class="fas fa-plus-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ£Ø¬Ø± Ø¬Ø¯ÙŠØ¯</button>
                </div>

                <!-- SaaS Management Table -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-200">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„ÙØ±Ø¹</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ù…Ù†ØµØ©</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ù…ÙƒØªØ¨</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
                                    <th class="p-4 text-xs font-bold text-slate-600 uppercase">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                ${entities.length ? entities.map(e => {
                                    const typeInfo = TENANT_TYPES[e.type] || TENANT_TYPES.BRANCH;
                                    const isBranch = e.type === 'BRANCH';
                                    const isIncubator = e.type === 'INCUBATOR';
                                    const isPlatform = e.type === 'PLATFORM';
                                    const isOffice = e.type === 'OFFICE';
                                    const isActive = e.status !== 'Suspended';
                                    
                                    return `
                                    <tr class="hover:bg-slate-50 transition">
                                        <td class="p-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-xl ${typeInfo.bg} ${typeInfo.color} flex items-center justify-center">
                                                    <i class="fas ${typeInfo.icon}"></i>
                                                </div>
                                                <div>
                                                    <div class="font-bold text-slate-800">${e.name}</div>
                                                    <div class="text-xs text-slate-500">${e.id}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-4">
                                            <span class="text-slate-700 font-mono text-sm">${e.phone || '-'}</span>
                                        </td>
                                        <td class="p-4">
                                            <span class="text-blue-600 text-sm">${e.email || '-'}</span>
                                        </td>
                                        <td class="p-4">
                                            ${isBranch ? `<span class="text-blue-700 font-semibold">${e.name}</span>` : '<span class="text-slate-400 text-center block">-</span>'}
                                        </td>
                                        <td class="p-4">
                                            ${isIncubator ? `<span class="text-purple-700 font-semibold">${e.name}</span>` : '<span class="text-slate-400 text-center block">-</span>'}
                                        </td>
                                        <td class="p-4">
                                            ${isPlatform ? `<span class="text-green-700 font-semibold">${e.name}</span>` : '<span class="text-slate-400 text-center block">-</span>'}
                                        </td>
                                        <td class="p-4">
                                            ${isOffice ? `<span class="text-orange-700 font-semibold">${e.name}</span>` : '<span class="text-slate-400 text-center block">-</span>'}
                                        </td>
                                        <td class="p-4">
                                            <div class="relative inline-block" id="dropdown-saas-${e.id}">
                                                <button onclick="window.toggleDropdown('saas-${e.id}')" class="px-4 py-2 bg-brand-600 text-white rounded-lg text-sm font-bold hover:bg-brand-700 transition flex items-center gap-2">
                                                    <i class="fas fa-ellipsis-v"></i> Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                                                    <i class="fas fa-chevron-down text-xs"></i>
                                                </button>
                                                <div id="dropdown-menu-saas-${e.id}" class="hidden absolute left-0 mt-2 w-56 bg-white rounded-xl shadow-2xl border border-slate-200 z-50 overflow-hidden">
                                                    <div class="py-2">
                                                        <button onclick="window.manageEntity('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-blue-50 transition flex items-center gap-3 text-blue-700 font-bold">
                                                            <i class="fas fa-cog w-5"></i>
                                                            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ø¹</span>
                                                        </button>
                                                        ${isActive ? `
                                                            <button onclick="window.suspendEntity('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-orange-50 transition flex items-center gap-3 text-orange-700 font-bold">
                                                                <i class="fas fa-pause w-5"></i>
                                                                <span>Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</span>
                                                            </button>
                                                        ` : `
                                                            <button onclick="window.reactivateEntity('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-green-50 transition flex items-center gap-3 text-green-700 font-bold">
                                                                <i class="fas fa-play w-5"></i>
                                                                <span>Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„</span>
                                                            </button>
                                                        `}
                                                        <button onclick="window.editEntity('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-purple-50 transition flex items-center gap-3 text-purple-700 font-bold">
                                                            <i class="fas fa-edit w-5"></i>
                                                            <span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ±Ø¹</span>
                                                        </button>
                                                        <button onclick="window.moveEntityUp('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-indigo-50 transition flex items-center gap-3 text-indigo-700 font-bold">
                                                            <i class="fas fa-arrow-up w-5"></i>
                                                            <span>Ù†Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</span>
                                                        </button>
                                                        <div class="border-t border-slate-200 my-1"></div>
                                                        <button onclick="window.deleteEntityPermanent('${e.id}'); window.closeAllDropdowns();" class="w-full text-right px-4 py-3 hover:bg-red-50 transition flex items-center gap-3 text-red-700 font-bold">
                                                            <i class="fas fa-trash w-5"></i>
                                                            <span>Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-4 text-center">
                                            ${isActive ? 
                                                '<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200"><i class="fas fa-check-circle ml-1"></i> Ù…ÙØ¹Ù‘Ù„</span>' : 
                                                '<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200"><i class="fas fa-pause-circle ml-1"></i> Ù…ÙˆÙ‚ÙˆÙ</span>'
                                            }
                                        </td>
                                    </tr>`;
                                }).join('') : '<tr><td colspan="9" class="p-8 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙŠØ§Ù†Ø§Øª</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        }
        
        // For non-HQ users, show their subscription
        const entity = db.entities.find(e => e.id === currentUser.entityId);
        const plan = SUBSCRIPTION_PLANS[entity.plan];
        return `
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <h2 class="text-2xl md:text-3xl font-extrabold text-slate-800 mb-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ø´ØªØ±Ø§ÙƒÙƒ</h2>
                <p class="text-slate-500">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù„Ù…Ø³ØªØ£Ø¬Ø±: <span class="font-bold text-slate-800">${entity.name}</span></p>
            </div>
            
            <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden relative mb-8">
                <div class="absolute top-0 right-0 w-32 h-32 bg-brand-50 rounded-bl-full -mr-10 -mt-10"></div>
                <div class="p-6 md:p-8 relative z-10 flex flex-col md:flex-row justify-between items-center gap-6">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-xs font-bold bg-brand-100 text-brand-600 px-3 py-1 rounded-full">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>
                            <h3 class="text-3xl font-black text-slate-800">${plan.name}</h3>
                        </div>
                        <p class="text-gray-500">ÙŠØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨ØªØ§Ø±ÙŠØ®: <span class="font-mono font-bold text-gray-800">${entity.expiry}</span></p>
                    </div>
                    <div class="text-center md:text-left">
                        <p class="text-4xl font-black text-slate-800">${plan.price} <span class="text-sm font-medium text-gray-400">Ø±.Ø³ / Ø´Ù‡Ø±ÙŠØ§Ù‹</span></p>
                    </div>
                </div>
                <div class="bg-slate-50 p-6 border-t border-slate-100">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${plan.features.map(f => `<div class="flex items-center gap-2 text-sm text-slate-600"><i class="fas fa-check text-green-500"></i> ${f}</div>`).join('')}
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                ${Object.keys(SUBSCRIPTION_PLANS).map(key => {
                    const p = SUBSCRIPTION_PLANS[key];
                    const isCurrent = entity.plan === key;
                    return `
                    <div class="border ${isCurrent ? 'border-brand-500 ring-2 ring-brand-100 bg-brand-50/50' : 'border-slate-200 bg-white'} rounded-xl p-6 text-center hover:shadow-lg transition relative overflow-hidden">
                        ${isCurrent ? '<div class="absolute top-3 right-3 text-brand-500"><i class="fas fa-check-circle text-xl"></i></div>' : ''}
                        <h4 class="font-bold text-lg text-slate-800 mb-2">${p.name}</h4>
                        <p class="text-2xl font-black text-slate-800 mb-4">${p.price}<span class="text-xs font-normal text-gray-400"> Ø±.Ø³</span></p>
                        <button class="w-full py-2 rounded-lg text-sm font-bold transition ${isCurrent ? 'bg-brand-600 text-white cursor-default' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}">
                            ${isCurrent ? 'Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©' : 'ØªØ±Ù‚ÙŠØ©'}
                        </button>
                    </div>
                    `;
                }).join('')}
            </div>
        </div>`;
    };

    const renderAdsFeed = () => {
        const visibleAds = perms.getVisibleAds();
        // Separate HQ source ads from others
        const hqSourceAds = visibleAds.filter(a => a.sourceType === 'HQ');
        const localAds = visibleAds.filter(a => a.sourceType !== 'HQ');

        return `
        <div class="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2"><i class="fas fa-bullhorn text-brand-500"></i> Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
                ${perms.canManageAds() ? `<button onclick="app.loadRoute('ads')" class="text-xs bg-slate-800 text-white px-3 py-1.5 rounded-lg hover:bg-brand-600 transition"><i class="fas fa-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>` : ''}
            </div>
            <div class="p-6 space-y-6">
                ${hqSourceAds.length > 0 ? `<div class="space-y-3"><h4 class="text-xs font-extrabold text-purple-600 uppercase tracking-widest">ØªØ¹Ø§Ù…ÙŠÙ… Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Global)</h4>${hqSourceAds.map(renderAdCard).join('')}</div>` : ''}
                <div class="space-y-3"><h4 class="text-xs font-extrabold text-slate-400 uppercase tracking-widest">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ (Local Scope)</h4>${localAds.length > 0 ? localAds.map(renderAdCard).join('') : '<p class="text-sm text-slate-400 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>'}</div>
            </div>
        </div>`;
    };

    const renderAdCard = (ad) => {
      const levelsMeta = getAdLevelsMeta(ad);
      const primary = levelsMeta[0];
      const badges = levelsMeta.map(l => `<span class="text-[10px] font-bold px-2 py-0.5 rounded border ${l.badgeClass}">${l.label}</span>`).join(' ');
      return `
      <div class="group relative bg-white border border-slate-100 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-300 hover:translate-x-1 overflow-hidden">
        <div class="absolute right-0 top-0 bottom-0 w-1.5 bg-gradient-to-b ${primary.gradient}"></div>
        <div class="flex justify-between items-start mb-2 pl-2 pr-4">
          <div>
            <div class="flex items-center gap-2 mb-1 flex-wrap">${badges}</div>
            <h4 class="font-bold text-gray-800 text-lg group-hover:text-brand-600 transition">${ad.title}</h4>
          </div>
          <span class="text-[10px] text-gray-400 bg-gray-50 px-2 py-1 rounded-full whitespace-nowrap">${ad.date}</span>
        </div>
        <p class="text-sm text-gray-500 pr-4 pl-2 line-clamp-2 leading-relaxed">${ad.content}</p>
      </div>`;
    };

    const renderAdsManager = () => {
        if (!perms.canManageAds()) return renderAdsFeed();
        const myAds = perms.getManagedAds();
        const totalImpressions = myAds.reduce((sum, ad) => sum + (ad.impressions || 0), 0);
        const totalClicks = myAds.reduce((sum, ad) => sum + (ad.clicks || 0), 0);
        const totalSpent = myAds.reduce((sum, ad) => sum + (ad.spent || 0), 0);
        const ctr = totalImpressions > 0 ? ((totalClicks / totalImpressions) * 100).toFixed(2) : 0;

        return `
        <div class="animate-fade-in space-y-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-extrabold text-slate-800">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù† (Advertiser Console)</h2>
                    <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù…Ø³ØªØ£Ø¬Ø±: <span class="font-bold text-brand-600">${currentUser.entityName}</span></p>
                </div>
                <button onclick="app.openAdWizard()" class="w-full md:w-auto bg-gradient-to-r from-brand-600 to-brand-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-brand-500/40 hover:-translate-y-1 transition transform flex items-center justify-center gap-2">
                    <i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù…Ù„Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©
                </button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                ${renderKpiCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª', totalImpressions.toLocaleString(), 'fa-eye', 'text-red-600', 'bg-red-50')}
                ${renderKpiCard('Ø§Ù„Ù†Ù‚Ø±Ø§Øª (Clicks)', totalClicks.toLocaleString(), 'fa-mouse-pointer', 'text-purple-600', 'bg-purple-50')}
                ${renderKpiCard('Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‚Ø± (CTR)', ctr + '%', 'fa-percent', 'text-green-600', 'bg-green-50')}
                ${renderKpiCard('Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„ÙƒÙ„ÙŠ', totalSpent.toLocaleString() + ' Ø±.Ø³', 'fa-coins', 'text-orange-600', 'bg-orange-50')}
            </div>
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                 <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="font-bold text-lg text-slate-800">Ø³Ø¬Ù„ Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                 </div>
                 <div class="overflow-x-auto">
                     <table class="w-full text-right whitespace-nowrap">
                        <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase tracking-wider">
                            <tr><th class="p-5">Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©</th><th class="p-5">Ø§Ù„Ù†Ø·Ø§Ù‚/Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th class="p-5">Ø§Ù„Ù…Ø¯Ø©</th><th class="p-5">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th class="p-5">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</th><th class="p-5">Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-50 text-sm">
                            ${myAds.length > 0 ? myAds.map(ad => {
                              const levelsMeta = getAdLevelsMeta(ad);
                              const badges = levelsMeta.map(l => `<span class="text-[10px] font-bold px-2 py-1 rounded border bg-white ${l.badgeClass}">${l.label}</span>`).join(' ');
                              return `
                              <tr class="hover:bg-slate-50 transition">
                                <td class="p-5 font-bold text-slate-700">${ad.title}</td>
                                <td class="p-5 space-x-1 space-y-1 flex flex-wrap-reverse justify-end">${badges}</td>
                                <td class="p-5 text-xs text-slate-600">${ad.startDate} - ${ad.endDate}</td>
                                <td class="p-5 min-w-[150px]"><span class="font-bold">${ad.spent}/${ad.budget}</span> Ø±.Ø³</td>
                                <td class="p-5 text-xs"><span class="font-bold">${ad.impressions}</span> Ù…Ø´Ø§Ù‡Ø¯Ø©</td>
                                <td class="p-5"><span class="px-2 py-1 rounded-full text-[10px] font-bold ${ad.status === 'ACTIVE' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'}">${ad.status}</span></td>
                              </tr>`;
                            }).join('') : `<tr><td colspan="7" class="p-8 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù…Ø³Ø¬Ù„Ø©.</td></tr>`}
                        </tbody>
                    </table>
                 </div>
            </div>
        </div>`;
    };

    const initAnalyticsChart = () => {
        const ctx = document.getElementById('analyticsChart');
        if (!ctx) return;
        analyticsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'],
                datasets: [{
                    label: 'Ù…Ø´Ø§Ù‡Ø¯Ø§Øª', data: [120, 300, 450, 320, 500, 650, 400], borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', tension: 0.4, fill: true
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false } } }
        });
    };

    const openAdWizard = () => {
        adWizardData = { step: 1, title: '', content: '', levels: ['L1_LOCAL'], budget: 100, startDate: '', endDate: '' };
        const modal = document.createElement('div');
        modal.id = 'ad-wizard-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden transform scale-95 animate-scale-up flex flex-col max-h-[90vh]">
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex justify-between items-center shrink-0">
                    <h3 class="font-bold text-lg text-slate-800">Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø§Øª</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-brand-600 bg-brand-50 px-3 py-1 rounded-full">Ø®Ø·ÙˆØ© <span id="wiz-step-num">1</span> Ù…Ù† 4</span>
                        <button onclick="document.getElementById('ad-wizard-modal').remove()" class="w-8 h-8 rounded-full hover:bg-slate-200 flex items-center justify-center transition text-slate-500"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div id="wizard-body" class="p-6 overflow-y-auto custom-scrollbar flex-1"></div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-between shrink-0">
                    <button id="wiz-prev-btn" onclick="app.wizardPrev()" class="px-6 py-2 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition hidden">Ø³Ø§Ø¨Ù‚</button>
                    <button id="wiz-next-btn" onclick="app.wizardNext()" class="px-6 py-2 rounded-xl font-bold bg-brand-600 text-white shadow-lg hover:shadow-brand-500/30 hover:bg-brand-700 transition ml-auto">Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left mr-2"></i></button>
                </div>
            </div>`;
        document.body.appendChild(modal);
        renderWizardStep(1);
    };

    const renderWizardStep = (step) => {
        const body = document.getElementById('wizard-body');
        const nextBtn = document.getElementById('wiz-next-btn');
        const prevBtn = document.getElementById('wiz-prev-btn');
        document.getElementById('wiz-step-num').innerText = step;
        adWizardData.step = step;

        if (step === 1) {
            prevBtn.classList.add('hidden');
            nextBtn.innerHTML = 'Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left mr-2"></i>';
            body.innerHTML = `
                <div class="space-y-4 animate-fade-in">
                    <h4 class="text-xl font-bold text-slate-800 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h4>
                    <div><label class="block text-xs font-bold text-slate-600 mb-1.5">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù…Ù„Ø©</label><input type="text" id="wiz-title" value="${adWizardData.title}" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition font-bold"></div>
                    <div><label class="block text-xs font-bold text-slate-600 mb-1.5">Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label><textarea id="wiz-content" rows="4" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition">${adWizardData.content}</textarea></div>
                </div>`;
        } else if (step === 2) {
            prevBtn.classList.remove('hidden');
            nextBtn.innerHTML = 'Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left mr-2"></i>';
            body.innerHTML = `
                <div class="space-y-6 animate-fade-in">
                    <h4 class="text-xl font-bold text-slate-800 mb-4">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„Ø©</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-slate-600 mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label><input type="date" id="wiz-start" value="${adWizardData.startDate}" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none"></div>
                        <div><label class="block text-xs font-bold text-slate-600 mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="wiz-end" value="${adWizardData.endDate}" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none"></div>
                    </div>
                    <div><label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©</label><input type="number" id="wiz-budget" value="${adWizardData.budget}" class="w-full px-4 py-3 rounded-xl border border-gray-200 font-bold text-lg"></div>
                </div>`;
        } else if (step === 3) {
            prevBtn.classList.remove('hidden');
            nextBtn.innerHTML = 'Ù…Ø±Ø§Ø¬Ø¹Ø© <i class="fas fa-check mr-2"></i>';
            body.innerHTML = `
                <div class="space-y-4 animate-fade-in">
                    <h4 class="text-xl font-bold text-slate-800 mb-4">Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù</h4>
                    <div class="flex justify-between items-center mb-2">
                      <span class="text-xs text-slate-500">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ø£Ùˆ ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</span>
                      <button id="wiz-levels-all" class="text-xs font-bold text-brand-600 hover:text-brand-700">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    <div class="grid grid-cols-1 gap-3" id="wiz-levels-grid">
                      ${Object.values(AD_LEVELS).map(l => {
                        const checked = adWizardData.levels?.includes(l.key);
                        return `<label class="flex items-center gap-4 p-4 border rounded-xl hover:bg-slate-50 cursor-pointer ${checked ? 'border-brand-500 bg-brand-50' : ''}">
                          <input type="checkbox" name="wiz-level" value="${l.key}" ${checked ? 'checked' : ''} class="peer w-5 h-5 text-brand-600">
                          <div class="flex-1">
                            <span class="font-bold text-sm block">${l.label}</span>
                            <span class="text-xs text-slate-500">${l.desc}</span>
                          </div>
                        </label>`;
                      }).join('')}
                    </div>
                </div>`;
        } else if (step === 4) {
            prevBtn.classList.remove('hidden');
            nextBtn.innerHTML = 'ØªØ£ÙƒÙŠØ¯ ÙˆÙ†Ø´Ø± <i class="fas fa-rocket mr-2"></i>';
            nextBtn.onclick = app.submitAdWizard;
            const levelsLabels = (adWizardData.levels || []).map(l => AD_LEVELS[l]?.label || l).join('ØŒ ');
            body.innerHTML = `<div class="space-y-6 animate-fade-in"><h4 class="text-xl font-bold text-slate-800 mb-4">Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</h4><div class="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3"><div class="flex justify-between"><span class="text-sm text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span><span class="font-bold">${adWizardData.title}</span></div><div class="flex justify-between pt-3 border-t"><span class="text-sm font-bold">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span><span class="font-black text-xl text-brand-600">${adWizardData.budget} Ø±.Ø³</span></div><div class="flex justify-between pt-3 border-t"><span class="text-sm text-slate-500">Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù</span><span class="text-xs font-bold text-slate-700">${levelsLabels || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></div></div><div class="flex gap-3 p-4 bg-yellow-50 rounded-xl"><input type="checkbox" id="wiz-confirm" class="mt-1"><label for="wiz-confirm" class="text-xs text-yellow-800 font-semibold">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·.</label></div></div>`;
        }
    };

    const wizardNext = () => {
        if (adWizardData.step === 1) { adWizardData.title = document.getElementById('wiz-title').value; adWizardData.content = document.getElementById('wiz-content').value; }
        else if (adWizardData.step === 2) { adWizardData.startDate = document.getElementById('wiz-start').value; adWizardData.endDate = document.getElementById('wiz-end').value; adWizardData.budget = document.getElementById('wiz-budget').value; }
        else if (adWizardData.step === 3) {
          const selectedLevels = Array.from(document.querySelectorAll('input[name="wiz-level"]:checked')).map(i => i.value);
          if (selectedLevels.length === 0) {
            showToast('Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ø³ØªÙ‡Ø¯Ø§Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
            return;
          }
          adWizardData.levels = selectedLevels;
        }
        renderWizardStep(adWizardData.step + 1);
    };

    const wizardPrev = () => renderWizardStep(adWizardData.step - 1);

    const submitAdWizard = () => {
        if (!document.getElementById('wiz-confirm').checked) return showToast('ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·', 'error');
        const levels = adWizardData.levels && adWizardData.levels.length ? adWizardData.levels : ['L1_LOCAL'];
        db.ads.unshift({ id: db.ads.length + 1, title: adWizardData.title, content: adWizardData.content, level: levels[0], levels, status: 'ACTIVE', sourceEntityId: currentUser.entityId, date: new Date().toISOString().slice(0, 10), sourceType: currentUser.tenantType, budget: parseInt(adWizardData.budget), spent: 0, impressions: 0, clicks: 0, startDate: adWizardData.startDate, endDate: adWizardData.endDate, targetIds: [] });
        document.getElementById('ad-wizard-modal').remove();
        showToast('ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©!', 'success');
        loadRoute('ads');
    };

    // --- FINANCE MODULE (Ø§Ù„Ù…Ø§Ù„ÙŠØ©) ---
    const renderFinance = () => {
        const invoices = perms.getVisibleInvoices();
        const ledger = perms.getVisibleLedger();
        
        const totalRevenue = ledger.reduce((sum, l) => sum + (l.credit || 0), 0);
        const totalExpenses = ledger.reduce((sum, l) => sum + (l.debit || 0), 0);
        const netBalance = totalRevenue - totalExpenses;
        const monthlyRevenue = ledger.filter(l => {
            const date = new Date(l.date);
            const now = new Date();
            return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
        }).reduce((sum, l) => sum + (l.credit || 0), 0);

        const totalDue = invoices.reduce((s, i) => s + (i.amount - (i.paidAmount || 0)), 0);
        const totalPaid = invoices.reduce((s, i) => s + (i.paidAmount || 0), 0);
        const overdue = invoices.filter(i => i.status === 'OVERDUE').length;

        return `
        <div class="space-y-6 animate-fade-in">
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-dollar-sign text-green-600"></i>
                        Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                    </h2>
                    <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                </div>
                <div class="flex gap-3">
                    ${perms.isHQ() ? `<button onclick="app.openCreateInvoiceModal()" class="bg-brand-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-brand-700 transition flex items-center gap-2"><i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©</button>` : ''}
                    <button onclick="window.openAddTransactionModal()" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø§Ù„ÙŠØ©
                    </button>
                </div>
            </div>

            <!-- Financial Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-arrow-up text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</span>
                    </div>
                    <div class="text-3xl font-bold">${totalRevenue.toLocaleString()} Ø±.Ø³</div>
                </div>

                <div class="bg-gradient-to-br from-red-500 to-rose-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-arrow-down text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
                    </div>
                    <div class="text-3xl font-bold">${totalExpenses.toLocaleString()} Ø±.Ø³</div>
                </div>

                <div class="bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-wallet text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ</span>
                    </div>
                    <div class="text-3xl font-bold">${netBalance.toLocaleString()} Ø±.Ø³</div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-indigo-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-calendar-alt text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
                    </div>
                    <div class="text-3xl font-bold">${monthlyRevenue.toLocaleString()} Ø±.Ø³</div>
                </div>
            </div>

            <!-- Tabs System -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="flex border-b border-slate-100">
                    <button onclick="app.switchTab('invoices')" id="tab-btn-invoices" class="flex-1 py-4 text-sm font-bold text-brand-600 border-b-2 border-brand-600 bg-brand-50 transition">Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Invoices)</button>
                    <button onclick="app.switchTab('ledger')" id="tab-btn-ledger" class="flex-1 py-4 text-sm font-bold text-slate-500 hover:bg-slate-50 transition">Ø³Ø¬Ù„ Ø§Ù„Ù‚ÙŠÙˆØ¯ (Ledger)</button>
                    <button onclick="app.switchTab('transactions')" id="tab-btn-transactions" class="flex-1 py-4 text-sm font-bold text-slate-500 hover:bg-slate-50 transition">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</button>
                </div>

                <!-- Invoices Tab -->
                <div id="tab-content-invoices" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        ${renderKpiCard('Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© (AR)', totalDue.toLocaleString() + ' Ø±.Ø³', 'fa-hand-holding-usd', 'text-red-600', 'bg-red-50')}
                        ${renderKpiCard('Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø­ØµÙ„Ø©', totalPaid.toLocaleString() + ' Ø±.Ø³', 'fa-check-double', 'text-green-600', 'bg-green-50')}
                        ${renderKpiCard('Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©', overdue, 'fa-clock', 'text-orange-600', 'bg-orange-50')}
                    </div>
                    <div class="overflow-x-auto">
                         <table class="w-full text-right whitespace-nowrap">
                            <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase tracking-wider">
                                <tr>
                                    <th class="p-4">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                    ${perms.isHQ() ? '<th class="p-4">Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th>' : ''}
                                    ${perms.isHQ() ? '<th class="p-4">ÙØ±Ø¹</th>' : ''}
                                    ${perms.isHQ() ? '<th class="p-4">Ø­Ø§Ø¶Ù†Ø©</th>' : ''}
                                    ${perms.isHQ() ? '<th class="p-4">Ù…Ù†ØµØ©</th>' : ''}
                                    ${perms.isHQ() ? '<th class="p-4">Ù…ÙƒØªØ¨</th>' : ''}
                                    <th class="p-4">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th class="p-4">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th class="p-4">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                                    <th class="p-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="p-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50 text-sm">
                                ${invoices.length ? invoices.map(inv => {
                                    const status = INVOICE_STATUS[inv.status] || INVOICE_STATUS.UNPAID;
                                    const entity = db.entities.find(e => e.id === inv.entityId);
                                    const entityName = entity?.name || inv.entityId;
                                    const isBranch = entity?.type === 'BRANCH';
                                    const isIncubator = entity?.type === 'INCUBATOR';
                                    const isPlatform = entity?.type === 'PLATFORM';
                                    const isOffice = entity?.type === 'OFFICE';
                                    
                                    return `
                                    <tr class="hover:bg-slate-50 transition group">
                                        <td class="p-4 font-mono font-bold text-brand-600">${inv.id}</td>
                                        ${perms.isHQ() ? `<td class="p-4 font-bold text-slate-700">${entityName}</td>` : ''}
                                        ${perms.isHQ() ? `<td class="p-4">${isBranch ? `<span class="text-blue-700 font-semibold">${entityName}</span>` : '<span class="text-slate-400 text-center block">-</span>'}</td>` : ''}
                                        ${perms.isHQ() ? `<td class="p-4">${isIncubator ? `<span class="text-purple-700 font-semibold">${entityName}</span>` : '<span class="text-slate-400 text-center block">-</span>'}</td>` : ''}
                                        ${perms.isHQ() ? `<td class="p-4">${isPlatform ? `<span class="text-green-700 font-semibold">${entityName}</span>` : '<span class="text-slate-400 text-center block">-</span>'}</td>` : ''}
                                        ${perms.isHQ() ? `<td class="p-4">${isOffice ? `<span class="text-orange-700 font-semibold">${entityName}</span>` : '<span class="text-slate-400 text-center block">-</span>'}</td>` : ''}
                                        <td class="p-4 text-slate-600">${inv.title}</td>
                                        <td class="p-4 font-bold">${inv.amount.toLocaleString()}</td>
                                        <td class="p-4 text-green-600">${inv.paidAmount.toLocaleString()}</td>
                                        <td class="p-4"><span class="px-2.5 py-1 rounded-full text-[10px] font-bold border ${status.bg} ${status.color} border-current border-opacity-20">${status.label}</span></td>
                                        <td class="p-4 text-xs text-slate-400">${inv.date}</td>
                                        <td class="p-4">
                                            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                                <button onclick="app.openPaymentModal('${inv.id}')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg tooltip" title="Ø³Ø¯Ø§Ø¯"><i class="fas fa-money-bill-wave"></i></button>
                                                <button onclick="window.viewInvoiceDetails('${inv.id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg" title="Ø¹Ø±Ø¶"><i class="fas fa-eye"></i></button>
                                                <button onclick="window.printInvoice('${inv.id}')" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg" title="Ø·Ø¨Ø§Ø¹Ø©"><i class="fas fa-print"></i></button>
                                                <button onclick="window.deleteInvoice('${inv.id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg" title="Ø­Ø°Ù"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>`;
                                }).join('') : '<tr><td colspan="8" class="p-8 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø³Ø¬Ù„Ø©</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ledger Tab -->
                <div id="tab-content-ledger" class="hidden p-6">
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 mb-6 flex items-start gap-3">
                        <i class="fas fa-shield-alt text-yellow-600 mt-1"></i>
                        <div>
                            <h4 class="font-bold text-yellow-800 text-sm">Ø³Ø¬Ù„ Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø­Ø°Ù (Immutable Ledger)</h4>
                            <p class="text-xs text-yellow-700 mt-1">ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù‡Ù†Ø§. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù‚ÙŠÙˆØ¯ØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ù‚ÙŠÙˆØ¯ Ø¹ÙƒØ³ÙŠØ© (Reversal) Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right whitespace-nowrap">
                            <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase tracking-wider">
                                <tr>
                                    <th class="p-4">#</th>
                                    <th class="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="p-4">Ø§Ù„Ù…Ø±Ø¬Ø¹ (Trx ID)</th>
                                    <th class="p-4">Ø§Ù„ÙˆØµÙ</th>
                                    <th class="p-4">Ø¯Ø§Ø¦Ù† (Credit)</th>
                                    <th class="p-4">Ø±ØµÙŠØ¯ ØªØ±Ø§ÙƒÙ…ÙŠ</th>
                                    <th class="p-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50 text-sm font-mono">
                                ${ledger.length ? ledger.map(l => `
                                <tr class="hover:bg-slate-50">
                                    <td class="p-4 text-slate-400">${l.id}</td>
                                    <td class="p-4 text-slate-500">${l.date}</td>
                                    <td class="p-4 text-brand-600">${l.trxId}</td>
                                    <td class="p-4 font-sans font-bold text-slate-700">${l.desc}</td>
                                    <td class="p-4 text-green-600">${l.credit > 0 ? l.credit.toLocaleString() : '-'}</td>
                                    <td class="p-4 font-bold text-slate-800">${l.balance.toLocaleString()}</td>
                                    <td class="p-4">
                                        ${l.credit > 0 ? `<button onclick="app.reverseTransaction('${l.trxId}')" class="text-[10px] bg-red-50 text-red-600 px-2 py-1 rounded border border-red-100 hover:bg-red-100 transition">Ù‚ÙŠØ¯ Ø¹ÙƒØ³ÙŠ</button>` : ''}
                                    </td>
                                </tr>`).join('') : '<tr><td colspan="7" class="p-8 text-center text-slate-400">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙØ§Ø±Øº</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Transactions Tab -->
                <div id="tab-content-transactions" class="hidden p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right">
                            <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase">
                                <tr>
                                    <th class="p-4">#</th>
                                    <th class="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="p-4">Ø§Ù„Ù…Ø±Ø¬Ø¹</th>
                                    <th class="p-4">Ø§Ù„ÙˆØµÙ</th>
                                    <th class="p-4">Ø¯Ø§Ø¦Ù† (Ø¥ÙŠØ±Ø§Ø¯)</th>
                                    <th class="p-4">Ù…Ø¯ÙŠÙ† (Ù…ØµØ±ÙˆÙ)</th>
                                    <th class="p-4">Ø§Ù„Ø±ØµÙŠØ¯</th>
                                    <th class="p-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50 text-sm">
                                ${ledger.length ? ledger.map((l, idx) => `
                                <tr class="hover:bg-slate-50">
                                    <td class="p-4 text-slate-400">${idx + 1}</td>
                                    <td class="p-4 text-slate-600">${l.date || '-'}</td>
                                    <td class="p-4 text-red-600 font-mono">${l.trxId || '-'}</td>
                                    <td class="p-4 text-slate-700">${l.desc || '-'}</td>
                                    <td class="p-4 text-green-600 font-bold">${l.credit > 0 ? l.credit.toLocaleString() : '-'}</td>
                                    <td class="p-4 text-red-600 font-bold">${l.debit > 0 ? l.debit.toLocaleString() : '-'}</td>
                                    <td class="p-4 font-bold text-slate-800">${(l.balance || 0).toLocaleString()}</td>
                                    <td class="p-4">
                                        <div class="flex gap-2">
                                            <button onclick="window.viewTransactionDetails('${l.trxId}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Ø¹Ø±Ø¶">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button onclick="window.deleteTransaction('${l.trxId}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Ø­Ø°Ù">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>`).join('') : '<tr><td colspan="8" class="p-8 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø§Ù„ÙŠØ©</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>`;
    };

    // --- COLLECTIONS MODULE (Ø§Ù„ØªØ­ØµÙŠÙ„) ---
    const renderCollections = () => {
        const invoices = perms.getVisibleInvoices();
        
        const unpaidInvoices = invoices.filter(i => i.status === 'UNPAID' || i.status === 'PARTIAL');
        const overdueInvoices = invoices.filter(i => i.status === 'OVERDUE');
        const totalDue = unpaidInvoices.reduce((sum, i) => sum + (i.amount - (i.paidAmount || 0)), 0);
        const totalOverdue = overdueInvoices.reduce((sum, i) => sum + (i.amount - (i.paidAmount || 0)), 0);
        const collectedThisMonth = invoices.filter(i => {
            const date = new Date(i.date);
            const now = new Date();
            return i.status === 'PAID' && date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
        }).reduce((sum, i) => sum + i.amount, 0);

        return `
        <div class="space-y-6 animate-fade-in">
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-money-bill-wave text-red-600"></i>
                        Ø§Ù„ØªØ­ØµÙŠÙ„
                    </h2>
                    <p class="text-slate-500 mt-1">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</p>
                </div>
                <button onclick="app.openCreateInvoiceModal()" class="px-6 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition shadow-lg flex items-center gap-2">
                    <i class="fas fa-file-invoice"></i>
                    Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>

            <!-- Collections Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-gradient-to-br from-amber-500 to-orange-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-clock text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</span>
                    </div>
                    <div class="text-3xl font-bold">${totalDue.toLocaleString()} Ø±.Ø³</div>
                    <div class="text-xs mt-2 opacity-75">${unpaidInvoices.length} ÙØ§ØªÙˆØ±Ø©</div>
                </div>

                <div class="bg-gradient-to-br from-red-500 to-rose-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-exclamation-triangle text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ù…ØªØ£Ø®Ø± Ø§Ù„Ø³Ø¯Ø§Ø¯</span>
                    </div>
                    <div class="text-3xl font-bold">${totalOverdue.toLocaleString()} Ø±.Ø³</div>
                    <div class="text-xs mt-2 opacity-75">${overdueInvoices.length} ÙØ§ØªÙˆØ±Ø©</div>
                </div>

                <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-check-circle text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">ØªÙ… ØªØ­ØµÙŠÙ„Ù‡ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
                    </div>
                    <div class="text-3xl font-bold">${collectedThisMonth.toLocaleString()} Ø±.Ø³</div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-indigo-600 p-6 rounded-2xl text-white shadow-xl">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-percentage text-3xl opacity-30"></i>
                        <span class="text-xs opacity-75">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„</span>
                    </div>
                    <div class="text-3xl font-bold">${invoices.length > 0 ? Math.round((invoices.filter(i => i.status === 'PAID').length / invoices.length) * 100) : 0}%</div>
                </div>
            </div>

            <!-- Invoices Table -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="p-6 bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i class="fas fa-file-invoice-dollar text-slate-600"></i>
                        Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©
                    </h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-right">
                        <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase">
                            <tr>
                                <th class="p-4">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                <th class="p-4">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th class="p-4">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th class="p-4">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th class="p-4">Ø§Ø³Ù… Ø§Ù„ÙƒÙŠØ§Ù†</th>
                                <th class="p-4">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th class="p-4">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                                <th class="p-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th class="p-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-50 text-sm">
                            ${invoices.length ? invoices.map(i => {
                                const remaining = i.amount - (i.paidAmount || 0);
                                const statusColors = {
                                    'PAID': 'bg-green-100 text-green-700',
                                    'UNPAID': 'bg-amber-100 text-amber-700',
                                    'PARTIAL': 'bg-red-100 text-red-700',
                                    'OVERDUE': 'bg-red-100 text-red-700'
                                };
                                return `
                                <tr class="hover:bg-slate-50">
                                    <td class="p-4 font-mono text-red-600 font-bold">${i.id}</td>
                                    <td class="p-4 text-slate-800 font-semibold">${i.customerName || '-'}</td>
                                    <td class="p-4 text-slate-600">${i.customerNumber || '-'}</td>
                                    <td class="p-4 text-slate-600 direction-ltr">${i.customerPhone || '-'}</td>
                                    <td class="p-4 text-slate-700">${i.entityId}</td>
                                    <td class="p-4 font-bold text-slate-800">${i.amount.toLocaleString()} Ø±.Ø³</td>
                                    <td class="p-4 font-bold ${remaining > 0 ? 'text-red-600' : 'text-green-600'}">${remaining.toLocaleString()} Ø±.Ø³</td>
                                    <td class="p-4">
                                        <span class="px-3 py-1 rounded-full text-xs font-bold ${statusColors[i.status] || 'bg-gray-100 text-gray-700'}">
                                            ${i.status === 'PAID' ? 'Ù…Ø¯ÙÙˆØ¹' : i.status === 'UNPAID' ? 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹' : i.status === 'PARTIAL' ? 'Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ' : 'Ù…ØªØ£Ø®Ø±'}
                                        </span>
                                    </td>
                                    <td class="p-4">
                                        <div class="flex gap-2">
                                            ${i.status !== 'PAID' ? `<button onclick="app.openPaymentModal('${i.id}')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition" title="Ø¯ÙØ¹"><i class="fas fa-money-bill"></i></button>` : ''}
                                            <button onclick="window.viewInvoiceDetails('${i.id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Ø¹Ø±Ø¶"><i class="fas fa-eye"></i></button>
                                            <button onclick="window.printInvoice('${i.id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition" title="Ø·Ø¨Ø§Ø¹Ø©"><i class="fas fa-print"></i></button>
                                            <button onclick="window.deleteInvoice('${i.id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Ø­Ø°Ù"><i class="fas fa-trash"></i></button>
                                        </div>
                                    </td>
                                </tr>`;
                            }).join('') : '<tr><td colspan="9" class="p-8 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>`;
    };

    // Modal for adding financial transaction
    window.openAddTransactionModal = function() {
        const modal = document.createElement('div');
        modal.id = 'transaction-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-scale-up">
                <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-green-50 to-emerald-50">
                    <h3 class="font-bold text-xl text-slate-800">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø§Ù„ÙŠØ©</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                        <select id="trx-type" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none">
                            <option value="credit">Ø¥ÙŠØ±Ø§Ø¯ (Credit)</option>
                            <option value="debit">Ù…ØµØ±ÙˆÙ (Debit)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" id="trx-desc" placeholder="Ù…Ø«Ø§Ù„: Ø±Ø³ÙˆÙ… Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³)</label>
                        <input type="number" id="trx-amount" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none font-bold text-lg">
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                    <button onclick="document.getElementById('transaction-modal').remove()" class="px-4 py-2 rounded-lg text-slate-500 font-bold hover:bg-slate-200">Ø¥Ù„ØºØ§Ø¡</button>
                    <button onclick="window.submitTransaction()" class="px-6 py-2 rounded-lg bg-green-600 text-white font-bold hover:bg-green-700 shadow-lg">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>`;
        document.body.appendChild(modal);
    };

    window.submitTransaction = function() {
        const type = document.getElementById('trx-type').value;
        const desc = document.getElementById('trx-desc').value;
        const amount = parseFloat(document.getElementById('trx-amount').value);

        if (!desc || !amount) {
            alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
            return;
        }

        // Get current user's ledger to calculate last balance
        const currentUserLedger = db.ledger.filter(l => l.entityId === currentUser.entityId);
        const lastLedger = currentUserLedger[currentUserLedger.length - 1];
        const lastBalance = lastLedger ? lastLedger.balance : 0;

        const newEntry = {
            id: db.ledger.length + 1,
            entityId: currentUser.entityId,  // Ø¥Ø¶Ø§ÙØ© entityId
            date: new Date().toISOString().slice(0, 10),
            trxId: `TRX-${Date.now()}`,
            desc: desc,
            credit: type === 'credit' ? amount : 0,
            debit: type === 'debit' ? amount : 0,
            balance: type === 'credit' ? lastBalance + amount : lastBalance - amount
        };

        db.ledger.push(newEntry);
        logAction('ADD_TRANSACTION', `Added ${type} transaction: ${desc} - ${amount} SAR`);
        document.getElementById('transaction-modal').remove();
        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadRoute('finance');
    };

    // View transaction details
    window.viewTransactionDetails = function(trxId) {
        const transaction = db.ledger.find(t => t.trxId === trxId);
        if (!transaction) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
            return;
        }

        const modal = document.createElement('div');
        modal.id = 'transaction-details-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-scale-up">
                <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-${transaction.credit > 0 ? 'green' : 'red'}-50 to-${transaction.credit > 0 ? 'emerald' : 'rose'}-50">
                    <h3 class="font-bold text-2xl text-slate-800 flex items-center gap-2">
                        <i class="fas fa-${transaction.credit > 0 ? 'arrow-up' : 'arrow-down'} text-${transaction.credit > 0 ? 'green' : 'red'}-600"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                            <div class="text-lg font-bold text-red-600 font-mono">${transaction.trxId}</div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                            <div class="text-lg font-bold ${transaction.credit > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${transaction.credit > 0 ? 'Ø¥ÙŠØ±Ø§Ø¯ (Credit)' : 'Ù…ØµØ±ÙˆÙ (Debit)'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <label class="text-xs font-bold text-slate-500">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <div class="text-lg text-slate-700">${transaction.date || '-'}</div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <label class="text-xs font-bold text-slate-500">Ø§Ù„ÙˆØµÙ</label>
                        <div class="text-lg text-slate-800 font-medium">${transaction.desc || '-'}</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 border-t pt-4">
                        ${transaction.credit > 0 ? `
                        <div class="col-span-2">
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¥ÙŠØ±Ø§Ø¯)</label>
                            <div class="text-3xl font-bold text-green-600">${transaction.credit.toLocaleString()} Ø±.Ø³</div>
                        </div>
                        ` : `
                        <div class="col-span-2">
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ù…Ø¨Ù„Øº (Ù…ØµØ±ÙˆÙ)</label>
                            <div class="text-3xl font-bold text-red-600">${transaction.debit.toLocaleString()} Ø±.Ø³</div>
                        </div>
                        `}
                    </div>
                    
                    <div class="border-t pt-4">
                        <label class="text-xs font-bold text-slate-500">Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                        <div class="text-2xl font-bold text-slate-800">${(transaction.balance || 0).toLocaleString()} Ø±.Ø³</div>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                    <button onclick="document.getElementById('transaction-details-modal').remove()" class="px-6 py-2 rounded-lg bg-slate-600 text-white font-bold hover:bg-slate-700">Ø¥ØºÙ„Ø§Ù‚</button>
                    <button onclick="document.getElementById('transaction-details-modal').remove(); window.deleteTransaction('${transaction.trxId}')" class="px-6 py-2 rounded-lg bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg">
                        <i class="fas fa-trash mr-1"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                    </button>
                </div>
            </div>`;
        document.body.appendChild(modal);
    };

    // Delete transaction from ledger
    window.deleteTransaction = function(trxId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŸ')) {
            return;
        }

        const index = db.ledger.findIndex(l => l.trxId === trxId);
        if (index !== -1) {
            db.ledger.splice(index, 1);
            logAction('DELETE_TRANSACTION', `Deleted transaction: ${trxId}`);
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            loadRoute('finance');
        } else {
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©', 'error');
        }
    };

    // Delete invoice
    // View invoice details
    window.viewInvoiceDetails = function(invoiceId) {
        const invoice = db.invoices.find(inv => inv.id === invoiceId);
        if (!invoice) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©');
            return;
        }

        const entity = db.entities.find(e => e.id === invoice.entityId);
        const remaining = invoice.amount - (invoice.paidAmount || 0);

        const modal = document.createElement('div');
        modal.id = 'invoice-details-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scale-up">
                <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-red-50 to-cyan-50">
                    <h3 class="font-bold text-2xl text-slate-800 flex items-center gap-2">
                        <i class="fas fa-file-invoice text-red-600"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                            <div class="text-lg font-bold text-red-600 font-mono">${invoice.id}</div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <div class="text-lg font-bold ${invoice.status === 'PAID' ? 'text-green-600' : invoice.status === 'OVERDUE' ? 'text-red-600' : 'text-amber-600'}">
                                ${invoice.status === 'PAID' ? 'Ù…Ø¯ÙÙˆØ¹' : invoice.status === 'UNPAID' ? 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹' : invoice.status === 'PARTIAL' ? 'Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ' : 'Ù…ØªØ£Ø®Ø±'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4 bg-slate-50 p-4 rounded-xl">
                        <h4 class="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                            <i class="fas fa-user-circle text-red-600"></i>
                            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-bold text-slate-500">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <div class="text-base font-semibold text-slate-800">${invoice.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <div class="text-base font-semibold text-slate-800">${invoice.customerNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <div class="text-base font-semibold text-slate-800 direction-ltr">${invoice.customerPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500">Ø§Ø³Ù… Ø§Ù„ÙƒÙŠØ§Ù†</label>
                                <div class="text-base font-semibold text-slate-800">${entity ? entity.name : invoice.entityId}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <label class="text-xs font-bold text-slate-500">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                        <div class="text-lg text-slate-700">${invoice.title || '-'}</div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 border-t pt-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                            <div class="text-xl font-bold text-slate-800">${invoice.amount.toLocaleString()} Ø±.Ø³</div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
                            <div class="text-xl font-bold text-green-600">${(invoice.paidAmount || 0).toLocaleString()} Ø±.Ø³</div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</label>
                            <div class="text-xl font-bold text-red-600">${remaining.toLocaleString()} Ø±.Ø³</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 border-t pt-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                            <div class="text-lg text-slate-700">${invoice.date || '-'}</div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                            <div class="text-lg text-slate-700">${invoice.dueDate || '-'}</div>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                    <button onclick="document.getElementById('invoice-details-modal').remove()" class="px-6 py-2 rounded-lg bg-slate-600 text-white font-bold hover:bg-slate-700">Ø¥ØºÙ„Ø§Ù‚</button>
                    ${invoice.status !== 'PAID' ? `<button onclick="document.getElementById('invoice-details-modal').remove(); app.openPaymentModal('${invoice.id}')" class="px-6 py-2 rounded-lg bg-green-600 text-white font-bold hover:bg-green-700 shadow-lg">ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©</button>` : ''}
                </div>
            </div>`;
        document.body.appendChild(modal);
    };

    // Print invoice with customer details
    window.printInvoice = function(invoiceId) {
        const invoice = db.invoices.find(inv => inv.id === invoiceId);
        if (!invoice) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©');
            return;
        }

        const entity = db.entities.find(e => e.id === invoice.entityId);
        const currentDate = new Date().toLocaleDateString('en-US');
        const subtotal = invoice.amount;
        const vat = subtotal * 0.15; // 15% VAT
        const total = subtotal + vat;

        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>Invoice ${invoice.id}</title>
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body { 
                        font-family: 'Arial', sans-serif; 
                        padding: 40px; 
                        background: #fff;
                        color: #333;
                    }
                    .invoice-container { 
                        max-width: 1000px; 
                        margin: 0 auto; 
                        border: 2px solid #000;
                        padding: 30px;
                    }
                    
                    /* Header Section */
                    .header-section {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 30px;
                        padding-bottom: 20px;
                        border-bottom: 2px solid #000;
                    }
                    .company-info {
                        flex: 1;
                    }
                    .logo {
                        width: 80px;
                        height: 80px;
                        background: #b11226;
                        color: white;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 36px;
                        font-weight: bold;
                        border-radius: 8px;
                        margin-bottom: 10px;
                    }
                    .company-name {
                        font-size: 16px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        line-height: 1.4;
                    }
                    .company-details {
                        font-size: 12px;
                        color: #555;
                        line-height: 1.6;
                    }
                    
                    /* Quote Info Table */
                    .quote-info {
                        margin-bottom: 20px;
                    }
                    .info-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-bottom: 20px;
                    }
                    .info-table td {
                        border: 1px solid #000;
                        padding: 8px 12px;
                        font-size: 12px;
                    }
                    .info-table td:first-child {
                        background: #f0f0f0;
                        font-weight: bold;
                        width: 150px;
                    }
                    
                    /* Details Section */
                    .details-section {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 30px;
                    }
                    .detail-box {
                        border: 1px solid #000;
                    }
                    .detail-header {
                        background: #000;
                        color: white;
                        padding: 10px;
                        text-align: center;
                        font-weight: bold;
                        font-size: 14px;
                    }
                    .detail-content {
                        padding: 15px;
                    }
                    .detail-row {
                        display: grid;
                        grid-template-columns: 120px 1fr;
                        margin-bottom: 8px;
                        font-size: 11px;
                    }
                    .detail-label {
                        font-weight: bold;
                        color: #555;
                    }
                    .detail-value {
                        color: #000;
                    }
                    
                    /* Products Table */
                    .products-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-bottom: 20px;
                    }
                    .products-table th,
                    .products-table td {
                        border: 1px solid #000;
                        padding: 10px;
                        text-align: center;
                    }
                    .products-table th {
                        background: #f0f0f0;
                        font-weight: bold;
                        font-size: 12px;
                    }
                    .products-table td {
                        font-size: 11px;
                    }
                    .products-table .text-right {
                        text-align: right;
                    }
                    
                    /* Totals Section */
                    .totals-section {
                        float: right;
                        width: 350px;
                        margin-top: 20px;
                    }
                    .totals-table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    .totals-table td {
                        border: 1px solid #000;
                        padding: 10px;
                        font-size: 13px;
                    }
                    .totals-table td:first-child {
                        background: #f0f0f0;
                        font-weight: bold;
                        text-align: center;
                    }
                    .totals-table td:last-child {
                        text-align: right;
                        font-weight: bold;
                    }
                    .total-row td {
                        background: #e0e0e0 !important;
                        font-size: 14px;
                    }
                    
                    @media print {
                        body { padding: 0; }
                        .invoice-container { border: none; }
                    }
                </style>
            </head>
            <body>
                <div class="invoice-container">
                    <!-- Header Section -->
                    <div class="header-section">
                        <div class="company-info">
                            <div class="logo">N</div>
                            <div class="company-name">
                                Ù†Ø§ÙŠÙˆØ´ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„<br>
                                NAIOSH Business Systems
                            </div>
                            <div class="company-details">
                                Building No. ${entity?.location || 'Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'}<br>
                                Riyadh 12613, Saudi Arabia<br>
                                Tel: + 966 11 XXXXXXX<br>
                                Tax ID: 310XXXXXXXXX
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quote Info -->
                    <table class="info-table">
                        <tr>
                            <td>Quote</td>
                            <td>${invoice.id}</td>
                            <td>SalesMan</td>
                            <td>${invoice.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        </tr>
                        <tr>
                            <td>SalesMan Email</td>
                            <td>${invoice.customerEmail || 'info@nayosh.com'}</td>
                            <td>Date</td>
                            <td>${currentDate}</td>
                        </tr>
                        <tr>
                            <td>Payment Terms</td>
                            <td>${invoice.paymentMethod || 'Ù†Ù‚Ø¯ÙŠ'}</td>
                            <td>Country</td>
                            <td>Saudi Arabia</td>
                        </tr>
                        <tr>
                            <td colspan="2"></td>
                            <td>Currency</td>
                            <td>SAR</td>
                        </tr>
                    </table>
                    
                    <!-- Reseller & End User Details -->
                    <div class="details-section">
                        <!-- Reseller Details -->
                        <div class="detail-box">
                            <div class="detail-header">Reseller Details</div>
                            <div class="detail-content">
                                <div class="detail-row">
                                    <div class="detail-label">Company Name</div>
                                    <div class="detail-value">Ù†Ø§ÙŠÙˆØ´ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Address</div>
                                    <div class="detail-value">Building No.7554, Riyadh 12613</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Country</div>
                                    <div class="detail-value">Saudi Arabia</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Sales Person</div>
                                    <div class="detail-value">${invoice.customerName || 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Phone</div>
                                    <div class="detail-value">${invoice.customerPhone || '+ 966 11 XXXXXXX'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Email Address</div>
                                    <div class="detail-value">info@nayosh.com</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Website</div>
                                    <div class="detail-value">https://www.nayosh.com</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- End User Details -->
                        <div class="detail-box">
                            <div class="detail-header">End User Details</div>
                            <div class="detail-content">
                                <div class="detail-row">
                                    <div class="detail-label">Customer Name</div>
                                    <div class="detail-value">${invoice.customerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Address</div>
                                    <div class="detail-value">${entity?.location || 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Country</div>
                                    <div class="detail-value">Saudi Arabia</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Phone</div>
                                    <div class="detail-value">${invoice.customerPhone || '00966 XXXXXXXXX'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Email Address</div>
                                    <div class="detail-value">${invoice.customerEmail || 'customer@example.com'}</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">Website</div>
                                    <div class="detail-value">-</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">VAT Number</div>
                                    <div class="detail-value">${invoice.customerNumber || '310XXXXXXXXX'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Products Table -->
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>SN</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬<br>Product Number</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬<br>Product Name</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©<br>Qty</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±<br>Unit price</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹<br>subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>${invoice.id}</td>
                                <td class="text-right">${invoice.title}</td>
                                <td>1.00</td>
                                <td>${subtotal.toLocaleString('en-US', {minimumFractionDigits: 2})} SR</td>
                                <td>${subtotal.toLocaleString('en-US', {minimumFractionDigits: 2})} SR</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- Totals -->
                    <div class="totals-section">
                        <table class="totals-table">
                            <tr>
                                <td>Subtotal</td>
                                <td>${subtotal.toLocaleString('en-US', {minimumFractionDigits: 2})} SR</td>
                            </tr>
                            <tr>
                                <td>VAT (15%)</td>
                                <td>${vat.toLocaleString('en-US', {minimumFractionDigits: 2})} SR</td>
                            </tr>
                            <tr class="total-row">
                                <td>Total</td>
                                <td>${total.toLocaleString('en-US', {minimumFractionDigits: 2})} SR</td>
                            </tr>
                        </table>
                    </div>
                    <div style="clear: both;"></div>
                </div>
                
                <script>
                    window.onload = function() {
                        setTimeout(function() {
                            window.print();
                        }, 500);
                    };
                </script>
            </body>
            </html>
        `);
        printWindow.document.close();
    };

    // Delete Invoice Function - ÙŠØ­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆÙŠØ¹ÙŠØ¯ ØªØµÙŠÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø· Ø¯ÙˆÙ† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† Ø§Ù„ØµÙØ­Ø©
    window.deleteInvoice = function(invoiceId) {
        const invoice = db.invoices.find(inv => inv.id === invoiceId);
        if (!invoice) {
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'error');
            return;
        }

        // Confirm deletion
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© ${invoiceId}ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
            return;
        }

        // Send delete request to API
        fetch(`/api/invoices/${invoiceId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
            return response.json();
        })
        .then(data => {
            logAction('DELETE_INVOICE', `Deleted Invoice ${invoiceId}`);
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©
            const currentRoute = window.location.hash.slice(1) || 'dashboard';
            
            // Reload invoices from API
            return fetch('/api/invoices', {
                headers: {
                    'x-entity-type': window.currentUser?.entityType || 'HQ',
                    'x-entity-id': window.currentUser?.entityId || 'HQ001'
                }
            })
            .then(response => response.json())
            .then(invoices => {
                // Update local cache
                db.invoices = invoices;
                
                // Re-render the current page
                if (currentRoute === 'finance' || currentRoute === 'collections') {
                    const view = document.getElementById('view');
                    if (view) {
                        if (currentRoute === 'finance') {
                            view.innerHTML = renderFinance();
                        } else if (currentRoute === 'collections') {
                            view.innerHTML = renderCollections();
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error deleting invoice:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    // --- EMPLOYEE REQUESTS MODULE ---
    
    const renderRequests = () => {
        // Define all 22 request types from the image
        const requestTypes = [
            { id: 'salary-certificate', icon: 'fa-file-alt', label: 'Ø·Ù„Ø¨ ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ø±Ø§ØªØ¨', color: 'blue' },
            { id: 'leave', icon: 'fa-plane-departure', label: 'Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©', color: 'green' },
            { id: 'leave-allowance', icon: 'fa-file-invoice', label: 'Ø·Ù„Ø¨ Ø¨Ø¯Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©', color: 'purple' },
            { id: 'custody', icon: 'fa-file-contract', label: 'Ø·Ù„Ø¨ Ø¹Ù‡Ø¯Ø©', color: 'orange' },
            { id: 'work-start', icon: 'fa-briefcase', label: 'Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù…Ù„', color: 'teal' },
            { id: 'flight-tickets', icon: 'fa-plane', label: 'Ø·Ù„Ø¨ ØªØ°Ø§ÙƒØ± Ø³ÙØ±', color: 'indigo' },
            { id: 'additional-rewards', icon: 'fa-users', label: 'Ø·Ù„Ø¨ Ø¬ÙˆØ§Ø¦Ø² Ø¥Ø¶Ø§ÙÙŠ', color: 'pink' },
            { id: 'shift-modification', icon: 'fa-user-clock', label: 'Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ ÙØªØ±Ø© Ø§Ù„Ø¹Ù…Ù„', color: 'cyan' },
            { id: 'fingerprint-loss', icon: 'fa-fingerprint', label: 'Ø·Ù„Ø¨ ÙÙ‚Ø¯Ø§Ù† Ø¨ØµÙ…Ø©', color: 'red' },
            { id: 'permission', icon: 'fa-door-open', label: 'Ø·Ù„Ø¨ Ø§Ø³ØªØ¦Ø°Ø§Ù†', color: 'yellow' },
            { id: 'allowance-disbursement', icon: 'fa-money-check', label: 'Ø·Ù„Ø¨ ØµØ±Ù Ù…Ø®ØµØµ', color: 'green' },
            { id: 'advance', icon: 'fa-hand-holding-usd', label: 'Ø·Ù„Ø¨ Ø³Ù„ÙØ©', color: 'blue' },
            { id: 'purchases', icon: 'fa-shopping-cart', label: 'Ø·Ù„Ø¨ Ù…Ø´ØªØ±ÙŠØ§Øª', color: 'purple' },
            { id: 'employee-data-modification', icon: 'fa-user-edit', label: 'Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù', color: 'orange' },
            { id: 'training', icon: 'fa-graduation-cap', label: 'Ø·Ù„Ø¨ Ø§Ù„ØªØ¯Ø§Ø¨ÙŠ', color: 'teal' },
            { id: 'recruitment', icon: 'fa-user-plus', label: 'Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ', color: 'indigo' },
            { id: 'complaint', icon: 'fa-exclamation-triangle', label: 'Ø·Ù„Ø¨ Ø´ÙƒÙˆÙ‰', color: 'pink' },
            { id: 'resignation', icon: 'fa-door-closed', label: 'Ø·Ù„Ø¨ Ø§Ø³ØªÙ‚Ø§Ù„Ø©', color: 'red' },
            { id: 'outside-office-rewards', icon: 'fa-gift', label: 'Ø·Ù„Ø¨ Ø¬ÙˆØ§Ø¦Ø² Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨', color: 'cyan' },
            { id: 'training-course', icon: 'fa-chalkboard-teacher', label: 'Ø·Ù„Ø¨ Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©', color: 'yellow' },
            { id: 'rest-day-swap', icon: 'fa-exchange-alt', label: 'Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„ ÙŠÙˆÙ… Ø±Ø§Ø­Ø©', color: 'green' },
            { id: 'salary-fixation', icon: 'fa-money-bill-wave', label: 'Ø·Ù„Ø¨ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø±Ø§ØªØ¨', color: 'blue' }
        ];

        const colorClasses = {
            'blue': 'bg-blue-50 hover:bg-blue-100 border-blue-200',
            'green': 'bg-green-50 hover:bg-green-100 border-green-200',
            'purple': 'bg-purple-50 hover:bg-purple-100 border-purple-200',
            'orange': 'bg-orange-50 hover:bg-orange-100 border-orange-200',
            'teal': 'bg-teal-50 hover:bg-teal-100 border-teal-200',
            'indigo': 'bg-indigo-50 hover:bg-indigo-100 border-indigo-200',
            'pink': 'bg-pink-50 hover:bg-pink-100 border-pink-200',
            'cyan': 'bg-cyan-50 hover:bg-cyan-100 border-cyan-200',
            'red': 'bg-red-50 hover:bg-red-100 border-red-200',
            'yellow': 'bg-yellow-50 hover:bg-yellow-100 border-yellow-200'
        };

        const iconColorClasses = {
            'blue': 'text-blue-500',
            'green': 'text-green-500',
            'purple': 'text-purple-500',
            'orange': 'text-orange-500',
            'teal': 'text-teal-500',
            'indigo': 'text-indigo-500',
            'pink': 'text-pink-500',
            'cyan': 'text-cyan-500',
            'red': 'text-red-500',
            'yellow': 'text-yellow-500'
        };

        return `
        <div class="space-y-6 animate-fade-in">
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-clipboard-list text-red-600"></i>
                        Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    </h2>
                    <p class="text-slate-500 mt-1">Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¹Ù„Ù‰ Ù†Ø¸Ø§Ù… ERP</p>
                </div>
                <button onclick="window.open('/manage-request-types.html', '_blank')" 
                        class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                    <i class="fas fa-plus-circle"></i>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª</span>
                </button>
            </div>

            <!-- Request Types Grid -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                ${requestTypes.map(req => `
                    <button 
                        onclick="app.openRequestModal('${req.id}', '${req.label}')"
                        class="flex flex-col items-center justify-center p-6 rounded-2xl border-2 transition-all transform hover:scale-105 hover:shadow-lg ${colorClasses[req.color]}">
                        <div class="w-16 h-16 rounded-full bg-white flex items-center justify-center mb-3 shadow-sm">
                            <i class="fas ${req.icon} text-3xl ${iconColorClasses[req.color]}"></i>
                        </div>
                        <span class="text-center text-sm font-bold text-slate-700">${req.label}</span>
                    </button>
                `).join('')}
            </div>

            <!-- My Requests Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-slate-800">
                        <i class="fas fa-list-ul text-red-600 mr-2"></i>
                        Ø·Ù„Ø¨Ø§ØªÙŠ
                    </h3>
                    <div class="flex gap-2">
                        <button onclick="app.filterRequests('all')" class="px-4 py-2 rounded-lg bg-slate-100 text-slate-700 text-sm font-bold hover:bg-slate-200 transition">
                            Ø§Ù„ÙƒÙ„
                        </button>
                        <button onclick="app.filterRequests('PENDING')" class="px-4 py-2 rounded-lg bg-yellow-100 text-yellow-700 text-sm font-bold hover:bg-yellow-200 transition">
                            Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                        </button>
                        <button onclick="app.filterRequests('APPROVED')" class="px-4 py-2 rounded-lg bg-green-100 text-green-700 text-sm font-bold hover:bg-green-200 transition">
                            Ù…Ø¹ØªÙ…Ø¯
                        </button>
                        <button onclick="app.filterRequests('REJECTED')" class="px-4 py-2 rounded-lg bg-red-100 text-red-700 text-sm font-bold hover:bg-red-200 transition">
                            Ù…Ø±ÙÙˆØ¶
                        </button>
                    </div>
                </div>

                <div id="requests-table-container">
                    ${renderRequestsTable()}
                </div>
            </div>
        </div>
        `;
    };

    const renderRequestsTable = () => {
        const requests = db.employeeRequests || [];
        
        if (requests.length === 0) {
            return `
                <div class="text-center py-12">
                    <i class="fas fa-inbox text-6xl text-slate-300 mb-4"></i>
                    <p class="text-slate-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                    <p class="text-slate-400 text-sm mt-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù†ÙˆØ¹ Ø·Ù„Ø¨ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</p>
                </div>
            `;
        }

        return `
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-slate-50 border-b-2 border-slate-200">
                        <tr>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø®ÙŠØ§Ø±Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${requests.map(req => {
                            const statusBadges = {
                                'PENDING': '<span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>',
                                'APPROVED': '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">Ù…Ø¹ØªÙ…Ø¯</span>',
                                'REJECTED': '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">Ù…Ø±ÙÙˆØ¶</span>',
                                'IN_PROGRESS': '<span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>',
                                'COMPLETED': '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">Ù…ÙƒØªÙ…Ù„</span>',
                                'CANCELLED': '<span class="bg-slate-100 text-slate-700 px-3 py-1 rounded-full text-xs font-bold">Ù…Ù„ØºÙŠ</span>'
                            };

                            const priorityBadges = {
                                'LOW': '<span class="text-slate-500">âšª Ø¹Ø§Ø¯ÙŠ</span>',
                                'NORMAL': '<span class="text-blue-500">ğŸ”µ Ù…ØªÙˆØ³Ø·</span>',
                                'HIGH': '<span class="text-orange-500">ğŸŸ  Ø¹Ø§Ù„ÙŠ</span>',
                                'URGENT': '<span class="text-red-500">ğŸ”´ Ø¹Ø§Ø¬Ù„</span>'
                            };

                            return `
                                <tr class="border-b border-slate-100 hover:bg-slate-50 transition">
                                    <td class="px-4 py-3 text-sm font-mono text-slate-600">${req.id}</td>
                                    <td class="px-4 py-3 text-sm font-bold text-slate-800">${req.request_title}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">${req.requested_date}</td>
                                    <td class="px-4 py-3">${statusBadges[req.status] || req.status}</td>
                                    <td class="px-4 py-3 text-sm">${priorityBadges[req.priority] || req.priority}</td>
                                    <td class="px-4 py-3">
                                        <button onclick="app.viewRequestDetails('${req.id}')" class="text-blue-600 hover:text-blue-800 mr-2" title="Ø¹Ø±Ø¶">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        ${req.status === 'PENDING' ? `
                                            <button onclick="app.deleteRequest('${req.id}')" class="text-red-600 hover:text-red-800" title="Ø­Ø°Ù">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        `;
    };

    window.openRequestModal = function(requestType, requestLabel) {
        const modal = document.createElement('div');
        modal.id = 'request-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scale-up">
                <div class="p-6 border-b border-slate-100 bg-red-50 flex justify-between items-center">
                    <h3 class="font-bold text-lg text-red-800">
                        <i class="fas fa-clipboard-list mr-2"></i>
                        ${requestLabel}
                    </h3>
                    <button onclick="document.getElementById('request-modal').remove()" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù <span class="text-red-500">*</span></label>
                        <input type="text" id="req-employee-name" value="${currentUser?.name || ''}" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <input type="text" id="req-employee-id" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„ÙˆØµÙ / Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
                        <textarea id="req-description" rows="4" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-600 mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                            <input type="date" id="req-start-date" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-600 mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                            <input type="date" id="req-end-date" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-1.5">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="req-priority" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200">
                            <option value="NORMAL">Ù…ØªÙˆØ³Ø·</option>
                            <option value="LOW">Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="HIGH">Ø¹Ø§Ù„ÙŠ</option>
                            <option value="URGENT">Ø¹Ø§Ø¬Ù„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-600 mb-1.5">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <textarea id="req-notes" rows="3" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                    <button onclick="document.getElementById('request-modal').remove()" class="px-6 py-3 rounded-xl bg-slate-200 text-slate-700 font-bold hover:bg-slate-300 transition">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button onclick="app.submitRequest('${requestType}', '${requestLabel}')" class="px-6 py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg shadow-red-200 transition">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    };

    window.submitRequest = async function(requestType, requestLabel) {
        const employeeName = document.getElementById('req-employee-name').value;
        const employeeId = document.getElementById('req-employee-id').value;
        const description = document.getElementById('req-description').value;
        const startDate = document.getElementById('req-start-date').value;
        const endDate = document.getElementById('req-end-date').value;
        const priority = document.getElementById('req-priority').value;
        const notes = document.getElementById('req-notes').value;

        if (!employeeName) {
            return showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
        }

        const newRequest = {
            id: `REQ-${Date.now()}`,
            entityId: currentUser.entityId,
            employeeId: employeeId || null,
            employeeName: employeeName,
            requestType: requestType,
            requestTitle: requestLabel,
            description: description,
            status: 'PENDING',
            priority: priority,
            requestData: {},
            requiresApproval: true,
            requestedDate: new Date().toISOString().slice(0, 10),
            startDate: startDate || null,
            endDate: endDate || null,
            notes: notes,
            createdBy: currentUser.id
        };

        try {
            const response = await fetch('/api/employee-requests', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newRequest)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨');
            }

            // Update local db
            if (!db.employeeRequests) db.employeeRequests = [];
            db.employeeRequests.unshift(newRequest);

            document.getElementById('request-modal').remove();
            showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            // Refresh the requests table
            const container = document.getElementById('requests-table-container');
            if (container) {
                container.innerHTML = renderRequestsTable();
            }
        } catch (error) {
            console.error('Error submitting request:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + error.message, 'error');
        }
    };

    window.filterRequests = function(status) {
        showToast(`ØªØµÙÙŠØ© Ø­Ø³Ø¨: ${status}`, 'info');
    };

    window.viewRequestDetails = function(requestId) {
        const request = db.employeeRequests?.find(r => r.id === requestId);
        if (!request) return showToast('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        
        showToast('Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨: ' + requestId, 'info');
    };

    window.deleteRequest = async function(requestId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

        try {
            const response = await fetch(`/api/employee-requests/${requestId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
            }

            // Remove from local db
            db.employeeRequests = db.employeeRequests.filter(r => r.id !== requestId);
            
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            // Refresh the requests table
            const container = document.getElementById('requests-table-container');
            if (container) {
                container.innerHTML = renderRequestsTable();
            }
        } catch (error) {
            console.error('Error deleting request:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨: ' + error.message, 'error');
        }
    };

    // --- APPROVALS MODULE ---
    const renderApprovals = () => {
        const myApprovals = db.approvals.filter(a => 
            a.steps.some(s => s.approver_id === currentUser.id)
        );
        
        const pendingForMe = myApprovals.filter(a => 
            a.steps.some(s => s.approver_id === currentUser.id && s.status === 'PENDING')
        );
        
        const myRequests = db.approvals.filter(a => a.createdBy === currentUser.id);
        
        const statusBadge = (status) => {
            const badges = {
                'PENDING': '<span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>',
                'IN_REVIEW': '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>',
                'APPROVED': '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">Ù…Ø¹ØªÙ…Ø¯</span>',
                'REJECTED': '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">Ù…Ø±ÙÙˆØ¶</span>'
            };
            return badges[status] || status;
        };
        
        const stepStatusBadge = (status) => {
            const badges = {
                'PENDING': '<span class="bg-yellow-50 text-yellow-600 px-2 py-0.5 rounded text-xs">Ù…Ù†ØªØ¸Ø±</span>',
                'APPROVED': '<span class="bg-green-50 text-green-600 px-2 py-0.5 rounded text-xs"><i class="fas fa-check"></i> Ù…ÙˆØ§ÙÙ‚</span>',
                'REJECTED': '<span class="bg-red-50 text-red-600 px-2 py-0.5 rounded text-xs"><i class="fas fa-times"></i> Ù…Ø±ÙÙˆØ¶</span>',
                'SKIPPED': '<span class="bg-gray-50 text-gray-500 px-2 py-0.5 rounded text-xs">Ù…ØªØ®Ø·Ù‰</span>'
            };
            return badges[status] || status;
        };
        
        return `
        <div class="space-y-8 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ©</h2>
                    <p class="text-slate-500">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª: Ù…Ø­Ø§Ø³Ø¨ â†’ Ù…Ø¯ÙŠØ± Ù…Ø§Ù„ÙŠ â†’ CFO/Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                ${renderKpiCard('Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø¹Ù„ÙŠÙƒ', pendingForMe.length, 'fa-hourglass-half', 'text-yellow-600', 'bg-yellow-50')}
                ${renderKpiCard('Ø·Ù„Ø¨Ø§ØªÙŠ', myRequests.length, 'fa-paper-plane', 'text-red-600', 'bg-red-50')}
                ${renderKpiCard('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª', myApprovals.length, 'fa-check-circle', 'text-green-600', 'bg-green-50')}
            </div>

            <!-- Tabs -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="flex border-b border-slate-100">
                    <button onclick="app.switchTab('pending-approvals')" id="tab-btn-pending-approvals" class="flex-1 py-4 text-sm font-bold text-brand-600 border-b-2 border-brand-600 bg-brand-50 transition">
                        Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø¹Ù„ÙŠÙƒ ${pendingForMe.length > 0 ? `<span class="bg-red-500 text-white px-2 py-0.5 rounded-full text-xs mr-2">${pendingForMe.length}</span>` : ''}
                    </button>
                    <button onclick="app.switchTab('my-requests')" id="tab-btn-my-requests" class="flex-1 py-4 text-sm font-bold text-slate-500 hover:bg-slate-50 transition">Ø·Ù„Ø¨Ø§ØªÙŠ</button>
                    <button onclick="app.switchTab('all-approvals')" id="tab-btn-all-approvals" class="flex-1 py-4 text-sm font-bold text-slate-500 hover:bg-slate-50 transition">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª</button>
                </div>

                <!-- Pending Approvals Tab -->
                <div id="tab-content-pending-approvals" class="p-6">
                    ${pendingForMe.length === 0 ? `
                        <div class="text-center py-12">
                            <i class="fas fa-check-double text-6xl text-slate-200 mb-4"></i>
                            <p class="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§ÙÙ‚Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø¹Ù„ÙŠÙƒ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </div>
                    ` : `
                        <div class="space-y-4">
                            ${pendingForMe.map(approval => {
                                const myStep = approval.steps.find(s => s.approver_id === currentUser.id && s.status === 'PENDING');
                                return `
                                    <div class="border border-slate-200 rounded-xl p-5 hover:shadow-md transition">
                                        <div class="flex justify-between items-start mb-4">
                                            <div class="flex-1">
                                                <h3 class="text-lg font-bold text-slate-800 mb-1">${approval.itemTitle}</h3>
                                                <p class="text-sm text-slate-500">Ø¨ÙˆØ§Ø³Ø·Ø©: ${approval.createdByName} â€¢ ${new Date(approval.createdAt).toLocaleDateString('ar-SA')}</p>
                                            </div>
                                            <div class="text-left">
                                                <div class="text-2xl font-bold text-brand-600">${approval.amount.toLocaleString()} Ø±.Ø³</div>
                                                ${statusBadge(approval.status)}
                                            </div>
                                        </div>
                                        
                                        <!-- Approval Steps Progress -->
                                        <div class="mb-4 bg-slate-50 rounded-lg p-4">
                                            <div class="text-xs font-bold text-slate-600 mb-3">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:</div>
                                            <div class="flex items-center gap-2">
                                                ${approval.steps.map((step, idx) => `
                                                    <div class="flex items-center gap-2">
                                                        <div class="text-center ${step.approver_id === currentUser.id && step.status === 'PENDING' ? 'animate-pulse' : ''}">
                                                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold mb-1
                                                                ${step.status === 'APPROVED' ? 'bg-green-500 text-white' : 
                                                                  step.status === 'REJECTED' ? 'bg-red-500 text-white' :
                                                                  step.approver_id === currentUser.id && step.status === 'PENDING' ? 'bg-yellow-400 text-white' :
                                                                  'bg-slate-200 text-slate-600'}">
                                                                ${step.status === 'APPROVED' ? '<i class="fas fa-check"></i>' :
                                                                  step.status === 'REJECTED' ? '<i class="fas fa-times"></i>' :
                                                                  (idx + 1)}
                                                            </div>
                                                            <div class="text-xs text-slate-600 max-w-[80px] truncate">${step.approver_name}</div>
                                                            <div class="text-xs text-slate-500">${step.approver_role}</div>
                                                        </div>
                                                        ${idx < approval.steps.length - 1 ? '<i class="fas fa-arrow-left text-slate-300"></i>' : ''}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        
                                        ${myStep ? `
                                            <div class="flex gap-3 mt-4">
                                                <button onclick="app.handleApprovalDecision(${approval.id}, ${myStep.id}, 'APPROVED')" 
                                                    class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2.5 rounded-lg font-bold transition">
                                                    <i class="fas fa-check ml-2"></i>Ø§Ø¹ØªÙ…Ø§Ø¯
                                                </button>
                                                <button onclick="app.handleApprovalDecision(${approval.id}, ${myStep.id}, 'REJECTED')" 
                                                    class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-lg font-bold transition">
                                                    <i class="fas fa-times ml-2"></i>Ø±ÙØ¶
                                                </button>
                                                <button onclick="app.editApproval(${approval.id})" 
                                                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2.5 rounded-lg font-bold transition">
                                                    <i class="fas fa-edit ml-2"></i>ØªØ¹Ø¯ÙŠÙ„
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `}
                </div>

                <!-- My Requests Tab -->
                <div id="tab-content-my-requests" class="p-6 hidden">
                    ${myRequests.length === 0 ? `
                        <div class="text-center py-12">
                            <i class="fas fa-inbox text-6xl text-slate-200 mb-4"></i>
                            <p class="text-slate-500">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ø¹Ø¯</p>
                        </div>
                    ` : `
                        <div class="space-y-4">
                            ${myRequests.map(approval => `
                                <div class="border border-slate-200 rounded-xl p-5">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-lg font-bold text-slate-800">${approval.itemTitle}</h3>
                                            <p class="text-sm text-slate-500">${new Date(approval.createdAt).toLocaleDateString('ar-SA')}</p>
                                        </div>
                                        <div class="text-left">
                                            <div class="text-xl font-bold text-brand-600">${approval.amount.toLocaleString()} Ø±.Ø³</div>
                                            ${statusBadge(approval.status)}
                                        </div>
                                    </div>
                                    
                                    <!-- Steps Progress -->
                                    <div class="bg-slate-50 rounded-lg p-4 mb-3">
                                        <div class="space-y-2">
                                            ${approval.steps.map((step, idx) => `
                                                <div class="flex items-center gap-3">
                                                    <div class="text-sm font-bold text-slate-600 w-8">${idx + 1}.</div>
                                                    <div class="flex-1">
                                                        <div class="font-semibold text-slate-700">${step.approver_name}</div>
                                                        <div class="text-xs text-slate-500">${step.approver_role}</div>
                                                        ${step.comments ? `<div class="text-xs text-slate-600 mt-1 italic">"${step.comments}"</div>` : ''}
                                                        ${step.rejection_reason ? `<div class="text-xs text-red-600 mt-1"><strong>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:</strong> ${step.rejection_reason}</div>` : ''}
                                                    </div>
                                                    <div>${stepStatusBadge(step.status)}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- Edit Button for My Requests -->
                                    ${approval.status === 'PENDING' || approval.status === 'IN_REVIEW' ? `
                                        <div class="flex justify-end">
                                            <button onclick="app.editApproval(${approval.id})" 
                                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold transition">
                                                <i class="fas fa-edit ml-2"></i>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>

                <!-- All Approvals Tab -->
                <div id="tab-content-all-approvals" class="p-6 hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right">
                            <thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase">
                                <tr>
                                    <th class="p-3">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                    <th class="p-3">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th class="p-3">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                                    <th class="p-3">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="p-3">Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</th>
                                    <th class="p-3">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="p-3">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm">
                                ${myApprovals.map(approval => `
                                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                                        <td class="p-3 font-semibold">${approval.itemTitle}</td>
                                        <td class="p-3 text-brand-600 font-bold">${approval.amount.toLocaleString()} Ø±.Ø³</td>
                                        <td class="p-3">${approval.currentLevel} / ${approval.steps.length}</td>
                                        <td class="p-3">${statusBadge(approval.status)}</td>
                                        <td class="p-3">${approval.createdByName}</td>
                                        <td class="p-3 text-slate-500">${new Date(approval.createdAt).toLocaleDateString('ar-SA')}</td>
                                        <td class="p-3">
                                            <button onclick="app.editApproval(${approval.id})" 
                                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold transition">
                                                <i class="fas fa-edit ml-1"></i>ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        `;
    };

    const renderEntitiesManager = () => {
        // ØªÙ… Ù†Ù‚Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØµÙØ­Ø© "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª (SaaS)"
        return `
        <div class="max-w-2xl mx-auto text-center py-20 animate-fade-in">
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-3xl p-12 shadow-xl border border-slate-200">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-arrow-right text-3xl text-blue-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 mb-4">ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                <p class="text-slate-600 mb-8 leading-relaxed">
                    ØªÙ… Ù†Ù‚Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† Ø¥Ù„Ù‰ ØµÙØ­Ø©<br>
                    <strong class="text-brand-600">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª (SaaS)</strong>
                </p>
                <button onclick="app.loadRoute('saas')" class="px-8 py-4 bg-brand-600 text-white rounded-xl font-bold hover:shadow-lg hover:bg-brand-700 transition flex items-center justify-center gap-3 mx-auto">
                    <i class="fas fa-cubes"></i>
                    <span>Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© SaaS</span>
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>`;
    };

    const renderTenantRegistration = () => {
        if (!perms.isHQ()) return renderPlaceholder('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Super Admin)');
        return `
        <div class="max-w-4xl mx-auto animate-slide-in">
            <div class="text-center mb-8"><h2 class="text-2xl md:text-3xl font-extrabold text-slate-800">ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ£Ø¬Ø± Ø¬Ø¯ÙŠØ¯</h2><p class="text-slate-500 mt-2">Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ®ØµÙŠØµ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</p></div>
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden p-6 md:p-8">
                <div class="grid grid-cols-1 gap-8">
                    <div><h4 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-600 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</label><input type="text" id="reg-name" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none"></div><div><label class="block text-sm font-semibold text-slate-600 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><input type="text" id="reg-location" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none"></div></div></div>
                    <div><h4 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">2. Ù†ÙˆØ¹ Ø§Ù„ÙƒÙŠØ§Ù†</h4><div class="grid grid-cols-2 md:grid-cols-4 gap-4">${Object.values(TENANT_TYPES).filter(t => t.id !== 'HQ').map(t => `<label class="cursor-pointer relative"><input type="radio" name="reg-type" value="${t.id}" class="peer sr-only"><div class="p-4 rounded-xl border-2 border-slate-100 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all text-center"><i class="fas ${t.icon} text-2xl mb-2 ${t.color}"></i><div class="text-xs font-bold">${t.label}</div></div></label>`).join('')}</div></div>
                    <div><h4 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">3. Ø®Ø·Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4">${Object.keys(SUBSCRIPTION_PLANS).map(key => `<label class="cursor-pointer relative"><input type="radio" name="reg-plan" value="${key}" class="peer sr-only"><div class="p-4 rounded-xl border-2 border-slate-100 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all"><div class="font-bold">${SUBSCRIPTION_PLANS[key].name}</div></div></label>`).join('')}</div></div>
                    <div class="pt-4 flex justify-end gap-3"><button onclick="app.loadRoute('entities')" class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100">Ø¥Ù„ØºØ§Ø¡</button><button onclick="app.submitTenantRegistration()" class="px-8 py-3 rounded-xl font-bold bg-brand-600 text-white shadow-lg">Ø¥Ù†Ø´Ø§Ø¡</button></div>
                </div>
            </div>
        </div>`;
    };

    const submitTenantRegistration = () => {
        const name = document.getElementById('reg-name').value;
        const location = document.getElementById('reg-location').value;
        const type = document.querySelector('input[name="reg-type"]:checked')?.value;
        const plan = document.querySelector('input[name="reg-plan"]:checked')?.value;
        if (!name || !location || !type || !plan) return showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        
        const newId = (type === 'BRANCH' ? 'BR' : type === 'INCUBATOR' ? 'INC' : type === 'PLATFORM' ? 'PLT' : type === 'OFFICE' ? 'OFF' : 'TNT') + Math.floor(100 + Math.random() * 900);
        
        // Save to database via API
        fetch('/api/entities', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            },
            body: JSON.stringify({
                id: newId,
                name: name,
                type: type,
                location: location,
                status: 'Active'
            })
        })
        .then(response => {
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            return response.json();
        })
        .then(entity => {
            // Add to local cache
            db.entities.push(entity);
            showToast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ${name} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            loadRoute('entities');
        })
        .catch(error => {
            console.error('Error creating entity:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    // Entity Management Functions
    window.manageEntity = function(entityId) {
        showToast('ÙØªØ­ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙŠØ§Ù†...', 'info');
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© modal Ø£Ùˆ ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙŠØ§Ù†
    };

    window.suspendEntity = function(entityId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙŠØ§Ù† Ù…Ø¤Ù‚ØªØ§Ù‹ØŸ')) return;
        
        fetch(`/api/entities/${entityId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            },
            body: JSON.stringify({ status: 'Suspended' })
        })
        .then(response => {
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙŠØ§Ù†');
            return response.json();
        })
        .then(updatedEntity => {
            // Update local cache
            const entity = db.entities.find(e => e.id === entityId);
            if (entity) entity.status = 'Suspended';
            
            logAction('SUSPEND_ENTITY', `Suspended entity ${entityId}`);
            showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙŠØ§Ù† Ù…Ø¤Ù‚ØªØ§Ù‹', 'success');
            loadRoute('entities');
        })
        .catch(error => {
            console.error('Error suspending entity:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    window.reactivateEntity = function(entityId) {
        fetch(`/api/entities/${entityId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            },
            body: JSON.stringify({ status: 'Active' })
        })
        .then(response => {
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙŠØ§Ù†');
            return response.json();
        })
        .then(updatedEntity => {
            // Update local cache
            const entity = db.entities.find(e => e.id === entityId);
            if (entity) entity.status = 'Active';
            
            logAction('REACTIVATE_ENTITY', `Reactivated entity ${entityId}`);
            showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙŠØ§Ù†', 'success');
            loadRoute('entities');
        })
        .catch(error => {
            console.error('Error reactivating entity:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    window.editEntity = function(entityId) {
        const entity = db.entities.find(e => e.id === entityId);
        if (!entity) return showToast('Ø§Ù„ÙƒÙŠØ§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        
        const modal = document.createElement('div');
        modal.id = 'edit-entity-modal';
        modal.className = 'fixed inset-0 bg-slate-900/60 z-[999] flex items-center justify-center backdrop-blur-sm fade-in p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-scale-up">
                <div class="p-6 border-b border-slate-100 bg-slate-50">
                    <h3 class="font-bold text-lg text-slate-800">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙŠØ§Ù†: ${entity.name}</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-600 mb-2">Ø§Ø³Ù… Ø§Ù„ÙƒÙŠØ§Ù†</label>
                        <input type="text" id="edit-entity-name" value="${entity.name}" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-600 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                        <input type="text" id="edit-entity-location" value="${entity.location || ''}" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:border-brand-500">
                    </div>
                </div>
                <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                    <button onclick="document.getElementById('edit-entity-modal').remove()" class="px-4 py-2 rounded-lg text-slate-500 font-bold hover:bg-slate-200">Ø¥Ù„ØºØ§Ø¡</button>
                    <button onclick="window.saveEntityEdits('${entityId}')" class="px-6 py-2 rounded-lg bg-brand-600 text-white font-bold hover:bg-brand-700">Ø­ÙØ¸</button>
                </div>
            </div>`;
        document.body.appendChild(modal);
    };

    window.saveEntityEdits = function(entityId) {
        const name = document.getElementById('edit-entity-name').value;
        const location = document.getElementById('edit-entity-location').value;
        
        fetch(`/api/entities/${entityId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            },
            body: JSON.stringify({ name, location })
        })
        .then(response => {
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');
            return response.json();
        })
        .then(updatedEntity => {
            // Update local cache
            const entity = db.entities.find(e => e.id === entityId);
            if (entity) {
                entity.name = name;
                entity.location = location;
            }
            
            logAction('EDIT_ENTITY', `Edited entity ${entityId}`);
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙŠØ§Ù†', 'success');
            document.getElementById('edit-entity-modal').remove();
            loadRoute('entities');
        })
        .catch(error => {
            console.error('Error editing entity:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    // Dropdown Menu Controls
    window.toggleDropdown = function(entityId) {
        const menu = document.getElementById(`dropdown-menu-${entityId}`);
        const allMenus = document.querySelectorAll('[id^="dropdown-menu-"]');
        
        // Close all other dropdowns
        allMenus.forEach(m => {
            if (m.id !== `dropdown-menu-${entityId}`) {
                m.classList.add('hidden');
            }
        });
        
        // Toggle current dropdown
        menu.classList.toggle('hidden');
    };

    window.closeAllDropdowns = function() {
        const allMenus = document.querySelectorAll('[id^="dropdown-menu-"]');
        allMenus.forEach(m => m.classList.add('hidden'));
    };

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        const isDropdownButton = event.target.closest('[onclick*="toggleDropdown"]');
        const isDropdownMenu = event.target.closest('[id^="dropdown-menu-"]');
        
        if (!isDropdownButton && !isDropdownMenu) {
            window.closeAllDropdowns();
        }
    });

    window.moveEntityUp = function(entityId) {
        const index = db.entities.findIndex(e => e.id === entityId);
        if (index > 0) {
            [db.entities[index - 1], db.entities[index]] = [db.entities[index], db.entities[index - 1]];
            logAction('MOVE_ENTITY_UP', `Moved entity ${entityId} up`);
            showToast('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„ÙƒÙŠØ§Ù† Ù„Ù„Ø£Ø¹Ù„Ù‰', 'success');
            loadRoute('entities');
        } else {
            showToast('Ø§Ù„ÙƒÙŠØ§Ù† Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆÙ„', 'info');
        }
    };

    window.deleteEntityPermanent = function(entityId) {
        if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡ ÙˆØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©.')) return;
        
        fetch(`/api/entities/${entityId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'x-entity-type': window.currentUser?.entityType || 'HQ',
                'x-entity-id': window.currentUser?.entityId || 'HQ001'
            }
        })
        .then(response => {
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ÙƒÙŠØ§Ù†');
            return response.json();
        })
        .then(data => {
            // Remove from local cache
            const index = db.entities.findIndex(e => e.id === entityId);
            if (index !== -1) {
                const entityName = db.entities[index].name;
                db.entities.splice(index, 1);
                logAction('DELETE_ENTITY_PERMANENT', `Permanently deleted entity ${entityId}`);
                showToast(`ØªÙ… Ø­Ø°Ù ${entityName} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹`, 'success');
            }
            loadRoute('entities');
        })
        .catch(error => {
            console.error('Error deleting entity:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        });
    };

    const renderTasksManager = () => {
        const tasks = perms.getVisibleTasks();
        console.log('ğŸ“‹ Tasks Manager: currentUser.entityId =', currentUser?.entityId, 'tasks count =', tasks.length);
        console.log('ğŸ“Š All db.tasks:', db.tasks);
        console.log('ğŸ” Filtered tasks:', tasks);
        
        if (tasks.length === 0) {
            return `
            <div class="space-y-8 animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h2>
                        <p class="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                    </div>
                    <button onclick="window.openCreateTaskModal()" class="bg-red-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-red-700 transition flex items-center gap-2">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg border-2 border-dashed border-slate-300 p-12 text-center">
                    <div class="text-6xl mb-4">ğŸ“‹</div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">Ù„Ù… ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯</h3>
                    <p class="text-slate-600 mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØªØ¨Ø¹ Ø¹Ù…Ù„Ùƒ ÙˆØ¥Ù†Ø¬Ø§Ø²Ùƒ</p>
                    <button onclick="window.openCreateTaskModal()" class="bg-red-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-red-700 transition inline-flex items-center gap-2">
                        <i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ù…Ù‡Ù…Ø©
                    </button>
                </div>
                
                ${db.tasks.length > 0 ? `
                <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 mt-6">
                    <p class="text-yellow-700"><i class="fas fa-info-circle ml-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙˆØ¬Ø¯ ${db.tasks.length} Ù…Ù‡Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ÙƒÙ† Ù„Ø§ ØªØªØ¹Ù„Ù‚ Ø¨ÙƒÙŠØ§Ù†Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ (${currentUser?.entityId})</p>
                </div>
                ` : ''}
            </div>`;
        }
        
        return `
        <div class="space-y-8 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (${tasks.length})</h2>
                    <p class="text-slate-500">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p>
                </div>
                <button onclick="window.openCreateTaskModal()" class="bg-red-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-red-700 transition flex items-center gap-2">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                </button>
            </div>
            
            <div class="grid gap-4">
                ${tasks.map(t => {
                    const statusColors = {
                        'Pending': 'bg-yellow-100 text-yellow-700',
                        'In Progress': 'bg-red-100 text-red-700',
                        'Done': 'bg-green-100 text-green-700',
                        'Cancelled': 'bg-red-100 text-red-700'
                    };
                    const priorityColors = {
                        'High': 'text-red-600',
                        'Medium': 'text-orange-600',
                        'Low': 'text-green-600'
                    };
                    return `
                    <div onclick="window.viewTaskDetails(${t.id})" class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-lg hover:border-blue-300 transition-all cursor-pointer group">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-slate-800 group-hover:text-red-600 transition-colors">${t.title}</h4>
                                ${t.assignee ? `<p class="text-sm text-blue-600 mt-1"><i class="fas fa-user ml-1"></i> ${t.assignee}</p>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-bold ${statusColors[t.status] || 'bg-slate-100 text-slate-700'}">${t.status}</span>
                                <span class="px-3 py-1 rounded-full text-xs font-bold bg-slate-100 text-slate-700 ${priorityColors[t.priority] || ''}">${t.priority}</span>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 mb-2">${t.type} â€¢ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ${t.dueDate}</p>
                        ${t.description ? `<p class="text-sm text-slate-500 italic truncate">${t.description}</p>` : ''}
                        <div class="mt-3 pt-3 border-t border-slate-100 flex items-center justify-between">
                            <span class="text-xs text-slate-400">
                                <i class="fas fa-hashtag"></i> ${t.id}
                            </span>
                            <span class="text-xs text-red-600 font-semibold opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fas fa-arrow-left ml-1"></i> Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶
                            </span>
                        </div>
                    </div>`;
                }).join('')}
            </div>
        </div>`;
    };

    const renderFacilities = () => {
        const modules = [
            {
                key: 'maintenance',
                title: 'Ø§Ù„ØµÙŠØ§Ù†Ø©',
                icon: 'fa-screwdriver-wrench',
                gradient: 'from-blue-50 to-blue-100',
                accent: 'text-blue-700',
                kpi: '7 Ø¨Ù„Ø§ØºØ§Øª Ù…ÙØªÙˆØ­Ø©',
                desc: 'ØªØªØ¨Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© Ù…Ø¹ Ù…ØªØ§Ø¨Ø¹Ø© SLA.',
                actions: ['ÙØªØ­ Ø¨Ù„Ø§Øº ØµÙŠØ§Ù†Ø©', 'Ø¬Ø¯ÙˆÙ„Ø© Ø²ÙŠØ§Ø±Ø© ÙÙ†ÙŠ', 'Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¹Ø·Ø§Ù„']
            },
            {
                key: 'contracts',
                title: 'Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø·Ø±Ù Ø§Ù„ØªØ§Ù†ÙŠ',
                icon: 'fa-file-contract',
                gradient: 'from-amber-50 to-amber-100',
                accent: 'text-amber-700',
                kpi: '3 Ø¹Ù‚ÙˆØ¯ ØªØ­ØªØ§Ø¬ ØªØ¬Ø¯ÙŠØ¯',
                desc: 'Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù‚ÙˆØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ø¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠÙŠÙ†.',
                actions: ['Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯', 'Ù…Ø±Ø§Ù‚Ø¨Ø© ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡', 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø´Ø±ÙˆØ·']
            },
            {
                key: 'vendors',
                title: 'Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†',
                icon: 'fa-truck-loading',
                gradient: 'from-emerald-50 to-emerald-100',
                accent: 'text-emerald-700',
                kpi: '18 Ù…ÙˆØ±Ø¯ Ù…Ø¹ØªÙ…Ø¯',
                desc: 'Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†ØŒ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§ØªØŒ ÙˆØ´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ† ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©.',
                actions: ['Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯', 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª', 'ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯']
            },
            {
                key: 'energy',
                title: 'Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ù‚Ù‡',
                icon: 'fa-bolt',
                gradient: 'from-yellow-50 to-yellow-100',
                accent: 'text-yellow-700',
                kpi: '-5% Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±',
                desc: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§ÙƒØŒ Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§ØªØŒ ÙˆØ§Ù„ÙØ±Øµ Ù„Ø®ÙØ¶ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ.',
                actions: ['ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯', 'Ø¶Ø¨Ø· Ø­Ø¯ÙˆØ¯ Ø¥Ù†Ø°Ø§Ø±', 'ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ']
            },
            {
                key: 'crowd',
                title: 'Ø§Ø¯Ø§Ø±Ù‡ Ø§Ù„Ø­Ø´ÙˆØ¯',
                icon: 'fa-people-group',
                gradient: 'from-rose-50 to-rose-100',
                accent: 'text-rose-700',
                kpi: '2 ØªØ¯Ø±ÙŠØ¨Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø©',
                desc: 'Ø®Ø·Ø· Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ØŒ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ØŒ ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„ØªØ¬Ù…Ø¹.',
                actions: ['ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø¥Ø®Ù„Ø§Ø¡', 'Ø¬Ø¯ÙˆÙ„Ø© ØªØ¯Ø±ÙŠØ¨', 'ØªØ³Ø¬ÙŠÙ„ Ù†Ù‚Ø§Ø· ØªØ¬Ù…Ø¹']
            }
        ];

        const summaries = [
            { label: 'Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø´Ø·Ø©', value: '7', icon: 'fa-screwdriver-wrench', color: 'text-blue-700', bg: 'bg-blue-50' },
            { label: 'Ø¹Ù‚ÙˆØ¯ ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©', value: '3', icon: 'fa-file-contract', color: 'text-amber-700', bg: 'bg-amber-50' },
            { label: 'Ù…ÙˆØ±Ø¯ÙŠÙ† ØªØ­Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', value: '4', icon: 'fa-user-check', color: 'text-emerald-700', bg: 'bg-emerald-50' },
            { label: 'Ø¥Ù†Ø°Ø§Ø±Ø§Øª Ø·Ø§Ù‚Ø©', value: '3 Ø­Ø³Ø§Ø³Ø§Øª', icon: 'fa-bolt', color: 'text-yellow-700', bg: 'bg-yellow-50' },
            { label: 'ØªÙ…Ø§Ø±ÙŠÙ† Ø¥Ø®Ù„Ø§Ø¡ Ù‚Ø§Ø¯Ù…Ø©', value: '2', icon: 'fa-route', color: 'text-rose-700', bg: 'bg-rose-50' }
        ];

        return `
        <div class="space-y-8 animate-fade-in">
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-6 md:p-8 relative overflow-hidden">
                <div class="absolute -left-10 top-0 h-full w-40 bg-gradient-to-b from-red-100/40 to-red-300/20 transform -skew-x-12"></div>
                <div class="relative flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider">Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚</p>
                        <h2 class="text-2xl md:text-3xl font-black text-slate-800 mt-2">ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ù…Ù† Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</h2>
                        <p class="text-slate-600 mt-2 max-w-2xl">Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ Ø§Ù„Ø¹Ù‚ÙˆØ¯ØŒ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†ØŒ Ø§Ù„Ø·Ø§Ù‚Ø©ØŒ ÙˆØ§Ù„Ø­Ø´ÙˆØ¯ ØªØ­Øª Ù„ÙˆØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø±ÙØ¹ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„.</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="app.exportFacilityReport()" class="px-4 py-2.5 bg-white border border-slate-200 rounded-xl font-bold text-slate-700 hover:bg-slate-50 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="app.createFacilityRequest()" class="px-5 py-2.5 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù…Ø±ÙÙ‚
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-5 gap-4">
                ${summaries.map(card => `
                    <button onclick="app.handleFacilitySummary('${card.label}')" class="bg-white border border-slate-100 rounded-2xl p-4 shadow-sm text-right w-full hover:border-red-200 hover:shadow transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-[11px] font-bold text-slate-500">${card.label}</p>
                                <h3 class="text-2xl font-black text-slate-800 mt-1">${card.value}</h3>
                            </div>
                            <div class="w-10 h-10 rounded-xl ${card.bg} flex items-center justify-center ${card.color}">
                                <i class="fas ${card.icon}"></i>
                            </div>
                        </div>
                    </button>
                `).join('')}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                ${modules.map(m => `
                    <div class="bg-white border border-slate-100 rounded-2xl shadow-sm p-5 flex flex-col gap-4">
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br ${m.gradient} flex items-center justify-center ${m.accent}">
                                    <i class="fas ${m.icon} text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-slate-800">${m.title}</h3>
                                    <p class="text-sm text-slate-500">${m.desc}</p>
                                </div>
                            </div>
                            <span class="text-xs font-bold px-3 py-1 rounded-full bg-slate-100 text-slate-700">${m.kpi}</span>
                        </div>
                        <div class="grid grid-cols-1 gap-2">
                            ${m.actions.map(action => `
                                <button onclick="app.handleFacilityAction('${m.key}','${action}')" class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2 text-right w-full hover:border-red-200 hover:shadow-sm transition">
                                    <span class="text-sm font-semibold text-slate-700">${action}</span>
                                    <i class="fas fa-chevron-left text-slate-400"></i>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
    };

    // Facilities actions
    const createFacilityRequest = () => {
        showToast('ğŸ“Œ ØªÙ… ÙØªØ­ Ø·Ù„Ø¨ Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙŠØ¯ (Ù†Ù…ÙˆØ°Ø¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ)', 'info');
    };

    const exportFacilityReport = () => {
        showToast('â¬‡ï¸ ØªÙ… ØªØ¬Ù‡ÙŠØ² ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§ÙÙ‚ (ØªÙ†Ø²ÙŠÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ)', 'success');
    };

    const handleFacilitySummary = (label) => {
        showToast(`âœ… ØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø©: ${label}`, 'success');
    };

    const handleFacilityAction = (moduleKey, action) => {
        showToast(`ğŸ› ï¸ [${moduleKey}] ${action}`, 'info');
    };

    // Strategic Management Render Functions
    const renderExecutiveManagement = async () => {
        console.log('ğŸ¯ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderExecutiveManagement - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©');
        
        let kpis = [], goals = [], operations = [];
        
        try {
            [kpis, goals, operations] = await Promise.all([
                fetchAPI('/api/executive-kpis').catch(e => { console.error('Error loading KPIs:', e); return []; }),
                fetchAPI('/api/executive-goals').catch(e => { console.error('Error loading goals:', e); return []; }),
                fetchAPI('/api/executive-operations').catch(e => { console.error('Error loading operations:', e); return []; })
            ]);
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©:', error);
        }
        
        const activeGoals = goals.filter(g => g.status === 'in_progress');
        const completedGoals = goals.filter(g => g.completion_percentage >= 100);
        
        console.log('ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', { kpis: kpis.length, goals: goals.length, operations: operations.length });
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-user-tie"></i>
                    Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ Ø§Ù„Ø£Ù‡Ø¯Ø§ÙØŒ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</p>
            </div>
            
            ${kpis.length === 0 && goals.length === 0 && operations.length === 0 ? `
                <div class="bg-white rounded-xl p-12 shadow-sm border text-center">
                    <i class="fas fa-database text-6xl text-slate-300 mb-4"></i>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                    <p class="text-slate-600">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    <p class="text-sm text-slate-500 mt-2">Ø§Ù„ØµÙØ­Ø©: Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©</p>
                </div>
            ` : ''}
            
            <!-- KPI Cards -->
            ${kpis.length > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${kpis.slice(0, 6).map((kpi, idx) => {
                    const colors = ['blue', 'green', 'purple', 'orange', 'red', 'teal'];
                    const color = colors[idx % colors.length];
                    const percentage = ((kpi.metric_value / kpi.target_value) * 100).toFixed(0);
                    return `
                    <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-sm text-slate-700">${kpi.metric_name}</h3>
                            <span class="px-2 py-1 rounded-full text-xs font-bold bg-${color}-100 text-${color}-700">
                                ${kpi.period}
                            </span>
                        </div>
                        <div class="flex items-end justify-between">
                            <div>
                                <div class="text-3xl font-black text-${color}-600">${kpi.metric_value}${kpi.metric_unit}</div>
                                <div class="text-sm text-slate-500 mt-1">Ø§Ù„Ù‡Ø¯Ù: ${kpi.target_value}${kpi.metric_unit}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${percentage >= 100 ? 'text-green-600' : 'text-orange-600'}">
                                    ${percentage}%
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-${color}-600 h-2 rounded-full" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                    </div>`;
                }).join('')}
            </div>
            ` : ''}

            <!-- Goals Section -->
            ${goals.length > 0 ? `
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-bold text-xl text-slate-800 flex items-center gap-2">
                        <i class="fas fa-bullseye text-indigo-600"></i>
                        Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
                    </h3>
                    <div class="text-sm">
                        <span class="text-green-600 font-bold">${completedGoals.length}</span>
                        <span class="text-slate-500"> / ${goals.length} Ù…ÙƒØªÙ…Ù„</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${activeGoals.slice(0, 6).map(goal => `
                        <div class="border border-slate-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800 flex-1">${goal.goal_title}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                    goal.completion_percentage >= 75 ? 'bg-green-100 text-green-700' :
                                    goal.completion_percentage >= 50 ? 'bg-blue-100 text-blue-700' :
                                    'bg-orange-100 text-orange-700'
                                }">
                                    ${goal.completion_percentage.toFixed(0)}%
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">${goal.description}</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                                <div class="bg-indigo-600 h-2 rounded-full" style="width: ${goal.completion_percentage}%"></div>
                            </div>
                            <div class="flex items-center justify-between text-xs text-slate-500">
                                <span><i class="fas fa-calendar ml-1"></i>Ø§Ù„Ù…ÙˆØ¹Ø¯: ${new Date(goal.target_date).toLocaleDateString('ar-EG')}</span>
                                <span class="px-2 py-1 rounded bg-slate-100">${goal.status}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}

            <!-- Operations Section -->
            ${operations.length > 0 ? `
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-tasks text-purple-600"></i>
                    Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©
                </h3>
                <div class="space-y-3">
                    ${operations.slice(0, 5).map(op => `
                        <div class="flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-cog text-purple-600"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-slate-800">${op.operation_name}</div>
                                    <div class="text-sm text-slate-500">${op.operation_type}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 rounded-full text-xs font-bold ${
                                    op.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
                                }">
                                    ${op.status}
                                </span>
                                <div class="text-xs text-slate-500 mt-1">
                                    ${new Date(op.start_date).toLocaleDateString('ar-EG')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
        </div>`;
    };

    const renderEmployeeManagement = () => {
        console.log('ğŸ‘¥ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderEmployeeManagement - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-users-cog"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„ÙØ±ÙˆØ¹ØŒ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§ØªØŒ Ø§Ù„Ù…Ù†ØµØ§ØªØŒ Ø§Ù„Ù…ÙƒØ§ØªØ¨</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-building text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold">Ø§Ù„ÙØ±ÙˆØ¹</h3>
                    </div>
                    <p class="text-2xl font-black text-blue-600">24</p>
                    <p class="text-sm text-slate-500">ÙØ±Ø¹ Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-seedling text-orange-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold">Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª</h3>
                    </div>
                    <p class="text-2xl font-black text-orange-600">8</p>
                    <p class="text-sm text-slate-500">Ø­Ø§Ø¶Ù†Ø© ÙØ¹Ø§Ù„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-server text-green-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold">Ø§Ù„Ù…Ù†ØµØ§Øª</h3>
                    </div>
                    <p class="text-2xl font-black text-green-600">12</p>
                    <p class="text-sm text-slate-500">Ù…Ù†ØµØ© Ø±Ù‚Ù…ÙŠØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-briefcase text-purple-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold">Ø§Ù„Ù…ÙƒØ§ØªØ¨</h3>
                    </div>
                    <p class="text-2xl font-black text-purple-600">16</p>
                    <p class="text-sm text-slate-500">Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±ÙŠ</p>
                </div>
            </div>
        </div>`;
    };

    const renderSmartSystems = async () => {
        console.log('ğŸ¤– ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderSmartSystems - Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©');
        const [digital, community, events] = await Promise.all([
            fetchAPI('/api/digital-marketing'),
            fetchAPI('/api/community-marketing'),
            fetchAPI('/api/event-marketing')
        ]);
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-microchip"></i>
                    Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØŒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¹Ø¨Ø± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</p>
            </div>
            
            <!-- Digital Marketing -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-laptop text-blue-600"></i>
                    Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (${digital.length} Ø­Ù…Ù„Ø©)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${digital.slice(0, 6).map(camp => {
                        const roi = ((camp.conversions / camp.reach) * 100).toFixed(2);
                        return `
                        <div class="border border-blue-200 bg-blue-50 rounded-lg p-4 hover:shadow-md transition">
                            <h4 class="font-bold text-slate-800 mb-3">${camp.campaign_name}</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©:</span>
                                    <span class="font-bold">${camp.budget.toLocaleString('ar-EG')} Ø±ÙŠØ§Ù„</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Ø§Ù„Ù…ØµØ±ÙˆÙ:</span>
                                    <span class="font-bold text-orange-600">${camp.spent.toLocaleString('ar-EG')} Ø±ÙŠØ§Ù„</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Ø§Ù„ÙˆØµÙˆÙ„:</span>
                                    <span class="font-bold text-blue-600">${camp.reach.toLocaleString('ar-EG')}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Ø§Ù„ØªÙØ§Ø¹Ù„:</span>
                                    <span class="font-bold text-green-600">${camp.engagement.toLocaleString('ar-EG')}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª:</span>
                                    <span class="font-bold text-purple-600">${camp.conversions}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">ROI:</span>
                                    <span class="font-bold text-amber-600">${roi}%</span>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <!-- Community Marketing -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-users text-green-600"></i>
                    Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠ (${community.length} ÙØ¹Ø§Ù„ÙŠØ©)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${community.map(cm => `
                        <div class="border border-green-200 bg-green-50 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-3">
                                <h4 class="font-bold text-slate-800">${cm.initiative_name}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                    cm.status === 'completed' ? 'bg-green-600 text-white' :
                                    cm.status === 'planned' ? 'bg-blue-100 text-blue-700' :
                                    'bg-gray-100 text-gray-700'
                                }">
                                    ${cm.status}
                                </span>
                            </div>
                            <div class="space-y-2 text-sm text-slate-600">
                                <div><i class="fas fa-map-marker-alt text-red-500 ml-2"></i>${cm.location}</div>
                                <div><i class="fas fa-calendar text-blue-500 ml-2"></i>${new Date(cm.event_date).toLocaleDateString('ar-EG')}</div>
                                <div><i class="fas fa-users text-purple-500 ml-2"></i>${cm.participants_count} Ù…Ø´Ø§Ø±Ùƒ</div>
                                <div><i class="fas fa-star text-amber-500 ml-2"></i>Ø§Ù„ØªØ£Ø«ÙŠØ±: ${cm.impact_score}/10</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Event Marketing -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-calendar-alt text-purple-600"></i>
                    Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¹Ø¨Ø± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª (${events.length} Ø­Ø¯Ø«)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${events.map(ev => `
                        <div class="border border-purple-200 bg-purple-50 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-3">
                                <h4 class="font-bold text-slate-800">${ev.event_name}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                    ev.status === 'upcoming' ? 'bg-blue-100 text-blue-700' :
                                    ev.status === 'completed' ? 'bg-green-100 text-green-700' :
                                    'bg-gray-100 text-gray-700'
                                }">
                                    ${ev.status}
                                </span>
                            </div>
                            <div class="space-y-2 text-sm text-slate-600">
                                <div><i class="fas fa-tag text-indigo-500 ml-2"></i>${ev.event_type}</div>
                                <div><i class="fas fa-map-marker-alt text-red-500 ml-2"></i>${ev.venue}</div>
                                <div><i class="fas fa-calendar text-blue-500 ml-2"></i>${new Date(ev.event_date).toLocaleDateString('ar-EG')}</div>
                                <div><i class="fas fa-users text-green-500 ml-2"></i>${ev.expected_attendees} Ù…ØªÙˆÙ‚Ø¹</div>
                                <div><i class="fas fa-dollar-sign text-amber-500 ml-2"></i>${ev.budget.toLocaleString('ar-EG')} Ø±ÙŠØ§Ù„</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderSubscriptionManagement = async () => {
        console.log('ğŸ“¦ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderSubscriptionManagement - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª');
        const [courses, skills, kpis] = await Promise.all([
            fetchAPI('/api/training-courses'),
            fetchAPI('/api/skills'),
            fetchAPI('/api/executive-kpis')
        ]);
        
        const avgKPI = kpis.length > 0 ? (kpis.reduce((sum, k) => sum + parseFloat(k.metric_value), 0) / kpis.length).toFixed(1) : 0;
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-amber-600 to-orange-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-tags"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„Ø¥Ø¯Ø§Ø± ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… KPIØŒ Ø§Ù„Ø¯ÙˆØ±Ø§ØªØŒ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-chart-line text-amber-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold text-lg">Ø§Ù„Ø¥Ø¯Ø§Ø± ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… KPI</h3>
                    </div>
                    <div class="text-3xl font-black text-amber-600">${avgKPI}%</div>
                    <p class="text-sm text-slate-500 mt-2">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
                    <p class="text-xs text-slate-400 mt-1">${kpis.length} Ù…Ø¤Ø´Ø± Ø£Ø¯Ø§Ø¡ Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-book text-orange-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold text-lg">Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h3>
                    </div>
                    <div class="text-3xl font-black text-orange-600">${courses.length}</div>
                    <p class="text-sm text-slate-500 mt-2">Ø¯ÙˆØ±Ø© Ù…ØªØ§Ø­Ø©</p>
                    <p class="text-xs text-slate-400 mt-1">${courses.filter(c => c.status === 'open').length} Ø¯ÙˆØ±Ø© Ù…ÙØªÙˆØ­Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-award text-red-600 text-xl"></i>
                        </div>
                        <h3 class="font-bold text-lg">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
                    </div>
                    <div class="text-3xl font-black text-red-600">${skills.length}</div>
                    <p class="text-sm text-slate-500 mt-2">Ù…Ù‡Ø§Ø±Ø© Ù…Ø³Ø¬Ù„Ø©</p>
                    <p class="text-xs text-slate-400 mt-1">ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                </div>
            </div>
            
            <!-- Courses List -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-graduation-cap text-orange-600"></i>
                    Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${courses.slice(0, 6).map(course => `
                        <div class="border border-slate-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800">${course.course_name}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                    course.status === 'open' ? 'bg-green-100 text-green-700' :
                                    course.status === 'full' ? 'bg-red-100 text-red-700' :
                                    'bg-gray-100 text-gray-700'
                                }">
                                    ${course.status === 'open' ? 'Ù…ØªØ§Ø­' : course.status === 'full' ? 'Ù…ÙƒØªÙ…Ù„' : course.status}
                                </span>
                            </div>
                            <div class="space-y-2 text-sm text-slate-600">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-clock text-amber-500"></i>
                                    <span>${course.duration_hours} Ø³Ø§Ø¹Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-user text-blue-500"></i>
                                    <span>${course.instructor_name}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-users text-green-500"></i>
                                    <span>${course.current_participants}/${course.max_participants} Ù…Ø´Ø§Ø±Ùƒ</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-dollar-sign text-purple-500"></i>
                                    <span>${course.price.toLocaleString('ar-EG')} Ø±ÙŠØ§Ù„</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Skills Categories -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-star text-amber-600"></i>
                    Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    ${[...new Set(skills.map(s => s.skill_category))].map(cat => {
                        const count = skills.filter(s => s.skill_category === cat).length;
                        return `
                        <div class="border border-slate-200 rounded-lg p-3 text-center hover:shadow-md transition">
                            <div class="text-2xl font-black text-amber-600">${count}</div>
                            <div class="text-sm text-slate-600 mt-1">${cat}</div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderOperationsManagement = () => {
        console.log('âš™ï¸ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderOperationsManagement - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª');
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-cogs"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„ÙØ±ÙˆØ¹ØŒ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§ØªØŒ Ø§Ù„Ù…Ù†ØµØ§ØªØŒ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
            </div>
            <div class="bg-white rounded-xl p-8 shadow-sm border">
                <div class="text-center">
                    <i class="fas fa-cogs text-6xl text-emerald-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-slate-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                    <p class="text-slate-600 mt-2">Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</p>
                </div>
            </div>
        </div>`;
    };

    const renderFinancialApprovals = async () => {
        console.log('ğŸ’° ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderFinancialApprovals - Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©');
        const [policies, manual, news] = await Promise.all([
            fetchAPI('/api/financial-policies'),
            fetchAPI('/api/financial-manual'),
            fetchAPI('/api/financial-news')
        ]);
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-rose-600 to-pink-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-file-signature"></i>
                    Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§ØªØŒ Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</p>
            </div>
            
            <!-- Policies -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-file-contract text-rose-600"></i>
                    Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª (${policies.length})
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${policies.map(policy => `
                        <div class="border border-rose-200 bg-rose-50 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800">${policy.policy_name}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-rose-600 text-white">
                                    ${policy.policy_code}
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">${policy.description}</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-white rounded p-2">
                                    <div class="text-slate-500">Ø§Ù„ÙØ¦Ø©</div>
                                    <div class="font-bold">${policy.category}</div>
                                </div>
                                <div class="bg-white rounded p-2">
                                    <div class="text-slate-500">Ø­Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>
                                    <div class="font-bold">${policy.approval_threshold ? policy.approval_threshold.toLocaleString('ar-EG') + ' Ø±ÙŠØ§Ù„' : 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Operating Manual -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-book text-pink-600"></i>
                    Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ (${manual.length} Ù‚Ø³Ù…)
                </h3>
                <div class="space-y-3">
                    ${manual.map(section => `
                        <div class="border border-pink-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <span class="px-2 py-1 rounded bg-pink-100 text-pink-700 text-xs font-bold">${section.section_number}</span>
                                    <h4 class="font-bold text-slate-800 mt-2">${section.section_title}</h4>
                                </div>
                                <span class="text-xs text-slate-500">${section.version}</span>
                            </div>
                            <p class="text-sm text-slate-600">${section.content}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- News -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-newspaper text-amber-600"></i>
                    Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± (${news.length})
                </h3>
                <div class="space-y-3">
                    ${news.map(item => `
                        <div class="border-r-4 ${
                            item.priority === 'high' ? 'border-red-500 bg-red-50' :
                            item.priority === 'normal' ? 'border-blue-500 bg-blue-50' :
                            'border-gray-500 bg-gray-50'
                        } rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800">${item.news_title}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                    item.priority === 'high' ? 'bg-red-600 text-white' :
                                    item.priority === 'normal' ? 'bg-blue-600 text-white' :
                                    'bg-gray-600 text-white'
                                }">
                                    ${item.priority}
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 mb-2">${item.news_content}</p>
                            <div class="text-xs text-slate-500">
                                <i class="fas fa-clock ml-1"></i>
                                ${new Date(item.published_date).toLocaleDateString('ar-EG')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderTenants = () => {
        return renderEntitiesManager();
    };

    const renderCollectionsStrategic = () => {
        return renderCollections();
    };

    const renderMarketing = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-pink-600 to-rose-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-bullhorn"></i>
                    Ø§Ù„ØªØ³ÙˆÙŠÙ‚
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØŒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¹Ø¨Ø± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4">
                        <i class="fas fa-laptop text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h3>
                    <p class="text-slate-600 text-sm">Ø­Ù…Ù„Ø§Øª Ø±Ù‚Ù…ÙŠØ© ÙˆØ¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-4">
                        <i class="fas fa-users text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠ</h3>
                    <p class="text-slate-600 text-sm">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition cursor-pointer">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                        <i class="fas fa-calendar-alt text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¹Ø¨Ø± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</h3>
                    <p class="text-slate-600 text-sm">Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶ ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠØ©</p>
                </div>
            </div>
        </div>`;
    };

    const renderAdvertisersCenter = () => {
        return renderAdsManager();
    };

    const renderTrainingDevelopment = async () => {
        console.log('ğŸ“ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderTrainingDevelopment - Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±');
        const programs = await fetchAPI('/api/development-programs');
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (${programs.length} Ø¨Ø±Ù†Ø§Ù…Ø¬)</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${programs.map((prog, idx) => {
                    const colors = ['indigo', 'purple', 'blue', 'pink', 'violet'];
                    const color = colors[idx % colors.length];
                    return `
                    <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-graduation-cap text-${color}-600 text-xl"></i>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${
                                prog.status === 'active' ? 'bg-green-100 text-green-700' :
                                prog.status === 'upcoming' ? 'bg-blue-100 text-blue-700' :
                                'bg-gray-100 text-gray-700'
                            }">
                                ${prog.status}
                            </span>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2">${prog.program_name}</h3>
                        <p class="text-sm text-slate-600 mb-3">${prog.program_type}</p>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2 text-slate-600">
                                <i class="fas fa-users text-${color}-500"></i>
                                <span>${prog.enrolled}/${prog.capacity} Ù…Ø´Ø§Ø±Ùƒ</span>
                            </div>
                            <div class="flex items-center gap-2 text-slate-600">
                                <i class="fas fa-clock text-${color}-500"></i>
                                <span>${prog.duration_weeks} Ø£Ø³Ø§Ø¨ÙŠØ¹</span>
                            </div>
                            <div class="flex items-center gap-2 text-slate-600">
                                <i class="fas fa-user-tie text-${color}-500"></i>
                                <span>${prog.trainer}</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-xs text-slate-500 mb-1">
                                <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                                <span>${prog.completion_rate}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${color}-600 h-2 rounded-full" style="width: ${prog.completion_rate}%"></div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('')}
            </div>
        </div>`;
    };

    const renderQualityAudit = async () => {
        console.log('âœ… ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderQualityAudit - Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚');
        const [standards, audits] = await Promise.all([
            fetchAPI('/api/quality-standards'),
            fetchAPI('/api/quality-audits')
        ]);
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-clipboard-check"></i>
                    Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
            </div>
            
            <!-- Quality Standards -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-award text-teal-600"></i>
                    Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© (${standards.length})
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${standards.map(std => `
                        <div class="border border-teal-200 bg-teal-50 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h4 class="font-bold text-slate-800">${std.standard_name}</h4>
                                    <p class="text-xs text-slate-500 mt-1">${std.standard_code}</p>
                                </div>
                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-teal-600 text-white">
                                    ${std.compliance_level}
                                </span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">${std.description}</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-white rounded p-2">
                                    <div class="text-slate-500">Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ</div>
                                    <div class="font-bold text-slate-800">${new Date(std.next_audit_date).toLocaleDateString('ar-EG')}</div>
                                </div>
                                <div class="bg-white rounded p-2">
                                    <div class="text-slate-500">Ø§Ù„ØªÙƒØ±Ø§Ø±</div>
                                    <div class="font-bold text-slate-800">${std.audit_frequency}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Audits -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-search text-cyan-600"></i>
                    Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ (${audits.length})
                </h3>
                <div class="space-y-3">
                    ${audits.map(audit => `
                        <div class="border border-cyan-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800">${audit.audit_name}</h4>
                                <span class="px-3 py-1 rounded-full text-xs font-bold ${
                                    audit.status === 'completed' ? 'bg-green-100 text-green-700' :
                                    audit.status === 'scheduled' ? 'bg-blue-100 text-blue-700' :
                                    'bg-orange-100 text-orange-700'
                                }">
                                    ${audit.status}
                                </span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                                <div>
                                    <span class="text-slate-500">Ø§Ù„Ù†ÙˆØ¹: </span>
                                    <span class="font-bold">${audit.audit_type}</span>
                                </div>
                                <div>
                                    <span class="text-slate-500">Ø§Ù„ØªØ§Ø±ÙŠØ®: </span>
                                    <span class="font-bold">${new Date(audit.audit_date).toLocaleDateString('ar-EG')}</span>
                                </div>
                                ${audit.compliance_score ? `
                                <div>
                                    <span class="text-slate-500">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„: </span>
                                    <span class="font-bold text-teal-600">${audit.compliance_score}%</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderEvaluation = async () => {
        console.log('â­ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderEvaluation - Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
        const evaluations = await fetchAPI('/api/evaluations');
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-yellow-600 to-amber-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-star"></i>
                    Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </h2>
                <p class="mt-2 opacity-90">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ÙƒÙØ§Ø¡Ø§Øª (${evaluations.length} ØªÙ‚ÙŠÙŠÙ…)</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${evaluations.map(ev => {
                    const percentage = (ev.score / ev.max_score) * 100;
                    return `
                    <div class="bg-white rounded-xl p-6 shadow-sm border hover:shadow-lg transition">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="font-bold text-lg text-slate-800">${ev.evaluation_name}</h3>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${
                                percentage >= 90 ? 'bg-green-100 text-green-700' :
                                percentage >= 75 ? 'bg-blue-100 text-blue-700' :
                                percentage >= 60 ? 'bg-yellow-100 text-yellow-700' :
                                'bg-red-100 text-red-700'
                            }">
                                ${ev.grade}
                            </span>
                        </div>
                        <p class="text-sm text-slate-600 mb-4">${ev.evaluation_type}</p>
                        
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-slate-600">Ø§Ù„Ø¯Ø±Ø¬Ø©</span>
                            <span class="font-bold text-xl ${
                                percentage >= 90 ? 'text-green-600' :
                                percentage >= 75 ? 'text-blue-600' :
                                percentage >= 60 ? 'text-yellow-600' :
                                'text-red-600'
                            }">${ev.score}/${ev.max_score}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                            <div class="${
                                percentage >= 90 ? 'bg-green-600' :
                                percentage >= 75 ? 'bg-blue-600' :
                                percentage >= 60 ? 'bg-yellow-600' :
                                'bg-red-600'
                            } h-3 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        
                        ${ev.comments ? `
                        <div class="bg-slate-50 rounded-lg p-3 mt-3">
                            <p class="text-sm text-slate-600">${ev.comments}</p>
                        </div>
                        ` : ''}
                        
                        <div class="mt-3 text-xs text-slate-500">
                            <i class="fas fa-calendar ml-1"></i>
                            ${new Date(ev.evaluation_date).toLocaleDateString('ar-EG')}
                        </div>
                    </div>
                    `;
                }).join('')}
            </div>
        </div>`;
    };

    const renderTasksStrategic = () => {
        return renderTasksManager();
    };

    const renderInformationCenter = async () => {
        console.log('â„¹ï¸ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderInformationCenter - Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª');
        const [repository, knowledgeBase] = await Promise.all([
            fetchAPI('/api/information-repository'),
            fetchAPI('/api/knowledge-base')
        ]);
        
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-info-circle"></i>
                    Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                </h2>
                <p class="mt-2 opacity-90">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø§Ù…Ù„Ø© ÙˆÙ…Ø±Ø¬Ø¹ÙŠØ©</p>
            </div>
            
            <!-- Information Repository -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-folder-open text-blue-600"></i>
                    Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (${repository.length} Ù…Ø§Ø¯Ø©)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${repository.slice(0, 6).map(item => `
                        <div class="border border-blue-200 bg-blue-50 rounded-lg p-4 hover:shadow-md transition cursor-pointer">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-bold text-slate-800 text-sm">${item.title}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-blue-600 text-white">
                                    ${item.category}
                                </span>
                            </div>
                            <p class="text-xs text-slate-600 mb-3 line-clamp-2">${item.content ? item.content.substring(0, 100) + '...' : ''}</p>
                            <div class="flex items-center justify-between text-xs text-slate-500">
                                <div>
                                    <i class="fas fa-eye ml-1"></i>
                                    ${item.views_count} Ù…Ø´Ø§Ù‡Ø¯Ø©
                                </div>
                                <div>
                                    <i class="fas fa-lock ml-1"></i>
                                    ${item.access_level}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Knowledge Base -->
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-xl text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-question-circle text-indigo-600"></i>
                    Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© (${knowledgeBase.length} Ø³Ø¤Ø§Ù„)
                </h3>
                <div class="space-y-3">
                    ${knowledgeBase.map(kb => `
                        <div class="border border-indigo-200 rounded-lg p-4 hover:shadow-md transition">
                            <div class="flex items-start gap-3">
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center shrink-0">
                                    <i class="fas fa-question text-indigo-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-slate-800 mb-2">${kb.question}</h4>
                                    <p class="text-sm text-slate-600 mb-3">${kb.answer}</p>
                                    <div class="flex items-center justify-between">
                                        <span class="px-2 py-1 rounded bg-indigo-100 text-indigo-700 text-xs font-bold">
                                            ${kb.category}
                                        </span>
                                        <div class="flex items-center gap-3 text-xs text-slate-500">
                                            <div>
                                                <i class="fas fa-thumbs-up text-green-500 ml-1"></i>
                                                ${kb.helpful_count}
                                            </div>
                                            <div>
                                                <i class="fas fa-thumbs-down text-red-500 ml-1"></i>
                                                ${kb.not_helpful_count}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderIdentitySettings = () => {
        return renderSettings();
    };

    const renderSystemLog = () => {
        return renderAuditLogs();
    };

    const renderReports = () => {
        const reportCategories = [
            {
                id: 'financial',
                title: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                icon: 'fa-file-invoice-dollar',
                color: 'blue',
                reports: [
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©', frequency: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', lastRun: '2026-01-01', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'employees',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
                icon: 'fa-users',
                color: 'green',
                reports: [
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±ÙˆØ§ØªØ¨', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-01', status: 'active' },
                    { name: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡', frequency: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', lastRun: '2026-01-01', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'performance',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡',
                icon: 'fa-chart-bar',
                color: 'purple',
                reports: [
                    { name: 'Ù…Ø¤Ø´Ø±Ø§Øª KPI', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' }
                ]
            },
            {
                id: 'marketing',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ³ÙˆÙŠÙ‚',
                icon: 'fa-bullhorn',
                color: 'orange',
                reports: [
                    { name: 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø§Øª', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'collections',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­ØµÙŠÙ„',
                icon: 'fa-money-bill-wave',
                color: 'emerald',
                reports: [
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª ÙˆØ§Ù„Ø¯ÙŠÙˆÙ†', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'ØªØ­Ù„ÙŠÙ„ Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¯ÙØ¹', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'facilities',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§ÙÙ‚',
                icon: 'fa-building',
                color: 'teal',
                reports: [
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙŠØ§Ù†Ø©', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø·Ø§Ù‚Ø©', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'operations',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',
                icon: 'fa-cogs',
                color: 'indigo',
                reports: [
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„Ø­Ù„ÙˆÙ„', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' }
                ]
            },
            {
                id: 'quality',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©',
                icon: 'fa-certificate',
                color: 'cyan',
                reports: [
                    { name: 'ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ¯Ø©', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', frequency: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', lastRun: '2026-01-01', status: 'active' }
                ]
            },
            {
                id: 'training',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¨',
                icon: 'fa-chalkboard-teacher',
                color: 'pink',
                reports: [
                    { name: 'Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' },
                    { name: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†', frequency: 'Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©', lastRun: '2026-01-10', status: 'active' },
                    { name: 'Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨', frequency: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', lastRun: '2026-01-01', status: 'active' }
                ]
            },
            {
                id: 'inventory',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                icon: 'fa-boxes',
                color: 'amber',
                reports: [
                    { name: 'Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'subscriptions',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª',
                icon: 'fa-tags',
                color: 'rose',
                reports: [
                    { name: 'Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'Ø§Ù„ØªØ¬Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©', frequency: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', lastRun: '2026-01-18', status: 'active' },
                    { name: 'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª', frequency: 'Ø´Ù‡Ø±ÙŠ', lastRun: '2026-01-15', status: 'active' }
                ]
            },
            {
                id: 'system',
                title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                icon: 'fa-server',
                color: 'slate',
                reports: [
                    { name: 'Ø³Ø¬Ù„ Ø§Ù„Ø£Ù†Ø´Ø·Ø©', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' },
                    { name: 'Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', frequency: 'ÙŠÙˆÙ…ÙŠ', lastRun: '2026-01-19', status: 'active' }
                ]
            }
        ];

        return `
        <div class="space-y-6 animate-fade-in">
            <!-- Header -->
            <div class="bg-gradient-to-r from-red-600 to-rose-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-line"></i>
                    Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">ØªÙ‚Ø§Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                <div class="mt-4 bg-white/20 backdrop-blur-sm rounded-lg p-3">
                    <p class="text-sm font-bold"><i class="fas fa-exclamation-triangle ml-2"></i>Ù…Ù‡Ù… Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                    <p class="text-xs mt-1 opacity-90">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                </div>
            </div>

            <!-- Statistics Overview -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-4 shadow-sm border">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± Ù†Ø´Ø·Ø©</p>
                            <p class="text-2xl font-black text-green-600">${reportCategories.reduce((sum, cat) => sum + cat.reports.length, 0)}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm border">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-blue-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ©</p>
                            <p class="text-2xl font-black text-blue-600">${reportCategories.reduce((sum, cat) => sum + cat.reports.filter(r => r.frequency === 'ÙŠÙˆÙ…ÙŠ').length, 0)}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm border">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar-week text-purple-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</p>
                            <p class="text-2xl font-black text-purple-600">${reportCategories.reduce((sum, cat) => sum + cat.reports.filter(r => r.frequency === 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ').length, 0)}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm border">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar-alt text-orange-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠØ©</p>
                            <p class="text-2xl font-black text-orange-600">${reportCategories.reduce((sum, cat) => sum + cat.reports.filter(r => r.frequency === 'Ø´Ù‡Ø±ÙŠ').length, 0)}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Categories -->
            ${reportCategories.map((category, idx) => {
                const colors = [
                    { bg: 'bg-blue-50', border: 'border-blue-100', icon: 'bg-blue-100 text-blue-600', btn: 'bg-blue-600 hover:bg-blue-700' },
                    { bg: 'bg-green-50', border: 'border-green-100', icon: 'bg-green-100 text-green-600', btn: 'bg-green-600 hover:bg-green-700' },
                    { bg: 'bg-purple-50', border: 'border-purple-100', icon: 'bg-purple-100 text-purple-600', btn: 'bg-purple-600 hover:bg-purple-700' },
                    { bg: 'bg-orange-50', border: 'border-orange-100', icon: 'bg-orange-100 text-orange-600', btn: 'bg-orange-600 hover:bg-orange-700' },
                    { bg: 'bg-emerald-50', border: 'border-emerald-100', icon: 'bg-emerald-100 text-emerald-600', btn: 'bg-emerald-600 hover:bg-emerald-700' },
                    { bg: 'bg-teal-50', border: 'border-teal-100', icon: 'bg-teal-100 text-teal-600', btn: 'bg-teal-600 hover:bg-teal-700' },
                    { bg: 'bg-indigo-50', border: 'border-indigo-100', icon: 'bg-indigo-100 text-indigo-600', btn: 'bg-indigo-600 hover:bg-indigo-700' },
                    { bg: 'bg-cyan-50', border: 'border-cyan-100', icon: 'bg-cyan-100 text-cyan-600', btn: 'bg-cyan-600 hover:bg-cyan-700' },
                    { bg: 'bg-pink-50', border: 'border-pink-100', icon: 'bg-pink-100 text-pink-600', btn: 'bg-pink-600 hover:bg-pink-700' },
                    { bg: 'bg-amber-50', border: 'border-amber-100', icon: 'bg-amber-100 text-amber-600', btn: 'bg-amber-600 hover:bg-amber-700' },
                    { bg: 'bg-rose-50', border: 'border-rose-100', icon: 'bg-rose-100 text-rose-600', btn: 'bg-rose-600 hover:bg-rose-700' },
                    { bg: 'bg-slate-50', border: 'border-slate-100', icon: 'bg-slate-100 text-slate-600', btn: 'bg-slate-600 hover:bg-slate-700' }
                ];
                const color = colors[idx % colors.length];
                return `
                <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
                    <div class="${color.bg} ${color.border} border-b p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 ${color.icon} rounded-xl flex items-center justify-center">
                                    <i class="fas ${category.icon} text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-slate-800">${category.title}</h3>
                                    <p class="text-sm text-slate-600">${category.reports.length} ØªÙ‚Ø±ÙŠØ± Ù†Ø´Ø·</p>
                                </div>
                            </div>
                            <button onclick="app.showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± ${category.title}', 'success')" class="px-4 py-2 ${color.btn} text-white rounded-lg transition text-sm font-bold">
                                <i class="fas fa-download ml-2"></i>ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${category.reports.map(report => `
                                <div class="border border-slate-200 rounded-lg p-4 hover:shadow-md transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-800">${report.name}</h4>
                                            <div class="flex items-center gap-4 mt-2 text-xs text-slate-500">
                                                <span><i class="fas fa-sync-alt ml-1"></i>${report.frequency}</span>
                                                <span><i class="fas fa-clock ml-1"></i>Ø¢Ø®Ø± ØªØ´ØºÙŠÙ„: ${report.lastRun}</span>
                                            </div>
                                        </div>
                                        <span class="px-2 py-1 rounded-full text-xs font-bold ${report.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'}">
                                            ${report.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…ØªÙˆÙ‚Ù'}
                                        </span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="app.showToast('ØªÙ… ØªØ´ØºÙŠÙ„ ØªÙ‚Ø±ÙŠØ±: ${report.name}', 'info')" class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm font-bold">
                                            <i class="fas fa-play ml-1"></i>ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†
                                        </button>
                                        <button onclick="app.showToast('ØªÙ… ØªØµØ¯ÙŠØ±: ${report.name}', 'success')" class="flex-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-bold">
                                            <i class="fas fa-file-pdf ml-1"></i>ØªØµØ¯ÙŠØ± PDF
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`;
            }).join('')}
        </div>`;
    };

    // Supply Chain Management Render Functions
    const renderPurchases = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-shopping-cart"></i>
                    Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
                        <i class="fas fa-clock text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">45</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                        <i class="fas fa-dollar-sign text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$125,000</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                        <i class="fas fa-hourglass-half text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2.5 ÙŠÙˆÙ…</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button onclick="app.showToast('ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©', 'info')" class="p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition text-right">
                        <i class="fas fa-list text-yellow-600 ml-2"></i>
                        <span class="font-bold text-yellow-700">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderLogistics = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-truck"></i>
                    Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ÙˆØ§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„
                </h2>
                <p class="mt-2 opacity-90">ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ù„</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø´Ø­Ù†Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-shipping-fast text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">28</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</span>
                        <i class="fas fa-route text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-check-double text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">42</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªØ£Ø®Ø±Ø©</span>
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª</h3>
                <div class="bg-slate-100 rounded-lg p-8 text-center">
                    <i class="fas fa-map-marked-alt text-6xl text-slate-400 mb-4"></i>
                    <p class="text-slate-600">Ø¹Ø±Ø¶ Ø®Ø±ÙŠØ·Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
                </div>
            </div>
        </div>`;
    };

    const renderInventory = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-boxes"></i>
                    Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</span>
                        <i class="fas fa-box text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,245</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø£ØµÙ†Ø§Ù Ù…Ù†Ø®ÙØ¶Ø©</span>
                        <i class="fas fa-exclamation-circle text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†ÙØ°Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
                        <i class="fas fa-times-circle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
                        <i class="fas fa-dollar-sign text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$520,000</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-plus text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-clipboard-list text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¬Ø±Ø¯</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-excel text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderSuppliers = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-handshake"></i>
                    Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ÙˆØ±Ø¯ÙˆÙ† Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-user-check text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª Ù…ÙØªÙˆØ­Ø©</span>
                        <i class="fas fa-file-invoice text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">23</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.5/5</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</span>
                        <i class="fas fa-money-bill-wave text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$2.1M</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø£ÙØ¶Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h3>
                <div class="space-y-3">
                    ${['Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù„ØªØ¬Ø§Ø±Ø©', 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ'].map((name, i) => `
                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 font-bold">
                                    ${i + 1}
                                </div>
                                <span class="font-bold text-slate-800">${name}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-yellow-500">â˜…â˜…â˜…â˜…â˜…</span>
                                <span class="text-sm text-slate-600">4.${9-i}/5</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderOrdersDelivery = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-clipboard-list"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ…
                </h2>
                <p class="mt-2 opacity-90">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ù†Ù‡Ø§ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</span>
                        <i class="fas fa-inbox text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">18</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</span>
                        <i class="fas fa-cog text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">32</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</span>
                        <i class="fas fa-truck text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">45</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <div class="space-y-2">
                    <div class="flex items-center gap-4">
                        <span class="w-32 text-slate-600">Ø¬Ø¯ÙŠØ¯Ø©</span>
                        <div class="flex-1 bg-slate-200 rounded-full h-4">
                            <div class="bg-blue-600 h-4 rounded-full" style="width: 15%"></div>
                        </div>
                        <span class="font-bold">15%</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="w-32 text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</span>
                        <div class="flex-1 bg-slate-200 rounded-full h-4">
                            <div class="bg-orange-600 h-4 rounded-full" style="width: 30%"></div>
                        </div>
                        <span class="font-bold">30%</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="w-32 text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</span>
                        <div class="flex-1 bg-slate-200 rounded-full h-4">
                            <div class="bg-purple-600 h-4 rounded-full" style="width: 25%"></div>
                        </div>
                        <span class="font-bold">25%</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="w-32 text-slate-600">Ù…ÙƒØªÙ…Ù„Ø©</span>
                        <div class="flex-1 bg-slate-200 rounded-full h-4">
                            <div class="bg-green-600 h-4 rounded-full" style="width: 65%"></div>
                        </div>
                        <span class="font-bold">65%</span>
                    </div>
                </div>
            </div>
        </div>`;
    };

    const renderSmartProcurement = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-brain"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ø³Ù„ Ø§Ù„ØªÙˆØ±ÙŠØ¯ ÙˆØ§Ù„Ø¥Ù…Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒÙŠ
                </h2>
                <p class="mt-2 opacity-90">ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØªÙˆÙ‚Ø¹Ø§Øª Ø°ÙƒÙŠØ© Ù„Ù„Ø¥Ù…Ø¯Ø§Ø¯</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø³Ù„Ø³Ù„Ø©</span>
                        <i class="fas fa-chart-line text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">92%</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù„Ø¨</span>
                        <i class="fas fa-crystal-ball text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">+15%</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙˆÙÙŠØ± Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</span>
                        <i class="fas fa-piggy-bank text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$45K</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ©</h3>
                <div class="space-y-3">
                    ${[
                        { text: 'ÙŠÙÙ†ØµØ­ Ø¨Ø·Ù„Ø¨ Ù…ÙˆØ§Ø¯ Ø®Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ØªØ²Ø§ÙŠØ¯', icon: 'fa-arrow-trend-up', color: 'blue' },
                        { text: 'ØªØ­Ø³ÙŠÙ† Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø­Ù† ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙˆÙØ± 12% Ù…Ù† ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù†Ù‚Ù„', icon: 'fa-route', color: 'green' },
                        { text: 'ØªÙ‚Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø²Ø§Ø¦Ø¯ Ù„Ù„ØµÙ†Ù #1245 ÙŠÙˆÙØ± Ù…Ø³Ø§Ø­Ø© ØªØ®Ø²ÙŠÙ†', icon: 'fa-warehouse', color: 'orange' }
                    ].map(rec => `
                        <div class="flex items-start gap-3 p-4 bg-${rec.color}-50 rounded-lg border border-${rec.color}-100">
                            <i class="fas ${rec.icon} text-${rec.color}-600 mt-1"></i>
                            <p class="text-slate-700">${rec.text}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderManufacturing = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-gray-700 to-gray-900 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-industry"></i>
                    Ø§Ù„ØªØµÙ†ÙŠØ¹
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ÙˆØ§Ù„ØªØµÙ†ÙŠØ¹</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø®Ø·ÙˆØ· Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-cogs text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8/10</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                        <i class="fas fa-box-open text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,245</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙƒÙØ§Ø¡Ø©</span>
                        <i class="fas fa-tachometer-alt text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87%</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø£ÙˆØ§Ù…Ø± Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                        <i class="fas fa-tasks text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ù†ØªØ§Ø¬</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¥Ù†ØªØ§Ø¬ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø£Ù…Ø± Ø¥Ù†ØªØ§Ø¬ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†ØªØ§Ø¬', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†ØªØ§Ø¬</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderProductLifecycle = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-recycle"></i>
                    Ø­ÙŠØ§Ø© Ø§Ù„Ù…Ù†ØªØ¬
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ù†Ù‡Ø§ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ù†ØªØ¬Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-cube text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">245</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</span>
                        <i class="fas fa-flask text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¶Ø¬</span>
                        <i class="fas fa-chart-line text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</span>
                        <i class="fas fa-stop-circle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ù…Ø±Ø§Ø­Ù„ Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø©</h3>
                <div class="space-y-4">
                    ${[
                        { stage: 'Ø§Ù„ØªØ·ÙˆÙŠØ±', count: 12, color: 'purple', percent: 5 },
                        { stage: 'Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…', count: 23, color: 'blue', percent: 10 },
                        { stage: 'Ø§Ù„Ù†Ù…Ùˆ', count: 54, color: 'teal', percent: 22 },
                        { stage: 'Ø§Ù„Ù†Ø¶Ø¬', count: 156, color: 'green', percent: 63 },
                        { stage: 'Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø±', count: 8, color: 'red', percent: 3 }
                    ].map(phase => `
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-bold text-slate-700">${phase.stage}</span>
                                <span class="text-slate-600">${phase.count} Ù…Ù†ØªØ¬ (${phase.percent}%)</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-3">
                                <div class="bg-${phase.color}-600 h-3 rounded-full transition-all" style="width: ${phase.percent}%"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderMaintenance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-yellow-600 to-orange-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-wrench"></i>
                    Ø§Ù„ØµÙŠØ§Ù†Ø©
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© ÙˆØ§Ù„ØªØµØ­ÙŠØ­ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª ØµÙŠØ§Ù†Ø© Ù…ÙØªÙˆØ­Ø©</span>
                        <i class="fas fa-tools text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØµÙŠØ§Ù†Ø© ÙˆÙ‚Ø§Ø¦ÙŠØ© Ù…Ø¬Ø¯ÙˆÙ„Ø©</span>
                        <i class="fas fa-calendar-check text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
                        <i class="fas fa-stopwatch text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2.5 Ø³Ø§Ø¹Ø©</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                        <i class="fas fa-check-circle text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94%</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                <div class="space-y-3">
                    ${[
                        { equipment: 'Ø®Ø· Ø§Ù„Ø¥Ù†ØªØ§Ø¬ A', date: '2026-01-25', type: 'ÙˆÙ‚Ø§Ø¦ÙŠØ©' },
                        { equipment: 'Ù…ÙˆÙ„Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø±Ø¦ÙŠØ³ÙŠ', date: '2026-01-27', type: 'Ø¯ÙˆØ±ÙŠØ©' },
                        { equipment: 'Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙƒÙŠÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', date: '2026-02-01', type: 'ÙˆÙ‚Ø§Ø¦ÙŠØ©' }
                    ].map(item => `
                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-wrench text-orange-600"></i>
                                <div>
                                    <p class="font-bold text-slate-800">${item.equipment}</p>
                                    <p class="text-sm text-slate-600">Ù†ÙˆØ¹: ${item.type}</p>
                                </div>
                            </div>
                            <span class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">${item.date}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderQualityControl = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-red-600 to-pink-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-check-double"></i>
                    Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©
                </h2>
                <p class="mt-2 opacity-90">Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù‚Ø¨ÙˆÙ„</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">98.5%</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙØ­ÙˆØµØ§Øª Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-clipboard-check text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±ÙØ¶</span>
                        <i class="fas fa-times-circle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø´Ù‡Ø§Ø¯Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-certificate text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${[
                        { standard: 'ISO 9001:2015', status: 'Ù…Ø¹ØªÙ…Ø¯', expiry: '2027-06-30', color: 'green' },
                        { standard: 'ISO 14001', status: 'Ù…Ø¹ØªÙ…Ø¯', expiry: '2026-12-31', color: 'green' },
                        { standard: 'OHSAS 18001', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯', expiry: '2026-03-15', color: 'yellow' },
                        { standard: 'HACCP', status: 'Ù…Ø¹ØªÙ…Ø¯', expiry: '2027-09-20', color: 'green' }
                    ].map(cert => `
                        <div class="p-4 border border-${cert.color}-200 bg-${cert.color}-50 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-slate-800">${cert.standard}</h4>
                                <span class="text-xs px-2 py-1 bg-${cert.color}-200 text-${cert.color}-800 rounded-full font-bold">${cert.status}</span>
                            </div>
                            <p class="text-sm text-slate-600">ØªÙ†ØªÙ‡ÙŠ ÙÙŠ: ${cert.expiry}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    const renderSafety = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-hard-hat"></i>
                    Ø§Ù„Ø³Ù„Ø§Ù…Ø©
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ø­ÙˆØ§Ø¯Ø«</span>
                        <i class="fas fa-shield-alt text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">245</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©</span>
                        <i class="fas fa-user-graduate text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©</span>
                        <i class="fas fa-clipboard-list text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8/8</h3>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©</span>
                        <i class="fas fa-box text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">100%</h3>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø®Ø·Ø· Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    ${[
                        { plan: 'Ø®Ø·Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙŠÙ‚', status: 'Ù…Ø­Ø¯Ø«Ø©', icon: 'fa-fire-extinguisher', color: 'red' },
                        { plan: 'Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø²Ù„Ø§Ø²Ù„', status: 'Ù…Ø­Ø¯Ø«Ø©', icon: 'fa-house-crack', color: 'orange' },
                        { plan: 'Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ø·Ø¨ÙŠØ©', status: 'Ù…Ø­Ø¯Ø«Ø©', icon: 'fa-briefcase-medical', color: 'blue' }
                    ].map(plan => `
                        <div class="p-4 bg-${plan.color}-50 border border-${plan.color}-100 rounded-lg">
                            <div class="flex items-center gap-3 mb-2">
                                <i class="fas ${plan.icon} text-${plan.color}-600 text-xl"></i>
                                <h4 class="font-bold text-slate-800">${plan.plan}</h4>
                            </div>
                            <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full font-bold">${plan.status}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                <div class="space-y-3">
                    ${[
                        { training: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', date: '2026-01-28', participants: 45 },
                        { training: 'Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', date: '2026-02-05', participants: 20 },
                        { training: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚', date: '2026-02-15', participants: 30 }
                    ].map(tr => `
                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-calendar-alt text-blue-600"></i>
                                <div>
                                    <p class="font-bold text-slate-800">${tr.training}</p>
                                    <p class="text-sm text-slate-600">${tr.participants} Ù…Ø´Ø§Ø±Ùƒ</p>
                                </div>
                            </div>
                            <span class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">${tr.date}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>`;
    };

    // Sales Management Render Functions
    const renderCRM = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-users-cog"></i>
                    Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ CRM
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ±Ø­Ù„Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2,547</h3>
                    <p class="text-sm text-green-600 mt-1">+12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-user-check text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,823</h3>
                    <p class="text-sm text-slate-600 mt-1">71.6% Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙˆÙ†</span>
                        <i class="fas fa-user-clock text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">456</h3>
                    <p class="text-sm text-orange-600 mt-1">ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù…ØªØ§Ø¨Ø¹Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</span>
                        <i class="fas fa-chart-line text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34.5%</h3>
                    <p class="text-sm text-green-600 mt-1">+5.2% ØªØ­Ø³Ù†</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                    <div class="space-y-3">
                        ${[
                            { stage: 'Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙˆÙ†', count: 456, color: 'yellow', percent: 18 },
                            { stage: 'ØªÙˆØ§ØµÙ„ Ø£ÙˆÙ„ÙŠ', count: 234, color: 'blue', percent: 9 },
                            { stage: 'Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…Ù‚Ø¯Ù…', count: 189, color: 'purple', percent: 7 },
                            { stage: 'ØªÙØ§ÙˆØ¶', count: 145, color: 'orange', percent: 6 },
                            { stage: 'Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†', count: 1823, color: 'green', percent: 72 }
                        ].map(stage => `
                            <div>
                                <div class="flex justify-between mb-2">
                                    <span class="font-bold text-slate-700">${stage.stage}</span>
                                    <span class="text-slate-600">${stage.count} Ø¹Ù…ÙŠÙ„ (${stage.percent}%)</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-3">
                                    <div class="bg-${stage.color}-600 h-3 rounded-full transition-all" style="width: ${stage.percent}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ù‡Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø­Ø³Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª)</h3>
                    <div class="space-y-3">
                        ${[
                            { name: 'Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„ØªØ¬Ø§Ø±Ø©', revenue: '$245,000', status: 'VIP', color: 'gold' },
                            { name: 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø£Ù…Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©', revenue: '$189,000', status: 'VIP', color: 'gold' },
                            { name: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªÙ…ÙŠØ² Ù„Ù„Ø£Ø¹Ù…Ø§Ù„', revenue: '$156,000', status: 'Premium', color: 'blue' },
                            { name: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©', revenue: '$134,000', status: 'Premium', color: 'blue' },
                            { name: 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ·ÙˆÙŠØ±', revenue: '$98,000', status: 'Standard', color: 'green' }
                        ].map((customer, i) => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${customer.name}</p>
                                        <p class="text-sm text-slate-600">${customer.revenue}</p>
                                    </div>
                                </div>
                                <span class="text-xs px-3 py-1 bg-${customer.color === 'gold' ? 'yellow' : customer.color}-100 text-${customer.color === 'gold' ? 'yellow' : customer.color}-700 rounded-full font-bold">
                                    ${customer.status}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-user-plus text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ ÙØ±ØµØ© Ø¨ÙŠØ¹', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-bullseye text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ÙØ±ØµØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© Ø§Ø¬ØªÙ…Ø§Ø¹', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-plus text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ø¬ØªÙ…Ø§Ø¹</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'success')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderSalesOperations = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-handshake"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹
                </h2>
                <p class="mt-2 opacity-90">Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„ØµÙÙ‚Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØµÙÙ‚Ø§Øª Ù…ÙØªÙˆØ­Ø©</span>
                        <i class="fas fa-briefcase text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠÙ…Ø© $1.2M</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØµÙÙ‚Ø§Øª Ù…ØºÙ„Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠÙ…Ø© $145K</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</span>
                        <i class="fas fa-percentage text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">42%</h3>
                    <p class="text-sm text-green-600 mt-1">+8% ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©</span>
                        <i class="fas fa-dollar-sign text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$15.7K</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù„ÙƒÙ„ ØµÙÙ‚Ø©</p>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                <div class="grid grid-cols-5 gap-3">
                    ${[
                        { stage: 'ØªØ£Ù‡ÙŠÙ„', count: 24, value: '$180K', color: 'yellow' },
                        { stage: 'Ø¹Ø±Ø¶', count: 18, value: '$320K', color: 'blue' },
                        { stage: 'Ù…ÙØ§ÙˆØ¶Ø©', count: 15, value: '$450K', color: 'purple' },
                        { stage: 'Ø§Ù‚ØªØ±Ø§Ø­', count: 12, value: '$280K', color: 'indigo' },
                        { stage: 'Ø¥ØºÙ„Ø§Ù‚', count: 18, value: '$540K', color: 'green' }
                    ].map(stage => `
                        <div class="p-4 bg-${stage.color}-50 border-2 border-${stage.color}-200 rounded-lg">
                            <div class="text-center">
                                <h4 class="font-bold text-${stage.color}-700 mb-2">${stage.stage}</h4>
                                <div class="text-3xl font-black text-${stage.color}-600 mb-1">${stage.count}</div>
                                <div class="text-sm text-slate-600">${stage.value}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø¹Ù„Ù‰ Ù…Ù†Ø¯ÙˆØ¨ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', deals: 23, value: '$340K', achievement: 142 },
                            { name: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', deals: 19, value: '$285K', achievement: 128 },
                            { name: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', deals: 17, value: '$256K', achievement: 115 },
                            { name: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', deals: 15, value: '$223K', achievement: 108 }
                        ].map((rep, i) => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 ${i === 0 ? 'bg-yellow-500' : i === 1 ? 'bg-gray-400' : i === 2 ? 'bg-amber-700' : 'bg-slate-300'} rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${rep.name}</p>
                                        <p class="text-sm text-slate-600">${rep.deals} ØµÙÙ‚Ø© â€¢ ${rep.value}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-green-600">${rep.achievement}%</div>
                                    <div class="text-xs text-slate-600">Ù…Ù† Ø§Ù„Ù‡Ø¯Ù</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { activity: 'Ø¥ØºÙ„Ø§Ù‚ ØµÙÙ‚Ø© Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­', time: 'Ù…Ù†Ø° 15 Ø¯Ù‚ÙŠÙ‚Ø©', icon: 'fa-check-circle', color: 'green' },
                            { activity: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø¹ Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªÙ…ÙŠØ²', time: 'Ù…Ù†Ø° Ø³Ø§Ø¹Ø©', icon: 'fa-handshake', color: 'blue' },
                            { activity: 'Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø±Ø¶ Ø³Ø¹Ø±', time: 'Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†', icon: 'fa-file-invoice', color: 'purple' },
                            { activity: 'Ù…ÙƒØ§Ù„Ù…Ø© Ù…ØªØ§Ø¨Ø¹Ø©', time: 'Ù…Ù†Ø° 3 Ø³Ø§Ø¹Ø§Øª', icon: 'fa-phone', color: 'orange' }
                        ].map(act => `
                            <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                                <div class="w-10 h-10 bg-${act.color}-100 rounded-full flex items-center justify-center">
                                    <i class="fas ${act.icon} text-${act.color}-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-slate-800">${act.activity}</p>
                                    <p class="text-sm text-slate-600">${act.time}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>`;
    };

    const renderPOS = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-cash-register"></i>
                    Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„ØªØ´Ø§Ø¨ÙƒÙŠ (POS)
                </h2>
                <p class="mt-2 opacity-90">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ù…ØªØ§Ø¬Ø±</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-cash-register text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$12,450</h3>
                    <p class="text-sm text-green-600 mt-1">+18% Ø¹Ù† Ø§Ù„Ø£Ù…Ø³</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</span>
                        <i class="fas fa-receipt text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
                        <i class="fas fa-dollar-sign text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$79.8</h3>
                    <p class="text-sm text-green-600 mt-1">+5.2% ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ù‚Ø§Ø· Ø¨ÙŠØ¹ Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-store text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8/10</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù…ØªØ§Ø¬Ø± Ù…ÙØªÙˆØ­Ø©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø¯Ø§Ø¡ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹</h3>
                    <div class="space-y-3">
                        ${[
                            { store: 'Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', sales: '$4,250', transactions: 52, status: 'Ù†Ø´Ø·' },
                            { store: 'ÙØ±Ø¹ Ø§Ù„Ù…ÙˆÙ„', sales: '$3,890', transactions: 45, status: 'Ù†Ø´Ø·' },
                            { store: 'ÙØ±Ø¹ Ø§Ù„Ù…Ø·Ø§Ø±', sales: '$2,100', transactions: 28, status: 'Ù†Ø´Ø·' },
                            { store: 'Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', sales: '$2,210', transactions: 31, status: 'Ù†Ø´Ø·' }
                        ].map(store => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-store text-purple-600 text-xl"></i>
                                    <div>
                                        <p class="font-bold text-slate-800">${store.store}</p>
                                        <p class="text-sm text-slate-600">${store.transactions} Ù…Ø¹Ø§Ù…Ù„Ø©</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-green-600">${store.sales}</div>
                                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">${store.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</h3>
                    <div class="space-y-4">
                        ${[
                            { method: 'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©', amount: '$6,780', percent: 54, color: 'blue' },
                            { method: 'Ù†Ù‚Ø¯ÙŠ', amount: '$3,450', percent: 28, color: 'green' },
                            { method: 'Ù…Ø­Ø§ÙØ¸ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', amount: '$1,890', percent: 15, color: 'purple' },
                            { method: 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ', amount: '$330', percent: 3, color: 'orange' }
                        ].map(method => `
                            <div>
                                <div class="flex justify-between mb-2">
                                    <span class="font-bold text-slate-700">${method.method}</span>
                                    <span class="text-slate-600">${method.amount} (${method.percent}%)</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-3">
                                    <div class="bg-${method.color}-600 h-3 rounded-full transition-all" style="width: ${method.percent}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ÙØªØ­ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('ÙØªØ­ Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-cash-register text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-tags text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderQuotesContracts = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-file-contract"></i>
                    Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ø±ÙˆØ¶ Ù…ÙØªÙˆØ­Ø©</span>
                        <i class="fas fa-file-alt text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠÙ…Ø© $890K</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù‚ÙˆØ¯ Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-file-signature text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">67</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠÙ…Ø© $2.3M</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶</span>
                        <i class="fas fa-check-double text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">45%</h3>
                    <p class="text-sm text-green-600 mt-1">+7% ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù‚ÙˆØ¯ ØªØ­ØªØ§Ø¬ ØªØ¬Ø¯ÙŠØ¯</span>
                        <i class="fas fa-exclamation-triangle text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-orange-600 mt-1">Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { client: 'Ø´Ø±ÙƒØ© Ø§Ù„ØªØ·ÙˆÙŠØ±', value: '$125,000', date: '2026-01-20', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: 'yellow' },
                            { client: 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù†Ø¬Ø§Ø­', value: '$89,500', date: '2026-01-19', status: 'Ù…Ù‚Ø¨ÙˆÙ„', color: 'green' },
                            { client: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù…Ù„', value: '$156,000', date: '2026-01-18', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙØ§ÙˆØ¶', color: 'blue' },
                            { client: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±', value: '$67,000', date: '2026-01-17', status: 'Ù…Ø±Ø³Ù„', color: 'purple' }
                        ].map(quote => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-file-invoice text-indigo-600 text-xl"></i>
                                    <div>
                                        <p class="font-bold text-slate-800">${quote.client}</p>
                                        <p class="text-sm text-slate-600">${quote.date}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-slate-800">${quote.value}</div>
                                    <span class="text-xs px-2 py-1 bg-${quote.color}-100 text-${quote.color}-700 rounded-full font-bold">${quote.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3>
                    <div class="space-y-4">
                        ${[
                            { type: 'Ø¹Ù‚ÙˆØ¯ Ø®Ø¯Ù…Ø§Øª', count: 28, value: '$1.2M', color: 'blue' },
                            { type: 'Ø¹Ù‚ÙˆØ¯ ØªÙˆØ±ÙŠØ¯', count: 23, value: '$780K', color: 'green' },
                            { type: 'Ø¹Ù‚ÙˆØ¯ ØµÙŠØ§Ù†Ø©', count: 12, value: '$245K', color: 'purple' },
                            { type: 'Ø¹Ù‚ÙˆØ¯ Ø§Ø³ØªØ´Ø§Ø±Ø§Øª', count: 4, value: '$95K', color: 'orange' }
                        ].map(contract => `
                            <div class="p-3 border-l-4 border-${contract.color}-500 bg-${contract.color}-50 rounded">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-slate-800">${contract.type}</p>
                                        <p class="text-sm text-slate-600">${contract.count} Ø¹Ù‚Ø¯ Ù†Ø´Ø·</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-${contract.color}-600">${contract.value}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition text-right">
                        <i class="fas fa-file-invoice text-indigo-600 ml-2"></i>
                        <span class="font-bold text-indigo-700">Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-file-signature text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-copy text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderCommissions = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-percentage"></i>
                    Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø³Ø§Ø¨ Ø¹Ù…ÙˆÙ„Ø§Øª ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (Ø§Ù„Ø´Ù‡Ø±)</span>
                        <i class="fas fa-money-bill-wave text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$45,680</h3>
                    <p class="text-sm text-green-600 mt-1">+12% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø³ØªØ­Ù‚Ø©</span>
                        <i class="fas fa-clock text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$12,340</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØµØ±Ù</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø¯ÙÙˆØ¹Ø©</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$33,340</h3>
                    <p class="text-sm text-green-600 mt-1">ØªÙ… Ø§Ù„ØµØ±Ù</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</span>
                        <i class="fas fa-chart-bar text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$2,135</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù„ÙƒÙ„ Ù…Ù†Ø¯ÙˆØ¨</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)</h3>
                    <div class="space-y-3">
                        ${[
                            { name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', sales: '$340,000', commission: '$8,500', percent: 2.5 },
                            { name: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', sales: '$285,000', commission: '$7,125', percent: 2.5 },
                            { name: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', sales: '$256,000', commission: '$6,400', percent: 2.5 },
                            { name: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', sales: '$223,000', commission: '$5,575', percent: 2.5 },
                            { name: 'Ø®Ø§Ù„Ø¯ ÙŠÙˆØ³Ù', sales: '$198,000', commission: '$4,950', percent: 2.5 }
                        ].map((rep, i) => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 ${i === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600' : i === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-500' : i === 2 ? 'bg-gradient-to-br from-amber-600 to-amber-800' : 'bg-gradient-to-br from-orange-400 to-red-500'} rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${rep.name}</p>
                                        <p class="text-sm text-slate-600">Ù…Ø¨ÙŠØ¹Ø§Øª: ${rep.sales}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-green-600">${rep.commission}</div>
                                    <div class="text-xs text-slate-600">${rep.percent}% Ø¹Ù…ÙˆÙ„Ø©</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</h3>
                    <div class="space-y-4">
                        ${[
                            { tier: 'Ù…Ø³ØªÙˆÙ‰ Ø£Ø³Ø§Ø³ÙŠ (0-100K)', rate: '2.0%', color: 'blue' },
                            { tier: 'Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙˆØ³Ø· (100K-250K)', rate: '2.5%', color: 'green' },
                            { tier: 'Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙ‚Ø¯Ù… (250K-500K)', rate: '3.0%', color: 'purple' },
                            { tier: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø®Ø¨Ø© (500K+)', rate: '3.5%', color: 'orange' }
                        ].map(tier => `
                            <div class="p-4 border-l-4 border-${tier.color}-500 bg-${tier.color}-50 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-slate-800">${tier.tier}</p>
                                    </div>
                                    <div class="text-2xl font-black text-${tier.color}-600">${tier.rate}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ù„Ù„ØµØ±Ù</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
                                <th class="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th>
                                <th class="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
                                <th class="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„ÙØªØ±Ø©</th>
                                <th class="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            ${[
                                { name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', sales: '$85,000', commission: '$2,125', period: 'ÙŠÙ†Ø§ÙŠØ± 2026' },
                                { name: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', sales: '$67,000', commission: '$1,675', period: 'ÙŠÙ†Ø§ÙŠØ± 2026' },
                                { name: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', sales: '$56,000', commission: '$1,400', period: 'ÙŠÙ†Ø§ÙŠØ± 2026' }
                            ].map(pay => `
                                <tr class="hover:bg-slate-50">
                                    <td class="px-4 py-3 font-bold text-slate-800">${pay.name}</td>
                                    <td class="px-4 py-3 text-slate-600">${pay.sales}</td>
                                    <td class="px-4 py-3 font-bold text-green-600">${pay.commission}</td>
                                    <td class="px-4 py-3 text-slate-600">${pay.period}</td>
                                    <td class="px-4 py-3">
                                        <button onclick="app.showToast('ØµØ±Ù Ø¹Ù…ÙˆÙ„Ø© ${pay.name}', 'success')" class="px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-bold">
                                            ØµØ±Ù
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>`;
    };

    const renderOrderTracking = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-shipping-fast"></i>
                    ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø´Ø­Ù†Ø§Øª
                </h2>
                <p class="mt-2 opacity-90">ØªØªØ¨Ø¹ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø´Ø­Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-box text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">142</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</span>
                        <i class="fas fa-truck text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">67</h3>
                    <p class="text-sm text-orange-600 mt-1">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">89</h3>
                    <p class="text-sm text-green-600 mt-1">Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯</span>
                        <i class="fas fa-clock text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94.5%</h3>
                    <p class="text-sm text-green-600 mt-1">Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²</p>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <div class="grid grid-cols-5 gap-3">
                    ${[
                        { status: 'Ø¬Ø¯ÙŠØ¯', count: 34, color: 'blue', icon: 'fa-inbox' },
                        { status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', count: 56, color: 'yellow', icon: 'fa-boxes' },
                        { status: 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø´Ø­Ù†', count: 52, color: 'purple', icon: 'fa-box-open' },
                        { status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†', count: 67, color: 'orange', icon: 'fa-shipping-fast' },
                        { status: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', count: 89, color: 'green', icon: 'fa-check-double' }
                    ].map(status => `
                        <div class="p-4 bg-${status.color}-50 border-2 border-${status.color}-200 rounded-lg text-center">
                            <i class="fas ${status.icon} text-3xl text-${status.color}-600 mb-2"></i>
                            <div class="text-2xl font-black text-${status.color}-600">${status.count}</div>
                            <div class="text-sm font-bold text-slate-700 mt-1">${status.status}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø´Ø­Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { order: 'ORD-2026-1234', customer: 'Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­', status: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', eta: '3 Ø³Ø§Ø¹Ø§Øª', color: 'blue' },
                            { order: 'ORD-2026-1235', customer: 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªÙ…ÙŠØ²', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„', eta: 'ØºØ¯Ø§Ù‹', color: 'orange' },
                            { order: 'ORD-2026-1236', customer: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù…Ù„', status: 'ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹', eta: 'ÙŠÙˆÙ…ÙŠÙ†', color: 'purple' },
                            { order: 'ORD-2026-1237', customer: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²', eta: '3 Ø£ÙŠØ§Ù…', color: 'yellow' }
                        ].map(shipment => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${shipment.order}</p>
                                        <p class="text-sm text-slate-600">${shipment.customer}</p>
                                    </div>
                                    <button onclick="app.showToast('ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø© ${shipment.order}', 'info')" class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                                        ØªØªØ¨Ø¹
                                    </button>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="px-2 py-1 bg-${shipment.color}-100 text-${shipment.color}-700 rounded-full font-bold">${shipment.status}</span>
                                    <span class="text-slate-600"><i class="fas fa-clock ml-1"></i>${shipment.eta}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø´Ø­Ù†</h3>
                    <div class="space-y-3">
                        ${[
                            { company: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø³Ø±ÙŠØ¹', active: 23, delivered: 156, rating: 4.8 },
                            { company: 'Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ', active: 18, delivered: 134, rating: 4.6 },
                            { company: 'Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø¢Ù…Ù†', active: 15, delivered: 98, rating: 4.5 },
                            { company: 'Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', active: 11, delivered: 87, rating: 4.7 }
                        ].map((carrier, i) => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-teal-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-truck text-teal-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${carrier.company}</p>
                                        <p class="text-sm text-slate-600">${carrier.active} Ù†Ø´Ø· â€¢ ${carrier.delivered} Ù…ÙƒØªÙ…Ù„</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">â˜…</span>
                                        <span class="font-bold text-slate-800">${carrier.rating}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨</h3>
                <div class="flex gap-3">
                    <input type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø´Ø­Ù†Ø©..." class="flex-1 px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                    <button onclick="app.showToast('Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨...', 'info')" class="px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition font-bold">
                        <i class="fas fa-search ml-2"></i>
                        Ø¨Ø­Ø«
                    </button>
                </div>
            </div>
        </div>`;
    };

    // Internet & Automation Render Functions
    const renderAIIntegration = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-brain"></i>
                    Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¯Ø®Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ ÙƒØ§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ù…Ø§Ø°Ø¬ Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-robot text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                    <p class="text-sm text-green-600 mt-1">+3 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¯Ù‚Ø© Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</span>
                        <i class="fas fa-chart-line text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94.7%</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ù‚Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¤ØªÙ…ØªØ©</span>
                        <i class="fas fa-cogs text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,234</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙˆÙ‚Øª Ù…ÙˆÙÙ‘Ø±</span>
                        <i class="fas fa-clock text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">456</h3>
                    <p class="text-sm text-orange-600 mt-1">Ø³Ø§Ø¹Ø©/Ø´Ù‡Ø±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                    <div class="space-y-3">
                        ${[
                            { name: 'Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', accuracy: 96.2, status: 'Ù†Ø´Ø·', color: 'green' },
                            { name: 'ØªØ­Ù„ÙŠÙ„ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', accuracy: 94.5, status: 'Ù†Ø´Ø·', color: 'green' },
                            { name: 'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', accuracy: 93.8, status: 'Ù†Ø´Ø·', color: 'green' },
                            { name: 'ÙƒØ´Ù Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„', accuracy: 98.1, status: 'Ù†Ø´Ø·', color: 'green' },
                            { name: 'ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', accuracy: 91.4, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨', color: 'yellow' }
                        ].map(model => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${model.name}</p>
                                    <span class="text-xs px-3 py-1 bg-${model.color}-100 text-${model.color}-700 rounded-full font-bold">${model.status}</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-slate-600">Ø¯Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</span>
                                    <span class="font-bold text-purple-600">${model.accuracy}%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¤ØªÙ…ØªØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { task: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª', count: 456, savings: '120 Ø³Ø§Ø¹Ø©' },
                            { task: 'Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', count: 789, savings: '95 Ø³Ø§Ø¹Ø©' },
                            { task: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', count: 1234, savings: '80 Ø³Ø§Ø¹Ø©' },
                            { task: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', count: 234, savings: '65 Ø³Ø§Ø¹Ø©' },
                            { task: 'ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', count: 567, savings: '96 Ø³Ø§Ø¹Ø©' }
                        ].map((auto, i) => `
                            <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${auto.task}</p>
                                        <p class="text-sm text-slate-600">${auto.count} Ø¹Ù…Ù„ÙŠØ©</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-bold text-green-600">${auto.savings}</p>
                                    <p class="text-xs text-slate-500">Ù…ÙˆÙØ±Ø©</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-graduation-cap text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ¯Ø±ÙŠØ¨</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚ÙŠÙŠÙ…</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderGovernance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-gray-700 to-slate-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-gavel"></i>
                    Ø§Ù„Ø­ÙˆÙƒÙ…Ø©
                </h2>
                <p class="mt-2 opacity-90">ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø§ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-file-contract text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">98.5%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                        <i class="fas fa-clipboard-check text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3</h3>
                    <p class="text-sm text-red-600 mt-1">ØªØ­ØªØ§Ø¬ Ø§Ù‡ØªÙ…Ø§Ù…</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø·Ø± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { framework: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (GDPR)', compliance: 100, status: 'Ù…Ù„ØªØ²Ù…', color: 'green' },
                            { framework: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ (ISO 27001)', compliance: 98, status: 'Ù…Ù„ØªØ²Ù…', color: 'green' },
                            { framework: 'Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ', compliance: 96, status: 'Ù…Ù„ØªØ²Ù…', color: 'green' },
                            { framework: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', compliance: 94, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: 'yellow' },
                            { framework: 'Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©', compliance: 92, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†', color: 'orange' }
                        ].map(fw => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${fw.framework}</p>
                                    <span class="text-xs px-3 py-1 bg-${fw.color}-100 text-${fw.color}-700 rounded-full font-bold">${fw.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-${fw.color}-600 h-2 rounded-full transition-all" style="width: ${fw.compliance}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${fw.compliance}% Ø§Ù…ØªØ«Ø§Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">ØªØ¯Ù‚ÙŠÙ‚Ø§Øª Ø­Ø¯ÙŠØ«Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { audit: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', date: '2026-01-15', result: 'Ù†Ø§Ø¬Ø­', score: 98 },
                            { audit: 'ÙØ­Øµ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø®ØµÙˆØµÙŠØ©', date: '2026-01-10', result: 'Ù†Ø§Ø¬Ø­', score: 96 },
                            { audit: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', date: '2026-01-05', result: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', score: 94 },
                            { audit: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', date: '2025-12-28', result: 'Ù†Ø§Ø¬Ø­', score: 100 }
                        ].map(audit => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${audit.audit}</p>
                                        <p class="text-sm text-slate-600">${audit.date}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-lg font-bold text-purple-600">${audit.score}%</p>
                                        <p class="text-xs text-slate-500">${audit.result}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© ØªØ¯Ù‚ÙŠÙ‚', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-check text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¬Ø¯ÙˆÙ„Ø© ØªØ¯Ù‚ÙŠÙ‚</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-pie text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderCompliance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-balance-scale"></i>
                    Ø§Ù„Ù…ÙˆØ§Ø¦Ù…Ø©
                </h2>
                <p class="mt-2 opacity-90">Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„Ø¯ÙˆÙ„ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-certificate text-teal-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">28</h3>
                    <p class="text-sm text-green-600 mt-1">+2 Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙˆØ§ÙÙ‚</span>
                        <i class="fas fa-check-double text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">97.8%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                        <i class="fas fa-award text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                    <p class="text-sm text-blue-600 mt-1">Ø³Ø§Ø±ÙŠØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</span>
                        <i class="fas fa-sync text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { standard: 'ISO 9001 - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', status: 'Ù†Ø´Ø·', expiry: '2026-12-31', color: 'green' },
                            { standard: 'ISO 27001 - Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', status: 'Ù†Ø´Ø·', expiry: '2026-08-15', color: 'green' },
                            { standard: 'GDPR - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', status: 'Ù†Ø´Ø·', expiry: 'Ø¯Ø§Ø¦Ù…', color: 'green' },
                            { standard: 'SOC 2 - Ø£Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯', expiry: '2026-02-28', color: 'orange' },
                            { standard: 'PCI DSS - Ø£Ù…Ù† Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹', status: 'Ù†Ø´Ø·', expiry: '2027-01-15', color: 'green' }
                        ].map(cert => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${cert.standard}</p>
                                    <span class="text-xs px-3 py-1 bg-${cert.color}-100 text-${cert.color}-700 rounded-full font-bold">${cert.status}</span>
                                </div>
                                <p class="text-sm text-slate-600">ØµØ§Ù„Ø­Ø© Ø­ØªÙ‰: ${cert.expiry}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚</h3>
                    <div class="space-y-3">
                        ${[
                            { area: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', score: 98, level: 'Ù…Ù…ØªØ§Ø²' },
                            { area: 'Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', score: 96, level: 'Ù…Ù…ØªØ§Ø²' },
                            { area: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', score: 97, level: 'Ù…Ù…ØªØ§Ø²' },
                            { area: 'Ø§Ù„Ø®ØµÙˆØµÙŠØ©', score: 95, level: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' },
                            { area: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', score: 94, level: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' }
                        ].map(assessment => `
                            <div class="p-3 bg-teal-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${assessment.area}</p>
                                    <span class="font-bold text-teal-600">${assessment.score}%</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-teal-600 h-2 rounded-full transition-all" style="width: ${assessment.score}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${assessment.level}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-teal-50 hover:bg-teal-100 rounded-lg transition text-right">
                        <i class="fas fa-certificate text-teal-600 ml-2"></i>
                        <span class="font-bold text-teal-700">Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© ØªÙ‚ÙŠÙŠÙ…', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-clipboard-list text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªÙ‚ÙŠÙŠÙ…</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ§ÙÙ‚', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderIOT = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-network-wired"></i>
                    Ø§Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ (IoT)
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØµÙ„Ø© ÙˆØ§Ù„Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØµÙ„Ø©</span>
                        <i class="fas fa-microchip text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">347</h3>
                    <p class="text-sm text-green-600 mt-1">+23 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ø´Ø·Ø© Ø§Ù„Ø¢Ù†</span>
                        <i class="fas fa-signal text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">328</h3>
                    <p class="text-sm text-slate-600 mt-1">94.5% Ù…ØªØµÙ„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª/ÙŠÙˆÙ…</span>
                        <i class="fas fa-database text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1.2M</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…Ù„ÙŠÙˆÙ†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                        <i class="fas fa-bell text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">7</h3>
                    <p class="text-sm text-orange-600 mt-1">ØªØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">ÙØ¦Ø§Øª Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { category: 'Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©', count: 89, status: 'Ù†Ø´Ø·', color: 'red' },
                            { category: 'ÙƒØ§Ù…ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', count: 45, status: 'Ù†Ø´Ø·', color: 'blue' },
                            { category: 'Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªØªØ¨Ø¹', count: 67, status: 'Ù†Ø´Ø·', color: 'green' },
                            { category: 'Ø¹Ø¯Ø§Ø¯Ø§Øª Ø°ÙƒÙŠØ©', count: 78, status: 'Ù†Ø´Ø·', color: 'purple' },
                            { category: 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ­ÙƒÙ…', count: 68, status: 'Ù†Ø´Ø·', color: 'orange' }
                        ].map(device => `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-${device.color}-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-microchip text-${device.color}-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${device.category}</p>
                                        <p class="text-sm text-slate-600">${device.count} Ø¬Ù‡Ø§Ø²</p>
                                    </div>
                                </div>
                                <span class="text-xs px-3 py-1 bg-green-100 text-green-700 rounded-full font-bold">${device.status}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { sensor: 'Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©', value: '234.5 kWh', trend: '+2.3%', color: 'green' },
                            { sensor: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', value: '22.5Â°C', trend: '+0.5Â°C', color: 'blue' },
                            { sensor: 'Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡', value: '145.2 L', trend: '-1.2%', color: 'cyan' },
                            { sensor: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø·ÙˆØ¨Ø©', value: '45%', trend: '+3%', color: 'purple' },
                            { sensor: 'Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡', value: 'Ø¬ÙŠØ¯', trend: 'Ù…Ø³ØªÙ‚Ø±', color: 'green' }
                        ].map(reading => `
                            <div class="p-3 bg-${reading.color}-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${reading.sensor}</p>
                                    <span class="text-xs text-slate-600">${reading.trend}</span>
                                </div>
                                <p class="text-2xl font-black text-${reading.color}-600">${reading.value}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-line text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ù…Ø±Ø§Ù‚Ø¨Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-chart-line text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderELearning = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-graduation-cap"></i>
                    Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                </h2>
                <p class="mt-2 opacity-90">Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
                        <i class="fas fa-book text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                    <p class="text-sm text-green-600 mt-1">+12 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2,847</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªØ¯Ø±Ø¨</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</span>
                        <i class="fas fa-check-circle text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">78.5%</h3>
                    <p class="text-sm text-green-600 mt-1">+5% ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</span>
                        <i class="fas fa-certificate text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,234</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø´Ù‡Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { course: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©', students: 456, progress: 85, rating: 4.8 },
                            { course: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø£Ø¹Ù…Ø§Ù„', students: 389, progress: 78, rating: 4.9 },
                            { course: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…', students: 345, progress: 82, rating: 4.7 },
                            { course: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ', students: 298, progress: 90, rating: 4.6 },
                            { course: 'Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©', students: 267, progress: 75, rating: 4.8 }
                        ].map((course, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white font-bold">
                                            ${i + 1}
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${course.course}</p>
                                            <p class="text-sm text-slate-600">${course.students} Ù…ØªØ¯Ø±Ø¨</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="flex items-center gap-1">
                                            <span class="text-yellow-500">â˜…</span>
                                            <span class="font-bold text-slate-800">${course.rating}</span>
                                        </div>
                                        <p class="text-xs text-slate-500">${course.progress}% Ù…ÙƒØªÙ…Ù„</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                    <div class="space-y-3">
                        ${[
                            { metric: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±', value: '92.3%', trend: '+2.1%', color: 'green' },
                            { metric: 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª', value: '85.7%', trend: '+3.5%', color: 'blue' },
                            { metric: 'ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ù„Ù…/ÙŠÙˆÙ…ÙŠØ§Ù‹', value: '2.5 Ø³Ø§Ø¹Ø©', trend: '+0.3', color: 'purple' },
                            { metric: 'Ø§Ù„ØªÙØ§Ø¹Ù„ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯ÙŠØ§Øª', value: '78%', trend: '+5%', color: 'orange' },
                            { metric: 'Ø±Ø¶Ø§ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†', value: '4.7/5', trend: 'Ù…Ø³ØªÙ‚Ø±', color: 'green' }
                        ].map(metric => `
                            <div class="p-3 bg-${metric.color}-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${metric.metric}</p>
                                    <span class="text-xs text-slate-600">${metric.trend}</span>
                                </div>
                                <p class="text-2xl font-black text-${metric.color}-600">${metric.value}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø¥ØµØ¯Ø§Ø± Ø´Ù‡Ø§Ø¯Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-certificate text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderForum = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-comments"></i>
                    Ø§Ù„Ù…Ù†ØªØ¯Ù‰
                </h2>
                <p class="mt-2 opacity-90">Ù…Ù†ØµØ© ØªÙˆØ§ØµÙ„ ÙˆØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØ§Ù„Ø®Ø¨Ø±Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-users text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3,456</h3>
                    <p class="text-sm text-green-600 mt-1">+234 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª</span>
                        <i class="fas fa-comments text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">789</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù†Ø´Ø·Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-comment text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">456</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ø´Ø§Ø±ÙƒØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„</span>
                        <i class="fas fa-heart text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87.5%</h3>
                    <p class="text-sm text-red-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹</h3>
                    <div class="space-y-3">
                        ${[
                            { topic: 'Ø£ÙØ¶Ù„ Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ', replies: 234, views: 1234, author: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯' },
                            { topic: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ 2026', replies: 189, views: 987, author: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ' },
                            { topic: 'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ', replies: 156, views: 876, author: 'Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…' },
                            { topic: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¥Ø­ØªØ±Ø§ÙÙŠØ©', replies: 145, views: 765, author: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†' },
                            { topic: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©', replies: 134, views: 654, author: 'Ù…Ø­Ù…ÙˆØ¯ Ø£Ø­Ù…Ø¯' }
                        ].map((topic, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                                        ${i + 1}
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 mb-1">${topic.topic}</p>
                                        <div class="flex items-center gap-4 text-sm text-slate-600">
                                            <span><i class="fas fa-user ml-1"></i>${topic.author}</span>
                                            <span><i class="fas fa-comments ml-1"></i>${topic.replies}</span>
                                            <span><i class="fas fa-eye ml-1"></i>${topic.views}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¯Ù‰</h3>
                    <div class="space-y-3">
                        ${[
                            { category: 'Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ', topics: 156, posts: 2340, icon: 'fa-robot' },
                            { category: 'Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©', topics: 134, posts: 1890, icon: 'fa-briefcase' },
                            { category: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', topics: 98, posts: 1456, icon: 'fa-chart-line' },
                            { category: 'Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ', topics: 87, posts: 1234, icon: 'fa-graduation-cap' },
                            { category: 'Ø¹Ø§Ù…', topics: 234, posts: 3456, icon: 'fa-comments' }
                        ].map(cat => `
                            <div class="p-3 bg-purple-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white">
                                            <i class="fas ${cat.icon}"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${cat.category}</p>
                                            <p class="text-sm text-slate-600">${cat.topics} Ù…ÙˆØ¶ÙˆØ¹ â€¢ ${cat.posts} Ù…Ø´Ø§Ø±ÙƒØ©</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-left text-slate-400"></i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯Ù‰', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-search text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¨Ø­Ø«</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-users text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¯Ù‰', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderEtiquette = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-rose-600 to-pink-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-user-tie"></i>
                    Ø§Ù„Ø¥ØªÙŠÙƒÙŠØª ÙˆØ¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù‡Ù†ÙŠ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-file-contract text-rose-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">23</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">96.8%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¯ÙˆØ±Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ©</span>
                        <i class="fas fa-graduation-cap text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªØ§Ø­Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</span>
                        <i class="fas fa-award text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">456</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
                    <div class="space-y-3">
                        ${[
                            { protocol: 'Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©', completion: 98, status: 'Ù†Ø´Ø·' },
                            { protocol: 'Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª', completion: 96, status: 'Ù†Ø´Ø·' },
                            { protocol: 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯', completion: 97, status: 'Ù†Ø´Ø·' },
                            { protocol: 'Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ù‡Ø§ØªÙÙŠØ©', completion: 95, status: 'Ù†Ø´Ø·' },
                            { protocol: 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', completion: 99, status: 'Ù†Ø´Ø·' }
                        ].map(proto => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${proto.protocol}</p>
                                    <span class="text-xs px-3 py-1 bg-green-100 text-green-700 rounded-full font-bold">${proto.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-rose-600 h-2 rounded-full transition-all" style="width: ${proto.completion}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${proto.completion}% Ø§Ù„ØªØ²Ø§Ù…</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { course: 'Ø¥ØªÙŠÙƒÙŠØª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ', students: 234, rating: 4.9 },
                            { course: 'ÙÙ† Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù‡Ù†ÙŠ', students: 189, rating: 4.8 },
                            { course: 'Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø©', students: 156, rating: 4.7 },
                            { course: 'Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶', students: 145, rating: 4.8 },
                            { course: 'Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ VIP ÙˆØ§Ù„Ø´Ø®ØµÙŠØ§Øª', students: 123, rating: 4.9 }
                        ].map((course, i) => `
                            <div class="flex items-center justify-between p-3 bg-rose-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-rose-600 rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${course.course}</p>
                                        <p class="text-sm text-slate-600">${course.students} Ù…ØªØ¯Ø±Ø¨</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">â˜…</span>
                                        <span class="font-bold text-slate-800">${course.rating}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-rose-50 hover:bg-rose-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-rose-600 ml-2"></i>
                        <span class="font-bold text-rose-700">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¯ÙˆØ±Ø©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-user-plus text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ³Ø¬ÙŠÙ„</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-line text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥ØªÙŠÙƒÙŠØª', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-book text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø§Ù„Ø¯Ù„ÙŠÙ„</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderKnowledge = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-amber-600 to-yellow-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-lightbulb"></i>
                    Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø±ÙØ©</span>
                        <i class="fas fa-database text-amber-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-green-600 mt-1">+5 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</span>
                        <i class="fas fa-file-alt text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,234</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…Ù‚Ø§Ù„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©</span>
                        <i class="fas fa-chart-pie text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">89</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span>
                        <i class="fas fa-users text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94.2%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù†Ø´Ø·</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { kb: 'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ', articles: 234, category: 'Ø¹Ù…Ù„ÙŠØ§Øª', color: 'blue' },
                            { kb: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', articles: 189, category: 'Ø¥Ø¯Ø§Ø±ÙŠ', color: 'purple' },
                            { kb: 'Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©', articles: 456, category: 'Ø¯Ø¹Ù…', color: 'green' },
                            { kb: 'Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª', articles: 178, category: 'ØªØ·ÙˆÙŠØ±', color: 'orange' },
                            { kb: 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚Ù†ÙŠØ©', articles: 156, category: 'ØªÙ‚Ù†ÙŠ', color: 'red' }
                        ].map((kb, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-${kb.color}-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-book text-${kb.color}-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${kb.kb}</p>
                                            <p class="text-sm text-slate-600">${kb.articles} Ù…Ù‚Ø§Ù„ â€¢ ${kb.category}</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-left text-slate-400"></i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„</h3>
                    <div class="space-y-3">
                        ${[
                            { dashboard: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', users: 456, updates: 'ÙŠÙˆÙ…ÙŠ', icon: 'fa-chart-line' },
                            { dashboard: 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', users: 234, updates: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', icon: 'fa-users' },
                            { dashboard: 'Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ', users: 189, updates: 'Ø´Ù‡Ø±ÙŠ', icon: 'fa-dollar-sign' },
                            { dashboard: 'Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', users: 345, updates: 'ÙŠÙˆÙ…ÙŠ', icon: 'fa-smile' },
                            { dashboard: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', users: 278, updates: 'ÙŠÙˆÙ…ÙŠ', icon: 'fa-cogs' }
                        ].map((dash, i) => `
                            <div class="p-3 bg-amber-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-amber-600 rounded-full flex items-center justify-center text-white">
                                            <i class="fas ${dash.icon}"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${dash.dashboard}</p>
                                            <p class="text-sm text-slate-600">${dash.users} Ù…Ø³ØªØ®Ø¯Ù… â€¢ ØªØ­Ø¯ÙŠØ« ${dash.updates}</p>
                                        </div>
                                    </div>
                                    <button onclick="app.showToast('ÙØªØ­ ${dash.dashboard}', 'info')" class="px-3 py-1 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition text-sm">
                                        Ø¹Ø±Ø¶
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-amber-50 hover:bg-amber-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-amber-600 ml-2"></i>
                        <span class="font-bold text-amber-700">Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ÙŠ', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙØ©', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-search text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø¨Ø­Ø«</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderIntellectualProperty = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-violet-600 to-purple-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-copyright"></i>
                    Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">ÙˆØ­Ù‚ÙˆÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø¨Ø±Ø§Ø¡Ø§Øª ÙˆØ§Ù„ØªØµØ§Ù…ÙŠÙ…</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</span>
                        <i class="fas fa-registered text-violet-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                    <p class="text-sm text-green-600 mt-1">+3 Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¨Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ø¹</span>
                        <i class="fas fa-lightbulb text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù†Ø´Ø·Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                        <i class="fas fa-shield-alt text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">89</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…Ø­Ù…ÙŠØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</span>
                        <i class="fas fa-sync text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">5</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { trademark: 'NAIOSHÂ® - Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', status: 'Ù†Ø´Ø·Ø©', expiry: '2028-12-31', class: 'Ø®Ø¯Ù…Ø§Øª ØªÙ‚Ù†ÙŠØ©' },
                            { trademark: 'NAIOSH ERPâ„¢', status: 'Ù†Ø´Ø·Ø©', expiry: '2027-08-15', class: 'Ø¨Ø±Ù…Ø¬ÙŠØ§Øª' },
                            { trademark: 'Smart ManagementÂ©', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯', expiry: '2026-06-30', class: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª' },
                            { trademark: 'Digital SolutionsÂ®', status: 'Ù†Ø´Ø·Ø©', expiry: '2029-03-20', class: 'Ø®Ø¯Ù…Ø§Øª Ø±Ù‚Ù…ÙŠØ©' },
                            { trademark: 'Innovation Hubâ„¢', status: 'Ù†Ø´Ø·Ø©', expiry: '2027-11-10', class: 'ØªØ¯Ø±ÙŠØ¨' }
                        ].map((tm, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-violet-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-copyright text-violet-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${tm.trademark}</p>
                                            <p class="text-sm text-slate-600">${tm.class}</p>
                                        </div>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${tm.status === 'Ù†Ø´Ø·Ø©' ? 'green' : 'orange'}-100 text-${tm.status === 'Ù†Ø´Ø·Ø©' ? 'green' : 'orange'}-700 rounded-full font-bold">${tm.status}</span>
                                </div>
                                <p class="text-sm text-slate-600">ØµØ§Ù„Ø­Ø© Ø­ØªÙ‰: ${tm.expiry}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¨Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ø¹</h3>
                    <div class="space-y-3">
                        ${[
                            { patent: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø°ÙƒÙŠ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†', num: 'PAT-2024-001', status: 'Ù†Ø´Ø·' },
                            { patent: 'Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', num: 'PAT-2024-002', status: 'Ù†Ø´Ø·' },
                            { patent: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', num: 'PAT-2023-045', status: 'Ù†Ø´Ø·' },
                            { patent: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ', num: 'PAT-2025-012', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
                            { patent: 'Ù…Ù†ØµØ© IoT Ù„Ù„Ø£Ø¹Ù…Ø§Ù„', num: 'PAT-2025-023', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' }
                        ].map((patent, i) => `
                            <div class="p-3 bg-violet-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-violet-600 rounded-full flex items-center justify-center text-white font-bold">
                                            ${i + 1}
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${patent.patent}</p>
                                            <p class="text-sm text-slate-600">${patent.num}</p>
                                        </div>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${patent.status === 'Ù†Ø´Ø·' ? 'green' : 'yellow'}-100 text-${patent.status === 'Ù†Ø´Ø·' ? 'green' : 'yellow'}-700 rounded-full font-bold">${patent.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-violet-50 hover:bg-violet-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-violet-600 ml-2"></i>
                        <span class="font-bold text-violet-700">Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø¨Ø±Ø§Ø¡Ø© Ø§Ø®ØªØ±Ø§Ø¹', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-lightbulb text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø¨Ø±Ø§Ø¡Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„ÙƒÙŠØ©', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderVisitorChat = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-comment-dots"></i>
                    Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ø²ÙˆØ§Ø±
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± ÙˆÙƒÙŠÙ„ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø¯Ø¹Ù… ÙÙˆØ±ÙŠ Ø°ÙƒÙŠ 24/7</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-comments text-emerald-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-green-600 mt-1">Ø¬Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ÙŠÙˆÙ…</span>
                        <i class="fas fa-calendar-day text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">234</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…Ø­Ø§Ø¯Ø«Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¶Ø§</span>
                        <i class="fas fa-smile text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">96.8%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
                        <i class="fas fa-clock text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2.3s</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù…ØªÙˆØ³Ø·</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        ${[
                            { visitor: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', message: 'Ù…Ø§ Ù‡ÙŠ Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ', time: 'Ø§Ù„Ø¢Ù†', status: 'Ù†Ø´Ø·', type: 'AI' },
                            { visitor: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', message: 'Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¬Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¶ ØªÙˆØ¶ÙŠØ­ÙŠØŸ', time: '1 Ø¯Ù‚ÙŠÙ‚Ø©', status: 'Ù†Ø´Ø·', type: 'AI' },
                            { visitor: 'Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', message: 'ÙƒÙŠÙ Ø£Ù‚ÙˆÙ… Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ', time: '3 Ø¯Ù‚Ø§Ø¦Ù‚', status: 'Ù†Ø´Ø·', type: 'AI' },
                            { visitor: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', message: 'Ø£Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±', time: '5 Ø¯Ù‚Ø§Ø¦Ù‚', status: 'ØªØ­ÙˆÙŠÙ„', type: 'Human' },
                            { visitor: 'Ù…Ø­Ù…ÙˆØ¯ Ø£Ø­Ù…Ø¯', message: 'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±', time: '7 Ø¯Ù‚Ø§Ø¦Ù‚', status: 'Ù†Ø´Ø·', type: 'AI' }
                        ].map((chat, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition cursor-pointer border-r-4 border-${chat.type === 'AI' ? 'emerald' : 'blue'}-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-full flex items-center justify-center text-white">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${chat.visitor}</p>
                                            <p class="text-sm text-slate-600 truncate">${chat.message}</p>
                                        </div>
                                    </div>
                                    <div class="text-right flex flex-col items-end gap-1">
                                        <span class="text-xs px-2 py-1 bg-${chat.type === 'AI' ? 'emerald' : 'blue'}-100 text-${chat.type === 'AI' ? 'emerald' : 'blue'}-700 rounded-full font-bold">${chat.type}</span>
                                        <span class="text-xs text-slate-500">${chat.time}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</h3>
                    <div class="space-y-3">
                        ${[
                            { metric: 'Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ØªÙ… Ø­Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹', value: '87.5%', color: 'emerald', icon: 'fa-check-circle' },
                            { metric: 'Ø¯Ù‚Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª', value: '96.2%', color: 'blue', icon: 'fa-bullseye' },
                            { metric: 'Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø­ÙˆÙ„Ø© Ù„Ù„Ø¨Ø´Ø±', value: '12.5%', color: 'purple', icon: 'fa-exchange-alt' },
                            { metric: 'ÙˆÙ‚Øª Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ØªÙˆØ³Ø·', value: '45 Ø«Ø§Ù†ÙŠØ©', color: 'orange', icon: 'fa-stopwatch' },
                            { metric: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', value: '4.8/5', color: 'yellow', icon: 'fa-star' }
                        ].map(stat => `
                            <div class="p-3 bg-${stat.color}-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-${stat.color}-600 rounded-full flex items-center justify-center text-white">
                                            <i class="fas ${stat.icon}"></i>
                                        </div>
                                        <p class="font-bold text-slate-800">${stat.metric}</p>
                                    </div>
                                    <p class="text-xl font-black text-${stat.color}-600">${stat.value}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹</h3>
                    <div class="space-y-2">
                        ${[
                            { question: 'ÙƒÙŠÙ Ø£Ø¨Ø¯Ø£ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ', count: 234 },
                            { question: 'Ù…Ø§ Ù‡ÙŠ Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ', count: 189 },
                            { question: 'ÙƒÙŠÙ Ø£Ø¶ÙŠÙ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯ØŸ', count: 156 },
                            { question: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©ØŸ', count: 145 },
                            { question: 'ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ', count: 123 }
                        ].map((faq, i) => `
                            <div class="flex items-center justify-between p-2 bg-slate-50 rounded-lg hover:bg-slate-100 transition">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-bold text-slate-500">${i + 1}.</span>
                                    <p class="text-sm text-slate-700">${faq.question}</p>
                                </div>
                                <span class="text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full">${faq.count}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</h3>
                    <div class="space-y-3">
                        <div class="p-3 bg-slate-50 rounded-lg">
                            <label class="flex items-center justify-between cursor-pointer">
                                <span class="font-bold text-slate-700">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                                <input type="checkbox" checked class="toggle">
                            </label>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-lg">
                            <label class="flex items-center justify-between cursor-pointer">
                                <span class="font-bold text-slate-700">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¨Ø´Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©</span>
                                <input type="checkbox" checked class="toggle">
                            </label>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-lg">
                            <label class="flex items-center justify-between cursor-pointer">
                                <span class="font-bold text-slate-700">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ©</span>
                                <input type="checkbox" checked class="toggle">
                            </label>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-lg">
                            <label class="flex items-center justify-between cursor-pointer">
                                <span class="font-bold text-slate-700">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</span>
                                <input type="checkbox" checked class="toggle">
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª', 'info')" class="p-4 bg-emerald-50 hover:bg-emerald-100 rounded-lg transition text-right">
                        <i class="fas fa-comments text-emerald-600 ml-2"></i>
                        <span class="font-bold text-emerald-700">Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙˆÙƒÙŠÙ„', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-graduation-cap text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ¯Ø±ÙŠØ¨</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-line text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-cog text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    // Occupational Health & Safety Render Functions
    const renderOccupationalSafety = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-shield-alt"></i>
                    Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ø¨Ø±Ø§Ù…Ø¬ ÙˆÙ†Ø¸Ù… Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</span>
                        <i class="fas fa-exclamation-circle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3</h3>
                    <p class="text-sm text-green-600 mt-1">-75% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ø­ÙˆØ§Ø¯Ø«</span>
                        <i class="fas fa-calendar-check text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">127</h3>
                    <p class="text-sm text-green-600 mt-1">Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span>
                        <i class="fas fa-check-circle text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">98.5%</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                        <i class="fas fa-users text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">456</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…ÙˆØ¸Ù Ù…Ø¯Ø±Ø¨</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { program: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚', compliance: 100, status: 'Ù†Ø´Ø·', color: 'green' },
                            { program: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©', compliance: 98, status: 'Ù†Ø´Ø·', color: 'green' },
                            { program: 'Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©', compliance: 96, status: 'Ù†Ø´Ø·', color: 'green' },
                            { program: 'Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', compliance: 94, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«', color: 'yellow' },
                            { program: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©', compliance: 92, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†', color: 'orange' }
                        ].map(prog => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${prog.program}</p>
                                    <span class="text-xs px-3 py-1 bg-${prog.color}-100 text-${prog.color}-700 rounded-full font-bold">${prog.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-${prog.color}-600 h-2 rounded-full transition-all" style="width: ${prog.compliance}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${prog.compliance}% Ø§Ù…ØªØ«Ø§Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø­ÙˆØ§Ø¯Ø« ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { incident: 'Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¨Ø³ÙŠØ· - Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†', date: '2026-01-15', severity: 'Ù…Ù†Ø®ÙØ¶', action: 'ØªÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' },
                            { incident: 'ØªØ³Ø±Ø¨ ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ù…Ø­Ø¯ÙˆØ¯', date: '2026-01-10', severity: 'Ù…ØªÙˆØ³Ø·', action: 'ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©' },
                            { incident: 'ÙƒØ³Ø± ÙÙŠ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ©', date: '2026-01-05', severity: 'Ù…Ù†Ø®ÙØ¶', action: 'ØªÙ… Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„' }
                        ].map(inc => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${inc.incident}</p>
                                        <p class="text-sm text-slate-600">${inc.date}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs px-2 py-1 bg-${inc.severity === 'Ù…Ù†Ø®ÙØ¶' ? 'green' : 'yellow'}-100 text-${inc.severity === 'Ù…Ù†Ø®ÙØ¶' ? 'green' : 'yellow'}-700 rounded-full">${inc.severity}</span>
                                        <p class="text-xs text-slate-500 mt-1">${inc.action}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø«', 'info')" class="p-4 bg-red-50 hover:bg-red-100 rounded-lg transition text-right">
                        <i class="fas fa-exclamation-triangle text-red-600 ml-2"></i>
                        <span class="font-bold text-red-700">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø«</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© ØªØ¯Ø±ÙŠØ¨', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-plus text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ¯Ø±ÙŠØ¨ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ÙØ­Øµ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-tools text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ÙØ­Øµ</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderInternationalStandards = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-700 to-indigo-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-globe"></i>
                    Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</span>
                        <i class="fas fa-clipboard-check text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">23</h3>
                    <p class="text-sm text-green-600 mt-1">+3 Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙˆØ§ÙÙ‚</span>
                        <i class="fas fa-percentage text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">97.2%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©</span>
                        <i class="fas fa-search text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                        <i class="fas fa-award text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-orange-600 mt-1">Ø³Ø§Ø±ÙŠØ©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { standard: 'OSHA - Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©', compliance: 98, region: 'Ø¹Ø§Ù„Ù…ÙŠ' },
                            { standard: 'ILO - Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©', compliance: 96, region: 'Ø¹Ø§Ù„Ù…ÙŠ' },
                            { standard: 'BS OHSAS 18001 - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', compliance: 95, region: 'Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ' },
                            { standard: 'NFPA - Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚', compliance: 100, region: 'Ø£Ù…Ø±ÙŠÙƒÙŠ' },
                            { standard: 'EN Standards - Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ©', compliance: 94, region: 'Ø£ÙˆØ±ÙˆØ¨ÙŠ' }
                        ].map((std, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-certificate text-blue-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${std.standard}</p>
                                            <p class="text-sm text-slate-600">${std.region}</p>
                                        </div>
                                    </div>
                                    <span class="font-bold text-blue-600">${std.compliance}%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">ØªØ¯Ù‚ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚</h3>
                    <div class="space-y-3">
                        ${[
                            { audit: 'ØªØ¯Ù‚ÙŠÙ‚ OSHA Ø§Ù„Ø³Ù†ÙˆÙŠ', date: '2026-01-10', result: 'Ù†Ø§Ø¬Ø­', score: 98 },
                            { audit: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ILO', date: '2025-12-15', result: 'Ù†Ø§Ø¬Ø­', score: 96 },
                            { audit: 'ÙØ­Øµ OHSAS', date: '2025-11-20', result: 'Ù†Ø§Ø¬Ø­', score: 95 },
                            { audit: 'ØªÙ‚ÙŠÙŠÙ… NFPA', date: '2025-10-05', result: 'Ù…Ù…ØªØ§Ø²', score: 100 }
                        ].map(audit => `
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${audit.audit}</p>
                                        <p class="text-sm text-slate-600">${audit.date}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-lg font-bold text-blue-600">${audit.score}%</p>
                                        <p class="text-xs text-slate-500">${audit.result}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ ØªØ¯Ù‚ÙŠÙ‚', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-search text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ¯Ù‚ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-sync text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªØ­Ø¯ÙŠØ«</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ§ÙÙ‚', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-certificate text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderISOStandards = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-green-700 to-teal-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-certificate"></i>
                    Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§ÙŠØ²Ùˆ
                </h2>
                <p class="mt-2 opacity-90">Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙŠØ²Ùˆ ÙÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙŠØ²Ùˆ</span>
                        <i class="fas fa-award text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">7</h3>
                    <p class="text-sm text-green-600 mt-1">Ù†Ø´Ø·Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span>
                        <i class="fas fa-check-circle text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">99.1%</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</span>
                        <i class="fas fa-sync text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">2</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø³Ù†Ø©</span>
                        <i class="fas fa-clipboard-list text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">14</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙŠØ²Ùˆ Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { iso: 'ISO 45001:2018', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', expiry: '2026-12-31', status: 'Ù†Ø´Ø·' },
                            { iso: 'ISO 9001:2015', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©', expiry: '2027-06-30', status: 'Ù†Ø´Ø·' },
                            { iso: 'ISO 14001:2015', title: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©', expiry: '2026-09-15', status: 'Ù†Ø´Ø·' },
                            { iso: 'ISO 27001:2013', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', expiry: '2026-03-20', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯' },
                            { iso: 'ISO 50001:2018', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ù‚Ø©', expiry: '2027-01-10', status: 'Ù†Ø´Ø·' },
                            { iso: 'ISO 22000:2018', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¡', expiry: '2026-08-05', status: 'Ù†Ø´Ø·' },
                            { iso: 'ISO 31000:2018', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', expiry: '2026-05-15', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯' }
                        ].map((cert, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-certificate text-green-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${cert.iso}</p>
                                            <p class="text-sm text-slate-600">${cert.title}</p>
                                        </div>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${cert.status === 'Ù†Ø´Ø·' ? 'green' : 'orange'}-100 text-${cert.status === 'Ù†Ø´Ø·' ? 'green' : 'orange'}-700 rounded-full font-bold">${cert.status}</span>
                                </div>
                                <p class="text-sm text-slate-600 mt-2">ØµØ§Ù„Ø­Ø© Ø­ØªÙ‰: ${cert.expiry}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { type: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯Ø§Ø®Ù„ÙŠØ© ISO 45001', date: '2026-01-15', result: 'Ù†Ø§Ø¬Ø­', findings: 2 },
                            { type: 'ØªØ¯Ù‚ÙŠÙ‚ Ø®Ø§Ø±Ø¬ÙŠ ISO 9001', date: '2026-01-10', result: 'Ù†Ø§Ø¬Ø­', findings: 0 },
                            { type: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ISO 14001', date: '2025-12-20', result: 'Ù†Ø§Ø¬Ø­', findings: 1 },
                            { type: 'ØªØ¯Ù‚ÙŠÙ‚ ISO 27001', date: '2025-12-05', result: 'Ù†Ø§Ø¬Ø­', findings: 3 },
                            { type: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ISO 50001', date: '2025-11-15', result: 'Ù…Ù…ØªØ§Ø²', findings: 0 }
                        ].map(review => `
                            <div class="p-3 bg-green-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${review.type}</p>
                                        <p class="text-sm text-slate-600">${review.date}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">${review.result}</span>
                                        <p class="text-xs text-slate-500 mt-1">${review.findings} Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø±Ø§Ø¬Ø¹Ø©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-check text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ÙŠØ²Ùˆ', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderRiskManagement = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-red-700 to-pink-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-exclamation-triangle"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±
                </h2>
                <p class="mt-2 opacity-90">ØªØ­Ø¯ÙŠØ¯ ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
                        <i class="fas fa-list text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-slate-600 mt-1">Ù…Ø®Ø§Ø·Ø± Ù…Ø³Ø¬Ù„Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©</span>
                        <i class="fas fa-exclamation-circle text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">3</h3>
                    <p class="text-sm text-red-600 mt-1">ØªØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø®Ø§Ø·Ø± Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">38</h3>
                    <p class="text-sm text-green-600 mt-1">80.9% Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø´Ù‡Ø±</span>
                        <i class="fas fa-clipboard-check text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { risk: 'ØªØ³Ø±Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©', level: 'Ø¹Ø§Ù„ÙŠ', probability: 15, impact: 'ÙƒØ¨ÙŠØ±', color: 'red' },
                            { risk: 'Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©', level: 'Ù…ØªÙˆØ³Ø·', probability: 30, impact: 'Ù…ØªÙˆØ³Ø·', color: 'yellow' },
                            { risk: 'Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª', level: 'Ø¹Ø§Ù„ÙŠ', probability: 10, impact: 'ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹', color: 'red' },
                            { risk: 'Ø§Ù„Ø³Ù‚ÙˆØ· Ù…Ù† Ø§Ø±ØªÙØ§Ø¹Ø§Øª', level: 'Ù…ØªÙˆØ³Ø·', probability: 25, impact: 'Ù…ØªÙˆØ³Ø·', color: 'yellow' },
                            { risk: 'Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ø¶ÙˆØ¶Ø§Ø¡', level: 'Ù…Ù†Ø®ÙØ¶', probability: 50, impact: 'Ù‚Ù„ÙŠÙ„', color: 'green' }
                        ].map((risk, i) => `
                            <div class="p-3 bg-${risk.color}-50 border-r-4 border-${risk.color}-500 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${risk.risk}</p>
                                        <p class="text-sm text-slate-600">Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©: ${risk.probability}% â€¢ ØªØ£Ø«ÙŠØ±: ${risk.impact}</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${risk.color}-100 text-${risk.color}-700 rounded-full font-bold">${risk.level}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { action: 'ØªØ±ÙƒÙŠØ¨ Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªØ³Ø±Ø¨', risk: 'ØªØ³Ø±Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', progress: 75 },
                            { action: 'ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ù…Ø¹Ø¯Ø§Øª', risk: 'Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', status: 'Ù…ÙƒØªÙ…Ù„', progress: 100 },
                            { action: 'ØªØ­Ø¯ÙŠØ« Ù†Ø¸Ø§Ù… Ø¥Ø·ÙØ§Ø¡ Ø§Ù„Ø­Ø±ÙŠÙ‚', risk: 'Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚', status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', progress: 60 },
                            { action: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª', risk: 'Ø§Ù„Ø³Ù‚ÙˆØ·', status: 'Ù…Ø®Ø·Ø·', progress: 30 }
                        ].map(action => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${action.action}</p>
                                        <p class="text-sm text-slate-600">${action.risk}</p>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full">${action.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all" style="width: ${action.progress}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${action.progress}% Ù…ÙƒØªÙ…Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªØ³Ø¬ÙŠÙ„ Ø®Ø·Ø± Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-red-50 hover:bg-red-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-red-600 ml-2"></i>
                        <span class="font-bold text-red-700">Ø®Ø·Ø± Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'info')" class="p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition text-right">
                        <i class="fas fa-clipboard-list text-yellow-600 ml-2"></i>
                        <span class="font-bold text-yellow-700">ØªÙ‚ÙŠÙŠÙ…</span>
                    </button>
                    <button onclick="app.showToast('Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-tasks text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø®Ø·Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderConsulting = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-700 to-indigo-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-user-tie"></i>
                    Ø§Ù„Ø¥Ø³ØªØ´Ø§Ø±Ø§Øª
                </h2>
                <p class="mt-2 opacity-90">Ø®Ø¯Ù…Ø§Øª Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-briefcase text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">18</h3>
                    <p class="text-sm text-green-600 mt-1">+5 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ†</span>
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªØ®ØµØµ</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¶Ø§</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.9</h3>
                    <p class="text-sm text-yellow-600 mt-1">Ù…Ù† 5</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { service: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', projects: 45, rating: 4.9 },
                            { service: 'ØªØ·ÙˆÙŠØ± Ù†Ø¸Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ISO 45001)', projects: 32, rating: 4.8 },
                            { service: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', projects: 28, rating: 4.9 },
                            { service: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±', projects: 67, rating: 4.7 },
                            { service: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„', projects: 39, rating: 4.8 }
                        ].map((svc, i) => `
                            <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                        ${i + 1}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${svc.service}</p>
                                        <p class="text-sm text-slate-600">${svc.projects} Ù…Ø´Ø±ÙˆØ¹</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">â˜…</span>
                                        <span class="font-bold text-slate-800">${svc.rating}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ† Ø§Ù„Ù…ØªØ®ØµØµÙˆÙ†</h3>
                    <div class="space-y-3">
                        ${[
                            { name: 'Ø¯. Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', specialty: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©', projects: 23, experience: '15 Ø³Ù†Ø©' },
                            { name: 'Ù…. Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', specialty: 'Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', projects: 19, experience: '12 Ø³Ù†Ø©' },
                            { name: 'Ø¯. Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', specialty: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', projects: 21, experience: '18 Ø³Ù†Ø©' },
                            { name: 'Ù…. ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', specialty: 'Ù†Ø¸Ù… Ø§Ù„Ø¬ÙˆØ¯Ø©', projects: 17, experience: '10 Ø³Ù†ÙˆØ§Øª' }
                        ].map(consultant => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold">
                                        ${consultant.name.charAt(0)}
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800">${consultant.name}</p>
                                        <p class="text-sm text-slate-600">${consultant.specialty}</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mt-2">
                                    <span>${consultant.projects} Ù…Ø´Ø±ÙˆØ¹</span>
                                    <span>${consultant.experience} Ø®Ø¨Ø±Ø©</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø§Ø³ØªØ´Ø§Ø±Ø©', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø§Ø³ØªØ´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© Ø§Ø¬ØªÙ…Ø§Ø¹', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-check text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø§Ø¬ØªÙ…Ø§Ø¹</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-star text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚ÙŠÙŠÙ…</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ†', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-users text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ†</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderSpecializedCourses = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-cyan-700 to-blue-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-graduation-cap"></i>
                    Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ø¯ÙˆØ±Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
                        <i class="fas fa-book text-cyan-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                    <p class="text-sm text-green-600 mt-1">+6 Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">567</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªØ¯Ø±Ø¨</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">89.3%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</span>
                        <i class="fas fa-certificate text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">234</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø´Ù‡Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h3>
                    <div class="space-y-3">
                        ${[
                            { course: 'OSHA 30-Hour General Industry', students: 89, rating: 4.9, duration: '30 Ø³Ø§Ø¹Ø©' },
                            { course: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚', students: 76, rating: 4.8, duration: '16 Ø³Ø§Ø¹Ø©' },
                            { course: 'Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', students: 92, rating: 4.9, duration: '24 Ø³Ø§Ø¹Ø©' },
                            { course: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø±ØªÙØ¹Ø©', students: 54, rating: 4.7, duration: '12 Ø³Ø§Ø¹Ø©' },
                            { course: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©', students: 67, rating: 4.8, duration: '20 Ø³Ø§Ø¹Ø©' }
                        ].map((course, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                            ${i + 1}
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${course.course}</p>
                                            <p class="text-sm text-slate-600">${course.students} Ù…ØªØ¯Ø±Ø¨ â€¢ ${course.duration}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="flex items-center gap-1">
                                            <span class="text-yellow-500">â˜…</span>
                                            <span class="font-bold text-slate-800">${course.rating}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h3>
                    <div class="space-y-3">
                        ${[
                            { track: 'Ù…Ø³Ø§Ø± Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', courses: 8, duration: '120 Ø³Ø§Ø¹Ø©', level: 'Ù…ØªÙ‚Ø¯Ù…' },
                            { track: 'Ù…Ø³Ø§Ø± Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', courses: 6, duration: '90 Ø³Ø§Ø¹Ø©', level: 'Ù…ØªÙˆØ³Ø·' },
                            { track: 'Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ Ù„Ù„Ø³Ù„Ø§Ù…Ø©', courses: 10, duration: '150 Ø³Ø§Ø¹Ø©', level: 'Ø®Ø¨ÙŠØ±' },
                            { track: 'Ù…Ø³Ø§Ø± Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©', courses: 4, duration: '40 Ø³Ø§Ø¹Ø©', level: 'Ù…Ø¨ØªØ¯Ø¦' }
                        ].map((track, i) => `
                            <div class="p-3 bg-cyan-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${track.track}</p>
                                        <p class="text-sm text-slate-600">${track.courses} Ø¯ÙˆØ±Ø§Øª â€¢ ${track.duration}</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-cyan-100 text-cyan-700 rounded-full font-bold">${track.level}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªØµÙØ­ Ø§Ù„Ø¯ÙˆØ±Ø§Øª', 'info')" class="p-4 bg-cyan-50 hover:bg-cyan-100 rounded-lg transition text-right">
                        <i class="fas fa-search text-cyan-600 ml-2"></i>
                        <span class="font-bold text-cyan-700">ØªØµÙØ­</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¯ÙˆØ±Ø©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-user-plus text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">ØªØ³Ø¬ÙŠÙ„</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø¬Ø¯ÙˆÙ„ÙŠ</span>
                    </button>
                    <button onclick="app.showToast('Ø´Ù‡Ø§Ø¯Ø§ØªÙŠ', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-certificate text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø´Ù‡Ø§Ø¯Ø§ØªÙŠ</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderOHSEvaluation = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-700 to-green-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-clipboard-check"></i>
                    Ø§Ù„ØªÙ‚ÙŠÙŠÙ… - Ø´Ø±ÙƒØ§ØªØŒ Ù…ØµØ§Ù†Ø¹ØŒ Ù…Ø´Ø§Ø±ÙŠØ¹
                </h2>
                <p class="mt-2 opacity-90">ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…Ø©</span>
                        <i class="fas fa-building text-teal-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-green-600 mt-1">+8 Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87.5%</h3>
                    <p class="text-sm text-green-600 mt-1">+3.2% ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-tasks text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ØªÙˆØµÙŠØ§Øª Ù…ØªØ§Ø¨Ø¹Ø©</span>
                        <i class="fas fa-exclamation-circle text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">23</h3>
                    <p class="text-sm text-orange-600 mt-1">ØªØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { site: 'Ù…ØµÙ†Ø¹ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', type: 'Ù…ØµÙ†Ø¹', score: 92, date: '2026-01-15', status: 'Ù…Ù…ØªØ§Ø²' },
                            { site: 'Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ - Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©', type: 'Ù…Ø´Ø±ÙˆØ¹', score: 85, date: '2026-01-12', status: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' },
                            { site: 'Ø´Ø±ÙƒØ© Ø§Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©', type: 'Ø´Ø±ÙƒØ©', score: 78, date: '2026-01-08', status: 'Ø¬ÙŠØ¯' },
                            { site: 'Ù…ØµÙ†Ø¹ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØ§Ù„ØªØºÙ„ÙŠÙ', type: 'Ù…ØµÙ†Ø¹', score: 88, date: '2026-01-05', status: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' }
                        ].map((evaluation, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                            ${evaluation.score}
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${evaluation.site}</p>
                                            <p class="text-sm text-slate-600">${evaluation.type} â€¢ ${evaluation.date}</p>
                                        </div>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${evaluation.score >= 90 ? 'green' : evaluation.score >= 80 ? 'blue' : 'yellow'}-100 text-${evaluation.score >= 90 ? 'green' : evaluation.score >= 80 ? 'blue' : 'yellow'}-700 rounded-full font-bold">${evaluation.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                    <div class="space-y-3">
                        ${[
                            { criterion: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', weight: 25, score: 90 },
                            { criterion: 'Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©', weight: 20, score: 88 },
                            { criterion: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©', weight: 15, score: 85 },
                            { criterion: 'Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', weight: 15, score: 92 },
                            { criterion: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦', weight: 15, score: 87 },
                            { criterion: 'Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', weight: 10, score: 84 }
                        ].map(crit => `
                            <div class="p-3 bg-teal-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${crit.criterion}</p>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm text-slate-600">${crit.weight}%</span>
                                        <span class="font-bold text-teal-600">${crit.score}/100</span>
                                    </div>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-teal-600 h-2 rounded-full transition-all" style="width: ${crit.score}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-teal-50 hover:bg-teal-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-teal-600 ml-2"></i>
                        <span class="font-bold text-teal-700">ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© ØªÙ‚ÙŠÙŠÙ…', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-check text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¬Ø¯ÙˆÙ„Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-tasks text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø®Ø·Ø·</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderDataAnalysis = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-700 to-purple-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-bar"></i>
                    ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </h2>
                <p class="mt-2 opacity-90">ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                        <i class="fas fa-database text-indigo-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">24.5K</h3>
                    <p class="text-sm text-green-600 mt-1">+2.3K Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-chart-pie text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">18</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù„ÙˆØ­Ø§Øª ØªØ­ÙƒÙ…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¯Ù‚Ø©</span>
                        <i class="fas fa-bullseye text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">98.7%</h3>
                    <p class="text-sm text-green-600 mt-1">Ø¯Ù‚ÙŠÙ‚</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª</span>
                        <i class="fas fa-brain text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù†Ù…ÙˆØ°Ø¬ AI</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { dashboard: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', metrics: 15, users: 234, update: 'ÙŠÙˆÙ…ÙŠ' },
                            { dashboard: 'Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©', metrics: 12, users: 189, update: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ' },
                            { dashboard: 'Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨', metrics: 18, users: 156, update: 'Ø´Ù‡Ø±ÙŠ' },
                            { dashboard: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', metrics: 20, users: 198, update: 'ÙŠÙˆÙ…ÙŠ' },
                            { dashboard: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚', metrics: 14, users: 145, update: 'Ø´Ù‡Ø±ÙŠ' }
                        ].map((dash, i) => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-chart-line text-indigo-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${dash.dashboard}</p>
                                            <p class="text-sm text-slate-600">${dash.metrics} Ù…Ø¤Ø´Ø± â€¢ ${dash.users} Ù…Ø³ØªØ®Ø¯Ù…</p>
                                        </div>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full">${dash.update}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { analysis: 'Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø­ÙˆØ§Ø¯Ø« (AI)', accuracy: 94.5, type: 'ØªÙ†Ø¨Ø¤ÙŠ', icon: 'fa-brain' },
                            { analysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠØ©', accuracy: 92.1, type: 'ØªØ´Ø®ÙŠØµÙŠ', icon: 'fa-search' },
                            { analysis: 'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡', accuracy: 89.3, type: 'ØªÙˆØ¬ÙŠÙ‡ÙŠ', icon: 'fa-lightbulb' },
                            { analysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª', accuracy: 96.7, type: 'ÙˆØµÙÙŠ', icon: 'fa-chart-area' }
                        ].map((analysis, i) => `
                            <div class="p-3 bg-indigo-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center text-white">
                                            <i class="fas ${analysis.icon}"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${analysis.analysis}</p>
                                            <p class="text-sm text-slate-600">${analysis.type}</p>
                                        </div>
                                    </div>
                                    <span class="font-bold text-indigo-600">${analysis.accuracy}%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø¯Ø«</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­ÙˆØ§Ø¯Ø«</span>
                            <span class="font-bold text-green-600">1.2</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø´Ø¯Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø«</span>
                            <span class="font-bold text-blue-600">0.8</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¶Ø§Ø¦Ø¹Ø©</span>
                            <span class="font-bold text-orange-600">2.3</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø²Ù…Ù†ÙŠ</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
                            <span class="font-bold text-green-600">+12%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</span>
                            <span class="font-bold text-blue-600">+8.5%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</span>
                            <span class="font-bold text-purple-600">+15.3%</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ©</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„ØµÙ†Ø§Ø¹Ø©</span>
                            <span class="font-bold text-green-600">Ø£ÙØ¶Ù„ 15%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span>
                            <span class="font-bold text-blue-600">Ø£ÙØ¶Ù„ 10%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù‡Ø¯Ù</span>
                            <span class="font-bold text-purple-600">102%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±', 'info')" class="p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-indigo-600 ml-2"></i>
                        <span class="font-bold text-indigo-700">ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-line text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…</span>
                    </button>
                    <button onclick="app.showToast('ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-download text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªØµØ¯ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-brain text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">AI</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    // Services Render Functions
    const renderProjectManagementOffice = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-blue-700 to-indigo-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-project-diagram"></i>
                    Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (PMO)
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-folder-open text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">23</h3>
                    <p class="text-sm text-green-600 mt-1">+4 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                        <i class="fas fa-chart-line text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87.5%</h3>
                    <p class="text-sm text-green-600 mt-1">ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
                        <i class="fas fa-dollar-sign text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$2.4M</h3>
                    <p class="text-sm text-purple-600 mt-1">73% Ù…Ø³ØªØ®Ø¯Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</span>
                        <i class="fas fa-users text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">156</h3>
                    <p class="text-sm text-orange-600 mt-1">Ø¹Ø¶Ùˆ Ù†Ø´Ø·</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { project: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', progress: 85, budget: 420000, team: 12, status: 'On Track', color: 'green' },
                            { project: 'Ù…Ù†ØµØ© Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', progress: 65, budget: 680000, team: 18, status: 'On Track', color: 'green' },
                            { project: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', progress: 45, budget: 320000, team: 8, status: 'At Risk', color: 'yellow' },
                            { project: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', progress: 92, budget: 250000, team: 10, status: 'Ahead', color: 'blue' }
                        ].map(proj => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${proj.project}</p>
                                        <p class="text-sm text-slate-600">${proj.team} Ø£Ø¹Ø¶Ø§Ø¡ â€¢ $${(proj.budget/1000).toFixed(0)}K</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${proj.color}-100 text-${proj.color}-700 rounded-full font-bold">${proj.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-${proj.color}-600 h-2 rounded-full transition-all" style="width: ${proj.progress}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${proj.progress}% Ù…ÙƒØªÙ…Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø±Ø¬Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', project: 'Ù†Ø¸Ø§Ù… HR', due: '2026-01-22', priority: 'Ø¹Ø§Ù„ÙŠ' },
                            { task: 'Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', project: 'Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', due: '2026-01-24', priority: 'Ù…ØªÙˆØ³Ø·' },
                            { task: 'Ù†Ø´Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±', project: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', due: '2026-01-25', priority: 'Ø¹Ø§Ù„ÙŠ' },
                            { task: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', project: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', due: '2026-01-28', priority: 'Ù…ØªÙˆØ³Ø·' }
                        ].map(task => `
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="font-bold text-slate-800">${task.task}</p>
                                    <span class="text-xs px-2 py-1 bg-${task.priority === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'yellow'}-100 text-${task.priority === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'yellow'}-700 rounded-full">${task.priority}</span>
                                </div>
                                <p class="text-sm text-slate-600">${task.project}</p>
                                <p class="text-xs text-slate-500 mt-1">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${task.due}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('ØªØ®ØµÙŠØµ Ù…ÙˆØ§Ø±Ø¯', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-users-cog text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ù…ÙˆØ§Ø±Ø¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-alt text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªÙ‚ÙˆÙŠÙ…</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderInstitutionalPerformance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-purple-700 to-pink-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-line"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ
                </h2>
                <p class="mt-2 opacity-90">Ù‚ÙŠØ§Ø³ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒÙ„ÙŠ</span>
                        <i class="fas fa-tachometer-alt text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8.7/10</h3>
                    <p class="text-sm text-green-600 mt-1">+0.5 ØªØ­Ø³Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©</span>
                        <i class="fas fa-bullseye text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">92%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø±Ø¶Ø§ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
                        <i class="fas fa-smile text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">88%</h3>
                    <p class="text-sm text-blue-600 mt-1">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.6/5</h3>
                    <p class="text-sm text-yellow-600 mt-1">Ù…Ù…ÙŠØ²</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (KPIs)</h3>
                    <div class="space-y-3">
                        ${[
                            { kpi: 'Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©', current: 92, target: 95, unit: '%', trend: '+3%' },
                            { kpi: 'Ø§Ù„Ø¬ÙˆØ¯Ø©', current: 96, target: 98, unit: '%', trend: '+2%' },
                            { kpi: 'Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', current: 88, target: 90, unit: '%', trend: '+5%' },
                            { kpi: 'Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±', current: 85, target: 88, unit: '%', trend: '+7%' },
                            { kpi: 'Ø§Ù„Ø±Ø¨Ø­ÙŠØ©', current: 78, target: 80, unit: '%', trend: '+4%' }
                        ].map(kpi => `
                            <div class="p-3 bg-purple-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${kpi.kpi}</p>
                                    <div class="text-right">
                                        <span class="font-bold text-purple-600">${kpi.current}${kpi.unit}</span>
                                        <span class="text-xs text-green-600 ml-2">${kpi.trend}</span>
                                    </div>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ${kpi.current}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">Ø§Ù„Ù‡Ø¯Ù: ${kpi.target}${kpi.unit}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†</h3>
                    <div class="space-y-3">
                        ${[
                            { initiative: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ', impact: 'Ø¹Ø§Ù„ÙŠ', progress: 75, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' },
                            { initiative: 'ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒÙØ§Ø¡Ø§Øª', impact: 'Ù…ØªÙˆØ³Ø·', progress: 60, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' },
                            { initiative: 'ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', impact: 'Ø¹Ø§Ù„ÙŠ', progress: 85, status: 'Ù…ØªÙ‚Ø¯Ù…' },
                            { initiative: 'Ø®ÙØ¶ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', impact: 'Ù…ØªÙˆØ³Ø·', progress: 40, status: 'Ù…Ø¨ÙƒØ±' }
                        ].map(init => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-bold text-slate-800">${init.initiative}</p>
                                    <span class="text-xs px-2 py-1 bg-${init.impact === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-100 text-${init.impact === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-700 rounded-full">${init.impact}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ${init.progress}%"></div>
                                </div>
                                <div class="flex items-center justify-between mt-2">
                                    <p class="text-sm text-slate-600">${init.progress}% Ù…ÙƒØªÙ…Ù„</p>
                                    <p class="text-xs text-slate-500">${init.status}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù„ÙˆØ­Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ù…Ø¨Ø§Ø¯Ø±Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-search text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªØ­Ù„ÙŠÙ„</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderOperationsMonitoring = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-teal-700 to-cyan-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-eye"></i>
                    Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-cogs text-teal-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">127</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">96.8%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                        <i class="fas fa-exclamation-triangle text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                    <p class="text-sm text-orange-600 mt-1">ØªØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
                        <i class="fas fa-clock text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12min</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªÙˆØ³Ø·</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { operation: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª', status: 'Ù†Ø´Ø·', load: 85, incidents: 2, color: 'green' },
                            { operation: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', status: 'Ù†Ø´Ø·', load: 72, incidents: 0, color: 'green' },
                            { operation: 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', status: 'ØªØ­Øª Ø§Ù„Ø¶ØºØ·', load: 94, incidents: 3, color: 'yellow' },
                            { operation: 'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©', status: 'Ù†Ø´Ø·', load: 68, incidents: 1, color: 'green' }
                        ].map(op => `
                            <div class="p-3 bg-${op.color}-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${op.operation}</p>
                                        <p class="text-sm text-slate-600">${op.incidents} Ø­ÙˆØ§Ø¯Ø« Ø§Ù„ÙŠÙˆÙ…</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${op.color}-100 text-${op.color}-700 rounded-full font-bold">${op.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-${op.color}-600 h-2 rounded-full transition-all" style="width: ${op.load}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">Ø­Ù…Ù„: ${op.load}%</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { alert: 'Ø§Ø±ØªÙØ§Ø¹ Ø­Ø¬Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª', time: '5 Ø¯Ù‚Ø§Ø¦Ù‚', level: 'ØªØ­Ø°ÙŠØ±', action: 'ØªÙ… Ø§Ù„ØªØµØ¹ÙŠØ¯' },
                            { alert: 'Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - ØµÙ†Ù A123', time: '12 Ø¯Ù‚ÙŠÙ‚Ø©', level: 'Ù…Ø¹Ù„ÙˆÙ…Ø©', action: 'ØªÙ… Ø§Ù„Ø·Ù„Ø¨' },
                            { alert: 'ÙˆÙ‚Øª Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø·ÙˆÙŠÙ„ - Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¹Ù…', time: '18 Ø¯Ù‚ÙŠÙ‚Ø©', level: 'ØªÙ†Ø¨ÙŠÙ‡', action: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' },
                            { alert: 'Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© - Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ', time: '25 Ø¯Ù‚ÙŠÙ‚Ø©', level: 'Ù†Ø¬Ø§Ø­', action: 'Ù…ÙƒØªÙ…Ù„' }
                        ].map(alert => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="font-bold text-slate-800">${alert.alert}</p>
                                    <span class="text-xs px-2 py-1 bg-${alert.level === 'ØªØ­Ø°ÙŠØ±' ? 'red' : alert.level === 'ØªÙ†Ø¨ÙŠÙ‡' ? 'yellow' : alert.level === 'Ù†Ø¬Ø§Ø­' ? 'green' : 'blue'}-100 text-${alert.level === 'ØªØ­Ø°ÙŠØ±' ? 'red' : alert.level === 'ØªÙ†Ø¨ÙŠÙ‡' ? 'yellow' : alert.level === 'Ù†Ø¬Ø§Ø­' ? 'green' : 'blue'}-700 rounded-full">${alert.level}</span>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mt-1">
                                    <span>Ù…Ù†Ø° ${alert.time}</span>
                                    <span>${alert.action}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©', 'info')" class="p-4 bg-teal-50 hover:bg-teal-100 rounded-lg transition text-right">
                        <i class="fas fa-desktop text-teal-600 ml-2"></i>
                        <span class="font-bold text-teal-700">Ù…Ø±Ø§Ù‚Ø¨Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-list text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø³Ø¬Ù„</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-bell text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderAIMarketResearch = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-700 to-purple-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-brain"></i>
                    Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                </h2>
                <p class="mt-2 opacity-90">ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ø³ÙˆÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-chart-pie text-indigo-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø¯Ù‚Ø© Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª</span>
                        <i class="fas fa-bullseye text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94.2%</h3>
                    <p class="text-sm text-green-600 mt-1">Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                        <i class="fas fa-database text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">247</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØµØ¯Ø± Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                        <i class="fas fa-file-chart text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">28</h3>
                    <p class="text-sm text-purple-600 mt-1">ØªÙ‚Ø±ÙŠØ±</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { analysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†', type: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ', progress: 78, insight: 'Ù…Ù…ÙŠØ²' },
                            { analysis: 'ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù„Ø¨', type: 'ØªÙ†Ø¨Ø¤ÙŠ', progress: 92, insight: 'Ù…Ø±ØªÙØ¹' },
                            { analysis: 'Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ', type: 'Ø³Ù„ÙˆÙƒÙŠ', progress: 65, insight: 'Ù…ØªÙˆØ³Ø·' },
                            { analysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª', type: 'Ø²Ù…Ù†ÙŠ', progress: 85, insight: 'Ù‚ÙˆÙŠ' }
                        ].map(item => `
                            <div class="p-3 bg-indigo-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${item.analysis}</p>
                                        <p class="text-sm text-slate-600">Ù†ÙˆØ¹: ${item.type}</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-purple-100 text-purple-700 rounded-full font-bold">${item.insight}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-indigo-600 h-2 rounded-full transition-all" style="width: ${item.progress}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${item.progress}% Ù…ÙƒØªÙ…Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø±Ø¤Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                    <div class="space-y-3">
                        ${[
                            { insight: 'ÙØ±ØµØ© Ù†Ù…Ùˆ ÙÙŠ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªÙ‚Ù†ÙŠ', confidence: 92, impact: 'Ø¹Ø§Ù„ÙŠ' },
                            { insight: 'ØªÙˆÙ‚Ø¹ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ³Ù…ÙŠ', confidence: 87, impact: 'Ù…ØªÙˆØ³Ø·' },
                            { insight: 'Ù…Ù†Ø§ÙØ³ Ø¬Ø¯ÙŠØ¯ ÙŠØ¯Ø®Ù„ Ø§Ù„Ø³ÙˆÙ‚', confidence: 78, impact: 'Ø¹Ø§Ù„ÙŠ' },
                            { insight: 'ØªØ­Ø³Ù† ÙÙŠ Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', confidence: 95, impact: 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ' }
                        ].map(insight => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="font-bold text-slate-800">${insight.insight}</p>
                                    <span class="text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full">${insight.impact}</span>
                                </div>
                                <div class="flex items-center gap-2 mt-2">
                                    <i class="fas fa-robot text-indigo-600"></i>
                                    <span class="text-sm text-slate-600">Ø«Ù‚Ø©: ${insight.confidence}%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¯Ø±Ø§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-indigo-600 ml-2"></i>
                        <span class="font-bold text-indigo-700">Ø¯Ø±Ø§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± AI', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù„ÙˆØ­Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª AI', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-cog text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderCustomerService = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-green-700 to-emerald-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-headset"></i>
                    Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø±ÙƒØ² Ù…ØªÙƒØ§Ù…Ù„ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø®Ø¯Ù…Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</span>
                        <i class="fas fa-ticket-alt text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">34</h3>
                    <p class="text-sm text-orange-600 mt-1">12 Ø¹Ø§Ø¬Ù„</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¶Ø§</span>
                        <i class="fas fa-smile text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.8/5</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
                        <i class="fas fa-clock text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8min</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªÙˆØ³Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ù„</span>
                        <i class="fas fa-check-circle text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">94%</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù…Ù† Ø£ÙˆÙ„ Ù…Ø±Ø©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { ticket: '#TK-1023', customer: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', issue: 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©', priority: 'Ø¹Ø§Ø¬Ù„', time: '5 Ø¯Ù‚Ø§Ø¦Ù‚', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' },
                            { ticket: '#TK-1022', customer: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', issue: 'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø©', priority: 'Ø¹Ø§Ø¯ÙŠ', time: '12 Ø¯Ù‚ÙŠÙ‚Ø©', status: 'Ø¬Ø¯ÙŠØ¯' },
                            { ticket: '#TK-1021', customer: 'Ø®Ø§Ù„Ø¯ Ø­Ø³Ù†', issue: 'Ø·Ù„Ø¨ ØªØºÙŠÙŠØ±', priority: 'Ù…Ù†Ø®ÙØ¶', time: '25 Ø¯Ù‚ÙŠÙ‚Ø©', status: 'Ù…Ù†ØªØ¸Ø±' },
                            { ticket: '#TK-1020', customer: 'ÙØ§Ø·Ù…Ø© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', issue: 'Ø´ÙƒÙˆÙ‰ Ø®Ø¯Ù…Ø©', priority: 'Ø¹Ø§Ø¬Ù„', time: '30 Ø¯Ù‚ÙŠÙ‚Ø©', status: 'ØªØµØ¹ÙŠØ¯' }
                        ].map(ticket => `
                            <div class="p-3 bg-slate-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between mb-1">
                                    <div>
                                        <p class="font-bold text-slate-800">${ticket.ticket} - ${ticket.customer}</p>
                                        <p class="text-sm text-slate-600">${ticket.issue}</p>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-${ticket.priority === 'Ø¹Ø§Ø¬Ù„' ? 'red' : ticket.priority === 'Ø¹Ø§Ø¯ÙŠ' ? 'blue' : 'gray'}-100 text-${ticket.priority === 'Ø¹Ø§Ø¬Ù„' ? 'red' : ticket.priority === 'Ø¹Ø§Ø¯ÙŠ' ? 'blue' : 'gray'}-700 rounded-full">${ticket.priority}</span>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mt-2">
                                    <span>Ù…Ù†Ø° ${ticket.time}</span>
                                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">${ticket.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</h3>
                    <div class="space-y-3">
                        ${[
                            { agent: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯', tickets: 23, rating: 4.9, status: 'Ù…ØªØ§Ø­' },
                            { agent: 'Ù‡Ù†Ø¯ Ø³Ø¹ÙŠØ¯', tickets: 19, rating: 4.8, status: 'Ù…Ø´ØºÙˆÙ„' },
                            { agent: 'Ø¹Ù…Ø± Ø®Ø§Ù„Ø¯', tickets: 21, rating: 4.7, status: 'Ù…ØªØ§Ø­' },
                            { agent: 'Ù„ÙŠÙ„Ù‰ Ø­Ø³Ù†', tickets: 17, rating: 4.9, status: 'Ø§Ø³ØªØ±Ø§Ø­Ø©' }
                        ].map(agent => `
                            <div class="p-3 bg-green-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white font-bold">
                                            ${agent.agent.charAt(0)}
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800">${agent.agent}</p>
                                            <p class="text-sm text-slate-600">${agent.tickets} Ø·Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="flex items-center gap-1 mb-1">
                                            <span class="text-yellow-500">â˜…</span>
                                            <span class="font-bold text-slate-800">${agent.rating}</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-${agent.status === 'Ù…ØªØ§Ø­' ? 'green' : agent.status === 'Ù…Ø´ØºÙˆÙ„' ? 'red' : 'yellow'}-100 text-${agent.status === 'Ù…ØªØ§Ø­' ? 'green' : agent.status === 'Ù…Ø´ØºÙˆÙ„' ? 'red' : 'yellow'}-700 rounded">${agent.status}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-book text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù…Ø¹Ø±ÙØ©</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-comments text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø¯Ø±Ø¯Ø´Ø©</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderClientAdminServices = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-cyan-700 to-blue-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-user-cog"></i>
                    Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„
                </h2>
                <p class="mt-2 opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                        <i class="fas fa-users text-cyan-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">342</h3>
                    <p class="text-sm text-green-600 mt-1">+18 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</span>
                        <i class="fas fa-clipboard-list text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">28</h3>
                    <p class="text-sm text-orange-600 mt-1">ØªØªØ·Ù„Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                        <i class="fas fa-file-alt text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,247</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">96.3%</h3>
                    <p class="text-sm text-green-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { service: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯', requests: 45, completion: 92 },
                            { service: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±', requests: 89, completion: 95 },
                            { service: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª', requests: 67, completion: 88 },
                            { service: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', requests: 34, completion: 97 },
                            { service: 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©', requests: 23, completion: 90 }
                        ].map((svc, i) => `
                            <div class="p-3 bg-cyan-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${svc.service}</p>
                                        <p class="text-sm text-slate-600">${svc.requests} Ø·Ù„Ø¨ Ù†Ø´Ø·</p>
                                    </div>
                                    <span class="font-bold text-cyan-600">${svc.completion}%</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-cyan-600 h-2 rounded-full transition-all" style="width: ${svc.completion}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { client: 'Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©', service: 'ØªØ¬Ø¯ÙŠØ¯ Ø¹Ù‚Ø¯', date: '2026-01-20', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
                            { client: 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ·ÙˆÙŠØ±', service: 'ÙØ§ØªÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ©', date: '2026-01-19', status: 'Ù…ÙƒØªÙ…Ù„' },
                            { client: 'Ù…ÙƒØªØ¨ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª', service: 'Ø·Ù„Ø¨ Ù…Ø³ØªÙ†Ø¯Ø§Øª', date: '2026-01-19', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯' },
                            { client: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¯ÙŠØ«', service: 'ØªÙ‚Ø±ÙŠØ± Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', date: '2026-01-18', status: 'Ù…ÙƒØªÙ…Ù„' }
                        ].map(req => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <div>
                                        <p class="font-bold text-slate-800">${req.client}</p>
                                        <p class="text-sm text-slate-600">${req.service}</p>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-${req.status === 'Ù…ÙƒØªÙ…Ù„' ? 'green' : 'blue'}-100 text-${req.status === 'Ù…ÙƒØªÙ…Ù„' ? 'green' : 'blue'}-700 rounded-full">${req.status}</span>
                                </div>
                                <p class="text-xs text-slate-500 mt-1">${req.date}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-cyan-50 hover:bg-cyan-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-cyan-600 ml-2"></i>
                        <span class="font-bold text-cyan-700">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-users text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¹Ù…Ù„Ø§Ø¡</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª', 'info')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-folder text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">Ù…Ø³ØªÙ†Ø¯Ø§Øª</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª', 'success')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderVirtualHalls = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-red-700 to-pink-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-video"></i>
                    Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                </h2>
                <p class="mt-2 opacity-90">Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-door-open text-red-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8</h3>
                    <p class="text-sm text-green-600 mt-1">Ø¬Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù†</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</span>
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">342</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù…ØªØµÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
                        <i class="fas fa-calendar text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">15</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¶Ø§</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.7/5</h3>
                    <p class="text-sm text-yellow-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { room: 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', event: 'Ù…Ø¤ØªÙ…Ø± Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ', participants: 145, capacity: 200, host: 'Ø¯. Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯' },
                            { room: 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ù†Ø¯ÙˆØ§Øª', event: 'ÙˆØ±Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', participants: 67, capacity: 100, host: 'Ù…. Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ' },
                            { room: 'Ù‚Ø§Ø¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ A', event: 'Ø¯ÙˆØ±Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', participants: 45, capacity: 50, host: 'Ø¯. Ø®Ø§Ù„Ø¯ Ø­Ø³Ù†' },
                            { room: 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª', event: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', participants: 12, capacity: 20, host: 'Ù…. ÙØ§Ø·Ù…Ø© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…' }
                        ].map(room => `
                            <div class="p-3 bg-red-50 rounded-lg hover:shadow-md transition cursor-pointer">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${room.room}</p>
                                        <p class="text-sm text-slate-600">${room.event}</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-green-100 text-green-700 rounded-full font-bold flex items-center gap-1">
                                        <i class="fas fa-circle animate-pulse"></i> Ù…Ø¨Ø§Ø´Ø±
                                    </span>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mt-2">
                                    <span>${room.participants}/${room.capacity} Ù…Ø´Ø§Ø±Ùƒ</span>
                                    <span>${room.host}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-1.5 mt-2">
                                    <div class="bg-red-600 h-1.5 rounded-full transition-all" style="width: ${(room.participants/room.capacity)*100}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { event: 'Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„ØªÙ‚Ù†ÙŠ', date: '2026-01-22', time: '10:00 ØµØ¨Ø§Ø­Ø§Ù‹', registered: 234, capacity: 300 },
                            { event: 'ÙˆØ±Ø´Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©', date: '2026-01-23', time: '14:00 Ù…Ø³Ø§Ø¡Ù‹', registered: 89, capacity: 100 },
                            { event: 'Ù†Ø¯ÙˆØ© Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ', date: '2026-01-24', time: '16:00 Ù…Ø³Ø§Ø¡Ù‹', registered: 156, capacity: 200 },
                            { event: 'Ø¯ÙˆØ±Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª', date: '2026-01-25', time: '11:00 ØµØ¨Ø§Ø­Ø§Ù‹', registered: 45, capacity: 50 }
                        ].map(event => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="font-bold text-slate-800">${event.event}</p>
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded">${event.registered}/${event.capacity}</span>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mt-2">
                                    <span><i class="fas fa-calendar ml-1"></i>${event.date}</span>
                                    <span><i class="fas fa-clock ml-1"></i>${event.time}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ù‚Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-red-50 hover:bg-red-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-red-600 ml-2"></i>
                        <span class="font-bold text-red-700">Ù‚Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø¬Ø¯ÙˆÙ„Ø© ÙØ¹Ø§Ù„ÙŠØ©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-calendar-plus text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ø¬Ø¯ÙˆÙ„Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-video text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">ØªØ³Ø¬ÙŠÙ„Ø§Øª</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderFeasibilityStudies = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-orange-700 to-red-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-calculator"></i>
                    Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰
                </h2>
                <p class="mt-2 opacity-90">Ø¯Ø±Ø§Ø³Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-file-invoice text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">12</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">87</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</span>
                        <i class="fas fa-chart-line text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">84%</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù†ÙØ°Ø©</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª</span>
                        <i class="fas fa-dollar-sign text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">$45M</h3>
                    <p class="text-sm text-purple-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { study: 'Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¬Ù…Ø¹ Ø³ÙƒÙ†ÙŠ', sector: 'Ø¹Ù‚Ø§Ø±Ø§Øª', investment: 12.5, roi: 18.5, progress: 75, feasibility: 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ' },
                            { study: 'Ù…ØµÙ†Ø¹ Ø¥Ù†ØªØ§Ø¬ Ø£ØºØ°ÙŠØ©', sector: 'ØµÙ†Ø§Ø¹Ø©', investment: 8.3, roi: 22.3, progress: 60, feasibility: 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¬Ø¯Ø§Ù‹' },
                            { study: 'Ù…Ù†ØµØ© ØªØ¬Ø§Ø±Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', sector: 'ØªÙ‚Ù†ÙŠØ©', investment: 3.2, roi: 35.7, progress: 85, feasibility: 'Ù…Ù…ØªØ§Ø²' },
                            { study: 'Ù…Ø±ÙƒØ² Ù„ÙˆØ¬Ø³ØªÙŠ', sector: 'Ø®Ø¯Ù…Ø§Øª', investment: 15.8, roi: 15.2, progress: 40, feasibility: 'Ù…ØªÙˆØ³Ø·' }
                        ].map(study => `
                            <div class="p-3 bg-orange-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${study.study}</p>
                                        <p class="text-sm text-slate-600">${study.sector} â€¢ $${study.investment}M</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-${study.feasibility === 'Ù…Ù…ØªØ§Ø²' ? 'green' : study.feasibility === 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¬Ø¯Ø§Ù‹' ? 'blue' : study.feasibility === 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ' ? 'teal' : 'yellow'}-100 text-${study.feasibility === 'Ù…Ù…ØªØ§Ø²' ? 'green' : study.feasibility === 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¬Ø¯Ø§Ù‹' ? 'blue' : study.feasibility === 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ' ? 'teal' : 'yellow'}-700 rounded-full font-bold">${study.feasibility}</span>
                                </div>
                                <div class="flex items-center justify-between text-sm text-slate-600 mb-2">
                                    <span>ROI Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${study.roi}%</span>
                                    <span>${study.progress}% Ù…ÙƒØªÙ…Ù„</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="bg-orange-600 h-2 rounded-full transition-all" style="width: ${study.progress}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h3>
                    <div class="space-y-3">
                        ${[
                            { component: 'Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙˆÙ‚', importance: 'Ø¹Ø§Ù„ÙŠ', status: 'Ù…ÙƒØªÙ…Ù„' },
                            { component: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ', importance: 'Ø¹Ø§Ù„ÙŠ', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„' },
                            { component: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ', importance: 'Ù…ØªÙˆØ³Ø·', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„' },
                            { component: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ', importance: 'Ù…ØªÙˆØ³Ø·', status: 'Ù…Ù†ØªØ¸Ø±' },
                            { component: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', importance: 'Ø¹Ø§Ù„ÙŠ', status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„' },
                            { component: 'Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°', importance: 'Ø¹Ø§Ù„ÙŠ', status: 'Ù…Ù†ØªØ¸Ø±' }
                        ].map(comp => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-bold text-slate-800">${comp.component}</p>
                                        <span class="text-xs px-2 py-1 bg-${comp.importance === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-100 text-${comp.importance === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-700 rounded mt-1 inline-block">${comp.importance}</span>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-${comp.status === 'Ù…ÙƒØªÙ…Ù„' ? 'green' : comp.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„' ? 'blue' : 'gray'}-100 text-${comp.status === 'Ù…ÙƒØªÙ…Ù„' ? 'green' : comp.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„' ? 'blue' : 'gray'}-700 rounded">${comp.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ø¯Ø±Ø§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'info')" class="p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-orange-600 ml-2"></i>
                        <span class="font-bold text-orange-700">Ø¯Ø±Ø§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-file-invoice text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù‚ÙˆØ§Ù„Ø¨</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ‰', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-file-alt text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                    <button onclick="app.showToast('Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-archive text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø£Ø±Ø´ÙŠÙ</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderResearch = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-emerald-700 to-teal-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-search"></i>
                    Ø§Ù„Ø¨Ø­ÙˆØ«
                </h2>
                <p class="mt-2 opacity-90">Ù…Ø±ÙƒØ² Ù…ØªØ®ØµØµ Ù„Ù„Ø¨Ø­ÙˆØ« ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¨Ø­ÙˆØ« Ø§Ù„Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-flask text-emerald-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">18</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¨Ø­ÙˆØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</span>
                        <i class="fas fa-book text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">142</h3>
                    <p class="text-sm text-blue-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¨Ø§Ø­Ø«ÙˆÙ†</span>
                        <i class="fas fa-user-graduate text-purple-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">47</h3>
                    <p class="text-sm text-purple-600 mt-1">Ø¨Ø§Ø­Ø« Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ´Ù‡Ø§Ø¯</span>
                        <i class="fas fa-quote-right text-orange-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">8.4</h3>
                    <p class="text-sm text-orange-600 mt-1">Ù„ÙƒÙ„ Ø¨Ø­Ø«</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ø­Ø«ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { project: 'ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„Ø·Ø¨', field: 'ØªÙ‚Ù†ÙŠØ© Ø·Ø¨ÙŠØ©', team: 8, progress: 72, status: 'Ù…ØªÙ‚Ø¯Ù…' },
                            { project: 'Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', field: 'Ù‡Ù†Ø¯Ø³Ø© Ø¨ÙŠØ¦ÙŠØ©', team: 6, progress: 58, status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' },
                            { project: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø©', field: 'Ø¹Ù„ÙˆÙ… Ø¨ÙŠØ§Ù†Ø§Øª', team: 10, progress: 85, status: 'Ø´Ø¨Ù‡ Ù…ÙƒØªÙ…Ù„' },
                            { project: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…', field: 'Ø£Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', team: 5, progress: 45, status: 'Ù…Ø¨ÙƒØ±' }
                        ].map(proj => `
                            <div class="p-3 bg-emerald-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${proj.project}</p>
                                        <p class="text-sm text-slate-600">${proj.field} â€¢ ${proj.team} Ø¨Ø§Ø­Ø«ÙŠÙ†</p>
                                    </div>
                                    <span class="text-xs px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full font-bold">${proj.status}</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                    <div class="bg-emerald-600 h-2 rounded-full transition-all" style="width: ${proj.progress}%"></div>
                                </div>
                                <p class="text-sm text-slate-600 mt-1">${proj.progress}% Ù…ÙƒØªÙ…Ù„</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¨Ø­ÙˆØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹</h3>
                    <div class="space-y-3">
                        ${[
                            { title: 'ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©', journal: 'Ù…Ø¬Ù„Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©', date: '2026-01', impact: 'Ø¹Ø§Ù„ÙŠ' },
                            { title: 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ù„Ù„ØªÙ†Ø¨Ø¤', journal: 'Ù…Ø¬Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', date: '2025-12', impact: 'Ù…ØªÙˆØ³Ø·' },
                            { title: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', journal: 'Ù…Ø¬Ù„Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', date: '2025-12', impact: 'Ø¹Ø§Ù„ÙŠ' },
                            { title: 'Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø°ÙƒÙŠØ©', journal: 'Ù…Ø¬Ù„Ø© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©', date: '2025-11', impact: 'Ù…ØªÙˆØ³Ø·' }
                        ].map(paper => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <div>
                                        <p class="font-bold text-slate-800">${paper.title}</p>
                                        <p class="text-sm text-slate-600">${paper.journal}</p>
                                    </div>
                                    <span class="text-xs px-2 py-1 bg-${paper.impact === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-100 text-${paper.impact === 'Ø¹Ø§Ù„ÙŠ' ? 'red' : 'blue'}-700 rounded-full">${paper.impact}</span>
                                </div>
                                <p class="text-xs text-slate-500 mt-1">${paper.date}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø­Ø«ÙŠ Ø¬Ø¯ÙŠØ¯', 'info')" class="p-4 bg-emerald-50 hover:bg-emerald-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-emerald-600 ml-2"></i>
                        <span class="font-bold text-emerald-700">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-book text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù…ÙƒØªØ¨Ø©</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ø¨Ø§Ø­Ø«ÙˆÙ†', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-users text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¨Ø§Ø­Ø«ÙˆÙ†</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ø­ÙˆØ«', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderConsultingTraining = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="bg-gradient-to-r from-violet-700 to-purple-700 rounded-2xl p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨
                </h2>
                <p class="mt-2 opacity-90">Ø®Ø¯Ù…Ø§Øª Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© Ù…ØªØ®ØµØµØ© ÙˆØ¨Ø±Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©</span>
                        <i class="fas fa-briefcase text-violet-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">28</h3>
                    <p class="text-sm text-green-600 mt-1">Ù†Ø´Ø·</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</span>
                        <i class="fas fa-graduation-cap text-blue-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">45</h3>
                    <p class="text-sm text-blue-600 mt-1">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ØªØ§Ø­</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†</span>
                        <i class="fas fa-users text-green-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">1,847</h3>
                    <p class="text-sm text-green-600 mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¶Ø§</span>
                        <i class="fas fa-star text-yellow-600"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800">4.9/5</h3>
                    <p class="text-sm text-yellow-600 mt-1">Ù…Ù…ØªØ§Ø²</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { service: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ', clients: 12, revenue: 340000, satisfaction: 4.8 },
                            { service: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', clients: 8, revenue: 220000, satisfaction: 4.9 },
                            { service: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', clients: 15, revenue: 180000, satisfaction: 4.7 },
                            { service: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ', clients: 10, revenue: 260000, satisfaction: 4.8 },
                            { service: 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', clients: 6, revenue: 320000, satisfaction: 5.0 }
                        ].map((svc, i) => `
                            <div class="p-3 bg-violet-50 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="font-bold text-slate-800">${svc.service}</p>
                                        <p class="text-sm text-slate-600">${svc.clients} Ø¹Ù…ÙŠÙ„ â€¢ $${(svc.revenue/1000).toFixed(0)}K</p>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-yellow-500">â˜…</span>
                                        <span class="font-bold text-slate-800">${svc.satisfaction}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="font-bold text-lg mb-4">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
                    <div class="space-y-3">
                        ${[
                            { program: 'Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', duration: '5 Ø£ÙŠØ§Ù…', trainees: 234, rating: 4.9, level: 'Ù…ØªÙ‚Ø¯Ù…' },
                            { program: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© PMP', duration: '35 Ø³Ø§Ø¹Ø©', trainees: 189, rating: 4.8, level: 'Ù…Ø­ØªØ±Ù' },
                            { program: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ', duration: '3 Ø£ÙŠØ§Ù…', trainees: 345, rating: 4.7, level: 'Ù…ØªÙˆØ³Ø·' },
                            { program: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù€ Python', duration: '4 Ø£ÙŠØ§Ù…', trainees: 278, rating: 4.9, level: 'Ù…ØªÙ‚Ø¯Ù…' }
                        ].map(prog => `
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <div class="flex items-center justify-between mb-1">
                                    <div>
                                        <p class="font-bold text-slate-800">${prog.program}</p>
                                        <p class="text-sm text-slate-600">${prog.duration} â€¢ ${prog.trainees} Ù…ØªØ¯Ø±Ø¨</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="flex items-center gap-1 mb-1">
                                            <span class="text-yellow-500">â˜…</span>
                                            <span class="font-bold text-slate-800">${prog.rating}</span>
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded">${prog.level}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="font-bold text-lg mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <button onclick="app.showToast('Ù…Ø´Ø±ÙˆØ¹ Ø§Ø³ØªØ´Ø§Ø±ÙŠ', 'info')" class="p-4 bg-violet-50 hover:bg-violet-100 rounded-lg transition text-right">
                        <i class="fas fa-plus-circle text-violet-600 ml-2"></i>
                        <span class="font-bold text-violet-700">Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button onclick="app.showToast('Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ', 'info')" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition text-right">
                        <i class="fas fa-chalkboard text-purple-600 ml-2"></i>
                        <span class="font-bold text-purple-700">Ø¨Ø±Ù†Ø§Ù…Ø¬</span>
                    </button>
                    <button onclick="app.showToast('Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ†', 'info')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition text-right">
                        <i class="fas fa-user-tie text-blue-600 ml-2"></i>
                        <span class="font-bold text-blue-700">Ù…Ø³ØªØ´Ø§Ø±ÙˆÙ†</span>
                    </button>
                    <button onclick="app.showToast('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª', 'success')" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg transition text-right">
                        <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                        <span class="font-bold text-green-700">ØªÙ‚Ø±ÙŠØ±</span>
                    </button>
                </div>
            </div>
        </div>`;
    };

    const renderSettings = () => {
        const entity = db.entities.find(e => e.id === currentUser.entityId);
        if (!perms.isAdmin()) return renderPlaceholder();
        return `
        <div class="max-w-4xl mx-auto space-y-8 animate-fade-in">
            <h2 class="text-2xl font-bold text-slate-800">Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</h2>
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-6">
                <h3 class="font-bold text-lg mb-4">Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    ${Object.entries(THEMES).map(([key, theme]) => `<label class="cursor-pointer group relative"><input type="radio" name="theme-select" value="${key}" onchange="app.previewTheme('${key}')" class="peer sr-only" ${entity.theme === key ? 'checked' : ''}><div class="flex flex-col items-center gap-3 p-4 rounded-2xl border-2 border-slate-100 peer-checked:border-brand-500 peer-checked:bg-slate-50 transition-all"><div class="w-12 h-12 rounded-full ${theme.preview} shadow-lg"></div><span class="text-xs font-bold">${theme.name}</span></div></label>`).join('')}
                </div>
            </div>
            <div class="flex justify-end pt-4"><button onclick="app.saveSettings()" class="bg-brand-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-brand-700 transition">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button></div>
        </div>`;
    };

    const previewTheme = (key) => updateThemeVariables(key);

    const saveSettings = () => {
        const entity = db.entities.find(e => e.id === currentUser.entityId);
        const newTheme = document.querySelector('input[name="theme-select"]:checked')?.value;
        if(entity) { entity.theme = newTheme; updateThemeVariables(newTheme); showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success'); }
    };

    const renderAuditLogs = () => {
        if (!perms.canViewAuditLogs()) return renderPlaceholder();
        return `
        <h2 class="text-2xl font-bold text-slate-800 mb-6">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-x-auto">
             <table class="w-full text-right whitespace-nowrap"><thead class="bg-slate-50 text-xs text-slate-500 font-bold uppercase"><tr><th class="p-4">Ø§Ù„ÙˆÙ‚Øª</th><th class="p-4">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th class="p-4">Ø§Ù„Ø­Ø¯Ø«</th><th class="p-4">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th></tr></thead><tbody class="divide-y divide-slate-50 text-sm">${perms.getVisibleAuditLogs().map(log => `<tr><td class="p-4 text-gray-400">${log.timestamp}</td><td class="p-4 font-bold">${log.user}</td><td class="p-4 text-brand-600">${log.action}</td><td class="p-4 text-gray-500">${log.details}</td></tr>`).join('')}</tbody></table>
        </div>`;
    };

    // --- HIERARCHY VIEWER (Multi-Tenant Structure) ---
    const renderHierarchy = async () => {
        try {
            // OPTIMIZATION: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ÙØ±ÙˆØ¹ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø­Ø§Ø¶Ù†Ø§ØªØŒ Ù…Ù†ØµØ§ØªØŒ Ù…ÙƒØ§ØªØ¨) ØªÙØ­Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨
            const stats = await fetchAPI('/hierarchy/stats');
            const headquarters = await fetchAPI('/headquarters');
            const branches = await fetchAPI('/branches');
            
            console.log(`ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ: ${headquarters.length} Ù…Ù‚Ø±ØŒ ${branches.length} ÙØ±Ø¹`);

            return `
            <div class="space-y-8 animate-fade-in">
                <!-- Header -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ Ù„Ù„Ù…Ù†ØµØ©</h2>
                        <p class="text-slate-500">Ø¹Ø±Ø¶ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ù‚Ø±Ø§Øª â†’ Ø§Ù„ÙØ±ÙˆØ¹ â†’ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª â†’ Ø§Ù„Ù…Ù†ØµØ§Øª â†’ Ø§Ù„Ù…ÙƒØ§ØªØ¨</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="app.refreshHierarchy()" class="bg-brand-600 text-white px-4 py-2 rounded-xl font-bold hover:bg-brand-700 transition flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-building text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_hqs || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">Ù…Ù‚Ø±Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-blue-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-map-marked-alt text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_branches || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">ÙØ±ÙˆØ¹</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-seedling text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_incubators || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">Ø­Ø§Ø¶Ù†Ø§Øª</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-server text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_platforms || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">Ù…Ù†ØµØ§Øª</p>
                    </div>
                    <div class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-briefcase text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_offices || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">Ù…ÙƒØ§ØªØ¨</p>
                    </div>
                    <div class="bg-gradient-to-br from-pink-500 to-pink-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-link text-2xl opacity-80"></i>
                            <span class="text-3xl font-black">${stats.active_links || 0}</span>
                        </div>
                        <p class="text-xs font-semibold opacity-90">Ø±ÙˆØ§Ø¨Ø·</p>
                    </div>
                </div>

                <!-- Entity Creation Buttons -->
                <div class="bg-white rounded-2xl shadow-lg border-2 border-slate-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-slate-700 to-slate-800 p-6 text-white">
                        <div class="flex items-center gap-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <i class="fas fa-plus-circle text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-black">ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª</h3>
                                <p class="text-sm opacity-90">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¶Ø§ÙØ© ÙƒÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <!-- Create Office Button -->
                            <button onclick="openCreateOfficeModal()" 
                                    class="group bg-gradient-to-br from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-xl p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition">
                                        <i class="fas fa-briefcase text-3xl"></i>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="font-black text-lg mb-1">Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙƒØªØ¨</h4>
                                        <p class="text-xs opacity-90">Office ØªØ§Ø¨Ø¹ Ù„Ø­Ø§Ø¶Ù†Ø©/Ù…Ù†ØµØ©</p>
                                    </div>
                                    <div class="mt-2 bg-white/20 px-3 py-1 rounded-full text-xs font-bold">
                                        <i class="fas fa-plus ml-1"></i> Ø¬Ø¯ÙŠØ¯
                                    </div>
                                </div>
                            </button>
                            
                            <!-- Create Platform Button -->
                            <button onclick="openCreatePlatformModal()" 
                                    class="group bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition">
                                        <i class="fas fa-server text-3xl"></i>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="font-black text-lg mb-1">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØµØ©</h4>
                                        <p class="text-xs opacity-90">Platform ØªØ§Ø¨Ø¹ Ù„Ø­Ø§Ø¶Ù†Ø©</p>
                                    </div>
                                    <div class="mt-2 bg-white/20 px-3 py-1 rounded-full text-xs font-bold">
                                        <i class="fas fa-plus ml-1"></i> Ø¬Ø¯ÙŠØ¯
                                    </div>
                                </div>
                            </button>
                            
                            <!-- Create Incubator Button -->
                            <button onclick="openCreateIncubatorModal()" 
                                    class="group bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-xl p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition">
                                        <i class="fas fa-seedling text-3xl"></i>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="font-black text-lg mb-1">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ø¶Ù†Ø©</h4>
                                        <p class="text-xs opacity-90">Incubator ØªØ§Ø¨Ø¹ Ù„ÙØ±Ø¹</p>
                                    </div>
                                    <div class="mt-2 bg-white/20 px-3 py-1 rounded-full text-xs font-bold">
                                        <i class="fas fa-plus ml-1"></i> Ø¬Ø¯ÙŠØ¯
                                    </div>
                                </div>
                            </button>
                            
                            <!-- Create Branch Button -->
                            <button onclick="openCreateBranchModal()" 
                                    class="group bg-gradient-to-br from-red-500 to-blue-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition">
                                        <i class="fas fa-store text-3xl"></i>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="font-black text-lg mb-1">Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹</h4>
                                        <p class="text-xs opacity-90">Branch ØªØ§Ø¨Ø¹ Ù„Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
                                    </div>
                                    <div class="mt-2 bg-white/20 px-3 py-1 rounded-full text-xs font-bold">
                                        <i class="fas fa-plus ml-1"></i> Ø¬Ø¯ÙŠØ¯
                                    </div>
                                </div>
                            </button>
                        </div>
                        
                        <!-- Info Box -->
                        <div class="mt-6 bg-red-50 border-r-4 border-red-500 p-4 rounded-lg">
                            <div class="flex items-start gap-3">
                                <i class="fas fa-info-circle text-red-600 text-xl mt-0.5"></i>
                                <div class="flex-1">
                                    <h5 class="font-bold text-blue-900 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©</h5>
                                    <p class="text-sm text-red-700">ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡Ø±Ù…ÙŠ: ÙØ±Ø¹ â† Ø­Ø§Ø¶Ù†Ø© â† Ù…Ù†ØµØ© â† Ù…ÙƒØªØ¨. ÙƒÙ„ ÙƒÙŠØ§Ù† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØªØ§Ø¨Ø¹Ø§Ù‹ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù…Ù†Ù‡.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accordion Hierarchy View with Lazy Loading -->
                ${headquarters.map(hq => `
                    <div class="bg-white rounded-2xl shadow-lg border-2 border-purple-200 overflow-hidden">
                        <!-- HQ Header -->
                        <div class="bg-gradient-to-r from-purple-600 to-purple-700 p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-white/20 rounded-full p-3">
                                        <i class="fas fa-building text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-black">${hq.name}</h3>
                                        <p class="text-sm opacity-90">Ø±Ù…Ø²: ${hq.code} | ${hq.country || 'Ø¹Ø§Ù„Ù…ÙŠ'}</p>
                                    </div>
                                </div>
                                <span class="px-4 py-1 rounded-full text-xs font-bold ${hq.is_active ? 'bg-green-400 text-green-900' : 'bg-red-400 text-red-900'}">
                                    ${hq.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                                </span>
                            </div>
                        </div>

                        <!-- Branches Accordion -->
                        <div class="p-6 space-y-3">
                            ${branches.filter(b => b.hq_id === hq.id).map(branch => `
                                <div class="border-2 border-blue-300 rounded-xl overflow-hidden">
                                    <!-- Branch Header (Clickable) -->
                                    <button onclick="toggleBranchAccordion(${branch.id})" 
                                            class="w-full bg-gradient-to-r from-blue-50 to-red-50 p-4 hover:from-blue-100 hover:to-red-100 transition-all duration-200">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-map-marked-alt text-white"></i>
                                                </div>
                                                <div class="text-right">
                                                    <h4 class="font-bold text-slate-800">${branch.name}</h4>
                                                    <p class="text-xs text-slate-500">${branch.city}, ${branch.country} | ${branch.code}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-xs font-bold px-3 py-1 rounded-full ${branch.is_active ? 'bg-green-500 text-white' : 'bg-gray-400 text-white'}">
                                                    ${branch.is_active ? 'ÙØ¹Ø§Ù„' : 'Ù…Ø¹Ø·Ù„'}
                                                </span>
                                                <i id="branch-icon-${branch.id}" class="fas fa-chevron-down text-blue-600 text-xl transition-transform duration-200"></i>
                                            </div>
                                        </div>
                                    </button>
                                    
                                    <!-- Branch Content (Lazy Loaded) -->
                                    <div id="branch-content-${branch.id}" class="hidden bg-white border-t-2 border-blue-200">
                                        <div class="flex justify-center items-center py-8">
                                            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                        </div>
                                    </div>
                                </div>
                            `).join('') || '<p class="text-slate-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆØ¹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø±</p>'}
                        </div>
                    </div>
                `).join('')}

                ${headquarters.length === 0 ? `
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-12 text-center">
                        <i class="fas fa-inbox text-6xl text-slate-300 mb-4"></i>
                        <h3 class="text-xl font-bold text-slate-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø±Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                        <p class="text-slate-500">Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ù‡ÙŠÙƒÙ„ ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø¨Ø¹Ø¯</p>
                    </div>
                ` : ''}
            </div>`;
        } catch (error) {
            console.error('Error loading hierarchy:', error);
            showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ', 'error');
            return `
            <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                <h3 class="text-xl font-bold text-red-700 mb-2">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h3>
                <p class="text-red-600">${error.message}</p>
            </div>`;
        }
    };

    const renderPlaceholder = (msg = 'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„') => `
        <div class="flex flex-col items-center justify-center h-96 text-center animate-fade-in px-4">
            <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mb-6 shadow-inner"><i class="fas fa-lock text-4xl text-slate-400"></i></div>
            <h3 class="text-2xl font-bold text-slate-700">ÙˆØµÙˆÙ„ Ù…Ù‚ÙŠØ¯</h3>
            <p class="text-slate-500 mt-2 max-w-md mx-auto">${msg}</p>
        </div>`;

    // --- OFFICE-PLATFORM LINK MANAGEMENT ---
    const openCreateLinkModal = () => {
        const modal = document.getElementById('createLinkModal');
        if (modal) {
            modal.classList.remove('hidden');
            document.getElementById('linkOfficeSelect').value = '';
            document.getElementById('linkPlatformSelect').value = '';
        }
    };

    const closeCreateLinkModal = () => {
        const modal = document.getElementById('createLinkModal');
        if (modal) modal.classList.add('hidden');
    };

    const submitCreateLink = async () => {
        const officeId = document.getElementById('linkOfficeSelect').value;
        const platformId = document.getElementById('linkPlatformSelect').value;

        if (!officeId || !platformId) {
            showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ù†ØµØ©', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/offices/${officeId}/platforms/${platformId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø·');
            }

            showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
            closeCreateLinkModal();
            loadRoute('hierarchy'); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        } catch (error) {
            console.error('Error creating link:', error);
            showToast(error.message || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø·', 'error');
        }
    };

    const deleteLink = async (officeId, platformId, officeName, platformName) => {
        const confirm = window.confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø±Ø¨Ø· Ø¨ÙŠÙ†:\n\nğŸ’¼ ${officeName}\nâ†•ï¸\nğŸ–¥ï¸ ${platformName}\n\nâš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!`);
        
        if (!confirm) return;

        try {
            const response = await fetch(`${API_BASE_URL}/offices/${officeId}/platforms/${platformId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø±Ø¨Ø·');
            }

            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
            loadRoute('hierarchy'); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        } catch (error) {
            console.error('Error deleting link:', error);
            showToast(error.message || 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø±Ø¨Ø·', 'error');
        }
    };

    // --- APPROVAL ACTIONS ---
    const handleApprovalDecision = async (workflowId, stepId, decision) => {
        let comments = null;
        let rejectionReason = null;
        
        if (decision === 'REJECTED') {
            rejectionReason = prompt('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:');
            if (!rejectionReason || rejectionReason.trim() === '') {
                showToast('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶', 'error');
                return;
            }
        } else {
            comments = prompt('ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):');
        }
        
        try {
            await fetchAPI(`/approvals/${workflowId}/decide`, {
                method: 'POST',
                body: JSON.stringify({
                    step_id: stepId,
                    decision: decision,
                    comments: comments || '',
                    rejection_reason: rejectionReason,
                    approver_id: currentUser.id
                })
            });
            
            showToast(decision === 'APPROVED' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', 'success');
            
            // Reload data and refresh view
            await loadDataFromAPI();
            loadRoute('approvals');
        } catch (error) {
            console.error('Error:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚Ø±Ø§Ø±', 'error');
        }
    };

    const editApproval = async (approvalId) => {
        const approval = db.approvals.find(a => a.id === approvalId);
        
        if (!approval) {
            showToast('Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
            return;
        }
        
        // Check if user can edit (creator or has permission)
        if (approval.createdBy !== currentUser.id && !perms.isAdmin()) {
            showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'error');
            return;
        }
        
        // Create edit dialog
        const dialog = document.createElement('div');
        dialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
        dialog.innerHTML = `
            <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white">
                    <h2 class="text-2xl font-bold flex items-center gap-3">
                        <i class="fas fa-edit"></i>
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                    </h2>
                </div>
                
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</label>
                        <input type="text" id="edit-approval-title" value="${approval.itemTitle}" 
                            class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³)</label>
                        <input type="number" id="edit-approval-amount" value="${approval.amount}" 
                            class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <span class="text-sm text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <strong>${approval.status}</strong></span>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="font-bold text-slate-700 mb-3">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:</h3>
                        <div class="space-y-2">
                            ${approval.steps.map((step, idx) => `
                                <div class="flex items-center gap-3 text-sm">
                                    <span class="font-bold text-slate-600">${idx + 1}.</span>
                                    <span class="flex-1">${step.approver_name} (${step.approver_role})</span>
                                    <span class="px-2 py-1 rounded text-xs font-bold
                                        ${step.status === 'APPROVED' ? 'bg-green-100 text-green-700' : 
                                          step.status === 'REJECTED' ? 'bg-red-100 text-red-700' : 
                                          'bg-yellow-100 text-yellow-700'}">
                                        ${step.status}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-50 p-6 flex gap-3">
                    <button onclick="app.saveApprovalEdit(${approvalId})" 
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold transition">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    </button>
                    <button onclick="this.closest('.fixed').remove()" 
                        class="flex-1 bg-slate-300 hover:bg-slate-400 text-slate-700 px-6 py-3 rounded-lg font-bold transition">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(dialog);
    };
    
    const saveApprovalEdit = async (approvalId) => {
        const title = document.getElementById('edit-approval-title').value;
        const amount = parseFloat(document.getElementById('edit-approval-amount').value);
        
        if (!title || !amount) {
            showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
            return;
        }
        
        try {
            await fetchAPI(`/approvals/${approvalId}`, {
                method: 'PUT',
                body: JSON.stringify({
                    item_title: title,
                    amount: amount,
                    updated_by: currentUser.id
                })
            });
            
            showToast('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            // Close dialog
            document.querySelector('.fixed.inset-0').remove();
            
            // Reload data and refresh view
            await loadDataFromAPI();
            loadRoute('approvals');
        } catch (error) {
            console.error('Error:', error);
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'error');
        }
    };


    // INCUBATOR SYSTEM - moved inside app to access db
    const renderIncubator = async () => {
        const view = document.getElementById('main-view');
        view.innerHTML = `
            <div class="flex items-center justify-center h-64">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div>
            </div>
        `;
        
        try {
            // Use window.renderIncubatorSystem if it exists (defined outside)
            if (typeof window.renderIncubatorSystem === 'function') {
                await window.renderIncubatorSystem(currentUser);
            } else {
                view.innerHTML = `
                    <div class="p-8 text-center">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-6xl mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ø¶Ù†Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</h2>
                        <p class="text-gray-600">Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading incubator:', error);
            view.innerHTML = `
                <div class="p-8 text-center text-red-600">
                    <i class="fas fa-times-circle text-6xl mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</h3>
                    <p>${error.message}</p>
                </div>
            `;
        }
    };

    // --- VIEW ENTITY DETAILS (ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒÙŠØ§Ù†) ---
    const viewEntityDetails = async (entityType, entityId) => {
        try {
            showToast(`Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ ${entityType}...`, 'info');
            
            // Fetch entity details from API
            const data = await fetchAPI(`/hierarchy/entity/${entityType}/${entityId}`);
            const entity = data.entity;
            
            // Get entity icon and color based on type
            const entityConfig = {
                'BRANCH': { icon: 'fa-map-marked-alt', color: 'blue', bgGradient: 'from-red-600 to-red-700' },
                'INCUBATOR': { icon: 'fa-seedling', color: 'green', bgGradient: 'from-green-600 to-green-700' },
                'PLATFORM': { icon: 'fa-server', color: 'orange', bgGradient: 'from-orange-600 to-orange-700' },
                'OFFICE': { icon: 'fa-briefcase', color: 'teal', bgGradient: 'from-teal-600 to-teal-700' }
            };
            
            const config = entityConfig[entityType];
            
            // Render entity details page
            const view = document.getElementById('main-view');
            view.innerHTML = `
                <div class="space-y-6 animate-fade-in">
                    <!-- Back Button -->
                    <div>
                        <button onclick="app.loadRoute('hierarchy')" class="text-slate-600 hover:text-slate-800 font-semibold flex items-center gap-2 transition">
                            <i class="fas fa-arrow-right"></i>
                            <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ</span>
                        </button>
                    </div>

                    <!-- Entity Header Card -->
                    <div class="bg-white rounded-2xl shadow-lg border-2 border-${config.color}-200 overflow-hidden">
                        <div class="bg-gradient-to-r ${config.bgGradient} p-8 text-white">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="bg-white/20 rounded-full p-4">
                                        <i class="fas ${config.icon} text-4xl"></i>
                                    </div>
                                    <div>
                                        <h1 class="text-3xl font-black mb-2">${entity.name}</h1>
                                        <p class="text-sm opacity-90">
                                            ${entityType === 'BRANCH' ? `${entity.city}, ${entity.country}` : ''}
                                            ${entityType === 'INCUBATOR' ? `${entity.program_type} | ØªØ§Ø¨Ø¹ Ù„Ù€ ${entity.branch_name}` : ''}
                                            ${entityType === 'PLATFORM' ? `${entity.pricing_model} | ØªØ§Ø¨Ø¹ Ù„Ù€ ${entity.incubator_name}` : ''}
                                            ${entityType === 'OFFICE' ? `${entity.office_type} | ØªØ§Ø¨Ø¹ Ù„Ù€ ${entity.incubator_name}` : ''}
                                        </p>
                                        <p class="text-xs mt-1 opacity-80">
                                            <i class="fas fa-code ml-1"></i> Ø±Ù…Ø²: ${entity.code}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <span class="px-4 py-2 rounded-full text-sm font-bold ${entity.is_active ? 'bg-green-400 text-green-900' : 'bg-red-400 text-red-900'}">
                                        ${entity.is_active ? 'âœ… Ù†Ø´Ø·' : 'âŒ ØºÙŠØ± Ù†Ø´Ø·'}
                                    </span>
                                    <button onclick="${entityType === 'BRANCH' ? `deleteBranch(${entityId}, '${entity.name.replace(/'/g, "\\'")}')` : 
                                                        entityType === 'INCUBATOR' ? `deleteIncubator(${entityId}, '${entity.name.replace(/'/g, "\\'")}')` :
                                                        entityType === 'PLATFORM' ? `deletePlatform(${entityId}, '${entity.name.replace(/'/g, "\\'")}')` :
                                                        `deleteOffice(${entityId}, '${entity.name.replace(/'/g, "\\'")}')`}" 
                                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold transition flex items-center gap-2">
                                        <i class="fas fa-trash"></i>
                                        <span>Ø­Ø°Ù</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Entity Details Grid -->
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${entityType === 'BRANCH' ? `
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.hq_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</p>
                                        <p class="font-bold text-slate-800">${entity.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø¯ÙˆÙ„Ø©</p>
                                        <p class="font-bold text-slate-800">${entity.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ø¯ÙŠØ±</p>
                                        <p class="font-bold text-slate-800">${entity.manager_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                ` : ''}
                                
                                ${entityType === 'INCUBATOR' ? `
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„ÙØ±Ø¹</p>
                                        <p class="font-bold text-slate-800">${entity.branch_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                                        <p class="font-bold text-slate-800">${entity.program_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</p>
                                        <p class="font-bold text-slate-800">${entity.capacity || 0} Ù…Ø´Ø±ÙˆØ¹</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ø¯ÙŠØ±</p>
                                        <p class="font-bold text-slate-800">${entity.manager_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                ` : ''}
                                
                                ${entityType === 'PLATFORM' ? `
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</p>
                                        <p class="font-bold text-slate-800">${entity.incubator_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¹ÙŠØ±</p>
                                        <p class="font-bold text-slate-800">${entity.pricing_model || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.base_price || 0} ${entity.currency || 'SAR'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ø¯ÙŠØ±</p>
                                        <p class="font-bold text-slate-800">${entity.manager_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                ` : ''}
                                
                                ${entityType === 'OFFICE' ? `
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</p>
                                        <p class="font-bold text-slate-800">${entity.incubator_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØªØ¨</p>
                                        <p class="font-bold text-slate-800">${entity.office_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø³Ø¹Ø©</p>
                                        <p class="font-bold text-slate-800">${entity.capacity || 0} Ø´Ø®Øµ</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</p>
                                        <p class="font-bold text-slate-800">${entity.contact_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="bg-slate-50 rounded-lg p-4">
                                        <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                                        <p class="font-bold text-slate-800">${entity.manager_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${entity.description ? `
                                <div class="mt-6 bg-red-50 border-r-4 border-red-500 p-4 rounded-lg">
                                    <h3 class="font-bold text-blue-900 mb-2">Ø§Ù„ÙˆØµÙ</h3>
                                    <p class="text-sm text-red-700">${entity.description}</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Children Entities -->
                    ${data.incubators && data.incubators.length > 0 ? `
                        <div class="bg-white rounded-2xl shadow-lg border-2 border-green-200 overflow-hidden">
                            <div class="bg-gradient-to-r from-green-600 to-green-700 p-4 text-white">
                                <h3 class="text-lg font-black flex items-center gap-2">
                                    <i class="fas fa-seedling"></i>
                                    Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© (${data.incubators.length})
                                </h3>
                            </div>
                            <div class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${data.incubators.map(inc => `
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 hover:shadow-md transition-shadow relative">
                                        <div onclick="app.viewEntityDetails('INCUBATOR', ${inc.id})" class="cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-bold text-slate-800 text-sm">${inc.name}</h4>
                                                <i class="fas fa-chevron-left text-green-500"></i>
                                            </div>
                                            <p class="text-xs text-slate-500">${inc.program_type} | Ø§Ù„Ø³Ø¹Ø©: ${inc.capacity}</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); deleteIncubator(${inc.id}, '${inc.name}')" class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${data.platforms && data.platforms.length > 0 ? `
                        <div class="bg-white rounded-2xl shadow-lg border-2 border-orange-200 overflow-hidden">
                            <div class="bg-gradient-to-r from-orange-600 to-orange-700 p-4 text-white">
                                <h3 class="text-lg font-black flex items-center gap-2">
                                    <i class="fas fa-server"></i>
                                    Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© (${data.platforms.length})
                                </h3>
                            </div>
                            <div class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${data.platforms.map(plt => `
                                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 hover:shadow-md transition-shadow relative">
                                        <div onclick="app.viewEntityDetails('PLATFORM', ${plt.id})" class="cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-bold text-slate-800 text-sm">${plt.name}</h4>
                                                <i class="fas fa-chevron-left text-orange-500"></i>
                                            </div>
                                            <p class="text-xs text-slate-500">${plt.pricing_model} - ${plt.base_price} ${plt.currency}</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); deletePlatform(${plt.id}, '${plt.name}')" class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${data.offices && data.offices.length > 0 ? `
                        <div class="bg-white rounded-2xl shadow-lg border-2 border-teal-200 overflow-hidden">
                            <div class="bg-gradient-to-r from-teal-600 to-teal-700 p-4 text-white">
                                <h3 class="text-lg font-black flex items-center gap-2">
                                    <i class="fas fa-briefcase"></i>
                                    Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„ØªØ§Ø¨Ø¹Ø© (${data.offices.length})
                                </h3>
                            </div>
                            <div class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${data.offices.map(ofc => `
                                    <div class="bg-teal-50 border border-teal-200 rounded-lg p-4 hover:shadow-md transition-shadow relative">
                                        <div onclick="app.viewEntityDetails('OFFICE', ${ofc.id})" class="cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-bold text-slate-800 text-sm">${ofc.name}</h4>
                                                <i class="fas fa-chevron-left text-teal-500"></i>
                                            </div>
                                            <p class="text-xs text-slate-500">${ofc.office_type} - Ø§Ù„Ø³Ø¹Ø©: ${ofc.capacity}</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); deleteOffice(${ofc.id}, '${ofc.name}')" class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
        } catch (error) {
            console.error('Error viewing entity details:', error);
            showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒÙŠØ§Ù†', 'error');
        }
    };

    // Load Branch Relationships
    const loadBranchRelationships = async () => {
        const container = document.getElementById('branch-relationships-container');
        if (!container) return;

        try {
            // Show loading state
            container.innerHTML = `
                <div class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-6xl text-indigo-300 mb-4"></i>
                    <p class="text-slate-500">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª...</p>
                </div>
            `;

            // Fetch merge stats
            const statsResponse = await fetch('/api/merge-stats');
            const stats = await statsResponse.json();

            // Fetch branches stats
            const branchesResponse = await fetch('/api/branches/stats');
            const branchesStats = await branchesResponse.json();

            // Display stats cards
            container.innerHTML = `
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-green-600 mb-2">Ø¯Ù…Ø¬ Ø§Ù„ÙØ±ÙˆØ¹-Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª</p>
                                <p class="text-3xl font-black text-green-700">${stats.merges.branchIncubators.toLocaleString()}</p>
                                <p class="text-xs text-green-600 mt-1">Ø¹Ù„Ø§Ù‚Ø© Ù†Ø´Ø·Ø©</p>
                            </div>
                            <i class="fas fa-seedling text-5xl text-green-300"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 border border-orange-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-orange-600 mb-2">Ø¯Ù…Ø¬ Ø§Ù„ÙØ±ÙˆØ¹-Ø§Ù„Ù…Ù†ØµØ§Øª</p>
                                <p class="text-3xl font-black text-orange-700">${stats.merges.branchPlatforms.toLocaleString()}</p>
                                <p class="text-xs text-orange-600 mt-1">Ø¹Ù„Ø§Ù‚Ø© Ù†Ø´Ø·Ø©</p>
                            </div>
                            <i class="fas fa-server text-5xl text-orange-300"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-6 border border-indigo-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-indigo-600 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª</p>
                                <p class="text-3xl font-black text-indigo-700">${stats.merges.total.toLocaleString()}</p>
                                <p class="text-xs text-indigo-600 mt-1">Ø¹Ù„Ø§Ù‚Ø© Ù†Ø´Ø·Ø©</p>
                            </div>
                            <i class="fas fa-project-diagram text-5xl text-indigo-300"></i>
                        </div>
                    </div>
                </div>

                <!-- Branch Details Table -->
                <div class="bg-slate-50 rounded-xl p-4 mb-6">
                    <h4 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-table text-indigo-600"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ù„ÙƒÙ„ ÙØ±Ø¹
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-white">
                                <tr>
                                    <th class="text-right px-4 py-3 text-sm font-bold text-slate-700">Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹</th>
                                    <th class="text-center px-4 py-3 text-sm font-bold text-green-700">
                                        <i class="fas fa-seedling ml-1"></i>Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª
                                    </th>
                                    <th class="text-center px-4 py-3 text-sm font-bold text-orange-700">
                                        <i class="fas fa-server ml-1"></i>Ø§Ù„Ù…Ù†ØµØ§Øª
                                    </th>
                                    <th class="text-center px-4 py-3 text-sm font-bold text-indigo-700">
                                        <i class="fas fa-link ml-1"></i>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                                    </th>
                                    <th class="text-center px-4 py-3 text-sm font-bold text-slate-700">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                ${branchesStats.map((branch, index) => `
                                    <tr class="hover:bg-white transition-colors ${index % 2 === 0 ? 'bg-slate-50' : 'bg-white'}">
                                        <td class="px-4 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center">
                                                    <i class="fas fa-store text-red-600"></i>
                                                </div>
                                                <div>
                                                    <p class="font-semibold text-slate-800">${branch.name}</p>
                                                    <p class="text-xs text-slate-500">Ù…Ø¹Ø±Ù: ${branch.id}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-4 py-4 text-center">
                                            <span class="inline-flex items-center gap-1 px-4 py-2 rounded-full text-sm font-bold bg-green-100 text-green-700">
                                                <i class="fas fa-seedling"></i>
                                                ${parseInt(branch.incubator_count).toLocaleString()}
                                            </span>
                                        </td>
                                        <td class="px-4 py-4 text-center">
                                            <span class="inline-flex items-center gap-1 px-4 py-2 rounded-full text-sm font-bold bg-orange-100 text-orange-700">
                                                <i class="fas fa-server"></i>
                                                ${parseInt(branch.platform_count).toLocaleString()}
                                            </span>
                                        </td>
                                        <td class="px-4 py-4 text-center">
                                            <span class="inline-flex items-center gap-1 px-4 py-2 rounded-full text-sm font-bold bg-indigo-100 text-indigo-700">
                                                <i class="fas fa-link"></i>
                                                ${(parseInt(branch.incubator_count) + parseInt(branch.platform_count)).toLocaleString()}
                                            </span>
                                        </td>
                                        <td class="px-4 py-4 text-center">
                                            <button onclick="app.viewBranchDetails('${branch.id}')" class="bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold transition flex items-center gap-1 mx-auto">
                                                <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="bg-indigo-50 border-r-4 border-indigo-500 p-4 rounded-lg">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-indigo-600 text-xl mt-0.5"></i>
                        <div class="flex-1">
                            <h5 class="font-bold text-indigo-900 mb-1">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h5>
                            <p class="text-sm text-indigo-700">
                                ØªÙ… Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹ (${stats.entities.branches}) Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª (${stats.entities.incubators}) ÙˆØ§Ù„Ù…Ù†ØµØ§Øª (${stats.entities.platforms}). 
                                ÙƒÙ„ ÙØ±Ø¹ Ø§Ù„Ø¢Ù† Ù…Ø±Ø¨ÙˆØ· Ø¨Ù€ ${stats.entities.incubators} Ø­Ø§Ø¶Ù†Ø© Ùˆ ${stats.entities.platforms} Ù…Ù†ØµØ© Ø¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ.
                            </p>
                        </div>
                    </div>
                </div>
            `;

        } catch (error) {
            console.error('Error loading branch relationships:', error);
            container.innerHTML = `
                <div class="text-center py-12">
                    <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                    <h4 class="text-xl font-bold text-slate-600 mb-2">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª</h4>
                    <p class="text-slate-500 mb-4">${error.message}</p>
                    <button onclick="app.loadBranchRelationships()" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-indigo-700 transition">
                        <i class="fas fa-redo ml-2"></i>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                    </button>
                </div>
            `;
        }
    };

    // View Branch Details
    const viewBranchDetails = async (branchId) => {
        try {
            // Fetch incubators and platforms for this branch
            const [incubatorsRes, platformsRes] = await Promise.all([
                fetch(`/api/branches/${branchId}/incubators`),
                fetch(`/api/branches/${branchId}/platforms`)
            ]);

            const incubators = await incubatorsRes.json();
            const platforms = await platformsRes.json();

            // Create modal content
            const modalContent = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onclick="this.remove()">
                    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden" onclick="event.stopPropagation()">
                        <div class="bg-gradient-to-r from-indigo-600 to-indigo-700 p-6 text-white">
                            <div class="flex items-center justify-between">
                                <h3 class="text-2xl font-black">ØªÙØ§ØµÙŠÙ„ Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„ÙØ±Ø¹</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-white hover:bg-white/20 rounded-full p-2 transition">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[calc(90vh-100px)]">
                            <!-- Incubators Section -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-green-700 mb-4 flex items-center gap-2">
                                    <i class="fas fa-seedling"></i>
                                    Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© (${incubators.length})
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    ${incubators.slice(0, 10).map(inc => `
                                        <div class="bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-green-200 flex items-center justify-center">
                                                <i class="fas fa-seedling text-green-700"></i>
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-semibold text-green-900 text-sm">${inc.name}</p>
                                                <p class="text-xs text-green-600">${inc.relationship_status}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                ${incubators.length > 10 ? `<p class="text-sm text-slate-500 mt-3 text-center">ÙˆØ¹Ø¯Ø¯ ${incubators.length - 10} Ø­Ø§Ø¶Ù†Ø© Ø£Ø®Ø±Ù‰...</p>` : ''}
                            </div>

                            <!-- Platforms Section -->
                            <div>
                                <h4 class="text-lg font-bold text-orange-700 mb-4 flex items-center gap-2">
                                    <i class="fas fa-server"></i>
                                    Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© (${platforms.length})
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    ${platforms.slice(0, 10).map(plat => `
                                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-orange-200 flex items-center justify-center">
                                                <i class="fas fa-server text-orange-700"></i>
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-semibold text-orange-900 text-sm">${plat.name}</p>
                                                <p class="text-xs text-orange-600">${plat.relationship_status} | Score: ${parseFloat(plat.performance_score || 0).toFixed(1)}%</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                ${platforms.length > 10 ? `<p class="text-sm text-slate-500 mt-3 text-center">ÙˆØ¹Ø¯Ø¯ ${platforms.length - 10} Ù…Ù†ØµØ© Ø£Ø®Ø±Ù‰...</p>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalContent);

        } catch (error) {
            console.error('Error viewing branch details:', error);
            showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ±Ø¹', 'error');
        }
    };

    // Toggle Submenu
    const toggleSubmenu = (menuId) => {
        const submenu = document.getElementById(`submenu-${menuId}`);
        const arrow = document.querySelector(`.submenu-arrow-${menuId}`);
        
        if (submenu) {
            submenu.classList.toggle('hidden');
            if (arrow) {
                arrow.classList.toggle('rotate-180');
            }
        }
    };

    // --- EMPLOYEE HR MODULES ---
    
    const renderAttendanceDeparture = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-clock text-brand-600"></i>
                        Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù
                    </h2>
                    <p class="text-slate-500 mt-1">ØªØªØ¨Ø¹ ÙˆÙ‚Øª Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                </div>
                <button onclick="app.markAttendance()" class="px-6 py-3 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition font-bold flex items-center gap-2">
                    <i class="fas fa-fingerprint"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                </button>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 border border-green-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-bold mb-1">Ø­Ø§Ø¶Ø± Ø§Ù„ÙŠÙˆÙ…</p>
                            <h3 class="text-3xl font-black text-green-700">45</h3>
                        </div>
                        <i class="fas fa-user-check text-4xl text-green-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl p-6 border border-red-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-bold mb-1">ØºØ§Ø¦Ø¨ Ø§Ù„ÙŠÙˆÙ…</p>
                            <h3 class="text-3xl font-black text-red-700">5</h3>
                        </div>
                        <i class="fas fa-user-times text-4xl text-red-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl p-6 border border-yellow-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-600 text-sm font-bold mb-1">Ù…ØªØ£Ø®Ø±</p>
                            <h3 class="text-3xl font-black text-yellow-700">3</h3>
                        </div>
                        <i class="fas fa-clock text-4xl text-yellow-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border border-blue-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-bold mb-1">Ø¥Ø¬Ø§Ø²Ø§Øª</p>
                            <h3 class="text-3xl font-black text-blue-700">7</h3>
                        </div>
                        <i class="fas fa-umbrella-beach text-4xl text-blue-300"></i>
                    </div>
                </div>
            </div>

            <!-- Attendance Log -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-4">
                    <i class="fas fa-list text-brand-600 mr-2"></i>
                    Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-50 border-b-2 border-slate-200">
                            <tr>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„Ù‚Ø³Ù…</th>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr class="hover:bg-slate-50 transition">
                                <td class="px-4 py-3">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-brand-600 to-brand-400 flex items-center justify-center text-white font-bold">Ø£Ø­</div>
                                        <div>
                                            <p class="font-bold text-slate-800">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</p>
                                            <p class="text-xs text-slate-500">EMP-001</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-slate-700">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td>
                                <td class="px-4 py-3 text-slate-700 font-medium">08:00 Øµ</td>
                                <td class="px-4 py-3 text-slate-700 font-medium">05:30 Ù…</td>
                                <td class="px-4 py-3 text-brand-600 font-bold">9.5 Ø³Ø§Ø¹Ø©</td>
                                <td class="px-4 py-3">
                                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700">ÙÙŠ Ø§Ù„ÙˆÙ‚Øª</span>
                                </td>
                            </tr>
                            <!-- Add more sample rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        `;
    };

    const renderAttendanceTable = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-table text-brand-600"></i>
                        Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                    </h2>
                    <p class="text-slate-500 mt-1">Ø¹Ø±Ø¶ ØªÙØµÙŠÙ„ÙŠ Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                </div>
                <div class="flex gap-2">
                    <button class="px-4 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition font-bold">
                        <i class="fas fa-download mr-2"></i>
                        ØªØµØ¯ÙŠØ± Excel
                    </button>
                    <button class="px-4 py-2 bg-slate-600 text-white rounded-xl hover:bg-slate-700 transition font-bold">
                        <i class="fas fa-print mr-2"></i>
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="w-full px-4 py-2 rounded-xl border border-slate-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="w-full px-4 py-2 rounded-xl border border-slate-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù‚Ø³Ù…</label>
                        <select class="w-full px-4 py-2 rounded-xl border border-slate-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none">
                            <option>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                            <option>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                            <option>Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</option>
                            <option>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button class="w-full px-4 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition font-bold">
                            <i class="fas fa-filter mr-2"></i>
                            ØªØµÙÙŠØ©
                        </button>
                    </div>
                </div>
            </div>

            <!-- Attendance Calendar View -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-4">
                    <i class="fas fa-calendar-alt text-brand-600 mr-2"></i>
                    Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
                </h3>
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-calendar text-6xl text-slate-300 mb-4"></i>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù‡Ù†Ø§</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderShiftSchedules = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-calendar-alt text-brand-600"></i>
                        Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª
                    </h2>
                    <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¹Ù…Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-calendar-week text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderLeaveManagement = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-umbrella-beach text-brand-600"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
                    </h2>
                    <p class="text-slate-500 mt-1">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-umbrella-beach text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderEmployeeProfile = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-id-card text-brand-600"></i>
                        Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
                    </h2>
                    <p class="text-slate-500 mt-1">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„ÙˆØ¸ÙŠÙÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-id-card text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderPayroll = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-money-check-alt text-brand-600"></i>
                        Ø§Ù„Ø±ÙˆØ§ØªØ¨
                    </h2>
                    <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø¨Ø¯Ù„Ø§Øª</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-money-check-alt text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderPerformance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-chart-line text-brand-600"></i>
                        ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
                    </h2>
                    <p class="text-slate-500 mt-1">ØªÙ‚ÙŠÙŠÙ… ÙˆÙ‚ÙŠØ§Ø³ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-chart-line text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderAttendanceRegister = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-fingerprint text-brand-600"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                    </h2>
                    <p class="text-slate-500 mt-1">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬</p>
                </div>
            </div>

            <!-- Fingerprint Scanner Interface -->
            <div class="bg-gradient-to-br from-brand-50 to-brand-100 rounded-2xl shadow-xl p-12">
                <div class="max-w-md mx-auto text-center">
                    <div class="relative inline-block mb-8">
                        <div class="w-48 h-48 rounded-full bg-white shadow-2xl flex items-center justify-center animate-pulse">
                            <i class="fas fa-fingerprint text-8xl text-brand-600"></i>
                        </div>
                        <div class="absolute -top-2 -right-2 w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white shadow-lg">
                            <i class="fas fa-check text-3xl"></i>
                        </div>
                    </div>
                    <h3 class="text-2xl font-black text-slate-800 mb-2">Ø¶Ø¹ Ø¥ØµØ¨Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø³Ø­</h3>
                    <p class="text-slate-600 mb-8">Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="app.registerAttendance('in')" class="px-8 py-4 bg-green-600 text-white rounded-xl hover:bg-green-700 transition font-bold text-lg shadow-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
                        </button>
                        <button onclick="app.registerAttendance('out')" class="px-8 py-4 bg-red-600 text-white rounded-xl hover:bg-red-700 transition font-bold text-lg shadow-lg">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>

            <!-- Last Registrations -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-4">
                    <i class="fas fa-history text-brand-600 mr-2"></i>
                    Ø¢Ø®Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
                </h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-xl border border-green-200">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center text-white">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div>
                                <p class="font-bold text-slate-800">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</p>
                                <p class="text-xs text-slate-500">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</p>
                            </div>
                        </div>
                        <span class="text-sm font-bold text-green-700">08:00 Øµ</span>
                    </div>
                </div>
            </div>
        </div>
        `;
    };

    // NEW EMPLOYEE HR PAGES
    
    const renderEmpRequests = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-clipboard-list text-brand-600"></i>
                        Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    </h2>
                    <p class="text-slate-500 mt-1">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
                </div>
                <button class="px-6 py-3 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition font-bold">
                    <i class="fas fa-plus mr-2"></i>
                    Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-clipboard-list text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…ØªØ§Ø­</p>
                    <p class="text-sm mt-2">ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ù‡Ù†Ø§</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderEmpLeaves = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                        <i class="fas fa-umbrella-beach text-brand-600"></i>
                        Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
                    </h2>
                    <p class="text-slate-500 mt-1">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</p>
                </div>
                <button class="px-6 py-3 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition font-bold">
                    <i class="fas fa-plus mr-2"></i>
                    Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©
                </button>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-umbrella-beach text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderLeaveBalance = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-calendar-check text-brand-600"></i>
                    Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</p>
            </div>
            
            <!-- Leave Balance Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border border-blue-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-blue-800">Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©</h3>
                        <i class="fas fa-calendar text-3xl text-blue-300"></i>
                    </div>
                    <div class="text-center">
                        <p class="text-4xl font-black text-blue-700">21</p>
                        <p class="text-sm text-blue-600 mt-1">ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</p>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 border border-green-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-green-800">Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©</h3>
                        <i class="fas fa-medkit text-3xl text-green-300"></i>
                    </div>
                    <div class="text-center">
                        <p class="text-4xl font-black text-green-700">15</p>
                        <p class="text-sm text-green-600 mt-1">ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</p>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 border border-purple-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-purple-800">Ø¥Ø¬Ø§Ø²Ø© Ø·Ø§Ø±Ø¦Ø©</h3>
                        <i class="fas fa-exclamation-circle text-3xl text-purple-300"></i>
                    </div>
                    <div class="text-center">
                        <p class="text-4xl font-black text-purple-700">5</p>
                        <p class="text-sm text-purple-600 mt-1">ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</p>
                    </div>
                </div>
            </div>
        </div>
        `;
    };

    const renderNotificationsWarnings = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-bell text-brand-600"></i>
                    Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© Ù„Ùƒ</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-bell text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderEmpDecisions = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-gavel text-brand-600"></i>
                    Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-gavel text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderCompanyViolations = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-exclamation-triangle text-brand-600"></i>
                    Ù…Ø®Ø§Ù„ÙØ§Øª Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ©
                </h2>
                <p class="text-slate-500 mt-1">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-exclamation-triangle text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderEvaluationForms = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-clipboard-check text-brand-600"></i>
                    Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </h2>
                <p class="text-slate-500 mt-1">Ù†Ù…Ø§Ø°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ÙƒÙØ§Ø¡Ø©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-clipboard-check text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderCirculars = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-file-alt text-brand-600"></i>
                    Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-file-alt text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderAdvancesReceivables = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-hand-holding-usd text-brand-600"></i>
                    Ø§Ù„Ø³Ù„Ù ÙˆØ§Ù„Ø°Ù…Ù…
                </h2>
                <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ù ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-hand-holding-usd text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„Ø³Ù„Ù ÙˆØ§Ù„Ø°Ù…Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderSurveys = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-poll text-brand-600"></i>
                    Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø£ÙŠ</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-poll text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderBusinessActivities = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-briefcase text-brand-600"></i>
                    Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-briefcase text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderEmpLetters = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-envelope text-brand-600"></i>
                    Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-envelope text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderCustodies = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-box text-brand-600"></i>
                    Ø§Ù„Ø¹Ù‡Ø¯
                </h2>
                <p class="text-slate-500 mt-1">Ø§Ù„Ø¹Ù‡Ø¯ ÙˆØ§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø³Ù„Ù…Ø© Ù„Ù„Ù…ÙˆØ¸Ù</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-box text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…Ø³Ù„Ù…Ø©</p>
                </div>
            </div>
        </div>
        `;
    };

    const renderSalarySlips = () => {
        return `
        <div class="space-y-6 animate-fade-in">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-receipt text-brand-600"></i>
                    Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ø±Ø§ØªØ¨
                </h2>
                <p class="text-slate-500 mt-1">Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-receipt text-6xl text-slate-300 mb-4"></i>
                    <p class="text-lg font-bold">Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ø±Ø§ØªØ¨</p>
                </div>
            </div>
        </div>
        `;
    };

    const markAttendance = () => {
        showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    };

    const registerAttendance = (type) => {
        const message = type === 'in' ? 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­';
        showToast(message, 'success');
    };

    // Expose functions
    return { 
        init, switchUser, loadRoute, openAdWizard, submitAdWizard, toggleRoleMenu, submitTenantRegistration, 
        renderSettings, saveSettings, previewTheme, toggleMobileMenu, toggleSubmenu, wizardNext, wizardPrev, switchTab,
        openCreateInvoiceModal, submitInvoice, openPaymentModal, submitPayment, reverseTransaction,
        handleApprovalDecision, editApproval, saveApprovalEdit, refreshHierarchy: () => loadRoute('hierarchy'),
        openCreateLinkModal, closeCreateLinkModal, submitCreateLink, deleteLink, changeTenant, viewEntityDetails,
        openRequestModal, submitRequest, filterRequests, viewRequestDetails, deleteRequest,
        loadBranchRelationships, viewBranchDetails, markAttendance, registerAttendance,
        getDb: () => db,  // Expose db for task management
        init: init,  // Expose init function
        loadRoute: loadRoute,  // Expose loadRoute function
        showToast: showToast,  // Expose showToast for external use
        createFacilityRequest, exportFacilityReport, handleFacilitySummary, handleFacilityAction  // Facilities functions
    };
})();

// ========================================
// TASK MANAGEMENT (Outside closure)
// ========================================

window.openCreateTaskModal = function() {
  const modal = document.getElementById('createTaskModal');
  if (modal) {
    modal.classList.remove('hidden');
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('task_due_date').value = today;
  }
};

window.closeCreateTaskModal = function() {
  const modal = document.getElementById('createTaskModal');
  if (modal) {
    modal.classList.add('hidden');
    document.getElementById('createTaskForm').reset();
  }
};

window.submitCreateTask = async function() {
  const formData = {
    title: document.getElementById('task_title').value,
    assignee: document.getElementById('task_assignee').value,
    priority: document.getElementById('task_priority').value,
    status: document.getElementById('task_status').value,
    type: document.getElementById('task_type').value,
    dueDate: document.getElementById('task_due_date').value,
    description: document.getElementById('task_description').value,
    entityId: window.currentUserData?.entityId || 'HQ001'
  };

  // Validation
  if (!formData.title || !formData.assignee || !formData.priority || !formData.status || !formData.type || !formData.dueDate) {
    alert('âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
    return;
  }

  try {
    // Get database from app
    const db = app.getDb();
    
    // Create new task ID
    const newId = Math.max(...db.tasks.map(t => t.id || 0), 0) + 1;
    
    // Add task to db.tasks
    const newTask = {
      id: newId,
      title: formData.title,
      assignee: formData.assignee,
      dueDate: formData.dueDate,
      status: formData.status,
      priority: formData.priority,
      type: formData.type,
      description: formData.description,
      entityId: formData.entityId
    };
    
    db.tasks.push(newTask);
    console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', newTask);
    
    // Close modal and show success
    window.closeCreateTaskModal();
    alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© "${formData.title}" Ø¨Ù†Ø¬Ø§Ø­!`);
    
    // Refresh the tasks page to show the new task
    app.loadRoute('tasks');
  } catch (error) {
    console.error('Error creating task:', error);
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// ========================================
// TASK VIEWING, EDITING, AND DELETING
// ========================================

// Global variable to track currently viewed task
let currentViewedTaskId = null;

// View task details
window.viewTaskDetails = function(taskId) {
  try {
    const db = app.getDb();
    const task = db.tasks.find(t => t.id === taskId);
    
    if (!task) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©');
      return;
    }
    
    // Store the task ID for edit/delete operations
    currentViewedTaskId = taskId;
    
    // Status colors
    const statusColors = {
      'Pending': 'bg-yellow-100 text-yellow-700 border-yellow-300',
      'In Progress': 'bg-red-100 text-red-700 border-blue-300',
      'Done': 'bg-green-100 text-green-700 border-green-300',
      'Cancelled': 'bg-red-100 text-red-700 border-red-300'
    };
    
    const priorityColors = {
      'High': 'bg-red-100 text-red-700 border-red-300',
      'Medium': 'bg-orange-100 text-orange-700 border-orange-300',
      'Low': 'bg-green-100 text-green-700 border-green-300'
    };
    
    const typeIcons = {
      'Billing': 'fa-file-invoice-dollar',
      'Ops': 'fa-cogs',
      'Support': 'fa-headset',
      'Development': 'fa-code',
      'Marketing': 'fa-bullhorn',
      'HR': 'fa-users'
    };
    
    // Populate modal content
    const content = `
      <div class="space-y-6">
        <!-- Title -->
        <div>
          <h3 class="text-2xl font-bold text-slate-800 mb-2">${task.title}</h3>
          <div class="flex gap-2">
            <span class="px-3 py-1 rounded-full text-sm font-bold border-2 ${statusColors[task.status] || 'bg-slate-100 text-slate-700 border-slate-300'}">
              <i class="fas fa-circle text-xs mr-1"></i>${task.status}
            </span>
            <span class="px-3 py-1 rounded-full text-sm font-bold border-2 ${priorityColors[task.priority] || 'bg-slate-100 text-slate-700 border-slate-300'}">
              <i class="fas fa-flag text-xs mr-1"></i>${task.priority}
            </span>
            <span class="px-3 py-1 rounded-full text-sm font-bold bg-slate-100 text-slate-700 border-2 border-slate-300">
              <i class="fas ${typeIcons[task.type] || 'fa-folder'} text-xs mr-1"></i>${task.type}
            </span>
          </div>
        </div>
        
        <!-- Details Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
            <label class="text-sm font-bold text-slate-600 mb-1 block">
              <i class="fas fa-calendar-alt ml-1"></i>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚
            </label>
            <p class="text-lg font-semibold text-slate-800">${task.dueDate}</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
            <label class="text-sm font-bold text-slate-600 mb-1 block">
              <i class="fas fa-hashtag ml-1"></i>Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ù…Ø©
            </label>
            <p class="text-lg font-semibold text-slate-800">#${task.id}</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-4 border border-slate-200 md:col-span-2">
            <label class="text-sm font-bold text-slate-600 mb-1 block">
              <i class="fas fa-building ml-1"></i>Ø§Ù„ÙƒÙŠØ§Ù†
            </label>
            <p class="text-lg font-semibold text-slate-800">${task.entityId}</p>
          </div>
        </div>
        
        <!-- Description -->
        ${task.description ? `
        <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
          <label class="text-sm font-bold text-slate-600 mb-2 block">
            <i class="fas fa-align-right ml-1"></i>Ø§Ù„ÙˆØµÙ
          </label>
          <p class="text-slate-700 leading-relaxed whitespace-pre-wrap">${task.description}</p>
        </div>
        ` : `
        <div class="bg-slate-50 rounded-lg p-4 border border-slate-200 text-center">
          <p class="text-slate-500 italic">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©</p>
        </div>
        `}
      </div>
    `;
    
    document.getElementById('taskDetailsContent').innerHTML = content;
    
    // Show modal
    const modal = document.getElementById('viewTaskModal');
    if (modal) {
      modal.classList.remove('hidden');
    }
  } catch (error) {
    console.error('Error viewing task:', error);
    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©');
  }
};

// Close view task modal
window.closeViewTaskModal = function() {
  const modal = document.getElementById('viewTaskModal');
  if (modal) {
    modal.classList.add('hidden');
    currentViewedTaskId = null;
  }
};

// Edit task from view modal
window.editTaskFromView = function() {
  if (!currentViewedTaskId) {
    alert('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ù‡Ù…Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„');
    return;
  }
  
  try {
    const db = app.getDb();
    const task = db.tasks.find(t => t.id === currentViewedTaskId);
    
    if (!task) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©');
      return;
    }
    
    // Close view modal
    window.closeViewTaskModal();
    
    // Populate edit form with task data
    document.getElementById('task_title').value = task.title;
    document.getElementById('task_priority').value = task.priority;
    document.getElementById('task_status').value = task.status;
    document.getElementById('task_type').value = task.type;
    document.getElementById('task_due_date').value = task.dueDate;
    document.getElementById('task_description').value = task.description || '';
    
    // Change modal title
    const modalTitle = document.querySelector('#createTaskModal h2');
    if (modalTitle) {
      modalTitle.innerHTML = '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©';
    }
    
    // Change button text and action
    const submitBtn = document.querySelector('#createTaskModal button[onclick*="submitCreateTask"]');
    if (submitBtn) {
      submitBtn.innerHTML = '<i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
      submitBtn.setAttribute('onclick', `window.submitEditTask(${currentViewedTaskId})`);
    }
    
    // Open create/edit modal
    window.openCreateTaskModal();
  } catch (error) {
    console.error('Error editing task:', error);
    alert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù‡Ù…Ø©');
  }
};

// Submit edited task
window.submitEditTask = async function(taskId) {
  const formData = {
    title: document.getElementById('task_title').value,
    priority: document.getElementById('task_priority').value,
    status: document.getElementById('task_status').value,
    type: document.getElementById('task_type').value,
    dueDate: document.getElementById('task_due_date').value,
    description: document.getElementById('task_description').value
  };

  // Validation
  if (!formData.title || !formData.priority || !formData.status || !formData.type || !formData.dueDate) {
    alert('âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
    return;
  }

  try {
    const db = app.getDb();
    const taskIndex = db.tasks.findIndex(t => t.id === taskId);
    
    if (taskIndex === -1) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©');
      return;
    }
    
    // Update task
    db.tasks[taskIndex] = {
      ...db.tasks[taskIndex],
      title: formData.title,
      priority: formData.priority,
      status: formData.status,
      type: formData.type,
      dueDate: formData.dueDate,
      description: formData.description
    };
    
    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©:', db.tasks[taskIndex]);
    
    // Reset form and modal
    window.closeCreateTaskModal();
    
    // Reset button to create mode
    const modalTitle = document.querySelector('#createTaskModal h2');
    if (modalTitle) {
      modalTitle.innerHTML = '<i class="fas fa-tasks"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©';
    }
    
    const submitBtn = document.querySelector('#createTaskModal button[onclick*="submitEditTask"]');
    if (submitBtn) {
      submitBtn.innerHTML = '<i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©';
      submitBtn.setAttribute('onclick', 'window.submitCreateTask()');
    }
    
    alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø© "${formData.title}" Ø¨Ù†Ø¬Ø§Ø­!`);
    
    // Refresh tasks page
    app.loadRoute('tasks');
  } catch (error) {
    console.error('Error updating task:', error);
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Delete task from view modal
window.deleteTaskFromView = function() {
  if (!currentViewedTaskId) {
    alert('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ù‡Ù…Ø© Ù„Ù„Ø­Ø°Ù');
    return;
  }
  
  try {
    const db = app.getDb();
    const task = db.tasks.find(t => t.id === currentViewedTaskId);
    
    if (!task) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©');
      return;
    }
    
    // Confirm deletion
    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© "${task.title}"ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
      return;
    }
    
    // Delete task
    const taskIndex = db.tasks.findIndex(t => t.id === currentViewedTaskId);
    if (taskIndex !== -1) {
      db.tasks.splice(taskIndex, 1);
      console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­');
    }
    
    // Close modal
    window.closeViewTaskModal();
    
    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    
    // Refresh tasks page
    app.loadRoute('tasks');
  } catch (error) {
    console.error('Error deleting task:', error);
    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©');
  }
};

// ========================================
// INCUBATOR TRAINING SYSTEM (Outside closure)
// Ù†Ø¸Ø§Ù… Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©
// ========================================

window.renderIncubatorSystem = async function(currentUser) {
  const container = document.querySelector('#main-view');
  
  // Check if a platform is selected, otherwise show platforms list
  const selectedPlatformId = localStorage.getItem('nayosh_selected_platform');
  
  if (!selectedPlatformId) {
    // Show platforms selection screen
    return renderPlatformSelection(currentUser);
  }
  
  // Platform is selected, render the training system for this platform
  // Initialize active tab
  if (!window.incubatorActiveTab) window.incubatorActiveTab = 'overview';
  
  container.innerHTML = `
    <div class="space-y-6">
      <!-- Header with Back Button -->
      <div class="bg-gradient-to-r from-red-600 to-blue-800 text-white p-6 rounded-lg shadow-lg flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold mb-2">ğŸ“ Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©</h1>
          <p class="text-blue-100">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ£Ù‡ÙŠÙ„ - ${currentUser.entityName}</p>
          <p class="text-blue-200 text-sm mt-2" id="platform-name-header">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©...</p>
        </div>
        <button onclick="window.changePlatform()" class="bg-red-500 hover:bg-blue-400 text-white px-4 py-2 rounded-lg transition">
          <i class="fas fa-arrow-right ml-2"></i> Ø§Ø®ØªØ± Ù…Ù†ØµØ© Ø£Ø®Ø±Ù‰
        </button>
      </div>

      <!-- Statistics Cards -->
      <div id="incubator-stats" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
              <p class="text-3xl font-bold text-red-600" id="stat-programs">-</p>
            </div>
            <div class="bg-red-100 p-3 rounded-full">
              <i class="fas fa-book text-red-600 text-2xl"></i>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</p>
              <p class="text-3xl font-bold text-green-600" id="stat-beneficiaries">-</p>
            </div>
            <div class="bg-green-100 p-3 rounded-full">
              <i class="fas fa-users text-green-600 text-2xl"></i>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
              <p class="text-3xl font-bold text-orange-600" id="stat-sessions">-</p>
            </div>
            <div class="bg-orange-100 p-3 rounded-full">
              <i class="fas fa-chalkboard-teacher text-orange-600 text-2xl"></i>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ù„Ø­Ø©</p>
              <p class="text-3xl font-bold text-purple-600" id="stat-certificates">-</p>
            </div>
            <div class="bg-purple-100 p-3 rounded-full">
              <i class="fas fa-certificate text-purple-600 text-2xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Area with Tabs -->
      <div class="bg-white rounded-lg shadow">
        <!-- Tab Navigation -->
        <div class="border-b border-gray-200">
          <nav class="flex -mb-px overflow-x-auto">
            <button onclick="window.switchIncubatorTab('overview')" 
                    class="incubator-tab-btn px-6 py-3 font-medium text-sm whitespace-nowrap ${window.incubatorActiveTab === 'overview' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-500 hover:text-gray-700'}">
              ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
            </button>
            <button onclick="window.switchIncubatorTab('programs')" 
                    class="incubator-tab-btn px-6 py-3 font-medium text-sm whitespace-nowrap ${window.incubatorActiveTab === 'programs' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-500 hover:text-gray-700'}">
              ğŸ“š Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©
            </button>
            <button onclick="window.switchIncubatorTab('beneficiaries')" 
                    class="incubator-tab-btn px-6 py-3 font-medium text-sm whitespace-nowrap ${window.incubatorActiveTab === 'beneficiaries' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-500 hover:text-gray-700'}">
              ğŸ‘¥ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†
            </button>
            <button onclick="window.switchIncubatorTab('sessions')" 
                    class="incubator-tab-btn px-6 py-3 font-medium text-sm whitespace-nowrap ${window.incubatorActiveTab === 'sessions' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-500 hover:text-gray-700'}">
              ğŸ“… Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©
            </button>
            <button onclick="window.switchIncubatorTab('certificates')" 
                    class="incubator-tab-btn px-6 py-3 font-medium text-sm whitespace-nowrap ${window.incubatorActiveTab === 'certificates' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-500 hover:text-gray-700'}">
              ğŸ† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª
            </button>
          </nav>
        </div>

        <!-- Tab Content -->
        <div id="incubator-tab-content" class="p-6">
          <!-- Content will be loaded here -->
        </div>
      </div>
    </div>
  `;

  // Load platform name in header
  try {
    const platforms = await window.fetchAPI(`/incubators/${currentUser.entityId}/platforms`);
    const currentPlatform = platforms.find(p => p.id === parseInt(selectedPlatformId));
    if (currentPlatform) {
      document.getElementById('platform-name-header').textContent = `ğŸ“ Ø§Ù„Ù…Ù†ØµØ©: ${currentPlatform.name}`;
    }
  } catch (error) {
    console.error('Error loading platform:', error);
  }

  // Load statistics
  try {
    const stats = await window.fetchAPI(`/incubator/stats?entity_id=${currentUser.entityId}`);
    document.getElementById('stat-programs').textContent = stats.total_programs || 0;
    document.getElementById('stat-beneficiaries').textContent = stats.total_beneficiaries || 0;
    document.getElementById('stat-sessions').textContent = stats.active_sessions || 0;
    document.getElementById('stat-certificates').textContent = stats.active_certificates || 0;
  } catch (error) {
    console.error('Error loading stats:', error);
  }
  
  // Load initial tab content
  window.switchIncubatorTab(window.incubatorActiveTab);
};

// Switch between incubator tabs
window.switchIncubatorTab = async function(tab) {
  window.incubatorActiveTab = tab;
  const content = document.getElementById('incubator-tab-content');
  
  if (!content) return;
  
  // Show loading
  content.innerHTML = `
    <div class="flex items-center justify-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div>
    </div>
  `;
  
  try {
    const currentUser = window.currentUserData;
    
    switch(tab) {
      case 'overview':
        await renderIncubatorOverview(content, currentUser);
        break;
      case 'programs':
        await renderTrainingPrograms(content, currentUser);
        break;
      case 'beneficiaries':
        await renderBeneficiaries(content, currentUser);
        break;
      case 'sessions':
        await renderTrainingSessions(content, currentUser);
        break;
      case 'certificates':
        await renderCertificates(content, currentUser);
        break;
      default:
        content.innerHTML = `<p class="text-gray-500">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…ØªÙˆÙØ±</p>`;
    }
    
    // Update tab buttons
    document.querySelectorAll('.incubator-tab-btn').forEach(btn => {
      btn.className = btn.className.replace(/border-b-2 border-red-500 text-red-600/, 'text-gray-500 hover:text-gray-700');
    });
    const activeBtn = document.querySelector(`button[onclick*="${tab}"]`);
    if (activeBtn) {
      activeBtn.className = activeBtn.className.replace(/text-gray-500 hover:text-gray-700/, 'border-b-2 border-red-500 text-red-600');
    }
  } catch (error) {
    console.error('Error loading tab:', error);
    content.innerHTML = `
      <div class="text-center py-8 text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰: ${error.message}</p>
      </div>
    `;
  }
};

// Render Platform Selection
async function renderPlatformSelection(currentUser) {
  const container = document.querySelector('#main-view');
  
  container.innerHTML = `
    <div class="space-y-6">
      <!-- Header -->
      <div class="bg-gradient-to-r from-red-600 to-blue-800 text-white p-6 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold mb-2">ğŸ“ Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©</h1>
        <p class="text-blue-100">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© - ${currentUser.entityName}</p>
      </div>

      <!-- Loading -->
      <div class="bg-white p-8 rounded-lg shadow text-center" id="platforms-loading">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div>
        <p class="text-gray-600 mt-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª...</p>
      </div>

      <!-- Platforms Grid -->
      <div id="platforms-grid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

      <!-- No Platforms Message -->
      <div id="no-platforms" class="hidden bg-yellow-50 p-8 rounded-lg border border-yellow-200 text-center">
        <i class="fas fa-inbox text-yellow-600 text-5xl mb-4"></i>
        <p class="text-yellow-800 font-bold text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØµØ§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
        <p class="text-yellow-600 mt-2">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</p>
      </div>
    </div>
  `;

  try {
    // Get incubator ID from entity
    const incubatorId = currentUser?.entityId || window.currentUserData?.entityId;
    console.log('ğŸ“‹ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª Ù„Ù„Ø­Ø§Ø¶Ù†Ø©:', incubatorId);
    
    if (!incubatorId) {
      throw new Error('Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø­Ø§Ø¶Ù†Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - Incubator ID not found');
    }

    const platforms = await window.fetchAPI(`/incubators/${incubatorId}/platforms`);
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª:', platforms.length);

    const loadingEl = document.getElementById('platforms-loading');
    const gridEl = document.getElementById('platforms-grid');
    const noEl = document.getElementById('no-platforms');

    if (platforms.length === 0) {
      loadingEl.classList.add('hidden');
      noEl.classList.remove('hidden');
      return;
    }

    // Render platforms
    gridEl.innerHTML = platforms.map(platform => `
      <div class="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow overflow-hidden group relative">
        <div onclick="window.selectPlatform(${platform.id}, '${platform.name}')" class="cursor-pointer">
          <div class="bg-gradient-to-r from-red-500 to-blue-600 p-6 text-white group-hover:from-red-600 group-hover:to-red-700 transition">
            <i class="fas fa-graduation-cap text-4xl mb-3"></i>
            <h3 class="text-xl font-bold">${platform.name}</h3>
            ${platform.description ? `<p class="text-sm text-blue-100 mt-2">${platform.description}</p>` : ''}
            ${platform.code ? `<p class="text-xs text-blue-200 mt-2">Ø§Ù„Ø±Ù…Ø²: ${platform.code}</p>` : ''}
          </div>
          <div class="p-6">
            <button class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition font-bold">
              Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© <i class="fas fa-arrow-left ml-2"></i>
            </button>
          </div>
        </div>
        <button onclick="event.stopPropagation(); deletePlatform(${platform.id}, '${platform.name.replace(/'/g, "\\'")}'); return false;" 
                class="absolute top-2 left-2 bg-red-500 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-600 transition z-10">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `).join('');

    loadingEl.classList.add('hidden');
    gridEl.classList.remove('hidden');

  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª:', error);
    document.getElementById('platforms-loading').innerHTML = `
      <div class="text-center">
        <i class="fas fa-exclamation-circle text-red-600 text-5xl mb-4"></i>
        <p class="text-red-600 font-bold">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª</p>
        <p class="text-red-500 mt-2">${error.message}</p>
      </div>
    `;
  }
}

// Select a platform
window.selectPlatform = function(platformId, platformName) {
  console.log('âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØµØ©:', platformName, platformId);
  localStorage.setItem('nayosh_selected_platform', platformId);
  localStorage.setItem('nayosh_selected_platform_name', platformName);
  window.renderIncubatorSystem(window.currentUserData);
};

// Change platform
window.changePlatform = function() {
  console.log('ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†ØµØ©');
  localStorage.removeItem('nayosh_selected_platform');
  localStorage.removeItem('nayosh_selected_platform_name');
  window.incubatorActiveTab = 'overview'; // Reset tab
  window.renderIncubatorSystem(window.currentUserData);
};

// Overview Tab
async function renderIncubatorOverview(container, currentUser) {
  container.innerHTML = `
    <div class="space-y-4">
      <h3 class="text-lg font-bold mb-4">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</h3>
      <p class="text-gray-600 mb-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ£Ù‡ÙŠÙ„</p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <button onclick="window.switchIncubatorTab('programs')" class="border rounded-lg p-6 hover:shadow-lg transition text-right cursor-pointer bg-white hover:bg-red-50">
          <i class="fas fa-book text-red-600 text-3xl mb-3"></i>
          <h4 class="font-bold mb-2 text-lg">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h4>
          <p class="text-sm text-gray-600">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
        </button>
        <button onclick="window.switchIncubatorTab('beneficiaries')" class="border rounded-lg p-6 hover:shadow-lg transition text-right cursor-pointer bg-white hover:bg-green-50">
          <i class="fas fa-users text-green-600 text-3xl mb-3"></i>
          <h4 class="font-bold mb-2 text-lg">Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</h4>
          <p class="text-sm text-gray-600">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† ÙˆØ§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</p>
        </button>
        <button onclick="window.switchIncubatorTab('sessions')" class="border rounded-lg p-6 hover:shadow-lg transition text-right cursor-pointer bg-white hover:bg-orange-50">
          <i class="fas fa-calendar text-orange-600 text-3xl mb-3"></i>
          <h4 class="font-bold mb-2 text-lg">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h4>
          <p class="text-sm text-gray-600">Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
        </button>
        <button onclick="window.switchIncubatorTab('certificates')" class="border rounded-lg p-6 hover:shadow-lg transition text-right cursor-pointer bg-white hover:bg-purple-50">
          <i class="fas fa-certificate text-purple-600 text-3xl mb-3"></i>
          <h4 class="font-bold mb-2 text-lg">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h4>
          <p class="text-sm text-gray-600">Ø¥ØµØ¯Ø§Ø± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</p>
        </button>
      </div>
    </div>
  `;
}

// Training Programs Tab
async function renderTrainingPrograms(container, currentUser) {
  try {
    const programs = await window.fetchAPI(`/training-programs?entity_id=${currentUser.entityId}`);
    
    container.innerHTML = `
      <div class="space-y-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
          <button onclick="window.openAddProgramModal()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
            <i class="fas fa-plus ml-2"></i> Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
        
        ${programs && programs.length > 0 ? `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${programs.map(program => `
              <div class="border rounded-lg p-4 hover:shadow-lg transition-shadow bg-white">
                <div class="flex justify-between items-start mb-3">
                  <div>
                    <h4 class="font-bold text-lg text-red-600">${program.name}</h4>
                    <p class="text-sm text-gray-500">${program.code}</p>
                  </div>
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${
                    program.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                  }">
                    ${program.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                  </span>
                </div>
                
                <p class="text-gray-600 text-sm mb-3">${program.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                
                <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                  <div class="flex items-center text-gray-600">
                    <i class="fas fa-clock ml-2"></i>
                    ${program.duration_hours} Ø³Ø§Ø¹Ø©
                  </div>
                  <div class="flex items-center text-gray-600">
                    <i class="fas fa-users ml-2"></i>
                    ${program.max_participants} Ù…ØªØ¯Ø±Ø¨
                  </div>
                  <div class="flex items-center text-gray-600">
                    <i class="fas fa-money-bill ml-2"></i>
                    ${program.price} Ø±ÙŠØ§Ù„
                  </div>
                  <div class="flex items-center text-gray-600">
                    <i class="fas fa-percentage ml-2"></i>
                    ${program.passing_score}% Ù„Ù„Ù†Ø¬Ø§Ø­
                  </div>
                </div>
                
                <div class="flex items-center justify-between pt-3 border-t">
                  <span class="text-xs text-gray-500">
                    ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©: ${program.certificate_validity_months} Ø´Ù‡Ø±
                  </span>
                  <div class="space-x-2 space-x-reverse flex gap-2">
                    <button onclick="window.viewProgramDetails(${program.id})" class="text-red-600 hover:text-blue-800 px-3 py-1 text-sm border border-red-600 rounded">
                      <i class="fas fa-eye ml-1"></i> Ø¹Ø±Ø¶
                    </button>
                    <button onclick="window.editProgram(${program.id})" class="text-green-600 hover:text-green-800 px-3 py-1 text-sm border border-green-600 rounded">
                      <i class="fas fa-edit ml-1"></i> ØªØ¹Ø¯ÙŠÙ„
                    </button>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="text-center py-12 bg-gray-50 rounded-lg">
            <i class="fas fa-book text-gray-400 text-5xl mb-4"></i>
            <h4 class="text-lg font-bold text-gray-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h4>
            <p class="text-gray-500 mb-4">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ</p>
            <button onclick="window.openAddProgramModal()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition">
              <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬
            </button>
          </div>
        `}
      </div>
    `;
  } catch (error) {
    console.error('Error loading programs:', error);
    container.innerHTML = `
      <div class="text-center py-8 text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬: ${error.message}</p>
      </div>
    `;
  }
}

// Beneficiaries Tab
async function renderBeneficiaries(container, currentUser) {
  try {
    const beneficiaries = await window.fetchAPI(`/beneficiaries?entity_id=${currentUser.entityId}`);
    
    container.innerHTML = `
      <div class="space-y-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</h3>
          <button onclick="window.openAddBeneficiaryModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
            <i class="fas fa-plus ml-2"></i> Ù…Ø³ØªÙÙŠØ¯ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
        
        ${beneficiaries && beneficiaries.length > 0 ? `
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border rounded-lg">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø§Ø³Ù…</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                ${beneficiaries.map(b => `
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <div class="h-10 w-10 rounded-full bg-green-100 flex items-center justify-center ml-3">
                          <i class="fas fa-user text-green-600"></i>
                        </div>
                        <div>
                          <div class="font-medium">${b.full_name}</div>
                          <div class="text-sm text-gray-500">${b.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯'}</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${b.national_id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${b.phone || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 py-1 text-xs rounded-full ${
                        b.status === 'ACTIVE' ? 'bg-green-100 text-green-800' : 
                        b.status === 'GRADUATED' ? 'bg-red-100 text-blue-800' : 
                        'bg-gray-100 text-gray-800'
                      }">
                        ${b.status === 'ACTIVE' ? 'Ù†Ø´Ø·' : b.status === 'GRADUATED' ? 'Ø®Ø±ÙŠØ¬' : 'Ù…ØªÙˆÙ‚Ù'}
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      <button onclick="window.viewBeneficiaryDetails(${b.id})" class="text-red-600 hover:text-blue-800 ml-3 px-2 py-1 border border-red-600 rounded">
                        <i class="fas fa-eye ml-1"></i> Ø¹Ø±Ø¶
                      </button>
                      <button onclick="window.editBeneficiary(${b.id})" class="text-green-600 hover:text-green-800 px-2 py-1 border border-green-600 rounded">
                        <i class="fas fa-edit ml-1"></i> ØªØ¹Ø¯ÙŠÙ„
                      </button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        ` : `
          <div class="text-center py-12 bg-gray-50 rounded-lg">
            <i class="fas fa-users text-gray-400 text-5xl mb-4"></i>
            <h4 class="text-lg font-bold text-gray-700 mb-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</h4>
            <p class="text-gray-500 mb-4">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø³ØªÙÙŠØ¯</p>
            <button onclick="window.openAddBeneficiaryModal()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
              <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙÙŠØ¯
            </button>
          </div>
        `}
      </div>
    `;
  } catch (error) {
    console.error('Error loading beneficiaries:', error);
    container.innerHTML = `
      <div class="text-center py-8 text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†: ${error.message}</p>
      </div>
    `;
  }
}

// Training Sessions Tab
async function renderTrainingSessions(container, currentUser) {
  try {
    const sessions = await window.fetchAPI(`/training-sessions?entity_id=${currentUser.entityId}`);
    
    container.innerHTML = `
      <div class="space-y-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
          <button onclick="window.openAddSessionModal()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition">
            <i class="fas fa-plus ml-2"></i> Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
          </button>
        </div>
        
        ${sessions && sessions.length > 0 ? `
          <div class="space-y-4">
            ${sessions.map(session => `
              <div class="border rounded-lg p-4 hover:shadow-lg transition-shadow bg-white">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <h4 class="font-bold text-lg">${session.session_name}</h4>
                    <p class="text-sm text-gray-600">${session.program_name} (${session.program_code})</p>
                  </div>
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${
                    session.status === 'IN_PROGRESS' ? 'bg-orange-100 text-orange-800' :
                    session.status === 'COMPLETED' ? 'bg-green-100 text-green-800' :
                    session.status === 'PLANNED' ? 'bg-red-100 text-blue-800' :
                    'bg-gray-100 text-gray-800'
                  }">
                    ${
                      session.status === 'IN_PROGRESS' ? 'Ø¬Ø§Ø±ÙŠØ©' :
                      session.status === 'COMPLETED' ? 'Ù…ÙƒØªÙ…Ù„Ø©' :
                      session.status === 'PLANNED' ? 'Ù…Ø®Ø·Ø·Ø©' :
                      'Ù…Ù„ØºØ§Ø©'
                    }
                  </span>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                  <div class="text-sm">
                    <span class="text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</span>
                    <p class="font-medium">${new Date(session.start_date).toLocaleDateString('ar-SA')}</p>
                  </div>
                  <div class="text-sm">
                    <span class="text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span>
                    <p class="font-medium">${new Date(session.end_date).toLocaleDateString('ar-SA')}</p>
                  </div>
                  <div class="text-sm">
                    <span class="text-gray-500">Ø§Ù„Ù…Ø¯Ø±Ø¨:</span>
                    <p class="font-medium">${session.instructor_name || '-'}</p>
                  </div>
                  <div class="text-sm">
                    <span class="text-gray-500">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†:</span>
                    <p class="font-medium">${session.current_participants} / ${session.max_participants}</p>
                  </div>
                </div>
                
                <div class="flex items-center justify-between pt-3 border-t">
                  <span class="text-sm text-gray-600">
                    <i class="fas fa-map-marker-alt ml-2"></i>${session.location || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
                  </span>
                  <div class="space-x-2 space-x-reverse flex gap-2">
                    <button onclick="window.viewSessionDetails(${session.id})" class="text-red-600 hover:text-blue-800 px-3 py-1 text-sm border border-red-600 rounded">
                      <i class="fas fa-eye ml-1"></i> Ø¹Ø±Ø¶
                    </button>
                    <button onclick="window.editSession(${session.id})" class="text-orange-600 hover:text-orange-800 px-3 py-1 text-sm border border-orange-600 rounded">
                      <i class="fas fa-edit ml-1"></i> ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button onclick="window.manageEnrollments(${session.id}, '${session.session_name}')" class="text-green-600 hover:text-green-800 px-3 py-1 text-sm border border-green-600 rounded">
                      <i class="fas fa-users ml-1"></i> Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†
                    </button>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="text-center py-12 bg-gray-50 rounded-lg">
            <i class="fas fa-calendar text-gray-400 text-5xl mb-4"></i>
            <h4 class="text-lg font-bold text-gray-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h4>
            <p class="text-gray-500 mb-4">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¯ÙØ¹Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>
            <button onclick="window.openAddSessionModal()" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition">
              <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©
            </button>
          </div>
        `}
      </div>
    `;
  } catch (error) {
    console.error('Error loading sessions:', error);
    container.innerHTML = `
      <div class="text-center py-8 text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª: ${error.message}</p>
      </div>
    `;
  }
}

// Certificates Tab
async function renderCertificates(container, currentUser) {
  try {
    const certificates = await window.fetchAPI(`/certificates?entity_id=${currentUser.entityId}`);
    
    container.innerHTML = `
      <div class="space-y-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h3>
          <div class="flex gap-2">
            <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©..." 
                   class="border rounded-lg px-4 py-2" 
                   id="cert-search">
            <button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
              <i class="fas fa-search"></i> ØªØ­Ù‚Ù‚
            </button>
          </div>
        </div>
        
        ${certificates && certificates.length > 0 ? `
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            ${certificates.map(cert => `
              <div class="border-2 rounded-lg p-6 bg-gradient-to-br from-purple-50 to-white hover:shadow-xl transition-all">
                <div class="text-center mb-4">
                  <div class="bg-purple-600 text-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-certificate text-2xl"></i>
                  </div>
                  <h4 class="font-bold text-lg">${cert.full_name}</h4>
                  <p class="text-sm text-gray-600">${cert.national_id}</p>
                </div>
                
                <div class="space-y-2 text-sm mb-4">
                  <div class="flex justify-between">
                    <span class="text-gray-600">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:</span>
                    <span class="font-medium">${cert.program_name}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:</span>
                    <span class="font-mono text-xs">${cert.certificate_number}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</span>
                    <span>${new Date(cert.issue_date).toLocaleDateString('ar-SA')}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">ØªÙ†ØªÙ‡ÙŠ ÙÙŠ:</span>
                    <span>${new Date(cert.expiry_date).toLocaleDateString('ar-SA')}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Ø§Ù„Ø¯Ø±Ø¬Ø©:</span>
                    <span class="font-bold ${
                      cert.grade === 'EXCELLENT' ? 'text-green-600' :
                      cert.grade === 'VERY_GOOD' ? 'text-red-600' :
                      'text-gray-600'
                    }">${cert.final_score}%</span>
                  </div>
                </div>
                
                <div class="flex justify-between items-center pt-3 border-t">
                  <span class="px-2 py-1 rounded-full text-xs font-medium ${
                    cert.status === 'VALID' ? 'bg-green-100 text-green-800' :
                    cert.status === 'EXPIRED' ? 'bg-red-100 text-red-800' :
                    'bg-gray-100 text-gray-800'
                  }">
                    ${cert.status === 'VALID' ? 'ØµØ§Ù„Ø­Ø©' : cert.status === 'EXPIRED' ? 'Ù…Ù†ØªÙ‡ÙŠØ©' : 'Ù…Ù„ØºØ§Ø©'}
                  </span>
                  <button onclick="window.viewCertificateDetails(${cert.id})" class="text-purple-600 hover:text-purple-800 text-sm border border-purple-600 px-3 py-1 rounded">
                    <i class="fas fa-eye ml-1"></i> Ø¹Ø±Ø¶
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="text-center py-12 bg-gray-50 rounded-lg">
            <i class="fas fa-certificate text-gray-400 text-5xl mb-4"></i>
            <h4 class="text-lg font-bold text-gray-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ù‡Ø§Ø¯Ø§Øª</h4>
            <p class="text-gray-500 mb-4">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ø¥ØµØ¯Ø§Ø±Ù‡Ø§</p>
          </div>
        `}
      </div>
    `;
  } catch (error) {
    console.error('Error loading certificates:', error);
    container.innerHTML = `
      <div class="text-center py-8 text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª: ${error.message}</p>
      </div>
    `;
  }
}

// ========================================
// INCUBATOR MODAL FUNCTIONS
// ========================================

// Open Add Training Program Modal
window.openAddProgramModal = function() {
  const modal = document.createElement('div');
  modal.id = 'add-program-modal';
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
  modal.innerHTML = `
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="bg-red-600 text-white p-6 rounded-t-lg">
        <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ø¬Ø¯ÙŠØ¯</h2>
      </div>
      
      <form id="add-program-form" class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
            <input type="text" name="name" required 
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø±Ù…Ø² Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
            <input type="text" name="code" required 
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="Ù…Ø«Ø§Ù„: SAF101">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
            <textarea name="description" rows="3"
                      class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                      placeholder="ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ..."></textarea>
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª *</label>
            <input type="number" name="duration_hours" required min="1"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="40">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† *</label>
            <input type="number" name="max_participants" required min="1"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="20">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„) *</label>
            <input type="number" name="price" required min="0" step="0.01"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="5000">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (%) *</label>
            <input type="number" name="passing_score" required min="0" max="100"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="70">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© (Ø´Ù‡ÙˆØ±) *</label>
            <input type="number" name="certificate_validity_months" required min="1"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                   placeholder="12">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select name="is_active" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
              <option value="true">Ù†Ø´Ø·</option>
              <option value="false">ØºÙŠØ± Ù†Ø´Ø·</option>
            </select>
          </div>
        </div>
        
        <div class="flex gap-3 pt-4 border-t">
          <button type="submit" class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-bold">
            <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
          </button>
          <button type="button" onclick="window.closeIncubatorModal()" 
                  class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
            Ø¥Ù„ØºØ§Ø¡
          </button>
        </div>
      </form>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('add-program-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
      entity_id: window.currentUserData.entityId,
      name: formData.get('name'),
      code: formData.get('code'),
      description: formData.get('description'),
      duration_hours: parseInt(formData.get('duration_hours')),
      max_participants: parseInt(formData.get('max_participants')),
      price: parseFloat(formData.get('price')),
      passing_score: parseInt(formData.get('passing_score')),
      certificate_validity_months: parseInt(formData.get('certificate_validity_months')),
      is_active: formData.get('is_active') === 'true'
    };
    
    try {
      await window.fetchAPI('/training-programs', {
        method: 'POST',
        body: JSON.stringify(data)
      });
      
      window.closeIncubatorModal();
      alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­!');
      window.switchIncubatorTab('programs');
    } catch (error) {
      alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
    }
  });
};

// Open Add Beneficiary Modal
window.openAddBeneficiaryModal = function() {
  const modal = document.createElement('div');
  modal.id = 'add-beneficiary-modal';
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
  modal.innerHTML = `
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="bg-green-600 text-white p-6 rounded-t-lg">
        <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙÙŠØ¯ Ø¬Ø¯ÙŠØ¯</h2>
      </div>
      
      <form id="add-beneficiary-form" class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
            <input type="text" name="full_name" required 
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none"
                   placeholder="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© *</label>
            <input type="text" name="national_id" required pattern="[0-9]{10}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none"
                   placeholder="1234567890">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
            <input type="tel" name="phone" pattern="05[0-9]{8}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none"
                   placeholder="0501234567">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" name="email"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none"
                   placeholder="name@example.com">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</label>
            <select name="education_level" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
              <option value="">Ø§Ø®ØªØ±...</option>
              <option value="Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
              <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
              <option value="Ø«Ø§Ù†ÙˆÙŠ">Ø«Ø§Ù†ÙˆÙŠ</option>
              <option value="Ø¯Ø¨Ù„ÙˆÙ…">Ø¯Ø¨Ù„ÙˆÙ…</option>
              <option value="Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³">Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
              <option value="Ù…Ø§Ø¬Ø³ØªÙŠØ±">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
              <option value="Ø¯ÙƒØªÙˆØ±Ø§Ù‡">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select name="status" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
              <option value="ACTIVE">Ù†Ø´Ø·</option>
              <option value="SUSPENDED">Ù…ØªÙˆÙ‚Ù</option>
              <option value="GRADUATED">Ø®Ø±ÙŠØ¬</option>
            </select>
          </div>
        </div>
        
        <div class="flex gap-3 pt-4 border-t">
          <button type="submit" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-bold">
            <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯
          </button>
          <button type="button" onclick="window.closeIncubatorModal()" 
                  class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
            Ø¥Ù„ØºØ§Ø¡
          </button>
        </div>
      </form>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('add-beneficiary-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
      entity_id: window.currentUserData.entityId,
      full_name: formData.get('full_name'),
      national_id: formData.get('national_id'),
      phone: formData.get('phone') || null,
      email: formData.get('email') || null,
      education_level: formData.get('education_level') || null,
      status: formData.get('status')
    };
    
    try {
      await window.fetchAPI('/beneficiaries', {
        method: 'POST',
        body: JSON.stringify(data)
      });
      
      window.closeIncubatorModal();
      alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
      window.switchIncubatorTab('beneficiaries');
    } catch (error) {
      alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
    }
  });
};

// Open Add Training Session Modal
window.openAddSessionModal = async function() {
  // First load programs list
  let programsOptions = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬...</option>';
  try {
    const programs = await window.fetchAPI(`/training-programs?entity_id=${window.currentUserData.entityId}`);
    programsOptions += programs.map(p => `<option value="${p.id}">${p.name} (${p.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading programs:', error);
  }
  
  // Get today's date in YYYY-MM-DD format
  const today = new Date();
  const todayStr = today.toISOString().split('T')[0];
  const nextMonth = new Date(today);
  nextMonth.setMonth(nextMonth.getMonth() + 1);
  const nextMonthStr = nextMonth.toISOString().split('T')[0];
  
  const modal = document.createElement('div');
  modal.id = 'add-session-modal';
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
  modal.innerHTML = `
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="bg-orange-600 text-white p-6 rounded-t-lg">
        <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
      </div>
      
      <form id="add-session-form" class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¯ÙØ¹Ø© *</label>
            <input type="text" name="session_name" required 
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none"
                   placeholder="Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ - 2026">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ *</label>
            <select name="program_id" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
              ${programsOptions}
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ *</label>
            <input type="date" name="start_date" required value="${todayStr}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ *</label>
            <input type="date" name="end_date" required value="${nextMonthStr}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨</label>
            <input type="text" name="instructor_name"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none"
                   placeholder="Ø¯. Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
            <input type="text" name="location"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none"
                   placeholder="Ù‚Ø§Ø¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ - Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£ÙˆÙ„">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select name="status" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
              <option value="PLANNED">Ù…Ø®Ø·Ø·Ø©</option>
              <option value="IN_PROGRESS">Ø¬Ø§Ø±ÙŠØ©</option>
              <option value="COMPLETED">Ù…ÙƒØªÙ…Ù„Ø©</option>
              <option value="CANCELLED">Ù…Ù„ØºØ§Ø©</option>
            </select>
          </div>
        </div>
        
        <div class="flex gap-3 pt-4 border-t">
          <button type="submit" class="flex-1 bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-bold">
            <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„Ø¯ÙØ¹Ø©
          </button>
          <button type="button" onclick="window.closeIncubatorModal()" 
                  class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
            Ø¥Ù„ØºØ§Ø¡
          </button>
        </div>
      </form>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('add-session-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    const program_id = formData.get('program_id');
    
    // Validate program selection
    if (!program_id) {
      alert('âš ï¸ ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ');
      return;
    }
    
    // Get dates and validate format
    const start_date = formData.get('start_date');
    const end_date = formData.get('end_date');
    
    if (!start_date || !end_date) {
      alert('âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡');
      return;
    }
    
    // Ensure dates are in correct format (YYYY-MM-DD)
    const startDateObj = new Date(start_date);
    const endDateObj = new Date(end_date);
    
    if (isNaN(startDateObj.getTime()) || isNaN(endDateObj.getTime())) {
      alert('âš ï¸ ØµÙŠØºØ© Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
      return;
    }
    
    if (endDateObj < startDateObj) {
      alert('âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡');
      return;
    }
    
    // Format dates as YYYY-MM-DD
    const formattedStartDate = startDateObj.toISOString().split('T')[0];
    const formattedEndDate = endDateObj.toISOString().split('T')[0];
    
    const data = {
      entity_id: window.currentUserData.entityId,
      session_name: formData.get('session_name'),
      program_id: parseInt(program_id),
      start_date: formattedStartDate,
      end_date: formattedEndDate,
      instructor_name: formData.get('instructor_name') || null,
      location: formData.get('location') || null,
      status: formData.get('status')
    };
    
    console.log('ğŸ“¤ Sending training session data:', data);
    
    try {
      await window.fetchAPI('/training-sessions', {
        method: 'POST',
        body: JSON.stringify(data)
      });
      
      window.closeIncubatorModal();
      alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!');
      window.switchIncubatorTab('sessions');
    } catch (error) {
      console.error('Error adding session:', error);
      alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
    }
  });
};

// Close Modal
window.closeIncubatorModal = function() {
  const modals = [
    'add-program-modal',
    'add-beneficiary-modal',
    'add-session-modal',
    'view-session-modal',
    'edit-session-modal',
    'enrollments-modal',
    'view-program-modal',
    'edit-program-modal',
    'view-beneficiary-modal',
    'edit-beneficiary-modal',
    'view-certificate-modal'
  ];
  
  modals.forEach(id => {
    const modal = document.getElementById(id);
    if (modal) modal.remove();
  });
};

// View Session Details
window.viewSessionDetails = async function(sessionId) {
  try {
    const sessions = await window.fetchAPI(`/training-sessions?entity_id=${window.currentUserData.entityId}`);
    const session = sessions.find(s => s.id === sessionId);
    
    if (!session) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹Ø©');
      return;
    }
    
    const modal = document.createElement('div');
    modal.id = 'view-session-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-orange-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h2>
        </div>
        
        <div class="p-6 space-y-6">
          <!-- Session Info -->
          <div class="border-b pb-4">
            <h3 class="font-bold text-xl mb-2">${session.session_name}</h3>
            <p class="text-gray-600">${session.program_name || 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
          </div>
          
          <!-- Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙØ¹Ø©</label>
              <p class="text-gray-900">${session.session_code}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <span class="px-3 py-1 rounded-full text-xs font-medium ${
                session.status === 'IN_PROGRESS' ? 'bg-orange-100 text-orange-800' :
                session.status === 'COMPLETED' ? 'bg-green-100 text-green-800' :
                session.status === 'PLANNED' ? 'bg-red-100 text-blue-800' :
                'bg-gray-100 text-gray-800'
              }">
                ${
                  session.status === 'IN_PROGRESS' ? 'Ø¬Ø§Ø±ÙŠØ©' :
                  session.status === 'COMPLETED' ? 'Ù…ÙƒØªÙ…Ù„Ø©' :
                  session.status === 'PLANNED' ? 'Ù…Ø®Ø·Ø·Ø©' :
                  'Ù…Ù„ØºØ§Ø©'
                }
              </span>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
              <p class="text-gray-900">${new Date(session.start_date).toLocaleDateString('ar-SA')}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
              <p class="text-gray-900">${new Date(session.end_date).toLocaleDateString('ar-SA')}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ù…Ø¯Ø±Ø¨</label>
              <p class="text-gray-900">${session.instructor_name || '-'}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
              <p class="text-gray-900">${session.location || '-'}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</label>
              <p class="text-gray-900">${session.max_participants}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</label>
              <p class="text-gray-900">${session.current_participants}</p>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="flex gap-3 pt-4 border-t">
            <button onclick="window.editSession(${sessionId})" class="flex-1 bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-bold">
              <i class="fas fa-edit ml-2"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button onclick="window.closeIncubatorModal()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
  } catch (error) {
    console.error('Error viewing session:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©');
  }
};

// Edit Session
window.editSession = async function(sessionId) {
  try {
    const sessions = await window.fetchAPI(`/training-sessions?entity_id=${window.currentUserData.entityId}`);
    const session = sessions.find(s => s.id === sessionId);
    
    if (!session) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹Ø©');
      return;
    }
    
    // Load programs for dropdown
    let programsOptions = '';
    try {
      const programs = await window.fetchAPI(`/training-programs?entity_id=${window.currentUserData.entityId}`);
      programsOptions = programs.map(p => 
        `<option value="${p.id}" ${p.id === session.program_id ? 'selected' : ''}>${p.name} (${p.code})</option>`
      ).join('');
    } catch (error) {
      console.error('Error loading programs:', error);
    }
    
    // Close any existing modals first
    window.closeIncubatorModal();
    
    const modal = document.createElement('div');
    modal.id = 'edit-session-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-orange-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h2>
        </div>
        
        <form id="edit-session-form" class="p-6 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¯ÙØ¹Ø© *</label>
              <input type="text" name="session_name" required value="${session.session_name}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ *</label>
              <select name="program_id" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
                ${programsOptions}
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ *</label>
              <input type="date" name="start_date" required value="${session.start_date.split('T')[0]}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ *</label>
              <input type="date" name="end_date" required value="${session.end_date.split('T')[0]}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨</label>
              <input type="text" name="instructor_name" value="${session.instructor_name || ''}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
              <input type="text" name="location" value="${session.location || ''}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <select name="status" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 outline-none">
                <option value="PLANNED" ${session.status === 'PLANNED' ? 'selected' : ''}>Ù…Ø®Ø·Ø·Ø©</option>
                <option value="IN_PROGRESS" ${session.status === 'IN_PROGRESS' ? 'selected' : ''}>Ø¬Ø§Ø±ÙŠØ©</option>
                <option value="COMPLETED" ${session.status === 'COMPLETED' ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„Ø©</option>
                <option value="CANCELLED" ${session.status === 'CANCELLED' ? 'selected' : ''}>Ù…Ù„ØºØ§Ø©</option>
              </select>
            </div>
          </div>
          
          <div class="flex gap-3 pt-4 border-t">
            <button type="submit" class="flex-1 bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-bold">
              <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            </button>
            <button type="button" onclick="window.closeIncubatorModal()" 
                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('edit-session-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        session_name: formData.get('session_name'),
        program_id: parseInt(formData.get('program_id')),
        start_date: formData.get('start_date'),
        end_date: formData.get('end_date'),
        instructor_name: formData.get('instructor_name') || null,
        location: formData.get('location') || null,
        status: formData.get('status')
      };
      
      try {
        await window.fetchAPI(`/training-sessions/${sessionId}`, {
          method: 'PUT',
          body: JSON.stringify(data)
        });
        
        window.closeIncubatorModal();
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        window.switchIncubatorTab('sessions');
      } catch (error) {
        console.error('Error updating session:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
      }
    });
  } catch (error) {
    console.error('Error editing session:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø©');
  }
};

// Manage Enrollments
// Manage Enrollments (Training Session Participants)
window.manageEnrollments = async function(sessionId, sessionName) {
  try {
    console.log('ğŸ“‹ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ù„Ù„Ø¯ÙØ¹Ø©:', sessionId);
    
    // Load session details and beneficiaries
    const [sessions, beneficiaries] = await Promise.all([
      window.fetchAPI(`/training-sessions?entity_id=${window.currentUserData.entityId}`),
      window.fetchAPI(`/beneficiaries?entity_id=${window.currentUserData.entityId}`)
    ]);
    
    const session = sessions.find(s => s.id === sessionId);
    if (!session) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹Ø©');
      return;
    }
    
    // Get current enrollments for this session
    let enrollments = [];
    try {
      enrollments = await window.fetchAPI(`/enrollments?session_id=${sessionId}`);
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†:', enrollments.length, enrollments);
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†:', error);
    }
    
    const enrolledIds = enrollments.map(e => e.beneficiary_id);
    const availableBeneficiaries = beneficiaries.filter(b => !enrolledIds.includes(b.id) && b.status === 'ACTIVE');
    
    const modal = document.createElement('div');
    modal.id = 'enrollments-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-green-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† - ${sessionName}</h2>
          <p class="text-sm mt-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†: ${enrollments.length} / ${session.max_participants}</p>
        </div>
        
        <div class="p-6">
          <!-- Add New Enrollment -->
          ${availableBeneficiaries.length > 0 ? `
            <div class="mb-6 p-4 bg-green-50 rounded-lg border border-green-200">
              <h3 class="font-bold mb-3">Ø¥Ø¶Ø§ÙØ© Ù…ØªØ¯Ø±Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
              <div class="flex gap-2">
                <select id="beneficiary-select" class="flex-1 border rounded-lg px-4 py-2">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯...</option>
                  ${availableBeneficiaries.map(b => `
                    <option value="${b.id}">${b.full_name} - ${b.national_id}</option>
                  `).join('')}
                </select>
                <button onclick="window.addEnrollment(${sessionId}, '${sessionName}')" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                  <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ©
                </button>
              </div>
            </div>
          ` : `
            <div class="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
              <p class="text-yellow-800">âš ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©</p>
            </div>
          `}
          
          <!-- Current Enrollments -->
          <h3 class="font-bold mb-3">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ† (${enrollments.length})</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border rounded-lg">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">#</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø§Ø³Ù…</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                ${enrollments.length > 0 ? enrollments.map((enrollment, idx) => `
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${idx + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="font-medium">${enrollment.beneficiary_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${enrollment.beneficiary_national_id || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${new Date(enrollment.enrollment_date).toLocaleDateString('ar-SA')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${enrollment.attendance_percentage || 0}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      ${enrollment.final_grade ? `<span class="font-bold">${enrollment.final_grade}%</span>` : '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 py-1 text-xs rounded-full ${
                        enrollment.status === 'ATTENDING' ? 'bg-green-100 text-green-800' :
                        enrollment.status === 'COMPLETED' ? 'bg-red-100 text-blue-800' :
                        enrollment.status === 'REGISTERED' ? 'bg-yellow-100 text-yellow-800' :
                        enrollment.status === 'WITHDRAWN' ? 'bg-gray-100 text-gray-800' :
                        'bg-red-100 text-red-800'
                      }">
                        ${
                          enrollment.status === 'ATTENDING' ? 'ÙŠØ­Ø¶Ø±' :
                          enrollment.status === 'COMPLETED' ? 'Ù…ÙƒØªÙ…Ù„' :
                          enrollment.status === 'REGISTERED' ? 'Ù…Ø³Ø¬Ù„' :
                          enrollment.status === 'WITHDRAWN' ? 'Ù…Ù†Ø³Ø­Ø¨' :
                          'Ø±Ø§Ø³Ø¨'
                        }
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                      <button onclick="window.removeEnrollment(${enrollment.id}, ${sessionId}, '${sessionName}')" 
                              class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition text-sm font-bold">
                        <i class="fas fa-trash ml-1"></i> Ø­Ø°Ù
                      </button>
                    </td>
                  </tr>
                `).join('') : `
                  <tr>
                    <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                      <i class="fas fa-inbox text-4xl mb-3 block text-gray-400"></i>
                      <p class="font-bold">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ¯Ø±Ø¨ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ† Ø¨Ø¹Ø¯</p>
                    </td>
                  </tr>
                `}
              </tbody>
            </table>
          </div>
          
          <!-- Actions -->
          <div class="flex gap-3 pt-6 border-t mt-6">
            <button onclick="window.closeIncubatorModal()" class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition font-bold">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
  } catch (error) {
    console.error('Error managing enrollments:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†: ' + error.message);
  }
};

// Add Enrollment
window.addEnrollment = async function(sessionId, sessionName) {
  const select = document.getElementById('beneficiary-select');
  const beneficiaryId = select.value;
  
  if (!beneficiaryId) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯');
    return;
  }
  
  try {
    await window.fetchAPI('/enrollments', {
      method: 'POST',
      body: JSON.stringify({
        session_id: sessionId,
        beneficiary_id: parseInt(beneficiaryId),
        enrollment_date: new Date().toISOString().split('T')[0],
        status: 'REGISTERED'
      })
    });
    
    alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    window.closeIncubatorModal();
    window.manageEnrollments(sessionId, sessionName);
  } catch (error) {
    console.error('Error adding enrollment:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
  }
};

// Remove Enrollment
window.removeEnrollment = async function(enrollmentId, sessionId, sessionName) {
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ù…Ù† Ø§Ù„Ø¯ÙØ¹Ø©ØŸ')) {
    return;
  }
  
  try {
    await window.fetchAPI(`/enrollments/${enrollmentId}`, {
      method: 'DELETE'
    });
    
    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    window.closeIncubatorModal();
    window.manageEnrollments(sessionId, sessionName);
  } catch (error) {
    console.error('Error removing enrollment:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
  }
};

// ========================================
// CERTIFICATES - View
// ========================================

// View Certificate Details
window.viewCertificateDetails = async function(certificateId) {
  try {
    const certificates = await window.fetchAPI(`/certificates?entity_id=${window.currentUserData.entityId}`);
    const cert = certificates.find(c => c.id === certificateId);
    
    if (!cert) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
      return;
    }
    
    const modal = document.createElement('div');
    modal.id = 'view-certificate-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <!-- Certificate Header -->
        <div class="bg-gradient-to-r from-purple-600 to-purple-800 text-white p-8 rounded-t-lg text-center">
          <div class="mb-4">
            <i class="fas fa-certificate text-6xl"></i>
          </div>
          <h2 class="text-3xl font-bold mb-2">Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù…</h2>
          <p class="text-purple-200">Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´ Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</p>
        </div>
        
        <!-- Certificate Body -->
        <div class="p-8">
          <!-- Beneficiary Info -->
          <div class="text-center mb-8 pb-8 border-b-2 border-purple-200">
            <p class="text-gray-600 mb-2">ØªÙÙ…Ù†Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰</p>
            <h3 class="text-4xl font-bold text-purple-800 mb-4">${cert.full_name}</h3>
            <p class="text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: <span class="font-bold">${cert.national_id}</span></p>
          </div>
          
          <!-- Program Info -->
          <div class="text-center mb-8">
            <p class="text-gray-600 mb-2">Ù„Ø¥ØªÙ…Ø§Ù…Ù‡ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
            <h4 class="text-2xl font-bold text-gray-800 mb-4">${cert.program_name}</h4>
            <div class="inline-block bg-purple-100 px-6 py-3 rounded-lg">
              <p class="text-lg font-bold text-purple-800">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${cert.final_score}%</p>
              <p class="text-sm text-purple-600">${
                cert.grade === 'EXCELLENT' ? 'Ù…Ù…ØªØ§Ø²' :
                cert.grade === 'VERY_GOOD' ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' :
                cert.grade === 'GOOD' ? 'Ø¬ÙŠØ¯' :
                cert.grade === 'PASS' ? 'Ù…Ù‚Ø¨ÙˆÙ„' : 'Ø±Ø§Ø³Ø¨'
              }</p>
            </div>
          </div>
          
          <!-- Certificate Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="border rounded-lg p-4">
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
              <p class="font-mono text-sm bg-gray-50 p-2 rounded">${cert.certificate_number}</p>
            </div>
            
            <div class="border rounded-lg p-4">
              <label class="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
              <p class="text-gray-900">${new Date(cert.issue_date).toLocaleDateString('ar-SA', {
                year: 'numeric', month: 'long', day: 'numeric'
              })}</p>
            </div>
            
            <div class="border rounded-lg p-4">
              <label class="block text-sm font-bold text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
              <p class="text-gray-900">${new Date(cert.expiry_date).toLocaleDateString('ar-SA', {
                year: 'numeric', month: 'long', day: 'numeric'
              })}</p>
            </div>
            
            <div class="border rounded-lg p-4">
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <span class="px-3 py-1 rounded-full text-xs font-medium ${
                cert.status === 'VALID' ? 'bg-green-100 text-green-800' :
                cert.status === 'EXPIRED' ? 'bg-red-100 text-red-800' :
                'bg-gray-100 text-gray-800'
              }">
                ${cert.status === 'VALID' ? 'ØµØ§Ù„Ø­Ø©' : cert.status === 'EXPIRED' ? 'Ù…Ù†ØªÙ‡ÙŠØ©' : 'Ù…Ù„ØºØ§Ø©'}
              </span>
            </div>
            
            <div class="md:col-span-2 border rounded-lg p-4">
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù‚Ù‚</label>
              <div class="flex gap-2">
                <input type="text" readonly value="${cert.verification_url || 'https://nayosh.sa/verify/' + cert.certificate_number}" 
                       class="flex-1 bg-gray-50 border rounded px-3 py-2 text-sm" id="verify-url">
                <button onclick="navigator.clipboard.writeText(document.getElementById('verify-url').value); alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·')" 
                        class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- QR Code -->
          <div class="text-center mb-6">
            <p class="text-sm text-gray-600 mb-2">Ø±Ù…Ø² QR Ù„Ù„ØªØ­Ù‚Ù‚</p>
            <div class="inline-block border-4 border-purple-200 p-4 rounded-lg">
              <div class="bg-gray-200 w-48 h-48 flex items-center justify-center">
                <i class="fas fa-qrcode text-6xl text-gray-400"></i>
              </div>
            </div>
          </div>
          
          <!-- Issued By -->
          <div class="text-center text-sm text-gray-600 pt-6 border-t">
            <p>Ø£ØµØ¯Ø± Ø¨ÙˆØ§Ø³Ø·Ø©: <span class="font-bold">${cert.issued_by || 'Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´'}</span></p>
          </div>
          
          <!-- Actions -->
          <div class="flex gap-3 pt-6 border-t mt-6">
            <button onclick="window.printCertificate(${certificateId})" class="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-bold">
              <i class="fas fa-print ml-2"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
            </button>
            <button onclick="window.closeIncubatorModal()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
  } catch (error) {
    console.error('Error viewing certificate:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
  }
};

// Print Certificate
window.printCertificate = async function(certificateId) {
  try {
    // Get certificate data
    const response = await window.fetchAPI(`/certificates?id=${certificateId}`);
    const cert = response[0];
    
    if (!cert) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
      return;
    }
    
    // Create printable certificate
    const printWindow = window.open('', '_blank', 'width=800,height=1000');
    
    printWindow.document.write(`
      <!DOCTYPE html>
      <html dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>Ø´Ù‡Ø§Ø¯Ø© - ${cert.certificate_number}</title>
        <style>
          @page {
            size: A4;
            margin: 0;
          }
          
          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: white;
          }
          
          .certificate {
            width: 210mm;
            height: 297mm;
            padding: 40mm 20mm;
            box-sizing: border-box;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          }
          
          .certificate-inner {
            background: white;
            height: 100%;
            border: 8px solid #f7d794;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            position: relative;
          }
          
          .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
          }
          
          .logo {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 10px;
          }
          
          .org-name {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 0;
          }
          
          .cert-title {
            text-align: center;
            margin: 40px 0;
          }
          
          .cert-title h1 {
            font-size: 42px;
            color: #667eea;
            margin: 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
          }
          
          .recipient {
            text-align: center;
            margin: 30px 0;
            font-size: 18px;
            color: #555;
          }
          
          .recipient-name {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
            text-decoration: underline;
            text-decoration-color: #f7d794;
            text-decoration-thickness: 3px;
          }
          
          .program-info {
            text-align: center;
            margin: 30px 0;
          }
          
          .program-name {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin: 15px 0;
          }
          
          .score-box {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
          }
          
          .score-box .score {
            font-size: 32px;
            font-weight: bold;
          }
          
          .score-box .grade {
            font-size: 18px;
            margin-top: 5px;
          }
          
          .details {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
          }
          
          .detail-item {
            text-align: center;
          }
          
          .detail-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
          }
          
          .detail-value {
            font-size: 16px;
            font-weight: bold;
            color: #333;
          }
          
          .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
          }
          
          .cert-number {
            font-size: 14px;
            color: #666;
            font-family: 'Courier New', monospace;
          }
          
          .verify-info {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
          }
          
          .signature {
            display: flex;
            justify-content: space-around;
            margin-top: 40px;
          }
          
          .signature-line {
            text-align: center;
          }
          
          .signature-line .line {
            width: 200px;
            border-top: 2px solid #333;
            margin: 0 auto 10px;
          }
          
          .signature-line .title {
            font-size: 14px;
            color: #666;
            font-weight: bold;
          }
          
          .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 120px;
            color: rgba(102, 126, 234, 0.05);
            font-weight: bold;
            pointer-events: none;
            z-index: 0;
          }
          
          @media print {
            body {
              print-color-adjust: exact;
              -webkit-print-color-adjust: exact;
            }
          }
        </style>
      </head>
      <body>
        <div class="certificate">
          <div class="certificate-inner">
            <div class="watermark">Ù†Ø§ÙŠÙˆØ´</div>
            
            <div class="header">
              <div class="logo">ğŸ“</div>
              <h2 class="org-name">Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠÙˆØ´ - Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©</h2>
            </div>
            
            <div class="cert-title">
              <h1>Ø´Ù‡Ù€Ù€Ù€Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠÙ€Ù€Ù€Ù€Ø±</h1>
            </div>
            
            <div class="recipient">
              <p>ØªØ´Ù‡Ø¯ Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø¨Ø£Ù†</p>
              <div class="recipient-name">${cert.beneficiary_name}</div>
              <p>Ù‚Ø¯ Ø£ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
            </div>
            
            <div class="program-info">
              <div class="program-name">${cert.program_name}</div>
              
              <div class="score-box">
                <div class="score">${cert.final_score}%</div>
                <div class="grade">
                  ${
                    cert.grade === 'EXCELLENT' ? 'Ù…Ù…ØªØ§Ø²' :
                    cert.grade === 'VERY_GOOD' ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' :
                    cert.grade === 'GOOD' ? 'Ø¬ÙŠØ¯' :
                    cert.grade === 'PASS' ? 'Ù…Ù‚Ø¨ÙˆÙ„' : 'Ø±Ø§Ø³Ø¨'
                  }
                </div>
              </div>
            </div>
            
            <div class="details">
              <div class="detail-item">
                <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</div>
                <div class="detail-value">${cert.certificate_number}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</div>
                <div class="detail-value">${new Date(cert.issue_date).toLocaleDateString('ar-SA', {
                  year: 'numeric', month: 'long', day: 'numeric'
                })}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>
                <div class="detail-value">${new Date(cert.expiry_date).toLocaleDateString('ar-SA', {
                  year: 'numeric', month: 'long', day: 'numeric'
                })}</div>
              </div>
            </div>
            
            <div class="signature">
              <div class="signature-line">
                <div class="line"></div>
                <div class="title">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ±</div>
              </div>
              <div class="signature-line">
                <div class="line"></div>
                <div class="title">Ø®ØªÙ… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</div>
              </div>
            </div>
            
            <div class="footer">
              <div class="cert-number">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©: ${cert.certificate_number}</div>
              <div class="verify-info">
                Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø²ÙŠØ§Ø±Ø©: ${cert.verification_url || 'https://nayosh.sa/verify/' + cert.certificate_number}
              </div>
            </div>
          </div>
        </div>
        
        <script>
          window.onload = function() {
            // Auto print when loaded
            setTimeout(function() {
              window.print();
            }, 500);
          };
          
          // Close window after printing
          window.onafterprint = function() {
            setTimeout(function() {
              window.close();
            }, 100);
          };
        </script>
      </body>
      </html>
    `);
    
    printWindow.document.close();
    
  } catch (error) {
    console.error('Error printing certificate:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
  }
};

// ========================================
// TRAINING PROGRAMS - View & Edit
// ========================================

// View Program Details
window.viewProgramDetails = async function(programId) {
  try {
    const programs = await window.fetchAPI(`/training-programs?entity_id=${window.currentUserData.entityId}`);
    const program = programs.find(p => p.id === programId);
    
    if (!program) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
      return;
    }
    
    const modal = document.createElement('div');
    modal.id = 'view-program-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-red-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ</h2>
        </div>
        
        <div class="p-6 space-y-6">
          <!-- Program Info -->
          <div class="border-b pb-4">
            <h3 class="font-bold text-xl mb-2">${program.name}</h3>
            <p class="text-gray-600">${program.code}</p>
          </div>
          
          <!-- Description -->
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„ÙˆØµÙ</label>
            <p class="text-gray-900">${program.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
          </div>
          
          <!-- Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
              <p class="text-gray-900">${program.duration_hours} Ø³Ø§Ø¹Ø©</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</label>
              <p class="text-gray-900">${program.max_participants} Ù…ØªØ¯Ø±Ø¨</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø³Ø¹Ø±</label>
              <p class="text-gray-900">${program.price} Ø±ÙŠØ§Ù„</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</label>
              <p class="text-gray-900">${program.passing_score}%</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
              <p class="text-gray-900">${program.certificate_validity_months} Ø´Ù‡Ø±</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <span class="px-3 py-1 rounded-full text-xs font-medium ${
                program.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
              }">
                ${program.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
              </span>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="flex gap-3 pt-4 border-t">
            <button onclick="window.editProgram(${programId})" class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-bold">
              <i class="fas fa-edit ml-2"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button onclick="window.closeIncubatorModal()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
  } catch (error) {
    console.error('Error viewing program:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
  }
};

// Edit Program
window.editProgram = async function(programId) {
  try {
    const programs = await window.fetchAPI(`/training-programs?entity_id=${window.currentUserData.entityId}`);
    const program = programs.find(p => p.id === programId);
    
    if (!program) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
      return;
    }
    
    window.closeIncubatorModal();
    
    const modal = document.createElement('div');
    modal.id = 'edit-program-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-red-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ</h2>
        </div>
        
        <form id="edit-program-form" class="p-6 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
              <input type="text" name="name" required value="${program.name}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙƒÙˆØ¯ *</label>
              <input type="text" name="code" required value="${program.code}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª *</label>
              <input type="number" name="duration_hours" required value="${program.duration_hours}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
              <textarea name="description" rows="3"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">${program.description || ''}</textarea>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† *</label>
              <input type="number" name="max_participants" required value="${program.max_participants}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„) *</label>
              <input type="number" name="price" required step="0.01" value="${program.price}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (%) *</label>
              <input type="number" name="passing_score" required min="0" max="100" value="${program.passing_score}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© (Ø´Ù‡Ø±) *</label>
              <input type="number" name="certificate_validity_months" required value="${program.certificate_validity_months}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="flex items-center">
                <input type="checkbox" name="is_active" ${program.is_active ? 'checked' : ''}
                       class="ml-2 h-4 w-4 text-red-600 rounded">
                <span class="text-sm font-bold text-gray-700">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ø´Ø·</span>
              </label>
            </div>
          </div>
          
          <div class="flex gap-3 pt-4 border-t">
            <button type="submit" class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-bold">
              <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            </button>
            <button type="button" onclick="window.closeIncubatorModal()" 
                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('edit-program-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        name: formData.get('name'),
        code: formData.get('code'),
        description: formData.get('description') || null,
        duration_hours: parseInt(formData.get('duration_hours')),
        max_participants: parseInt(formData.get('max_participants')),
        price: parseFloat(formData.get('price')),
        passing_score: parseInt(formData.get('passing_score')),
        certificate_validity_months: parseInt(formData.get('certificate_validity_months')),
        is_active: formData.get('is_active') === 'on'
      };
      
      try {
        await window.fetchAPI(`/training-programs/${programId}`, {
          method: 'PUT',
          body: JSON.stringify(data)
        });
        
        window.closeIncubatorModal();
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­!');
        window.switchIncubatorTab('programs');
      } catch (error) {
        console.error('Error updating program:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
      }
    });
  } catch (error) {
    console.error('Error editing program:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
  }
};

// ========================================
// BENEFICIARIES - View & Edit
// ========================================

// View Beneficiary Details
window.viewBeneficiaryDetails = async function(beneficiaryId) {
  try {
    const beneficiaries = await window.fetchAPI(`/beneficiaries?entity_id=${window.currentUserData.entityId}`);
    const beneficiary = beneficiaries.find(b => b.id === beneficiaryId);
    
    if (!beneficiary) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯');
      return;
    }
    
    const modal = document.createElement('div');
    modal.id = 'view-beneficiary-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-green-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</h2>
        </div>
        
        <div class="p-6 space-y-6">
          <!-- Beneficiary Info -->
          <div class="border-b pb-4">
            <h3 class="font-bold text-xl mb-2">${beneficiary.full_name}</h3>
            <p class="text-gray-600">${beneficiary.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'}</p>
          </div>
          
          <!-- Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
              <p class="text-gray-900">${beneficiary.national_id}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
              <p class="text-gray-900">${beneficiary.phone || '-'}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</label>
              <p class="text-gray-900">${beneficiary.education_level || '-'}</p>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <span class="px-3 py-1 rounded-full text-xs font-medium ${
                beneficiary.status === 'ACTIVE' ? 'bg-green-100 text-green-800' : 
                beneficiary.status === 'GRADUATED' ? 'bg-red-100 text-blue-800' : 
                'bg-gray-100 text-gray-800'
              }">
                ${beneficiary.status === 'ACTIVE' ? 'Ù†Ø´Ø·' : beneficiary.status === 'GRADUATED' ? 'Ø®Ø±ÙŠØ¬' : 'Ù…ØªÙˆÙ‚Ù'}
              </span>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="flex gap-3 pt-4 border-t">
            <button onclick="window.editBeneficiary(${beneficiaryId})" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-bold">
              <i class="fas fa-edit ml-2"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button onclick="window.closeIncubatorModal()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
  } catch (error) {
    console.error('Error viewing beneficiary:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯');
  }
};

// Edit Beneficiary
window.editBeneficiary = async function(beneficiaryId) {
  try {
    const beneficiaries = await window.fetchAPI(`/beneficiaries?entity_id=${window.currentUserData.entityId}`);
    const beneficiary = beneficiaries.find(b => b.id === beneficiaryId);
    
    if (!beneficiary) {
      alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯');
      return;
    }
    
    window.closeIncubatorModal();
    
    const modal = document.createElement('div');
    modal.id = 'edit-beneficiary-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
      <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-green-600 text-white p-6 rounded-t-lg">
          <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</h2>
        </div>
        
        <form id="edit-beneficiary-form" class="p-6 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
              <input type="text" name="full_name" required value="${beneficiary.full_name}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© *</label>
              <input type="text" name="national_id" required value="${beneficiary.national_id}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *</label>
              <input type="tel" name="phone" required value="${beneficiary.phone || ''}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
            </div>
            
            <div class="md:col-span-2">
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" name="email" value="${beneficiary.email || ''}"
                     class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</label>
              <select name="education_level" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰...</option>
                <option value="ELEMENTARY" ${beneficiary.education_level === 'ELEMENTARY' ? 'selected' : ''}>Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                <option value="MIDDLE" ${beneficiary.education_level === 'MIDDLE' ? 'selected' : ''}>Ù…ØªÙˆØ³Ø·</option>
                <option value="SECONDARY" ${beneficiary.education_level === 'SECONDARY' ? 'selected' : ''}>Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="DIPLOMA" ${beneficiary.education_level === 'DIPLOMA' ? 'selected' : ''}>Ø¯Ø¨Ù„ÙˆÙ…</option>
                <option value="BACHELOR" ${beneficiary.education_level === 'BACHELOR' ? 'selected' : ''}>Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
                <option value="MASTER" ${beneficiary.education_level === 'MASTER' ? 'selected' : ''}>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                <option value="PHD" ${beneficiary.education_level === 'PHD' ? 'selected' : ''}>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <select name="status" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
                <option value="ACTIVE" ${beneficiary.status === 'ACTIVE' ? 'selected' : ''}>Ù†Ø´Ø·</option>
                <option value="GRADUATED" ${beneficiary.status === 'GRADUATED' ? 'selected' : ''}>Ø®Ø±ÙŠØ¬</option>
                <option value="SUSPENDED" ${beneficiary.status === 'SUSPENDED' ? 'selected' : ''}>Ù…ØªÙˆÙ‚Ù</option>
              </select>
            </div>
          </div>
          
          <div class="flex gap-3 pt-4 border-t">
            <button type="submit" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-bold">
              <i class="fas fa-save ml-2"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            </button>
            <button type="button" onclick="window.closeIncubatorModal()" 
                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-bold">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('edit-beneficiary-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        full_name: formData.get('full_name'),
        national_id: formData.get('national_id'),
        phone: formData.get('phone'),
        email: formData.get('email') || null,
        education_level: formData.get('education_level') || null,
        status: formData.get('status')
      };
      
      try {
        await window.fetchAPI(`/beneficiaries/${beneficiaryId}`, {
          method: 'PUT',
          body: JSON.stringify(data)
        });
        
        window.closeIncubatorModal();
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
        window.switchIncubatorTab('beneficiaries');
      } catch (error) {
        console.error('Error updating beneficiary:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
      }
    });
  } catch (error) {
    console.error('Error editing beneficiary:', error);
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯');
  }
};

// Make fetchAPI available globally for employee functions
// This version MUST include data isolation headers from currentUser
window.fetchAPI = async function(endpoint, options = {}) {
    try {
        const headers = {
            'Content-Type': 'application/json',
            ...options.headers
        };
        
        // Get currentUser from the app closure
        // Note: This is a bit of a workaround - ideally currentUser would be global or in sessionStorage
        if (window.currentUserData) {
            headers['x-entity-type'] = window.currentUserData.tenantType;
            headers['x-entity-id'] = window.currentUserData.entityId;
            console.log('ğŸ“¤ Sending isolation headers:', { entityType: window.currentUserData.tenantType, entityId: window.currentUserData.entityId });
        }
        
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            ...options,
            headers
        });
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
};

// ========================================
// INCUBATOR TRAINING SYSTEM
// Ù†Ø¸Ø§Ù… Ø­Ø§Ø¶Ù†Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©
// ========================================

// Helper to expose openAssessmentModal if needed
app.openAssessmentModal = async (enrollmentId, name, programId) => {
    const score = prompt(`Ø±ØµØ¯ Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…ØªØ¯Ø±Ø¨: ${name}\nØ§Ù„Ø¯Ø±Ø¬Ø© Ù…Ù† 100:`);
    if (score && !isNaN(score)) {
        try {
            // Simplified: directly issue certificate (skipping detailed assessment for now)
            // In real world: 1. Create Assessment, 2. If Passed -> Create Certificate
            
            // Generate certificate number
            const certNum = `CERT-${programId}-${new Date().getFullYear()}-${enrollmentId}`;
             
            await fetchAPI('/certificates', {
                method: 'POST',
                body: JSON.stringify({
                    enrollment_id: enrollmentId,
                    beneficiary_id: 1, // Need to get valid ID
                    program_id: programId,
                    certificate_number: certNum,
                    final_score: parseFloat(score),
                    grade: parseFloat(score) >= 90 ? 'EXCELLENT' : 'VERY_GOOD',
                    issued_by: 'Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¨'
                })
            });
            alert(`ØªÙ… Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø© (${score}) ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
            renderAssessments(document.getElementById('incubator-content'), app.currentUser.entityId);
        } catch (e) {
            console.error(e);
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ø­Ø§ÙƒØ§Ø©)');
        }
    }
};

// ========================================
// EMPLOYEES MANAGEMENT
// ========================================

const renderEmployees = async () => {
    try {
        const employees = await window.fetchAPI('/employees');
        const branches = await window.fetchAPI('/branches');
        const incubators = await window.fetchAPI('/incubators');
        const platforms = await window.fetchAPI('/platforms');
        const offices = await window.fetchAPI('/offices');

        // Group by entity type
        const byType = employees.reduce((acc, emp) => {
            acc[emp.assigned_entity_type] = (acc[emp.assigned_entity_type] || []);
            acc[emp.assigned_entity_type].push(emp);
            return acc;
        }, {});

        return `
        <div class="space-y-6 animate-fade-in">
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
                    <p class="text-slate-500">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
                <button onclick="app.openCreateEmployeeModal()" class="bg-red-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-red-700 transition flex items-center gap-2 shadow-lg">
                    <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="bg-gradient-to-br from-red-500 to-blue-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-users text-2xl opacity-80"></i>
                        <span class="text-3xl font-black">${employees.length}</span>
                    </div>
                    <p class="text-xs font-semibold opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-store text-2xl opacity-80"></i>
                        <span class="text-3xl font-black">${byType.BRANCH?.length || 0}</span>
                    </div>
                    <p class="text-xs font-semibold opacity-90">Ù…ÙˆØ¸ÙÙˆ Ø§Ù„ÙØ±ÙˆØ¹</p>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-seedling text-2xl opacity-80"></i>
                        <span class="text-3xl font-black">${byType.INCUBATOR?.length || 0}</span>
                    </div>
                    <p class="text-xs font-semibold opacity-90">Ù…ÙˆØ¸ÙÙˆ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª</p>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-server text-2xl opacity-80"></i>
                        <span class="text-3xl font-black">${byType.PLATFORM?.length || 0}</span>
                    </div>
                    <p class="text-xs font-semibold opacity-90">Ù…ÙˆØ¸ÙÙˆ Ø§Ù„Ù…Ù†ØµØ§Øª</p>
                </div>
                <div class="bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-briefcase text-2xl opacity-80"></i>
                        <span class="text-3xl font-black">${byType.OFFICE?.length || 0}</span>
                    </div>
                    <p class="text-xs font-semibold opacity-90">Ù…ÙˆØ¸ÙÙˆ Ø§Ù„Ù…ÙƒØ§ØªØ¨</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-md border-2 border-slate-200 p-4">
                <div class="flex flex-wrap gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ÙƒÙŠØ§Ù†</label>
                        <select id="filterEntityType" onchange="app.filterEmployees()" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="HQ">Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                            <option value="BRANCH">Ø§Ù„ÙØ±ÙˆØ¹</option>
                            <option value="INCUBATOR">Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª</option>
                            <option value="PLATFORM">Ø§Ù„Ù…Ù†ØµØ§Øª</option>
                            <option value="OFFICE">Ø§Ù„Ù…ÙƒØ§ØªØ¨</option>
                        </select>
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Ø¨Ø­Ø«</label>
                        <input type="text" id="searchEmployee" onkeyup="app.filterEmployees()" placeholder="Ø§Ø³Ù…ØŒ Ø¨Ø±ÙŠØ¯ØŒ Ø±Ù‚Ù… Ù…ÙˆØ¸Ù..." class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    </div>
                    <div class="flex items-end">
                        <button onclick="app.resetEmployeeFilters()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 font-bold">
                            <i class="fas fa-redo ml-2"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                    </div>
                </div>
            </div>

            <!-- Employees Table -->
            <div class="bg-white rounded-xl shadow-md border-2 border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-slate-700 to-slate-800 p-6 text-white">
                    <h3 class="text-xl font-black flex items-center gap-3">
                        <i class="fas fa-users text-2xl"></i>
                        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </h3>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full" id="employeesTable">
                        <thead class="bg-slate-50 border-b-2 border-slate-200">
                            <tr>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ø§Ø³Ù…</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ù…ÙƒØªØ¨</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ù…Ù†ØµØ©</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ø¶Ù†Ø©</th>
                                <th class="text-right px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„ÙØ±Ø¹</th>
                                <th class="text-center px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ø±Ø§ØªØ¨</th>
                                <th class="text-center px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th class="text-center px-4 py-3 text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            ${employees.map(emp => `
                                <tr class="hover:bg-slate-50 transition-colors employee-row" data-entity-type="${emp.assigned_entity_type}" data-search="${emp.full_name} ${emp.email} ${emp.employee_number}">
                                    <td class="px-4 py-4">
                                        <span class="font-mono text-xs bg-slate-100 px-2 py-1 rounded">${emp.employee_number}</span>
                                    </td>
                                    <td class="px-4 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                                                <span class="font-bold text-red-600">${emp.full_name.charAt(0)}</span>
                                            </div>
                                            <div>
                                                <p class="font-semibold text-slate-800">${emp.full_name}</p>
                                                <p class="text-xs text-slate-500">${emp.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯'}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-4">
                                        <span class="text-sm font-medium text-slate-700">${emp.position || '-'}</span>
                                    </td>
                                    <td class="px-4 py-4">
                                        <span class="text-sm text-slate-600">${emp.assigned_entity_type === 'OFFICE' ? (emp.entity_name || '-') : '-'}</span>
                                    </td>
                                    <td class="px-4 py-4">
                                        <span class="text-sm text-slate-600">${emp.assigned_entity_type === 'PLATFORM' ? (emp.entity_name || '-') : '-'}</span>
                                    </td>
                                    <td class="px-4 py-4">
                                        <span class="text-sm text-slate-600">${emp.assigned_entity_type === 'INCUBATOR' ? (emp.entity_name || '-') : '-'}</span>
                                    </td>
                                    <td class="px-4 py-4">
                                        <span class="text-sm text-slate-600">${emp.assigned_entity_type === 'BRANCH' ? (emp.entity_name || '-') : '-'}</span>
                                    </td>
                                    <td class="px-4 py-4 text-center">
                                        <span class="font-bold text-green-600">${emp.salary ? parseFloat(emp.salary).toLocaleString() + ' SAR' : '-'}</span>
                                    </td>
                                    <td class="px-4 py-4 text-center">
                                        <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${emp.is_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                            <i class="fas ${emp.is_active ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                                            ${emp.is_active ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                                        </span>
                                    </td>
                                    <td class="px-4 py-4 text-center">
                                        <div class="flex items-center justify-center gap-2">
                                            <button onclick="app.viewEmployee(${emp.id})" class="text-red-600 hover:text-blue-800 p-2 rounded-lg hover:bg-red-50" title="Ø¹Ø±Ø¶">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button onclick="app.editEmployee(${emp.id})" class="text-orange-600 hover:text-orange-800 p-2 rounded-lg hover:bg-orange-50" title="ØªØ¹Ø¯ÙŠÙ„">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="app.deleteEmployee(${emp.id}, '${emp.full_name}')" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50" title="Ø­Ø°Ù">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    ${employees.length === 0 ? `
                        <div class="text-center py-12">
                            <i class="fas fa-users text-6xl text-slate-300 mb-4"></i>
                            <h4 class="text-xl font-bold text-slate-600 mb-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</h4>
                            <p class="text-slate-500 mb-4">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø¸Ø§Ù…</p>
                            <button onclick="app.openCreateEmployeeModal()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 font-bold">
                                <i class="fas fa-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
                            </button>
                        </div>
                    ` : ''}
                </div>
            </div>
        </div>
        `;
    } catch (error) {
        return `<div class="text-red-600 p-8 bg-red-50 rounded-lg border border-red-200">
            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
            <p class="font-bold">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
            <p class="text-sm">${error.message}</p>
        </div>`;
    }
};

// Filter employees
app.filterEmployees = function() {
    const entityType = document.getElementById('filterEntityType').value;
    const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
    const rows = document.querySelectorAll('.employee-row');

    rows.forEach(row => {
        const rowEntityType = row.dataset.entityType;
        const rowSearch = row.dataset.search.toLowerCase();
        
        const matchesType = !entityType || rowEntityType === entityType;
        const matchesSearch = !searchTerm || rowSearch.includes(searchTerm);
        
        row.style.display = matchesType && matchesSearch ? '' : 'none';
    });
};

// Reset filters
app.resetEmployeeFilters = function() {
    document.getElementById('filterEntityType').value = '';
    document.getElementById('searchEmployee').value = '';
    app.filterEmployees();
};

// View employee details
app.viewEmployee = async function(id) {
    try {
        const employee = await window.fetchAPI(`/employees/${id}`);
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-red-600 to-red-700 text-white p-6 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold flex items-center gap-3">
                            <i class="fas fa-user-circle"></i>
                            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
                        </h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white hover:rotate-90 transition-all duration-300">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.employee_number}</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.full_name}</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.position}</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ù‚Ø³Ù…</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.department}</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„ÙƒÙŠØ§Ù†</label>
                            <p class="text-lg font-semibold text-red-600">${employee.entity_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.employment_type === 'FULL_TIME' ? 'Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„' : employee.employment_type === 'PART_TIME' ? 'Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ' : employee.employment_type}</p>
                        </div>
                        ${employee.email ? `
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.email}</p>
                        </div>` : ''}
                        ${employee.phone ? `
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <p class="text-lg font-semibold text-gray-800">${employee.phone}</p>
                        </div>` : ''}
                        ${employee.salary ? `
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">Ø§Ù„Ø±Ø§ØªØ¨</label>
                            <p class="text-lg font-semibold text-green-600">${parseFloat(employee.salary).toLocaleString()} SAR</p>
                        </div>` : ''}
                        ${employee.hire_date ? `
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆØ¸ÙŠÙ</label>
                            <p class="text-lg font-semibold text-gray-800">${new Date(employee.hire_date).toLocaleDateString('ar-SA')}</p>
                        </div>` : ''}
                    </div>
                </div>
                
                <div class="bg-gray-50 p-6 rounded-b-2xl flex gap-3 justify-end">
                    <button onclick="this.closest('.fixed').remove()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-bold transition">
                        <i class="fas fa-times ml-2"></i>
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                    <button onclick="app.editEmployee(${id}); this.closest('.fixed').remove();" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold transition">
                        <i class="fas fa-edit ml-2"></i>
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù');
    }
};

// Edit employee
app.editEmployee = async function(id) {
    try {
        const employee = await window.fetchAPI(`/employees/${id}`);
        const modal = document.getElementById('editEmployeeModal');
        if (!modal) {
            console.error('Edit modal not found');
            return;
        }
        
        // Fill form with employee data
        document.getElementById('edit_employee_id').value = id;
        document.getElementById('edit_employee_number').value = employee.employee_number;
        document.getElementById('edit_full_name').value = employee.full_name;
        document.getElementById('edit_email').value = employee.email || '';
        document.getElementById('edit_phone').value = employee.phone || '';
        document.getElementById('edit_position').value = employee.position;
        document.getElementById('edit_department').value = employee.department;
        document.getElementById('edit_salary').value = employee.salary || '';
        document.getElementById('edit_employment_type').value = employee.employment_type;
        document.getElementById('edit_address').value = employee.address || '';
        
        modal.classList.remove('hidden');
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„ØªØ¹Ø¯ÙŠÙ„');
    }
};

// Delete employee
app.deleteEmployee = async function(id, name) {
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù "${name}"ØŸ`)) {
        try {
            await window.fetchAPI(`/employees/${id}`, { method: 'DELETE' });
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­');
            app.loadRoute('employees');
        } catch (error) {
            alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù: ' + error.message);
        }
    }
};

// Open create employee modal
app.openCreateEmployeeModal = async function() {
    const modal = document.getElementById('createEmployeeModal');
    if (modal) {
        modal.classList.remove('hidden');
        await loadAllEntitiesForEmployee();
    }
};

// Close create employee modal
app.closeCreateEmployeeModal = function() {
    const modal = document.getElementById('createEmployeeModal');
    if (modal) {
        modal.classList.add('hidden');
        document.getElementById('createEmployeeForm').reset();
    }
};

// Load all entities for employee assignment
async function loadAllEntitiesForEmployee() {
    try {
        const [branches, incubators, platforms, offices] = await Promise.all([
            window.fetchAPI('/branches'),
            window.fetchAPI('/incubators'),
            window.fetchAPI('/platforms'),
            window.fetchAPI('/offices')
        ]);

        // Populate branches
        const branchSelect = document.getElementById('assigned_branch');
        branchSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ --</option>';
        branches.forEach(entity => {
            const option = document.createElement('option');
            option.value = entity.id;
            option.textContent = entity.name;
            branchSelect.appendChild(option);
        });

        // Populate incubators
        const incubatorSelect = document.getElementById('assigned_incubator');
        incubatorSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ø¶Ù†Ø© --</option>';
        incubators.forEach(entity => {
            const option = document.createElement('option');
            option.value = entity.id;
            option.textContent = entity.name;
            incubatorSelect.appendChild(option);
        });

        // Populate platforms
        const platformSelect = document.getElementById('assigned_platform');
        platformSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© --</option>';
        platforms.forEach(entity => {
            const option = document.createElement('option');
            option.value = entity.id;
            option.textContent = entity.name;
            platformSelect.appendChild(option);
        });

        // Populate offices
        const officeSelect = document.getElementById('assigned_office');
        officeSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨ --</option>';
        offices.forEach(entity => {
            const option = document.createElement('option');
            option.value = entity.id;
            option.textContent = entity.name;
            officeSelect.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading entities:', error);
    }
}

// Submit create employee form
app.submitCreateEmployee = async function() {
    const form = document.getElementById('createEmployeeForm');
    
    // Get form values
    const employeeData = {
        employee_number: document.getElementById('employee_number').value,
        full_name: document.getElementById('full_name').value,
        email: document.getElementById('email').value || null,
        phone: document.getElementById('phone').value || null,
        national_id: document.getElementById('national_id').value || null,
        position: document.getElementById('position').value,
        department: document.getElementById('department').value,
        hire_date: document.getElementById('hire_date').value || null,
        salary: document.getElementById('salary').value ? parseFloat(document.getElementById('salary').value) : null,
        employment_type: document.getElementById('employment_type').value,
        address: document.getElementById('address').value || null,
        emergency_contact: document.getElementById('emergency_contact').value || null,
        emergency_phone: document.getElementById('emergency_phone').value || null
    };

    // Handle entity assignment - can select multiple entities
    const branchId = document.getElementById('assigned_branch').value;
    const incubatorId = document.getElementById('assigned_incubator').value;
    const platformId = document.getElementById('assigned_platform').value;
    const officeId = document.getElementById('assigned_office').value;

    // Add selected entity IDs to employeeData
    if (branchId) {
        employeeData.branch_id = parseInt(branchId);
    }
    if (incubatorId) {
        employeeData.incubator_id = parseInt(incubatorId);
    }
    if (platformId) {
        employeeData.platform_id = parseInt(platformId);
    }
    if (officeId) {
        employeeData.office_id = parseInt(officeId);
    }

    // Determine primary entity type based on first selected entity
    // assigned_entity_type is required in database, so we must set it
    if (branchId) {
        employeeData.assigned_entity_type = 'BRANCH';
    } else if (incubatorId) {
        employeeData.assigned_entity_type = 'INCUBATOR';
    } else if (platformId) {
        employeeData.assigned_entity_type = 'PLATFORM';
    } else if (officeId) {
        employeeData.assigned_entity_type = 'OFFICE';
    } else {
        // If no entity selected, default to HQ
        employeeData.assigned_entity_type = 'HQ';
        employeeData.hq_id = 1; // Default HQ ID
    }

    // Validate required fields
    if (!employeeData.employee_number || !employeeData.full_name || !employeeData.position || 
        !employeeData.department || !employeeData.employment_type) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
    }

    // Ensure hire_date is null if empty (not empty string)
    if (!employeeData.hire_date) {
        employeeData.hire_date = null;
    }

    // Log data for debugging
    console.log('Employee data being sent:', employeeData);

    try {
        const response = await window.fetchAPI('/employees', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(employeeData)
        });

        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­!');
        app.closeCreateEmployeeModal();
        app.loadRoute('employees'); // Refresh employees page
    } catch (error) {
        console.error('Employee creation error:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù: ' + error.message);
    }
};

// Make functions available globally
window.openCreateEmployeeModal = app.openCreateEmployeeModal;
window.closeCreateEmployeeModal = app.closeCreateEmployeeModal;
window.loadEntityOptions = app.loadEntitiesForEmployee;
window.submitCreateEmployee = app.submitCreateEmployee;

// Close edit employee modal
window.closeEditEmployeeModal = function() {
    const modal = document.getElementById('editEmployeeModal');
    if (modal) {
        modal.classList.add('hidden');
        document.getElementById('editEmployeeForm').reset();
    }
};

// Submit edit employee form
window.submitEditEmployee = async function() {
    const id = document.getElementById('edit_employee_id').value;
    const employeeData = {
        full_name: document.getElementById('edit_full_name').value,
        email: document.getElementById('edit_email').value || null,
        phone: document.getElementById('edit_phone').value || null,
        position: document.getElementById('edit_position').value,
        department: document.getElementById('edit_department').value,
        salary: document.getElementById('edit_salary').value ? parseFloat(document.getElementById('edit_salary').value) : null,
        employment_type: document.getElementById('edit_employment_type').value,
        address: document.getElementById('edit_address').value || null
    };

    // Validate required fields
    if (!employeeData.full_name || !employeeData.position || !employeeData.department || !employeeData.employment_type) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
    }

    try {
        await window.fetchAPI(`/employees/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(employeeData)
        });

        alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­!');
        window.closeEditEmployeeModal();
        app.loadRoute('employees'); // Refresh employees page
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù: ' + error.message);
    }
};

// ========================================
// ENTITY CREATION FUNCTIONS
// ========================================

// Open Create Branch Modal
window.openCreateBranchModal = function() {
  const modal = document.getElementById('createBranchModal');
  if (modal) {
    modal.classList.remove('hidden');
  }
};

// Close Create Branch Modal
window.closeCreateBranchModal = function() {
  const modal = document.getElementById('createBranchModal');
  if (modal) {
    modal.classList.add('hidden');
    document.getElementById('createBranchForm').reset();
  }
};

// Submit Create Branch
window.submitCreateBranch = async function() {
  const formData = {
    hq_id: parseInt(document.getElementById('branch_hq_id').value),
    name: document.getElementById('branch_name').value,
    code: document.getElementById('branch_code').value,
    description: document.getElementById('branch_description').value,
    country: document.getElementById('branch_country').value,
    city: document.getElementById('branch_city').value,
    address: document.getElementById('branch_address').value,
    contact_email: document.getElementById('branch_email').value,
    contact_phone: document.getElementById('branch_phone').value,
    manager_name: document.getElementById('branch_manager').value
  };

  try {
    const response = await fetch(`${API_BASE_URL}/branches`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ±Ø¹');

    const result = await response.json();
    alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ±Ø¹ "${result.name}" Ø¨Ù†Ø¬Ø§Ø­!`);
    closeCreateBranchModal();
    app.loadRoute('hierarchy'); // Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Open Create Incubator Modal
window.openCreateIncubatorModal = function() {
  const modal = document.getElementById('createIncubatorModal');
  if (modal) {
    modal.classList.remove('hidden');
    loadBranchesForIncubator();
  }
};

// Close Create Incubator Modal
window.closeCreateIncubatorModal = function() {
  const modal = document.getElementById('createIncubatorModal');
  if (modal) {
    modal.classList.add('hidden');
    document.getElementById('createIncubatorForm').reset();
  }
};

// Load branches for incubator dropdown
async function loadBranchesForIncubator() {
  try {
    const response = await fetch(`${API_BASE_URL}/branches`);
    const branches = await response.json();
    const select = document.getElementById('incubator_branch_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ÙØ±Ø¹ --</option>' +
      branches.map(b => `<option value="${b.id}">${b.name} (${b.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading branches:', error);
  }
}

// Submit Create Incubator
window.submitCreateIncubator = async function() {
  const formData = {
    branch_id: parseInt(document.getElementById('incubator_branch_id').value),
    name: document.getElementById('incubator_name').value,
    code: document.getElementById('incubator_code').value,
    description: document.getElementById('incubator_description').value,
    program_type: document.getElementById('incubator_program_type').value,
    capacity: parseInt(document.getElementById('incubator_capacity').value),
    contact_email: document.getElementById('incubator_email').value,
    contact_phone: document.getElementById('incubator_phone').value,
    manager_name: document.getElementById('incubator_manager').value,
    start_date: document.getElementById('incubator_start_date').value || null,
    end_date: document.getElementById('incubator_end_date').value || null
  };

  try {
    const response = await fetch(`${API_BASE_URL}/incubators`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø§Ø¶Ù†Ø©');

    const result = await response.json();
    alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø§Ø¶Ù†Ø© "${result.name}" Ø¨Ù†Ø¬Ø§Ø­!`);
    closeCreateIncubatorModal();
    app.loadRoute('hierarchy'); // Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Open Create Platform Modal
window.openCreatePlatformModal = function() {
  const modal = document.getElementById('createPlatformModal');
  if (modal) {
    modal.classList.remove('hidden');
    loadBranchesForPlatform();
    // Reset incubator dropdown
    document.getElementById('platform_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
  }
};

// Close Create Platform Modal
window.closeCreatePlatformModal = function() {
  const modal = document.getElementById('createPlatformModal');
  if (modal) {
    modal.classList.add('hidden');
    document.getElementById('createPlatformForm').reset();
  }
};

// Load branches for platform dropdown
async function loadBranchesForPlatform() {
  try {
    const response = await fetch(`${API_BASE_URL}/branches`);
    const branches = await response.json();
    const select = document.getElementById('platform_branch_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ÙØ±Ø¹ --</option>' +
      branches.map(b => `<option value="${b.id}">${b.name} (${b.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading branches:', error);
  }
}

// Load incubators for platform dropdown based on selected branch
async function loadIncubatorsForPlatformByBranch() {
  const branchId = document.getElementById('platform_branch_id').value;
  
  if (!branchId) {
    document.getElementById('platform_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
    return;
  }
  
  try {
    // Use junction table API
    const response = await fetch(`${API_BASE_URL}/incubators?branch_id=${branchId}`);
    const incubators = await response.json();
    const select = document.getElementById('platform_incubator_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>' +
      incubators.map(i => `<option value="${i.id}">${i.name}</option>`).join('');
  } catch (error) {
    console.error('Error loading incubators:', error);
  }
}

// Load incubators for platform dropdown (legacy function kept for compatibility)
async function loadIncubatorsForPlatform() {
  try {
    const response = await fetch(`${API_BASE_URL}/incubators`);
    const incubators = await response.json();
    const select = document.getElementById('platform_incubator_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>' +
      incubators.map(i => `<option value="${i.id}">${i.name} (${i.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading incubators:', error);
  }
}

// Submit Create Platform
window.submitCreatePlatform = async function() {
  const formData = {
    incubator_id: parseInt(document.getElementById('platform_incubator_id').value),
    name: document.getElementById('platform_name').value,
    code: document.getElementById('platform_code').value,
    description: document.getElementById('platform_description').value,
    platform_type: document.getElementById('platform_type').value,
    pricing_model: document.getElementById('platform_pricing_model').value,
    base_price: parseFloat(document.getElementById('platform_base_price').value) || 0,
    currency: document.getElementById('platform_currency').value || 'USD'
  };

  try {
    const response = await fetch(`${API_BASE_URL}/platforms`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©');

    const result = await response.json();
    alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ© "${result.name}" Ø¨Ù†Ø¬Ø§Ø­!`);
    closeCreatePlatformModal();
    app.loadRoute('hierarchy'); // Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Open Create Office Modal
window.openCreateOfficeModal = function() {
  const modal = document.getElementById('createOfficeModal');
  if (modal) {
    modal.classList.remove('hidden');
    loadBranchesForOffice();
    // Reset the dropdowns
    document.getElementById('office_platform_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>';
    document.getElementById('office_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
  }
};

// Close Create Office Modal
window.closeCreateOfficeModal = function() {
  const modal = document.getElementById('createOfficeModal');
  if (modal) {
    modal.classList.add('hidden');
    document.getElementById('createOfficeForm').reset();
  }
};

// Load branches for office dropdown
async function loadBranchesForOffice() {
  try {
    const response = await fetch(`${API_BASE_URL}/branches`);
    const branches = await response.json();
    const select = document.getElementById('office_branch_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ÙØ±Ø¹ --</option>' +
      branches.map(b => `<option value="${b.id}">${b.name} (${b.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading branches:', error);
  }
}

// Load platforms for office dropdown based on selected branch
async function loadIncubatorsForOfficeByBranch() {
  const branchId = document.getElementById('office_branch_id').value;
  
  if (!branchId) {
    document.getElementById('office_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
    document.getElementById('office_platform_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>';
    return;
  }
  
  try {
    // Get incubators for this branch - using the correct endpoint
    const incResponse = await fetch(`${API_BASE_URL}/branches/${branchId}/incubators`);
    const incubators = await incResponse.json();
    
    const select = document.getElementById('office_incubator_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>' +
      incubators.map(i => `<option value="${i.id}">${i.name}</option>`).join('');
    
    // Load platforms for this branch - using the correct endpoint
    const platResponse = await fetch(`${API_BASE_URL}/branches/${branchId}/platforms`);
    const platforms = await platResponse.json();
    
    const platformSelect = document.getElementById('office_platform_id');
    platformSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>' +
      platforms.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
  } catch (error) {
    console.error('Error loading incubators:', error);
    alert('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª ÙˆØ§Ù„Ù…Ù†ØµØ§Øª: ' + error.message);
  }
}

// Load platforms for office dropdown based on selected incubator
// Shows ALL platforms regardless of the incubator
async function loadPlatformsForOfficeByIncubator() {
  const incubatorId = document.getElementById('office_incubator_id').value;
  
  try {
    // Get ALL platforms
    const response = await fetch(`${API_BASE_URL}/platforms`);
    const platforms = await response.json();
    
    const select = document.getElementById('office_platform_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>' +
      platforms.map(p => `<option value="${p.id}">${p.name} (${p.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading platforms:', error);
  }
}

// Legacy functions kept for backward compatibility
async function loadPlatformsForOfficeByBranch() {
  const branchId = document.getElementById('office_branch_id').value;
  
  if (!branchId) {
    document.getElementById('office_platform_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>';
    document.getElementById('office_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
    return;
  }
  
  try {
    // Get incubators for this branch
    const incResponse = await fetch(`${API_BASE_URL}/branches/${branchId}/incubators`);
    const incubators = await incResponse.json();
    
    // Get all platforms and filter by the incubators in this branch
    const platResponse = await fetch(`${API_BASE_URL}/platforms`);
    const allPlatforms = await platResponse.json();
    
    const incubatorIds = new Set(incubators.map(i => i.id));
    const filteredPlatforms = allPlatforms.filter(p => incubatorIds.has(p.incubator_id));
    
    const select = document.getElementById('office_platform_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØµØ© --</option>' +
      filteredPlatforms.map(p => `<option value="${p.id}">${p.name} (${p.code})</option>`).join('');
    
    // Reset incubator dropdown
    document.getElementById('office_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
  } catch (error) {
    console.error('Error loading platforms:', error);
  }
}

// Load incubators for office dropdown based on selected platform
async function loadIncubatorsForOfficeByPlatform() {
  const platformId = document.getElementById('office_platform_id').value;
  
  if (!platformId) {
    document.getElementById('office_incubator_id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>';
    return;
  }
  
  try {
    // Get incubators for this branch using junction table
    const branchId = document.getElementById('office_branch_id').value;
    const incResponse = await fetch(`${API_BASE_URL}/incubators?branch_id=${branchId}`);
    const incubators = await incResponse.json();
    
    const select = document.getElementById('office_incubator_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>' +
      incubators.map(i => `<option value="${i.id}">${i.name} (${i.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading incubators:', error);
  }
}

// Load incubators for office dropdown (legacy function kept for compatibility)
async function loadIncubatorsForOffice() {
  try {
    const response = await fetch(`${API_BASE_URL}/incubators`);
    const incubators = await response.json();
    const select = document.getElementById('office_incubator_id');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø­Ø§Ø¶Ù†Ø© --</option>' +
      incubators.map(i => `<option value="${i.id}">${i.name} (${i.code})</option>`).join('');
  } catch (error) {
    console.error('Error loading incubators:', error);
  }
}

// Submit Create Office
window.submitCreateOffice = async function() {
  const formData = {
    incubator_id: parseInt(document.getElementById('office_incubator_id').value),
    name: document.getElementById('office_name').value,
    code: document.getElementById('office_code').value,
    description: document.getElementById('office_description').value,
    office_type: document.getElementById('office_type').value,
    location: document.getElementById('office_location').value,
    address: document.getElementById('office_address').value,
    capacity: parseInt(document.getElementById('office_capacity').value) || 0,
    contact_email: document.getElementById('office_email').value,
    contact_phone: document.getElementById('office_phone').value,
    manager_name: document.getElementById('office_manager').value
  };

  try {
    const response = await fetch(`${API_BASE_URL}/offices`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙƒØªØ¨');

    const result = await response.json();
    alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙƒØªØ¨ "${result.name}" Ø¨Ù†Ø¬Ø§Ø­!`);
    closeCreateOfficeModal();
    app.loadRoute('hierarchy'); // Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Load branches watermark on page load
async function loadBranchesWatermark() {
  try {
    const response = await fetch(`${API_BASE_URL}/branches`);
    if (!response.ok) return;
    
    const branches = await response.json();
    const container = document.getElementById('branches-watermark');
    
    if (container && branches && branches.length > 0) {
      container.innerHTML = branches.map(branch => `
        <div class="text-center p-2 border border-slate-200 rounded-lg bg-white/30">
          <p class="text-xs font-bold text-slate-600">${branch.name}</p>
          <p class="text-[10px] text-slate-400">${branch.country || ''}</p>
        </div>
      `).join('');
    }
  } catch (error) {
    console.log('Could not load branches watermark:', error.message);
  }
}

// ========================================
// PAYMENT SYSTEM FUNCTIONS
// ========================================

// 1. Render Enhanced Invoices
const renderInvoicesEnhanced = () => `
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-800">ğŸ§¾ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø°ÙƒÙŠØ©</h1>
        <button onclick="app.openCreateInvoiceModal()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-bold flex items-center gap-2">
            <i class="fas fa-plus"></i> ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-green-100 text-sm">Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</p>
                    <p class="text-3xl font-bold">45</p>
                </div>
                <i class="fas fa-check-circle text-3xl opacity-50"></i>
            </div>
            <p class="text-xs text-green-100 mt-2">â†‘ 12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
        
        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-orange-100 text-sm">Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ</p>
                    <p class="text-3xl font-bold">12</p>
                </div>
                <i class="fas fa-half-circle text-3xl opacity-50"></i>
            </div>
            <p class="text-xs text-orange-100 mt-2">â†‘ 5% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
        
        <div class="bg-gradient-to-br from-red-500 to-red-600 text-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-red-100 text-sm">Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</p>
                    <p class="text-3xl font-bold">8</p>
                </div>
                <i class="fas fa-exclamation-circle text-3xl opacity-50"></i>
            </div>
            <p class="text-xs text-red-100 mt-2">â†‘ 3% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
        
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-blue-100 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</p>
                    <p class="text-2xl font-bold">450,000 Ø±.Ø³</p>
                </div>
                <i class="fas fa-wallet text-3xl opacity-50"></i>
            </div>
            <p class="text-xs text-blue-100 mt-2">â†“ 8% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
        <table class="w-full text-sm">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="text-right p-3 font-bold text-gray-700">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                    <th class="text-right p-3 font-bold text-gray-700">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th class="text-right p-3 font-bold text-gray-700">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th class="text-right p-3 font-bold text-gray-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th class="text-right p-3 font-bold text-gray-700">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                <tr class="hover:bg-gray-50">
                    <td class="p-3">INV-2026-001</td>
                    <td class="p-3">Ø´Ø±ÙƒØ© Ø§Ù„Ù†ÙˆØ±</td>
                    <td class="p-3">45,000 Ø±.Ø³</td>
                    <td class="p-3"><span class="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-bold">Ù…Ø¯ÙÙˆØ¹Ø©</span></td>
                    <td class="p-3">2026-01-10</td>
                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="p-3">INV-2026-002</td>
                    <td class="p-3">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø®Ù„ÙŠØ¬</td>
                    <td class="p-3">75,000 Ø±.Ø³</td>
                    <td class="p-3"><span class="bg-orange-100 text-orange-700 px-3 py-1 rounded text-xs font-bold">Ø¬Ø²Ø¦ÙŠ</span></td>
                    <td class="p-3">2026-01-05</td>
                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="p-3">INV-2026-003</td>
                    <td class="p-3">Ø´Ø±ÙƒØ© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</td>
                    <td class="p-3">120,000 Ø±.Ø³</td>
                    <td class="p-3"><span class="bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-bold">Ù…ØªØ£Ø®Ø±Ø©</span></td>
                    <td class="p-3">2025-12-20</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>`;

// 2. Render Payment Methods
const renderPaymentMethods = () => {
    const db = app.getDb();
    const paymentMethods = db.paymentMethods || [];
    
    const colorClasses = {
        '#3b82f6': 'border-blue-200',
        '#10b981': 'border-green-200',
        '#a855f7': 'border-purple-200',
        '#f59e0b': 'border-orange-200',
        '#ec4899': 'border-pink-200',
        '#6366f1': 'border-indigo-200'
    };
    
    return `
    <div class="space-y-6 animate-fade-in">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                    <i class="fas fa-wallet text-red-600"></i>
                    Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©
                </h1>
                <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
            </div>
            <button onclick="window.open('/manage-payment-methods.html', '_blank')" 
                    class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                <i class="fas fa-plus-circle"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</span>
            </button>
        </div>
        
        <!-- Payment Methods Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${paymentMethods.length > 0 ? paymentMethods.map(method => `
                <div class="bg-white border-2 ${colorClasses[method.color] || 'border-gray-200'} rounded-lg p-6 hover:shadow-lg transition transform hover:scale-105">
                    <div class="text-4xl mb-4">${method.icon || 'ğŸ’³'}</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${method.method_name_ar}</h3>
                    <p class="text-gray-600 mb-4">${method.description_ar || ''}</p>
                    ${method.is_active 
                        ? '<span class="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-bold">Ù…ØªØ§Ø­</span>'
                        : '<span class="bg-gray-100 text-gray-700 px-3 py-1 rounded text-xs font-bold">ØºÙŠØ± Ù…ØªØ§Ø­</span>'
                    }
                </div>
            `).join('') : `
                <div class="col-span-full text-center py-12">
                    <i class="fas fa-wallet text-6xl text-slate-300 mb-4"></i>
                    <p class="text-slate-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…ØªØ§Ø­Ø©</p>
                    <p class="text-slate-400 text-sm mt-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¯Ø§Ø±Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹" Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ø±Ù‚ Ø¬Ø¯ÙŠØ¯Ø©</p>
                </div>
            `}
        </div>
    </div>
`};


// 3. Render Installment Plans
const renderInstallmentPlans = () => {
    const db = app.getDb();
    const plans = db.installmentPlanTypes || [];
    
    return `
    <div class="space-y-6 animate-fade-in">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                    <i class="fas fa-calendar-alt text-blue-600"></i>
                    Ø®Ø·Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                </h1>
                <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø· Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
            </div>
            <button onclick="window.open('/manage-installment-plans.html', '_blank')" 
                    class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                <i class="fas fa-cog"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø·Ø·</span>
            </button>
        </div>
        
        <!-- Plans Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${plans.length > 0 ? plans.map(plan => `
                <div class="bg-gradient-to-br from-slate-50 to-slate-100 border border-slate-300 rounded-lg p-6 hover:shadow-lg transition transform hover:scale-105">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-3xl">${plan.icon || 'ğŸ“…'}</span>
                            <h3 class="text-xl font-bold text-gray-800">${plan.planNameAr}</h3>
                        </div>
                        ${plan.isFeatured ? '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold">â­ Ù…Ù…ÙŠØ²</span>' : ''}
                    </div>
                    ${plan.badgeText ? `<p class="text-gray-600 mb-4">${plan.badgeText}</p>` : ''}
                    ${plan.descriptionAr ? `<p class="text-sm text-gray-600 mb-3">${plan.descriptionAr}</p>` : ''}
                    <div class="text-2xl font-bold text-slate-800 mb-3">${plan.numberOfPayments} Ø¯ÙØ¹Ø§Øª Ù…ØªØ³Ø§ÙˆÙŠØ©</div>
                    <div class="space-y-1 text-sm text-gray-600">
                        <div>ğŸ“… Ø§Ù„Ù…Ø¯Ø©: ${plan.durationMonths} Ø´Ù‡Ø±</div>
                        ${plan.interestRate > 0 ? `<div>ğŸ“Š Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ${plan.interestRate}%</div>` : '<div>âœ“ Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©</div>'}
                        ${plan.earlyPaymentDiscount > 0 ? `<div>ğŸ Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ±: ${plan.earlyPaymentDiscount}%</div>` : ''}
                    </div>
                </div>
            `).join('') : `
                <div class="col-span-full text-center py-12">
                    <i class="fas fa-calendar-alt text-6xl text-slate-300 mb-4"></i>
                    <p class="text-slate-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ§Ø­Ø©</p>
                    <p class="text-slate-400 text-sm mt-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø·Ø·" Ù„Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø· Ø¬Ø¯ÙŠØ¯Ø©</p>
                </div>
            `}
        </div>
    </div>
`};


// 4. Render Tax Settings
const renderTaxSettings = () => {
    const db = app.getDb();
    const taxes = db.taxSettings || [];
    return `
    <div class="space-y-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                    <i class="fas fa-percent text-red-600"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </h1>
                <p class="text-slate-500 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</p>
            </div>
            <button onclick="window.open('/manage-tax-settings.html', '_blank')" 
                    class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                <i class="fas fa-cog"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</span>
            </button>
        </div>
        
        <!-- Taxes Table -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-red-500 to-red-600 text-white">
                        <tr>
                            <th class="px-6 py-4 text-right font-bold">Ø§Ø³Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
                            <th class="px-6 py-4 text-right font-bold">Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="px-6 py-4 text-right font-bold">Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
                            <th class="px-6 py-4 text-right font-bold">Ø§Ù„ÙØ±Ø¹</th>
                            <th class="px-6 py-4 text-right font-bold">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        ${taxes.length > 0 ? taxes.map(tax => {
                            const rate = tax.branchSpecificRate || tax.defaultRate;
                            const branch = tax.branchNameAr || 'Ø¹Ø§Ù…';
                            const statusBadge = tax.isActive 
                                ? '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">âœ… Ù†Ø´Ø·Ø©</span>'
                                : '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">âŒ Ù…Ø¹Ø·Ù„Ø©</span>';
                            
                            return `
                                <tr class="hover:bg-gray-50 transition">
                                    <td class="px-6 py-4">
                                        <div class="font-bold text-gray-800">${tax.taxNameAr}</div>
                                        <div class="text-sm text-gray-500">${tax.taxCode}</div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-bold">${tax.taxType}</span>
                                    </td>
                                    <td class="px-6 py-4 font-bold text-red-600">${rate}%</td>
                                    <td class="px-6 py-4 text-sm text-gray-600">${branch}</td>
                                    <td class="px-6 py-4">${statusBadge}</td>
                                </tr>
                            `;
                        }).join('') : `
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-2"></i>
                                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¶Ø±Ø§Ø¦Ø¨ Ù…ÙØ¹Ù„Ø©</p>
                                    <p class="text-sm mt-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨" Ù„Ø¥Ø¶Ø§ÙØ© Ø¶Ø±Ø§Ø¦Ø¨ Ø¬Ø¯ÙŠØ¯Ø©</p>
                                </td>
                            </tr>
                        `}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
`;
};


// 5. Render Payment Tracking
const renderPaymentTracking = () => `
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">ğŸ“Š ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙØ¹Ø§Øª</h1>
    
    <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Ø­Ø±ÙƒØ© Ø§Ù„Ø¯ÙØ¹Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</h3>
        <p class="text-gray-600">ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¯ÙØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</p>
    </div>
</div>`;

// 6. Render Collection Rules
const renderCollectionRules = () => `
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">âš™ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
    
    <div class="space-y-4">
        <div class="bg-gradient-to-r from-blue-50 to-blue-100 border-l-4 border-blue-500 p-4 rounded">
            <h3 class="font-bold text-blue-900">ğŸ“Œ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„Ø£ÙˆÙ„</h3>
            <p class="text-blue-800 text-sm">Ø¨Ø¹Ø¯ 5 Ø£ÙŠØ§Ù… Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</p>
        </div>
        
        <div class="bg-gradient-to-r from-orange-50 to-orange-100 border-l-4 border-orange-500 p-4 rounded">
            <h3 class="font-bold text-orange-900">ğŸ“Œ Ø§Ù„ØªØµØ¹ÙŠØ¯</h3>
            <p class="text-orange-800 text-sm">Ø¨Ø¹Ø¯ 30 ÙŠÙˆÙ… - Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ</p>
        </div>
        
        <div class="bg-gradient-to-r from-red-50 to-red-100 border-l-4 border-red-500 p-4 rounded">
            <h3 class="font-bold text-red-900">ğŸ“Œ Ø¥Ø¬Ø±Ø§Ø¡ Ù‚Ø§Ù†ÙˆÙ†ÙŠ</h3>
            <p class="text-red-800 text-sm">Ø¨Ø¹Ø¯ 60 ÙŠÙˆÙ… - Ø¥Ø­Ø§Ù„Ø© Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ©</p>
        </div>
        
        <div class="bg-gradient-to-r from-green-50 to-green-100 border-l-4 border-green-500 p-4 rounded">
            <h3 class="font-bold text-green-900">ğŸ’° Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ±</h3>
            <p class="text-green-800 text-sm">Ø®ØµÙ… 3% Ù„Ù„Ø¯ÙØ¹ Ù‚Ø¨Ù„ 7 Ø£ÙŠØ§Ù…</p>
        </div>
    </div>
</div>`;

// 7. Render Payment Reminders
const renderPaymentReminders = () => `
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">ğŸ”” Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ø¢Ù„ÙŠØ©</h1>
    
    <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©</h3>
        <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                <span class="font-semibold text-gray-700">ØªØ°ÙƒÙŠØ±: ÙØ§ØªÙˆØ±Ø© INV-2026-002</span>
                <span class="text-xs bg-blue-200 text-blue-800 px-3 py-1 rounded font-bold">Ù…Ø±Ø³Ù„Ø©</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                <span class="font-semibold text-gray-700">ØªØ°ÙƒÙŠØ±: ÙØ§ØªÙˆØ±Ø© INV-2026-003</span>
                <span class="text-xs bg-yellow-200 text-yellow-800 px-3 py-1 rounded font-bold">Ù…Ø¹Ù„Ù‚Ø©</span>
            </div>
        </div>
    </div>
</div>`;

// 8. Render Overdue Management
const renderOverdueManagement = () => `
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-red-800 font-semibold mb-2">ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª</p>
            <p class="text-3xl font-bold text-red-600">8 ÙÙˆØ§ØªÙŠØ±</p>
            <p class="text-xs text-red-600 mt-2">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 350,000 Ø±.Ø³</p>
        </div>
        
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <p class="text-orange-800 font-semibold mb-2">â° Ù…ØªØ£Ø®Ø±Ø© Ø£Ù‚Ù„ Ù…Ù† 30 ÙŠÙˆÙ…</p>
            <p class="text-3xl font-bold text-orange-600">3 ÙÙˆØ§ØªÙŠØ±</p>
            <p class="text-xs text-orange-600 mt-2">Ø§Ù„Ù…Ø¨Ù„Øº: 120,000 Ø±.Ø³</p>
        </div>
        
        <div class="bg-red-100 border border-red-400 rounded-lg p-4">
            <p class="text-red-900 font-semibold mb-2">ğŸš¨ Ù…ØªØ£Ø®Ø±Ø© Ø£ÙƒØ«Ø± Ù…Ù† 60 ÙŠÙˆÙ…</p>
            <p class="text-3xl font-bold text-red-700">2 ÙÙˆØ§ØªÙŠØ±</p>
            <p class="text-xs text-red-700 mt-2">Ø§Ù„Ù…Ø¨Ù„Øº: 150,000 Ø±.Ø³</p>
        </div>
    </div>
</div>`;

// 9. Render Payment Analytics
const renderPaymentAnalytics = () => `
<div class="space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">ğŸ“ˆ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¯ÙØ¹</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„</h3>
            <div class="text-center">
                <div class="text-5xl font-bold text-green-600">87.5%</div>
                <p class="text-gray-600 mt-2">Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</p>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¯ÙØ¹</h3>
            <div class="text-center">
                <div class="text-5xl font-bold text-blue-600">12 Ø£ÙŠØ§Ù…</div>
                <p class="text-gray-600 mt-2">Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</p>
            </div>
        </div>
    </div>
</div>`;

// ========================================
// DELETE FUNCTIONS
// ========================================

// Delete Branch
window.deleteBranch = async function(branchId, branchName) {
  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹ "${branchName}"ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ø¶Ù†Ø§Øª ÙˆØ§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡.`)) {
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE_URL}/branches/${branchId}`, {
      method: 'DELETE'
    });
    
    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹');
    
    alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹ "${branchName}" Ø¨Ù†Ø¬Ø§Ø­`);
    app.loadRoute('hierarchy');
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Delete Incubator
window.deleteIncubator = async function(incubatorId, incubatorName) {
  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø§Ø¶Ù†Ø© "${incubatorName}"ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§.`)) {
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE_URL}/incubators/${incubatorId}`, {
      method: 'DELETE'
    });
    
    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø§Ø¶Ù†Ø©');
    
    alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø§Ø¶Ù†Ø© "${incubatorName}" Ø¨Ù†Ø¬Ø§Ø­`);
    app.loadRoute('hierarchy');
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Delete Platform
window.deletePlatform = async function(platformId, platformName) {
  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØµØ© "${platformName}"ØŸ`)) {
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE_URL}/platforms/${platformId}`, {
      method: 'DELETE'
    });
    
    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØµØ©');
    
    alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØµØ© "${platformName}" Ø¨Ù†Ø¬Ø§Ø­`);
    app.loadRoute('hierarchy');
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Delete Office
window.deleteOffice = async function(officeId, officeName) {
  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙƒØªØ¨ "${officeName}"ØŸ`)) {
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE_URL}/offices/${officeId}`, {
      method: 'DELETE'
    });
    
    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ÙƒØªØ¨');
    
    alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙƒØªØ¨ "${officeName}" Ø¨Ù†Ø¬Ø§Ø­`);
    app.loadRoute('hierarchy');
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
  }
};

// Load watermark when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    app.init();
    loadBranchesWatermark();
  });
} else {
  app.init();
  loadBranchesWatermark();
}
